<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Fun to Program</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>Fun to Program</h1>
<span id="author">Osamu Aoki</span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This "Fun to Program" is a work in progress.</p></div>
<div class="paragraph"><p>If you find any issue, contact <code>&lt;osamu at debian.org&gt;</code> with a plain ascii
(non-html) mail.</p></div>
<div class="paragraph"><p>Latest public version: <a href="http://people.debian.org/~osamu/fun2prog.html">http://people.debian.org/~osamu/fun2prog.html</a></p></div>
<div class="paragraph"><p>Latest source tree: <a href="http://people.debian.org/~osamu/fun2prog.tar.xz">http://people.debian.org/~osamu/fun2prog.tar.xz</a></p></div>
<div class="paragraph"><p>All contents are licensed as</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.gnu.org/licenses/gpl2.html">GPL2</a> or later and
</p>
</li>
<li>
<p>
<a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a> or later, and
</p>
</li>
<li>
<p>
<a href="http://www.debian.org/misc/bsd.license">modified BSD</a>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>(Pick any one of the licenses as you need if you take any parts of this.  This
is intended to be used for any purposes with least conflicts.)</p></div>
<div class="paragraph"><p>Please note that the quoted part from the <code>ioputs.c</code> source remains in just LGPL (GNU Lesser General Public License).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_what_this_is">What this is</h2>
<div class="sectionbody">
<div class="paragraph"><p>Please consider this as a <strong>note of a self-study student</strong>.</p></div>
<div class="paragraph"><p>This is not mean to be a tutorial document to explain how to program
nor authoritative document by an expert.</p></div>
<div class="paragraph"><p>I recorded how I tried to learn programing basics of the modern large software
packages written in mixed languages using various complicated libraries. I
provide the followings:</p></div>
<div class="ulist"><ul>
<li>
<p>
Learning records of my programing and building binaries.
</p>
</li>
<li>
<p>
URL links to the essential technical information for learning.
</p>
</li>
<li>
<p>
Minimal explanation and many simple examples.
</p>
</li>
<li>
<p>
Some summary list of things to remember.
</p>
</li>
<li>
<p>
Priority on POSIX shell, Python, and C. (on Debian system)
</p>
</li>
</ul></div>
<div class="paragraph"><p>I hope this information is useful to others.</p></div>
<div class="paragraph"><p>If the tailing parts of terminal example lines are dropped to fit within 80
character/line, they are indicated by <code>...</code> at the end of the line. (Or, I
forced them to fit using <code>fold</code> command.)</p></div>
<div class="paragraph"><p>My local user name on this machine is <code>osamu</code>.  You may need to replace it with
your user name.</p></div>
<div class="paragraph"><p>Please be careful about the publication date of reference documents since the
software infrastructure is a moving target and such documentations may be
obsoleted when you read this document.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you find any questionable contents in this document, doubt them.  If
you find errors, let me know.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="_background">Background</h3>
<div class="paragraph"><p>To be a Debian developer, I encounter situations to deal with large software
packages written in a combination of languages such as C, C++, Vala, Python,
Perl, Shell, LaTex, DocBook, &#8230; with specialty cross platform build script
generators such as autotools and cmake.  Their build tools invoke commands such
as <code>./configure</code>, <code>make</code>, <code>gcc</code>, and <code>g++</code>.  These software packages tend to be
linked to many libraries which make them even more complex.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="ulist"><ul>
<li>
<p>
GNOME: <code>gcc</code> + Glib + GTK+ + D-bus + Autoconf + Automake + Autopoint + &#8230;
</p>
</li>
<li>
<p>
KDE: MOC (Metaobject compiler) + <code>g++</code> + Qt (QtCore, QtGui, &#8230;) + D-bus + Cmake + &#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>Even with all these complexities, using these software package just for
backporting is not usually out-of-reach for me as a novice programmer with the
help of well designed packaging tools such as debhelper.  The package build
script can be deceptively simple as the following.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">%:</span>
        dh <span style="color: #009900">$@</span></tt></pre></div></div>
<div class="paragraph"><p>But when I need to tweak something, I get overwhelmed with the complexity.  I
felt I have to practice program building and packaging with simpler case to
understand its fundamentals and to become a better Debian developer.</p></div>
<div class="paragraph"><p>Also, being a maintainer, it is essential to know how debugger works to use it effectively.</p></div>
<div class="paragraph"><p>There are new major technical challenges such as multitarch and fortify of
binary packages which I did not deal in "Debian New Maintainers' Guide".  These
needed to be addressed for newer packages, too.</p></div>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph"><p>I expect readers of this to read the followings first.</p></div>
<div class="ulist"><ul>
<li>
<p>
Debian system: <a href="http://www.debian.org/doc/manuals/debian-reference/">Debian Reference</a>
</p>
</li>
<li>
<p>
Debian packaging: <a href="http://www.debian.org/doc/manuals/maint-guide/">Debian New Maintainers' Guide</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>I have browsed through tutorial contents of these documents &#8230; so I expect you to do the same.</p></div>
<div class="ulist"><ul>
<li>
<p>
Unix system: <a href="http://cm.bell-labs.com/cm/cs/upe/">The Unix Programming Environment</a> (Brian W. Kernighan and Rob Pike. Prentice Hall, Inc., 1984. )
</p>
</li>
<li>
<p>
POSIX shell: <a href="http://tldp.org/LDP/abs/html/">Advanced Bash-Scripting Guide</a>
</p>
</li>
<li>
<p>
C Language:
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://cm.bell-labs.com/cm/cs/cbook/">The C Programming Language</a> (2nd ed., Brian W. Kernighan, Dennis M. Ritchie Prentice Hall.)
</p>
</li>
<li>
<p>
Gccintro package containing "Introduction to GCC by Brian J. Gough": <code>apt-get install gccintro</code> (non-free GFDL package)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Python:
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.python.org/">http://www.python.org/</a> and <a href="http://docs.python.org/tutorial/">The Python Tutorial</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Vala: <a href="https://live.gnome.org/Vala">Vala</a> and <a href="https://live.gnome.org/Vala/Tutorial">Vala Tutorial</a>
</p>
</li>
<li>
<p>
Lua: <a href="http://www.lua.org/">http://www.lua.org/</a> and  <a href="http://www.lua.org/pil/">Programming in Lua</a>
</p>
</li>
<li>
<p>
Perl: <a href="http://www.perl.org/">http://www.perl.org/</a> and <a href="http://perldoc.perl.org/index-tutorials.html">Perl Tutorials</a>
</p>
</li>
<li>
<p>
Devhelp package: <code>apt-get install devhelp</code> with recommended packages.
</p>
<div class="ulist"><ul>
<li>
<p>
libglib2.0-doc: Documentation files for the GLib library
</p>
</li>
<li>
<p>
libgtk2.0-doc: Documentation for the GTK+2 graphical user interface library (tutorial included)
</p>
</li>
<li>
<p>
libgtk-3-doc: Documentation for the GTK+3 graphical user interface library
</p>
</li>
<li>
<p>
libpango1.0-doc: Documentation files for the Pango
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Also, I recently found on-line textbooks from <a href="http://www.greenteapress.com/">Green Tea Press</a>.  They are very informative.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.greenteapress.com/thinkpython/thinkpython.html">Think Python: How to Think Like a Computer Scientist</a> by Allen B. Downey
</p>
</li>
<li>
<p>
<a href="http://www.greenteapress.com/thinkapjava/index.html">Think Java: How to Think Like a Computer Scientist</a> by Allen B. Downey
</p>
</li>
<li>
<p>
<a href="http://www.greenteapress.com/thinkcpp/index.html">How to Think Like a Computer Scientist - <em>C++-Version</em> (PDF)</a> by Allen B. Downey
</p>
</li>
<li>
<p>
<a href="http://prof.beuth-hochschule.de/scheffler/lehre/programmieren-in-c/">How to Think Like a Computer Scientist - <em>C-Version</em> (PDF)</a> by Allen B. Downey (C-Version by Thomas Scheffler)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here are extra sources of information &#8230;</p></div>
<div class="ulist"><ul>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/C_(programming_language)">C (programming language)</a>
</p>
</li>
<li>
<p>
Wikibook: <a href="http://en.wikibooks.org/wiki/C_Programming">C Programming</a>
</p>
</li>
<li>
<p>
Slightly outdated: <a href="http://www.iu.hio.no/~mark/CTutorial/">C Programming Tutorial (K&amp;R version 4)</a>
</p>
</li>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/Bourne_shell">Bourne shell</a>
</p>
</li>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/Python_(programming_language)">Python</a>
</p>
</li>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/Vala_(programming_language)">Vala</a>
</p>
</li>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/Lua_(programming_language)">Lua</a>
</p>
</li>
<li>
<p>
Wikipedia: <a href="http://en.wikipedia.org/wiki/Perl">Perl</a>
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Install all dependency packages of devscripts, vim, lua, python, python3, perl, vala, swig, git, manpages-dev, devhelp, &#8230;</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hello_world">"Hello World!"</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are example code snippets to print "Hello World!" and
somethings we should be aware of for each language.</p></div>
<div class="sect2">
<h3 id="_shell">Shell</h3>
<div class="paragraph"><p>The most basic programing language: Shell.</p></div>
<div class="ulist"><ul>
<li>
<p>
Interpreter (slow)
</p>
</li>
<li>
<p>
Easy to write a small program.
</p>
</li>
<li>
<p>
Not easy to write a big program.
</p>
</li>
<li>
<p>
Test code snippet under the normal console (or by "<code>sh -i</code>").
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code for the hello shell script</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># my first shell program</span></span>
echo <span style="color: #FF0000">"Hello, world!"</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution of the hello shell script</div>
<div class="content">
<pre><code>$ ls -l ./hello
-rwxr-xr-x 1 osamu osamu 56 Mar 11  2013 ./hello
$ file ./hello
./hello: POSIX shell script, ASCII text executable
$ ./hello
Hello, world!</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Here, the interactive shell to be Bash and the non-interactive shell to be Dash unless explicitly mentioned.  They are POSIX shell.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_python">Python</h3>
<div class="ulist"><ul>
<li>
<p>
Interpreter (with fast JIT compiler)
</p>
</li>
<li>
<p>
One of the most versatile language.
</p>
</li>
<li>
<p>
Guide you to write readable program.
</p>
</li>
<li>
<p>
Good for dynamic data.
</p>
</li>
<li>
<p>
Test code snippet under the console provided by "<code>python3</code>".
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code for the hello Python script (simple)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># My first Python program (bare bones)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Python programs are usually written as follows:</p></div>
<div class="listingblock">
<div class="title">Source code for the hello Python script (with <code>__name__</code>)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># My first Python program (nicer style)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!"</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>If you use wish to ensure to use the Python interpreter offered by the Debian
system, the starting line should use as follows.</p></div>
<div class="listingblock">
<div class="title">Source code for the hello Python script (force the Python interpreter offered by the Debian system)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!"</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution of the hello Python script</div>
<div class="content">
<pre><code>$ ls -l ./hello
-rwxr-xr-x 1 osamu osamu 99 Mar 11  2013 ./hello
$ file ./hello
./hello: Python script, ASCII text executable
$ ./hello
Hello, world!</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lua">Lua</h3>
<div class="ulist"><ul>
<li>
<p>
Interpreter
</p>
</li>
<li>
<p>
Small but very versatile.
</p>
</li>
<li>
<p>
Good for embedding into C/C++.
</p>
</li>
<li>
<p>
Good for dynamic data.
</p>
</li>
<li>
<p>
Test code snippet under the console provided by "<code>lua</code>".
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code for the hello Lua script</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>lua
<span style="font-style: italic"><span style="color: #9A1900">-- my first lua program --</span></span>
<span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution of the hello Lua script</div>
<div class="content">
<pre><code>$ ls -l ./hello
-rwxr-xr-x 1 osamu osamu 65 Mar 11  2013 ./hello
$ file ./hello
./hello: Lua script, ASCII text executable
$ ./hello
Hello, world!</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_perl">Perl</h3>
<div class="ulist"><ul>
<li>
<p>
Interpreter (with fast JIT compiler)
</p>
</li>
<li>
<p>
One of the most versatile language with history.
</p>
</li>
<li>
<p>
Without discipline, you can write mess.
</p>
</li>
<li>
<p>
Good for dynamic data.
</p>
</li>
<li>
<p>
Test code snippet under the console provided by "<code>perl -d -e 1</code>".
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code for the hello Perl script</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/perl</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># my first python program</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!\n"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution of the hello Perl script</div>
<div class="content">
<pre><code>$ ls -l ./hello
-rwxr-xr-x 1 osamu osamu 68 Mar 11  2013 ./hello
$ file ./hello
./hello: Perl script, ASCII text executable
$ ./hello
Hello, world!</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c">C</h3>
<div class="ulist"><ul>
<li>
<p>
Super fast binary (Compiler)
</p>
</li>
<li>
<p>
Very versatile.
</p>
</li>
<li>
<p>
Not so easy for dynamic data without special libraries.
</p>
</li>
<li>
<p>
You need to compile code to test it.
</p>
</li>
<li>
<p>
ABI compatibility issue is less complex.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code in C language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-style: italic"><span style="color: #9A1900">/* my first C program */</span></span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Here, I need to include header files:</p></div>
<div class="ulist"><ul>
<li>
<p>
"<code>#include &lt;stdio.h&gt;</code>" for <code>printf</code>.
</p>
</li>
<li>
<p>
"<code>#include &lt;stdlib.h&gt;</code>" for <code>EXIT_SUCCESS</code>. (<code>EXIT_SUCCESS = 0</code>)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s compile hello.c to create the ELF object <code>hello</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ls -l ./hello
-rwxrwxr-x 1 osamu osamu 6696 Aug 20 23:23 ./hello
$ file ./hello
./hello: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked
, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=2
1d6168f6909d2c2ea3ca54ae75a1cbc0dd5f8fd, not stripped
$ ./hello
Hello, world!</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s list linked libraries to the ELF object <code>hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>    linux-vdso.so.1 (0x00007ffe1abda000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffb34cf4000)
    /lib64/ld-linux-x86-64.so.2 (0x00007ffb3509d000)</code></pre>
</div></div>
<div class="paragraph"><p>Here, notable libraries are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>linux-vdso.so.1</code> : Linux Virtual Dynamic Shared Object
</p>
</li>
<li>
<p>
<code>libc.so.6</code> : The GNU C Library (glibc)
</p>
</li>
<li>
<p>
<code>/lib64/ld-linux-x86-64.so.2</code> :  dynamic linker/loader
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s list symbols defined in the ELF object <code>hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>                 w __gmon_start__
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
                 w _Jv_RegisterClasses
                 U __libc_start_main@@GLIBC_2.2.5
                 U puts@@GLIBC_2.2.5
00000000004003a8 T _init
0000000000400410 T _start
0000000000400440 t deregister_tm_clones
0000000000400480 t register_tm_clones
00000000004004c0 t __do_global_dtors_aux
00000000004004e0 t frame_dummy
0000000000400506 T main
0000000000400520 T __libc_csu_init
0000000000400590 T __libc_csu_fini
0000000000400594 T _fini
00000000004005a0 R _IO_stdin_used
00000000004006d8 r __FRAME_END__
00000000006006e0 t __frame_dummy_init_array_entry
00000000006006e0 t __init_array_start
00000000006006e8 t __do_global_dtors_aux_fini_array_entry
00000000006006e8 t __init_array_end
00000000006006f0 d __JCR_END__
00000000006006f0 d __JCR_LIST__
00000000006006f8 d _DYNAMIC
00000000006008d0 d _GLOBAL_OFFSET_TABLE_
0000000000600900 D __data_start
0000000000600900 W data_start
0000000000600908 D __dso_handle
0000000000600910 B __bss_start
0000000000600910 b completed.6661
0000000000600910 D _edata
0000000000600910 D __TMC_END__
0000000000600918 B _end</code></pre>
</div></div>
<div class="paragraph"><p>Here, symbol types are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>A</code> : value is absolute
</p>
</li>
<li>
<p>
<code>b</code> : uninitialized data (local)
</p>
</li>
<li>
<p>
<code>D</code> : initialized data (global)
</p>
</li>
<li>
<p>
<code>d</code> : initialized data (local)
</p>
</li>
<li>
<p>
<code>R</code> : read only data (global)
</p>
</li>
<li>
<p>
<code>r</code> : read only data (local)
</p>
</li>
<li>
<p>
<code>T</code> : text (code) section (global)
</p>
</li>
<li>
<p>
<code>t</code> : text (code) section (local)
</p>
</li>
<li>
<p>
<code>U</code> : undefined
</p>
</li>
<li>
<p>
<code>w</code> : weak symbol
</p>
</li>
<li>
<p>
<code>W</code> : weak symbol
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s look into how <code>hello.c</code> is compiled by stopping before the assembler by creating assembler code as <code>hello.s</code> with the <code>-S</code> option.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat hello.s
    .file    "hello.c"
    .section    .rodata
.LC0:
    .string    "Hello, world!"
    .text
    .globl    main
    .type    main, @function
main:
.LFB2:
    .cfi_startproc
    pushq    %rbp
    .cfi_def_cfa_offset 16
    .cfi_offset 6, -16
    movq    %rsp, %rbp
    .cfi_def_cfa_register 6
    movl    $.LC0, %edi
    call    puts
    movl    $0, %eax
    popq    %rbp
    .cfi_def_cfa 7, 8
    ret
    .cfi_endproc
.LFE2:
    .size    main, .-main
    .ident    "GCC: (Debian 4.9.2-10) 4.9.2"
    .section    .note.GNU-stack,"",@progbits</code></pre>
</div></div>
<div class="paragraph"><p>Please note this is written in the AT&amp;T assembler style. We will get back to
its details later.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Several lines with <code>.cfi_...</code> in the assembler code are the <a href="http://en.wikipedia.org/wiki/DWARF">DWARF</a> CFI directives which help debugger to do backtrace on the modern ABI system without frame pointers (FP). See <a href="http://www.logix.cz/michal/devel/gas-cfi/">CFI support for GNU assembler (GAS)</a>.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_c_2">C++</h3>
<div class="ulist"><ul>
<li>
<p>
Super fast binary (Compiler)
</p>
</li>
<li>
<p>
Very versatile.
</p>
</li>
<li>
<p>
Good for dynamic data.
</p>
</li>
<li>
<p>
You need to compile code to test it.
</p>
</li>
<li>
<p>
ABI compatibility issue is more complex.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Source code in C++ language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-style: italic"><span style="color: #9A1900">//  my first C++ program</span></span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    using <span style="color: #008080">namespace</span> std<span style="color: #990000">;</span>
    cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Hello World!"</span> <span style="color: #990000">&lt;&lt;</span> endl<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>hello.cxx</code> to create the ELF object <code>hello</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ls -l ./hello
-rwxrwxr-x 1 osamu osamu 8376 Aug 20 23:23 ./hello
$ file ./hello
./hello: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked,...
$ ./hello
Hello World!</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s list linked libraries to the ELF object <code>hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>    linux-vdso.so.1 (0x00007fff0ff17000)
    libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fcfdaf8100...
    libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fcfdac80000)
    libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fcfdaa6a000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fcfda6c1000)
    /lib64/ld-linux-x86-64.so.2 (0x00007fcfdb28c000)</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<code>linux-vdso.so.1</code> : Linux Virtual Dynamic Shared Object
</p>
</li>
<li>
<p>
<code>libstdc++.so.6</code> : The GNU Standard C++ Library
</p>
</li>
<li>
<p>
<code>libm.so.6</code> : The GNU C Library (glibc, support math functions)
</p>
</li>
<li>
<p>
<code>libgcc_s.so.1</code> : The runtime library of GCC
</p>
</li>
<li>
<p>
<code>libc.so.6</code> : The GNU C Library (glibc)
</p>
</li>
<li>
<p>
<code>/lib64/ld-linux-x86-64.so.2</code> :  dynamic linker/loader
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s list symbols defined in the ELF object <code>hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>                 U __cxa_atexit@@GLIBC_2.2.5
                 w __gmon_start__
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
                 w _Jv_RegisterClasses
                 U __libc_start_main@@GLIBC_2.2.5
                 U _ZNSolsEPFRSoS_E@@GLIBCXX_3.4
                 U _ZNSt8ios_base4InitC1Ev@@GLIBCXX_3.4
                 U _ZNSt8ios_base4InitD1Ev@@GLIBCXX_3.4
                 U _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_@@GL...
                 U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@@GLIBC...
0000000000400698 T _init
0000000000400750 T _start
0000000000400780 t deregister_tm_clones
00000000004007c0 t register_tm_clones
0000000000400800 t __do_global_dtors_aux
0000000000400820 t frame_dummy
0000000000400846 T main
000000000040086d t _Z41__static_initialization_and_destruction_0ii
00000000004008aa t _GLOBAL__sub_I_main
00000000004008c0 T __libc_csu_init
0000000000400930 T __libc_csu_fini
0000000000400934 T _fini
0000000000400940 R _IO_stdin_used
0000000000400ac8 r __FRAME_END__
0000000000600ad0 t __frame_dummy_init_array_entry
0000000000600ad0 t __init_array_start
0000000000600ae0 t __do_global_dtors_aux_fini_array_entry
0000000000600ae0 t __init_array_end
0000000000600ae8 d __JCR_END__
0000000000600ae8 d __JCR_LIST__
0000000000600af0 d _DYNAMIC
0000000000600cf8 d _GLOBAL_OFFSET_TABLE_
0000000000600d50 D __data_start
0000000000600d50 W data_start
0000000000600d58 D __dso_handle
0000000000600d60 B __bss_start
0000000000600d60 D _edata
0000000000600d60 D __TMC_END__
0000000000600d80 B _ZSt4cout@@GLIBCXX_3.4
0000000000600e90 b completed.6661
0000000000600e91 b _ZStL8__ioinit
0000000000600e98 B _end</code></pre>
</div></div>
<div class="paragraph"><p>There are many symbols starting with <code>_Z</code>.  These are mangled symbols.  We need
to demangle these symbol with <code>c++filt</code> to make this readable.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>                 U __cxa_atexit@@GLIBC_2.2.5
                 w __gmon_start__
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
                 w _Jv_RegisterClasses
                 U __libc_start_main@@GLIBC_2.2.5
                 U std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;::operator&lt;&lt;
(std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; (*)(std::basic_ostream&lt;char,
 std::char_traits&lt;char&gt; &gt;&amp;))@@GLIBCXX_3.4
                 U std::ios_base::Init::Init()@@GLIBCXX_3.4
                 U std::ios_base::Init::~Init()@@GLIBCXX_3.4
                 U std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; std::endl&lt;
char, std::char_traits&lt;char&gt; &gt;(std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;
&amp;)@@GLIBCXX_3.4
                 U std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; std::opera
tor&lt;&lt; &lt;std::char_traits&lt;char&gt; &gt;(std::basic_ostream&lt;char, std::char_traits&lt;char&gt;
&gt;&amp;, char const*)@@GLIBCXX_3.4
0000000000400698 T _init
0000000000400750 T _start
0000000000400780 t deregister_tm_clones
00000000004007c0 t register_tm_clones
0000000000400800 t __do_global_dtors_aux
0000000000400820 t frame_dummy
0000000000400846 T main
000000000040086d t __static_initialization_and_destruction_0(int, int)
00000000004008aa t _GLOBAL__sub_I_main
00000000004008c0 T __libc_csu_init
0000000000400930 T __libc_csu_fini
0000000000400934 T _fini
0000000000400940 R _IO_stdin_used
0000000000400ac8 r __FRAME_END__
0000000000600ad0 t __frame_dummy_init_array_entry
0000000000600ad0 t __init_array_start
0000000000600ae0 t __do_global_dtors_aux_fini_array_entry
0000000000600ae0 t __init_array_end
0000000000600ae8 d __JCR_END__
0000000000600ae8 d __JCR_LIST__
0000000000600af0 d _DYNAMIC
0000000000600cf8 d _GLOBAL_OFFSET_TABLE_
0000000000600d50 D __data_start
0000000000600d50 W data_start
0000000000600d58 D __dso_handle
0000000000600d60 B __bss_start
0000000000600d60 D _edata
0000000000600d60 D __TMC_END__
0000000000600d80 B std::cout@@GLIBCXX_3.4
0000000000600e90 b completed.6661
0000000000600e91 b std::__ioinit
0000000000600e98 B _end</code></pre>
</div></div>
<div class="paragraph"><p>Although the source code for both C and C++ are as simple,
C++ creates more complicated code linked to more libraries
with mangled symbols.</p></div>
<div class="paragraph"><p>Let&#8217;s look into how <code>hello.cxx</code> is compiled by stopping before the assembler
by creating assembler code with the <code>-S</code> option and demangling it
with <code>c++filt -n</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ c++filt -n &lt;hello.s |fold
    .file    "hello.cxx"
    .local    std::__ioinit
    .comm    std::__ioinit,1,1
    .section    .rodata
.LC0:
    .string    "Hello World!"
    .text
    .globl    main
    .type    main, @function
main:
.LFB1020:
    .cfi_startproc
    pushq    %rbp
    .cfi_def_cfa_offset 16
    .cfi_offset 6, -16
    movq    %rsp, %rbp
    .cfi_def_cfa_register 6
    movl    $.LC0, %esi
    movl    std::cout, %edi
    call    std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; std::operator
&lt;&lt; &lt;std::char_traits&lt;char&gt; &gt;(std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp;,
 char const*)
    movl    std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; std::endl&lt;cha
r, std::char_traits&lt;char&gt; &gt;(std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp;),
 %esi
    movq    %rax, %rdi
    call    std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;::operator&lt;&lt;(st
d::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; (*)(std::basic_ostream&lt;char, st
d::char_traits&lt;char&gt; &gt;&amp;))
    movl    $0, %eax
    popq    %rbp
    .cfi_def_cfa 7, 8
    ret
    .cfi_endproc
.LFE1020:
    .size    main, .-main
    .type    __static_initialization_and_destruction_0(int, int), @function
__static_initialization_and_destruction_0(int, int):
.LFB1029:
    .cfi_startproc
    pushq    %rbp
    .cfi_def_cfa_offset 16
    .cfi_offset 6, -16
    movq    %rsp, %rbp
    .cfi_def_cfa_register 6
    subq    $16, %rsp
    movl    %edi, -4(%rbp)
    movl    %esi, -8(%rbp)
    cmpl    $1, -4(%rbp)
    jne    .L3
    cmpl    $65535, -8(%rbp)
    jne    .L3
    movl    std::__ioinit, %edi
    call    std::ios_base::Init::Init()
    movl    $__dso_handle, %edx
    movl    std::__ioinit, %esi
    movl    std::ios_base::Init::~Init(), %edi
    call    __cxa_atexit
.L3:
    leave
    .cfi_def_cfa 7, 8
    ret
    .cfi_endproc
.LFE1029:
    .size    __static_initialization_and_destruction_0(int, int), .-__static_
initialization_and_destruction_0(int, int)
    .type    _GLOBAL__sub_I_main, @function
_GLOBAL__sub_I_main:
.LFB1030:
    .cfi_startproc
    pushq    %rbp
    .cfi_def_cfa_offset 16
    .cfi_offset 6, -16
    movq    %rsp, %rbp
    .cfi_def_cfa_register 6
    movl    $65535, %esi
    movl    $1, %edi
    call    __static_initialization_and_destruction_0(int, int)
    popq    %rbp
    .cfi_def_cfa 7, 8
    ret
    .cfi_endproc
.LFE1030:
    .size    _GLOBAL__sub_I_main, .-_GLOBAL__sub_I_main
    .section    .init_array,"aw"
    .align 8
    .quad    _GLOBAL__sub_I_main
    .hidden    __dso_handle
    .ident    "GCC: (Debian 4.9.2-10) 4.9.2"
    .section    .note.GNU-stack,"",@progbits</code></pre>
</div></div>
<div class="paragraph"><p>For more on C++ ABI issues, see:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://techbase.kde.org/Policies/Binary_Compatibility_Issues_With_C++">Policies/Binary Compatibility Issues With C++</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_vala">Vala</h3>
<div class="ulist"><ul>
<li>
<p>
C#, Java like source code
</p>
</li>
<li>
<p>
Super fast binary (C compiler as its backend, no byte code interpreter)
</p>
</li>
<li>
<p>
Easy support for GLib and GObject.
</p>
</li>
<li>
<p>
Good for dynamic data.
</p>
</li>
<li>
<p>
Automatic memory management.
</p>
</li>
<li>
<p>
You need to compile code to test it.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_simple_non_oop_style_no_class">Simple non-OOP style (no class)</h4>
<div class="listingblock">
<div class="title">Source code <code>hello-1.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>hello-1.vala</code> to create the ELF object <code>hello-1</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/hello-1' '/path/to/vala/hello-1.vala.c' -I/usr/include/glib-...
$ ./hello-1
Hello, world!</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
<span style="color: #993399">4</span> hello<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala
<span style="color: #993399">35</span> hello<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> hello<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
<span style="font-style: italic"><span style="color: #9A1900">/* hello-1.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from hello-1.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>




<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>Since no OOP techniques are used, the resulting C code is logically as simple as
the Vala code except for some <code>#include</code> directives to pertinent libraries automatically
included for the Vala code.</p></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_outside_of_class">OOP style (main outside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>hello-2.vala</code> in the Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> GLib<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Demo</span><span style="color: #990000">.</span>HelloWorld <span style="color: #990000">:</span> GLib<span style="color: #990000">.</span>Object <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">var</span> obj <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Demo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
    obj<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Since the use of <code>GLib</code> for the parent class is the default for Vala, the
line of <code>using GLib;</code> and the prefix of <code>GLib.</code> in the above example may be
dropped as an exception.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>hello-2.vala</code> to create the ELF object <code>hello-2</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/hello-2' '/path/to/vala/hello-2.vala.c' -I/usr/include/glib-...
$ ./hello-2
Hello, world!</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
<span style="color: #993399">13</span> hello<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala
<span style="color: #993399">111</span> hello<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> hello<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c<span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/      /    /g'</span><span style="color: #990000">|</span>fold # tab <span style="color: #990000">=&gt;</span> <span style="color: #993399">4</span> spaces
<span style="font-style: italic"><span style="color: #9A1900">/* hello-2.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from hello-2.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_TYPE_HELL
O_WORLD<span style="color: #990000">,</span> DemoHelloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> DEMO_TY
PE_HELLO_WORLD<span style="color: #990000">,</span> DemoHelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_TYPE_H
ELLO_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> DEMO
_TYPE_HELLO_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_
TYPE_HELLO_WORLD<span style="color: #990000">,</span> DemoHelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorld</span> DemoHelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldClass</span> DemoHelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldPrivate</span> DemoHelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    DemoHelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> demo_hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    DEMO_HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    DemoHelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span>DEMO_TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_class_init</span></span> <span style="color: #990000">(</span>DemoHelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    demo_hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_instance_init</span></span> <span style="color: #990000">(</span>DemoHelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> demo_hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>demo_hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>DemoHelloWorldClas
s<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> demo_hello_
world_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>
GInstanceInitFunc<span style="color: #990000">)</span> demo_hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> demo_hello_world_type_id<span style="color: #990000">;</span>
        demo_hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"DemoH</span>
<span style="color: #FF0000">elloWorld"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>demo_hello_world_type_id__volatile<span style="color: #990000">,</span> demo_hello_world
_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> demo_hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    DemoHelloWorld<span style="color: #990000">*</span> obj <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    DemoHelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">();</span>
    obj <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious Vala code is much shorter than C.</p></div>
<div class="paragraph"><p>The Vala class definition of <code>Demo.HelloWorld</code> subclassed from <code>GLib.Object</code>
are converted into the C code defining GObject with many macros.  These C code
macros are cliches to use GLib and GObject in C.  The Vala compiler takes care
these chores for you.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>demo</code>, <code>DEMO</code>, <code>Demo</code>: prefix taken from library or application name
</p>
</li>
<li>
<p>
<code>hello_world</code>, <code>HELLO_WORLD</code>, <code>HelloWorld</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>demo_hello_world_get_type()</code>: returning GType of object HELLO_WORLD defined in DEMO
</p>
</li>
</ul></div>
<div class="paragraph"><p>The instantiation of the <code>obj</code> object by the Vala <code>new</code> expression is converted
into the C <code>demo_hello_world_new()</code> function which in turn calls the C
<code>demo_hello_world_construct()</code> function.  The dynamic memory management by the
reference counting in the GLib is used to assign memory to the <code>obj</code> object.</p></div>
<div class="paragraph"><p>The Vala also adds a wrapper macro <code>_g_object_unref0(obj)</code> to the C code which
is required to free memory properly for the <code>obj</code> object.</p></div>
<div class="paragraph"><p>In general, these macro cliches of GObject are defined as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_TYPE_BAR</span></span>            <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">foo_bar_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_BAR</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>            <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> <span style="color: #990000">\</span>
                                FOO_TYPE_BAR<span style="color: #990000">,</span> FooBar<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_BAR_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span>    <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span>  <span style="color: #990000">\</span>
                                FOO_TYPE_BAR<span style="color: #990000">,</span> FooBarClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_IS_BAR</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>         <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> <span style="color: #990000">\</span>
                                FOO_TYPE_BAR<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_IS_BAR_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span>  <span style="color: #990000">\</span>
                                FOO_TYPE_BAR<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">FOO_BAR_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>  <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span>  <span style="color: #990000">\</span>
                                FOO_TYPE_BAR<span style="color: #990000">,</span> FooBarClass<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Here:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>foo</code>, <code>FOO</code>, <code>Foo</code>: prefix taken from library or application name (Optional)
</p>
</li>
<li>
<p>
<code>bar</code>, <code>BAR</code>, <code>Bar</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>foo_bar_get_type()</code>: returning GType of object BAR defined in FOO
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_inside_of_class">OOP style (main inside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>hello-3.vala</code> in the Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> GLib<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Demo</span><span style="color: #990000">.</span>HelloWorld <span style="color: #990000">:</span> GLib<span style="color: #990000">.</span>Object <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">var</span> obj <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Demo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
        obj<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Since the use of <code>GLib</code> for the parent class is the default for Vala, the
line of <code>using GLib;</code> and the prefix of <code>GLib.</code> in the above example may be
dropped as an exception.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>hello-3.vala</code> to create the ELF object <code>hello-3</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/hello-3' '/path/to/vala/hello-3.vala.c' -I/usr/include/glib-...
$ ./hello-3
Hello, world!</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> hello<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
<span style="color: #993399">13</span> hello<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala
<span style="color: #993399">111</span> hello<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> hello<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c<span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/      /    /g'</span><span style="color: #990000">|</span>fold # tab <span style="color: #990000">=&gt;</span> <span style="color: #993399">4</span> spaces
<span style="font-style: italic"><span style="color: #9A1900">/* hello-3.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from hello-3.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_TYPE_HELL
O_WORLD<span style="color: #990000">,</span> DemoHelloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> DEMO_TY
PE_HELLO_WORLD<span style="color: #990000">,</span> DemoHelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_TYPE_H
ELLO_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> DEMO
_TYPE_HELLO_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">DEMO_HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> DEMO_
TYPE_HELLO_WORLD<span style="color: #990000">,</span> DemoHelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorld</span> DemoHelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldClass</span> DemoHelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldPrivate</span> DemoHelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    DemoHelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_DemoHelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> demo_hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    DEMO_HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"Hello, world!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    DemoHelloWorld<span style="color: #990000">*</span> obj <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    DemoHelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">();</span>
    obj <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_hello</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    DemoHelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


DemoHelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_construct</span></span> <span style="color: #990000">(</span>DEMO_TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_class_init</span></span> <span style="color: #990000">(</span>DemoHelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    demo_hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_instance_init</span></span> <span style="color: #990000">(</span>DemoHelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">demo_hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> demo_hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>demo_hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>DemoHelloWorldClas
s<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> demo_hello_
world_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>DemoHelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>
GInstanceInitFunc<span style="color: #990000">)</span> demo_hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> demo_hello_world_type_id<span style="color: #990000">;</span>
        demo_hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"DemoH</span>
<span style="color: #FF0000">elloWorld"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>demo_hello_world_type_id__volatile<span style="color: #990000">,</span> demo_hello_world
_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> demo_hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious Vala code is much shorter than C.  Many CPP macros are defined
here, too.  These are cliches to use GLib and GObject in C.  The Vala compiler takes care
these chores for you.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>demo</code>, <code>DEMO</code>, <code>Demo</code>: prefix taken from library or application name
</p>
</li>
<li>
<p>
<code>hello_world</code>, <code>HELLO_WORLD</code>, <code>HelloWorld</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>demo_hello_world_get_type()</code>: returning GType of object HELLO_WORLD defined in DEMO
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cli_programs">CLI programs</h2>
<div class="sectionbody">
<div class="paragraph"><p>The command line interface (CLI) program requires to parse its command line
arguments.  Here are simple example code snippets.</p></div>
<div class="paragraph"><p>Please note I chose the coding style which is the most legible for each
language.  I know there are other ways &#8230;</p></div>
<div class="sect2">
<h3 id="_shell_2">Shell</h3>
<div class="sect3">
<h4 id="_shell_script_short_option_only">Shell script (short option only)</h4>
<div class="paragraph"><p>Shell program with short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for the shell script: cli_s</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="color: #009900">verbose</span><span style="color: #990000">=</span><span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="font-weight: bold"><span style="color: #0000FF">getopts</span></span> <span style="color: #FF0000">"af:v"</span> opt <span style="color: #990000">;</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #009900">$opt</span> <span style="font-weight: bold"><span style="color: #0000FF">in</span></span>
    a<span style="color: #990000">)</span>  echo <span style="color: #FF0000">"Option a"</span>
        <span style="color: #990000">;;</span>
    f<span style="color: #990000">)</span>  cat <span style="color: #FF0000">"$OPTARG"</span>
        <span style="color: #990000">;;</span>
    v<span style="color: #990000">)</span>  <span style="color: #009900">verbose</span><span style="color: #990000">=</span><span style="color: #993399">1</span>
        <span style="color: #990000">;;</span>
    -<span style="color: #990000">)</span>  <span style="font-weight: bold"><span style="color: #0000FF">break</span></span>
        <span style="color: #990000">;;</span>
    <span style="color: #990000">?)</span>  echo <span style="color: #FF0000">"Usage: $0: [-a] [-v] [-f file] args ..."</span>
        <span style="font-weight: bold"><span style="color: #0000FF">exit</span></span> <span style="color: #993399">1</span>
        <span style="color: #990000">;;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">esac</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">done</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">shift</span></span> <span style="color: #009900">$(</span><span style="color: #990000">(</span><span style="color: #009900">$OPTIND</span> - <span style="color: #993399">1</span><span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">printf</span></span> <span style="color: #FF0000">"Remaining arguments are: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span> <span style="color: #FF0000">"$*"</span>
</tt></pre></div></div>
<div class="paragraph"><p>Please note shell variables are used.</p></div>
<div class="ulist"><ul>
<li>
<p>
OPTARG : option argument
</p>
</li>
<li>
<p>
OPTIND : index of the next element to be processed
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">No long option like "<code>--file ...</code>".</td>
</tr></table>
</div>
<div class="paragraph"><p>The POSIX <code>getopts</code> is available as a shell buildin command of BASH/DASH.
(Please note <code>s</code> at the end. The older Bell Labs derived external command is
called <code>getopt</code>.)</p></div>
</div>
<div class="sect3">
<h4 id="_shell_script_long_and_short_option">Shell script (long and short option)</h4>
<div class="paragraph"><p>Shell program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for the shell script: cli_l</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="color: #009900">verbose</span><span style="color: #990000">=</span><span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">[</span> <span style="color: #FF0000">"$#"</span> -gt <span style="color: #FF0000">"0"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #009900">$1</span> <span style="font-weight: bold"><span style="color: #0000FF">in</span></span>
    -a<span style="color: #990000">)</span>    echo <span style="color: #FF0000">"Option a"</span>
        <span style="color: #990000">;;</span>
    -f<span style="color: #990000">|</span>--file<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">shift</span></span>
        cat <span style="color: #009900">$1</span>
        <span style="color: #990000">;;</span>
    -v<span style="color: #990000">)</span>    <span style="color: #009900">verbose</span><span style="color: #990000">=</span><span style="color: #993399">1</span>
        <span style="color: #990000">;;</span>
    --long<span style="color: #990000">)</span>    echo <span style="color: #FF0000">"Option long"</span>
        <span style="color: #990000">;;</span>
    --longextra<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">shift</span></span>
        echo <span style="color: #FF0000">"Option longextra with $1"</span>
        <span style="color: #990000">;;</span>
    --<span style="color: #990000">)</span>    <span style="font-weight: bold"><span style="color: #0000FF">shift</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span>
        <span style="color: #990000">;;</span>
    -<span style="color: #990000">*)</span>    echo <span style="color: #FF0000">"Unknown option: $1"</span>
        echo <span style="color: #FF0000">"Usage: $0 [-a] [-f|--file file] [-v] args ..."</span>
        <span style="font-weight: bold"><span style="color: #0000FF">exit</span></span> <span style="color: #993399">1</span>
        <span style="color: #990000">;;</span>
    <span style="color: #990000">*)</span>    <span style="font-weight: bold"><span style="color: #0000FF">break</span></span>
        <span style="color: #990000">;;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">esac</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">shift</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">done</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">printf</span></span> <span style="color: #FF0000">"Remaining arguments are: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span> <span style="color: #FF0000">"$*"</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You must type as "<code>-a -f ...</code>" and not as "<code>-af ...</code>"</td>
</tr></table>
</div>
<div class="paragraph"><p>Here I avoided the use of <code>getopts</code>/<code>getopt</code> for long option support to gain maximum portability.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_python_2">Python</h3>
<div class="sect3">
<h4 id="_python_script_with_argparse">Python script with argparse</h4>
<div class="paragraph"><p>Simple example program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for Python with argparse</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vim:se tw=0 sts=4 ts=4 et cindent:</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #000080">import</span></span> argparse<span style="color: #990000">,</span> sys
    parser <span style="color: #990000">=</span> argparse<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">ArgumentParser</span></span><span style="color: #990000">(</span>description<span style="color: #990000">=</span><span style="color: #FF0000">'This is skelton program.'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'-a'</span><span style="color: #990000">,</span> action<span style="color: #990000">=</span><span style="color: #FF0000">"store_true"</span><span style="color: #990000">,</span> dest<span style="color: #990000">=</span><span style="color: #FF0000">"opt_a"</span><span style="color: #990000">,</span>
                    default<span style="color: #990000">=</span>False<span style="color: #990000">,</span> help<span style="color: #990000">=</span><span style="color: #FF0000">'operation mode'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'-f'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'--file'</span><span style="color: #990000">,</span> action<span style="color: #990000">=</span><span style="color: #FF0000">"store"</span><span style="color: #990000">,</span> dest<span style="color: #990000">=</span><span style="color: #FF0000">"filename"</span><span style="color: #990000">,</span>
                    help<span style="color: #990000">=</span><span style="color: #FF0000">'input filename'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'-v'</span><span style="color: #990000">,</span> action<span style="color: #990000">=</span><span style="color: #FF0000">"store_true"</span><span style="color: #990000">,</span> dest<span style="color: #990000">=</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span>
                    default<span style="color: #990000">=</span>False<span style="color: #990000">,</span> help<span style="color: #990000">=</span><span style="color: #FF0000">'vebosity'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'args'</span><span style="color: #990000">,</span> nargs<span style="color: #990000">=</span><span style="color: #FF0000">'*'</span><span style="color: #990000">,</span> help<span style="color: #990000">=</span><span style="color: #FF0000">'arguments'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'--long'</span><span style="color: #990000">,</span> action<span style="color: #990000">=</span><span style="color: #FF0000">"store_true"</span><span style="color: #990000">,</span> dest<span style="color: #990000">=</span><span style="color: #FF0000">"opt_long"</span><span style="color: #990000">,</span>
                    help<span style="color: #990000">=</span><span style="color: #FF0000">'long mode'</span><span style="color: #990000">)</span>
    parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_argument</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'--longextra'</span><span style="color: #990000">,</span> action<span style="color: #990000">=</span><span style="color: #FF0000">"store"</span><span style="color: #990000">,</span> dest<span style="color: #990000">=</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span>
                    help<span style="color: #990000">=</span><span style="color: #FF0000">'long extra mode'</span><span style="color: #990000">)</span>
    args <span style="color: #990000">=</span> parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse_args</span></span><span style="color: #990000">()</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>opt_a<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option a"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>filename<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"filename = "</span> <span style="color: #990000">+</span> args<span style="color: #990000">.</span>filename<span style="color: #990000">)</span>
        with <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>args<span style="color: #990000">.</span>filename<span style="color: #990000">)</span> as f<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> line <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> f<span style="color: #990000">:</span>
                <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #990000">(</span>line<span style="color: #990000">[:-</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>verbose<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option verbose"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>opt_long<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option long"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>long<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"longextra = "</span> <span style="color: #990000">+</span> args<span style="color: #990000">.</span>long<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> args<span style="color: #990000">.</span>args<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"args = "</span> <span style="color: #990000">,</span> args<span style="color: #990000">.</span>args<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution examples with auto generated help</div>
<div class="content">
<pre><code>usage: cli [-h] [-a] [-f FILENAME] [-v] [--long] [--longextra LONG]
           [args [args ...]]

This is skelton program.

positional arguments:
  args                  arguments

optional arguments:
  -h, --help            show this help message and exit
  -a                    operation mode
  -f FILENAME, --file FILENAME
                        input filename
  -v                    vebosity
  --long                long mode
  --longextra LONG      long extra mode
$ ./cli -avf BOGUS.txt --long --longextra=FOO cli BOGUS.txt
option a
filename = BOGUS.txt
This is BOGUS.txt here.
EOF here :-)
option verbose
option long
longextra = FOO
args =  ['cli', 'BOGUS.txt']
$ ./cli -b
usage: cli [-h] [-a] [-f FILENAME] [-v] [--long] [--longextra LONG]
           [args [args ...]]
cli: error: unrecognized arguments: -b</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Older programs may use <code>getopt</code> module which is not as object oriented as <code>argparse</code>.</td>
</tr></table>
</div>
<div class="paragraph"><p>See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/library/argparse.html">"argparse" in "The Python Standard Library"</a>.
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/3/howto/argparse.html">"Argparse Tutorial" in "Python HOWTOs"</a>.
</p>
</li>
<li>
<p>
Comments in the file such as <code>/usr/lib/python3.2/argparse.py</code> providing the <code>argparse</code> module.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Actual module file on the system can be obtained by running the Python interpreter interactively as follows.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ /usr/bin/python3 -q
&gt;&gt;&gt; import argparse
&gt;&gt;&gt; print (argparse.__file__)
/usr/lib/python3.2/argparse.py</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_python_script_with_cliapp">Python script with cliapp</h4>
<div class="paragraph"><p><a href="http://code.liw.fi/cliapp/docs/">cliapp</a> is a Python framework for Unix-like
command line programs and provides a unified supports for the command line and
the configuration file.</p></div>
<div class="paragraph"><p>This seems to be interesting and is used by the backup program <code>obnam</code>(1).</p></div>
<div class="listingblock">
<div class="title">Source code for Python with cliapp</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vim:se tw=0 sts=4 ts=4 et cindent:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">'''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">Example using cliapp framework. (Python2 only)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">'''</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> cliapp
<span style="font-weight: bold"><span style="color: #000080">import</span></span> logging

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ExampleApp</span></span><span style="color: #990000">(</span>cliapp<span style="color: #990000">.</span>Application<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">add_settings</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>settings<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">boolean</span></span><span style="color: #990000">([</span><span style="color: #FF0000">'append'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">],</span> <span style="color: #FF0000">'append mode'</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>settings<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">string</span></span><span style="color: #990000">([</span><span style="color: #FF0000">'file'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'f'</span><span style="color: #990000">],</span> <span style="color: #FF0000">'configuration filename'</span><span style="color: #990000">,</span>
                metavar<span style="color: #990000">=</span><span style="color: #FF0000">'FILENAME'</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>settings<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">boolean</span></span><span style="color: #990000">([</span><span style="color: #FF0000">'verbose'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">],</span> <span style="color: #FF0000">'verbose mode'</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>settings<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">boolean</span></span><span style="color: #990000">([</span><span style="color: #FF0000">'long'</span><span style="color: #990000">],</span> <span style="color: #FF0000">'long mode'</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>settings<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">string</span></span><span style="color: #990000">([</span><span style="color: #FF0000">'longextra'</span><span style="color: #990000">],</span> <span style="color: #FF0000">'longextra mode'</span><span style="color: #990000">,</span>
                metavar<span style="color: #990000">=</span><span style="color: #FF0000">'LONG'</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">process_inputs</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> args<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>counts <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        cliapp<span style="color: #990000">.</span>Application<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">process_inputs</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> args<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>output<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'There were %s lines in %s.\n'</span>
            <span style="color: #990000">%</span> <span style="color: #990000">(</span>self<span style="color: #990000">.</span>counts<span style="color: #990000">,</span> args<span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'append=%s'</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'append'</span><span style="color: #990000">])</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'verbose=%s'</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'verbose'</span><span style="color: #990000">])</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'long=%s'</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'long'</span><span style="color: #990000">])</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'longextra=%s'</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'longextra'</span><span style="color: #990000">])</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'file'</span><span style="color: #990000">]:</span>
           <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"filename = %s"</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'file'</span><span style="color: #990000">])</span>
           with <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>settings<span style="color: #990000">[</span><span style="color: #FF0000">'file'</span><span style="color: #990000">])</span> as f<span style="color: #990000">:</span>
               <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> line <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> f<span style="color: #990000">:</span>
                   <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #990000">(</span>line<span style="color: #990000">[:-</span><span style="color: #993399">1</span><span style="color: #990000">])</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">process_input_line</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">,</span> line<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>counts <span style="color: #990000">+=</span> <span style="color: #993399">1</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    app <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ExampleApp</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'Cli'</span><span style="color: #990000">,</span> version<span style="color: #990000">=</span><span style="color: #FF0000">'0.1'</span><span style="color: #990000">,</span>
        description<span style="color: #990000">=</span><span style="color: #FF0000">"Cli as a command line program example"</span><span style="color: #990000">,</span>
        epilog<span style="color: #990000">=</span><span style="color: #FF0000">"Copyright (C) 2012 Osamu Aoki"</span><span style="color: #990000">)</span>
    app<span style="color: #990000">.</span>settings<span style="color: #990000">.</span>config_files <span style="color: #990000">=</span> <span style="color: #990000">[</span><span style="color: #FF0000">'example.conf'</span><span style="color: #990000">]</span>
    app<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution examples with auto generated help</div>
<div class="content">
<pre><code>Traceback (most recent call last):
  File "./cli", line 6, in &lt;module&gt;
    import cliapp
ImportError: No module named cliapp
$ ./cli -avf BOGUS.txt --long --longextra=FOO cli BOGUS.txt
Traceback (most recent call last):
  File "./cli", line 6, in &lt;module&gt;
    import cliapp
ImportError: No module named cliapp
$ ./cli -b
Traceback (most recent call last):
  File "./cli", line 6, in &lt;module&gt;
    import cliapp
ImportError: No module named cliapp</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_lua_2">Lua</h3>
<div class="sect3">
<h4 id="_lua_script_long_and_short_option">Lua script (long and short option)</h4>
<div class="paragraph"><p>Simple example program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for the Lua script: cli</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>lua
verbose <span style="color: #990000">=</span> <span style="color: #993399">0</span>
i <span style="color: #990000">=</span> <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">&lt;=</span> #arg<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'-a'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Option a"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'-f'</span> <span style="font-weight: bold"><span style="color: #0000FF">or</span></span> arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'--file'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        i <span style="color: #990000">=</span> i <span style="color: #990000">+</span><span style="color: #993399">1</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> line <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> io<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">lines</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">])</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
            <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>line<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'-v'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        verbose <span style="color: #990000">=</span> <span style="color: #993399">1</span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'--long'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Option long"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sub</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">],</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">11</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'--longextra'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Option longextra with "</span> <span style="color: #990000">..</span> string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sub</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">],</span> <span style="color: #993399">13</span><span style="color: #990000">))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'--'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        i <span style="color: #990000">=</span> i <span style="color: #990000">+</span><span style="color: #993399">1</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">elseif</span></span> <span style="color: #990000">(</span>string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sub</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span>i<span style="color: #990000">],</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'-'</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Unknown option: "</span> <span style="color: #990000">..</span> arg<span style="color: #990000">[</span>i<span style="color: #990000">])</span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Usage: "</span> <span style="color: #990000">..</span> arg<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">..</span>
            <span style="color: #FF0000">" [-a] [-f|--file file] [-v] [--long] [--longextra=value] [args...]"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    i <span style="color: #990000">=</span> i <span style="color: #990000">+</span> <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
i0 <span style="color: #990000">=</span> i <span style="color: #990000">-</span> <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> #arg <span style="color: #990000">-</span> i0<span style="color: #990000">,</span> <span style="color: #993399">1</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ARG["</span> <span style="color: #990000">..</span> i <span style="color: #990000">..</span> <span style="color: #FF0000">"] = "</span> <span style="color: #990000">..</span> arg<span style="color: #990000">[</span>i <span style="color: #990000">+</span> i0<span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution examples with auto generated help</div>
<div class="content">
<pre><code>Unknown option: --help
Usage: ./cli [-a] [-f|--file file] [-v] [--long] [--longextra=value] [args...]
$ ./cli -a -v -f BOGUS.txt --long --longextra=FOO cli BOGUS.txt
Option a
This is BOGUS.txt here.
EOF here :-)
Option long
Option longextra with FOO
ARG[1] = cli
ARG[2] = BOGUS.txt</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You must type as "<code>-a -f ...</code>" and not as "<code>-af ...</code>"</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_perl_2">Perl</h3>
<div class="sect3">
<h4 id="_perl_script_with_getopt_long">Perl script with Getopt::Long</h4>
<div class="paragraph"><p>Simple example program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for Perl with <code>Getopt::Long</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/perl -w</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">use</span></span> strict<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">use</span></span> Getopt<span style="color: #990000">::</span>Long<span style="color: #990000">;</span>
<span style="font-style: italic"><span style="color: #9A1900"># Global variables</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">use</span></span> vars <span style="font-weight: bold"><span style="color: #0000FF">qw</span></span><span style="color: #990000">(</span><span style="color: #009900">%opt</span> <span style="color: #009900">$verbose</span> <span style="color: #009900">$helpmsg</span><span style="color: #990000">);</span>
<span style="color: #009900">%opt</span> <span style="color: #990000">=</span> <span style="color: #990000">();</span>
<span style="color: #009900">$verbose</span> <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #009900">$helpmsg</span> <span style="color: #990000">=</span> <span style="color: #FF0000">"Usage: $0 [-a] [-v] [-f|--file name] [--long] [--longextra extra]...\n"</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">sub</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="color: #990000">&amp;</span><span style="font-weight: bold"><span style="color: #000000">GetOptions</span></span><span style="color: #990000">(</span>
        <span style="color: #FF0000">"a"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'a'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"f|file=s"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'f'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"h|help"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'h'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"v"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'v'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"long"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'long'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"longextra=s"</span><span style="color: #990000">=&gt;\</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'longextra'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> or <span style="font-weight: bold"><span style="color: #0000FF">die</span></span> <span style="color: #009900">$helpmsg</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'a'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Option a\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'h'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #009900">$helpmsg</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'f'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Option f with $opt{'f'}\n"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">open</span></span><span style="color: #990000">(</span>INPUT_FILE<span style="color: #990000">,</span> <span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'f'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span>
            or <span style="font-weight: bold"><span style="color: #0000FF">die</span></span> <span style="color: #FF0000">"Couldn't open $opt{'f'}!"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">&lt;INPUT_FILE&gt;</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"$_"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">close</span></span><span style="color: #990000">(</span>INPUT_FILE<span style="color: #990000">)</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'v'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">$verbose</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'long'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Option long\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$opt</span><span style="color: #FF0000">{</span><span style="color: #FF0000">'longextra'</span><span style="color: #FF0000">}</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Option f with $opt{'longextra'}\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="color: #009900">$ARGV</span><span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">])</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Other things found on the command line:\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">@ARGV</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"ARG=$_\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">();</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Older programs with short command line options may use functions such as
<code>getopt("af:v")</code> or <code>getopts("af:v")</code> with <code>use Getopt::Std;</code> which set global
variables <code>$opt_a</code>, <code>$opt_f</code>, <code>$opt_v</code>.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Execution examples with auto generated help</div>
<div class="content">
<pre><code>Usage: ./cli [-a] [-v] [-f|--file name] [--long] [--longextra extra]...
$ ./cli -a -v -f BOGUS.txt --long --longextra=FOO cli BOGUS.txt
Option a
Option f with BOGUS.txt
This is BOGUS.txt here.
EOF here :-)
Option long
Option f with FOO
Other things found on the command line:
ARG=cli
ARG=BOGUS.txt
$ ./cli -b
Unknown option: b
Usage: ./cli [-a] [-v] [-f|--file name] [--long] [--longextra extra]...</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_c_3">C</h3>
<div class="paragraph"><p>Writing a code with the iteration over unknown length lines is not easy with C
since it requires dynamic memory allocation for the line buffer.  We will come
back to such coding later.</p></div>
<div class="sect3">
<h4 id="_c_with_getopt">C with getopt()</h4>
<div class="paragraph"><p>Simple example program with short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for C with getopt()</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* a short command line option example */</span></span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* getopt */</span></span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> c<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> verbose <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((</span>c <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getopt</span></span><span style="color: #990000">(</span>argc<span style="color: #990000">,</span> argv<span style="color: #990000">,</span> <span style="color: #FF0000">"af:v"</span><span style="color: #990000">))</span> <span style="color: #990000">!=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'a'</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option a</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'f'</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option f with %s.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> optarg<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'v'</span><span style="color: #990000">:</span>
            verbose <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #008080">        default:</span></span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"unknown option = %c = ascii(0%x)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                    optopt<span style="color: #990000">,</span> optopt<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"return value of getopt() = %c</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> c<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"verbose mode = %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> verbose<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>optind <span style="color: #990000">&lt;</span> argc<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> j <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>optind <span style="color: #990000">&lt;</span> argc<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"argument[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> j<span style="color: #990000">,</span> argv<span style="color: #990000">[</span>optind<span style="color: #990000">++]);</span>
            j<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Please note few global external variables used.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>char *optarg</code>  : pointer to the option argument string
</p>
</li>
<li>
<p>
<code>int optind</code>    : index for the next argument to be processed
</p>
</li>
<li>
<p>
<code>int opterr</code>    : set to zero for quieting error message
</p>
</li>
<li>
<p>
<code>int optopt</code>    :
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_c_with_getopt_long">C with getopt_long()</h4>
<div class="paragraph"><p>Simple example program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for C with getopt_long()</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* a long command line option example */</span></span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;getopt.h&gt;</span>        <span style="font-style: italic"><span style="color: #9A1900">/* getopt_long */</span></span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> c<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #009900">int</span> verbose <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">option</span> longopts<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">{</span><span style="color: #FF0000">"append"</span><span style="color: #990000">,</span> no_argument<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">'a'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> no_argument<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span><span style="color: #FF0000">"file"</span><span style="color: #990000">,</span> required_argument<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">'f'</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> no_argument<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> required_argument<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span>NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((</span>c <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getopt_long</span></span><span style="color: #990000">(</span>argc<span style="color: #990000">,</span> argv<span style="color: #990000">,</span> <span style="color: #FF0000">"af:v"</span><span style="color: #990000">,</span> longopts<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>i<span style="color: #990000">))</span> <span style="color: #990000">!=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">0</span><span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900">/* for longopts[all][3] == 0 */</span></span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"option %s"</span><span style="color: #990000">,</span> longopts<span style="color: #990000">[</span>i<span style="color: #990000">].</span>name<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>optarg<span style="color: #990000">)</span>
                <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">" with arg %s"</span><span style="color: #990000">,</span> optarg<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'a'</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option a</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'f'</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"option f with %s.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> optarg<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'v'</span><span style="color: #990000">:</span>
            verbose <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #008080">        default:</span></span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"unknown option = %c = ascii(0%x)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> optopt<span style="color: #990000">,</span> optopt<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"return value of getopt_long() = %c</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> c<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"verbose mode = %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> verbose<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>optind <span style="color: #990000">&lt;</span> argc<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> j <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>optind <span style="color: #990000">&lt;</span> argc<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"argument[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> j<span style="color: #990000">,</span> argv<span style="color: #990000">[</span>optind<span style="color: #990000">++]);</span>
            j<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Please note few global external variables used just like <code>getopt()</code>.</p></div>
<div class="paragraph"><p>In order to avoid GNU vs. BSD incompatibility, the following may be a good idea:</p></div>
<div class="ulist"><ul>
<li>
<p>
Do not define <code>-W</code> option.
</p>
</li>
<li>
<p>
Third component of <code>longopts[]</code> must be 0. (as in the above example)
</p>
</li>
<li>
<p>
Always put all of arguments after all the options when calling the compiled program with <code>getopt_long()</code>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>See <a href="http://www.unix.com/man-page/freebsd/3/getopt_long/">FreeBSD 8.0 getopt_long(3)</a> manual.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_c_4">C++</h3>
<div class="paragraph"><p>The golden rule of C++ programing: "If you can not find something in the C++ Standard Library, look for it in Boost libraries."</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://gcc.gnu.org/onlinedocs/gcc-4.7.1/libstdc++/manual/">The GNU C++ Library</a>
</p>
</li>
<li>
<p>
<a href="http://gcc.gnu.org/onlinedocs/gcc-4.7.1/libstdc++/api/">libstdc++ Source Documentation</a>
</p>
</li>
<li>
<p>
<a href="http://www.boost.org/">Boost C++ Libraries</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Simple example program with long and short command line options.</p></div>
<div class="listingblock">
<div class="title">Source code for C++ with boost::program_options</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;boost/program_options.hpp&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iostream&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;iterator&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
using <span style="color: #008080">namespace</span> std<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// A helper function to simplify the main part.</span></span>
template<span style="color: #990000">&lt;</span><span style="color: #008080">class</span> T<span style="color: #990000">&gt;</span>
ostream<span style="color: #990000">&amp;</span> operator<span style="color: #990000">&lt;&lt;(</span>ostream<span style="color: #990000">&amp;</span> os<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> vector<span style="color: #990000">&lt;</span>T<span style="color: #990000">&gt;&amp;</span> v<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">(</span>v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">begin</span></span><span style="color: #990000">(),</span> v<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">end</span></span><span style="color: #990000">(),</span> ostream_iterator<span style="color: #990000">&lt;</span>T<span style="color: #990000">&gt;(</span>cout<span style="color: #990000">,</span> <span style="color: #FF0000">" "</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> os<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">string</span> file<span style="color: #990000">;</span>
    <span style="color: #008080">string</span> extra<span style="color: #990000">;</span>
    try <span style="color: #FF0000">{</span>
        <span style="color: #008080">namespace</span> po <span style="color: #990000">=</span> boost<span style="color: #990000">::</span>program_options<span style="color: #990000">;</span>
        po<span style="color: #990000">::</span><span style="color: #008080">options_description</span> <span style="font-weight: bold"><span style="color: #000000">visible</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"SYNTAX: cli [OPTION ...] files ..."</span><span style="color: #990000">);</span>
        visible<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_options</span></span><span style="color: #990000">()</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"append,a"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"append option"</span><span style="color: #990000">)</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"help,h"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"help message"</span><span style="color: #990000">)</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"verbose,v"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"verbose option"</span><span style="color: #990000">)</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"file,f"</span><span style="color: #990000">,</span> po<span style="color: #990000">::</span>value<span style="color: #990000">&lt;</span>string<span style="color: #990000">&gt;(&amp;</span>file<span style="color: #990000">),</span> <span style="color: #FF0000">"file option"</span><span style="color: #990000">)</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"long option"</span><span style="color: #990000">)</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> po<span style="color: #990000">::</span>value<span style="color: #990000">&lt;</span>string<span style="color: #990000">&gt;(&amp;</span>extra<span style="color: #990000">),</span> <span style="color: #FF0000">"longextra option"</span><span style="color: #990000">)</span>
        <span style="color: #990000">;</span>
        po<span style="color: #990000">::</span><span style="color: #008080">options_description</span> hidden<span style="color: #990000">;</span>
        hidden<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_options</span></span><span style="color: #990000">()</span>
            <span style="color: #990000">(</span><span style="color: #FF0000">"input-file"</span><span style="color: #990000">,</span> po<span style="color: #990000">::</span>value<span style="color: #990000">&lt;</span> vector<span style="color: #990000">&lt;</span>string<span style="color: #990000">&gt;</span> <span style="color: #990000">&gt;(),</span> <span style="color: #FF0000">"input file"</span><span style="color: #990000">)</span>
        <span style="color: #990000">;</span>
        po<span style="color: #990000">::</span><span style="color: #008080">positional_options_description</span> p<span style="color: #990000">;</span>
        p<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"input-file"</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">);</span>

        po<span style="color: #990000">::</span><span style="color: #008080">options_description</span> desc<span style="color: #990000">;</span>
        desc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>visible<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>hidden<span style="color: #990000">);</span>

        po<span style="color: #990000">::</span><span style="color: #008080">variables_map</span> vm<span style="color: #990000">;</span>
        po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">store</span></span><span style="color: #990000">(</span>po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">command_line_parser</span></span><span style="color: #990000">(</span>argc<span style="color: #990000">,</span> argv<span style="color: #990000">)</span>
            <span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">options</span></span><span style="color: #990000">(</span>desc<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">positional</span></span><span style="color: #990000">(</span>p<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(),</span> vm<span style="color: #990000">);</span>
        po<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">notify</span></span><span style="color: #990000">(</span>vm<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"help"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> visible <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"append"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"append mode</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"verbose mode</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"file"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Filename: "</span>
                 <span style="color: #990000">&lt;&lt;</span> file <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            cout  <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Filename: (unset)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"long"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"long mode</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Longextra: "</span>
                 <span style="color: #990000">&lt;&lt;</span> extra <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            cout  <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Longextra: (unset)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>vm<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"input-file"</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            cout <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"Input files are: "</span>
                 <span style="color: #990000">&lt;&lt;</span> vm<span style="color: #990000">[</span><span style="color: #FF0000">"input-file"</span><span style="color: #990000">].</span>as<span style="color: #990000">&lt;</span> vector<span style="color: #990000">&lt;</span>string<span style="color: #990000">&gt;</span> <span style="color: #990000">&gt;()</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span>exception<span style="color: #990000">&amp;</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"E: "</span> <span style="color: #990000">&lt;&lt;</span> e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">what</span></span><span style="color: #990000">()</span> <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(...)</span> <span style="color: #FF0000">{</span>
        cerr <span style="color: #990000">&lt;&lt;</span> <span style="color: #FF0000">"E: unknown type!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>cli.cxx</code> to create the ELF object <code>cli</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/usr/bin/ld: cannot find -lboost_program_options
collect2: error: ld returned 1 exit status
$ ./cli -avf BOGUS.txt --long --longextra=FOO X1 X2
/path/to/cxx/../../bin/p: 1: eval: ./cli: not found
$ ./cli -b
/path/to/cxx/../../bin/p: 1: eval: ./cli: not found
$ ./cli --help
/path/to/cxx/../../bin/p: 1: eval: ./cli: not found</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_vala_2">Vala</h3>
<div class="paragraph"><p>Simple Vala example programs with long and short command line options using GLib.</p></div>
<div class="sect3">
<h4 id="_simple_non_oop_style_no_class_2">Simple non-OOP style (no class)</h4>
<div class="listingblock">
<div class="title">Source code <code>cli-1.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> append <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> verbose <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> op_long <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> filename <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> longextra <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">// sources is a string array containing all non-option arguments</span></span>
<span style="font-style: italic"><span style="color: #9A1900">// https://mail.gnome.org/archives/vala-list/2009-March/msg00090.html</span></span>
<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>array_length <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> array_null_terminated <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)]</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span><span style="color: #990000">[]</span> sources<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> OptionEntry<span style="color: #990000">[]</span> options <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">"append"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> append<span style="color: #990000">,</span>
        <span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> verbose<span style="color: #990000">,</span>
        <span style="color: #FF0000">"Set verbose mode"</span><span style="color: #990000">,</span>    <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">"file"</span><span style="color: #990000">,</span>    <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> filename<span style="color: #990000">,</span>
        <span style="color: #FF0000">"Use F file"</span><span style="color: #990000">,</span>         <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">"long"</span><span style="color: #990000">,</span>      <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> op_long<span style="color: #990000">,</span>
        <span style="color: #FF0000">"Set long mode"</span><span style="color: #990000">,</span>      <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>STRING<span style="color: #990000">,</span>   <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> longextra<span style="color: #990000">,</span>
        <span style="color: #FF0000">"Set longextra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span>    <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME_ARRAY<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> sources<span style="color: #990000">,</span>
        <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span>                <span style="color: #FF0000">"FILE..."</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// initialize locale</span></span>
    Intl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LocaleCategory<span style="color: #990000">.</span>ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-style: italic"><span style="color: #9A1900">//</span></span>
    stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
    stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> Path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_basename</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]));</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// parse command line options with GLib</span></span>
        <span style="color: #009900">var</span> opt_context <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">OptionContext</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
        opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_help_enabled</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>
        opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_main_entries</span></span> <span style="color: #990000">(</span>options<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
        opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">OptionError</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span>
<span style="color: #FF0000">"Run '%s --help' to see a full list of available command line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
            args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">// print variables</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>verbose<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>append<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>op_long<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>filename <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> filename<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>longextra <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> longextra<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sources <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span> s <span style="color: #008080">in</span> sources<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> s<span style="color: #990000">);</span>
            i<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above example skips specifying <code>GLib</code> for the parent class since it is
the default for Vala.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>cli-1.vala</code> to create the ELF object <code>cli-1</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/cli-1' '/path/to/vala/cli-1.vala.c' -I/usr/include/glib-2.0 ...
$ ./cli-1 -avf BOGUS.txt --long --longextra=FOO X1 X2
command  = ./cli-1
basename = cli-1
Cli: verbose ON
Cli: appemd ON
Cli: long ON
Cli: file = BOGUS.txt
Cli: longextra = FOO
sources[0]=X1
sources[1]=X2
$ ./cli-1 -b
command  = ./cli-1
basename = cli-1
Unknown option -b
Run './cli-1 --help' to see a full list of available command line options.
$ ./cli-1 --help
command  = ./cli-1
basename = cli-1
Usage:
  cli-1 [OPTION...] FILE... - Cli

Help Options:
  -h, --help        Show help options

Application Options:
  -a, --append      Set append mode
  -v, --verbose     Set verbose mode
  -f, --file=F      Use F file
  --long            Set long mode
  --longextra=M     Set longextra to M</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
<span style="color: #993399">75</span> cli<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala
<span style="color: #993399">223</span> cli<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> cli<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold  # tab <span style="color: #990000">=&gt;</span> <span style="color: #993399">4</span> spaces
<span style="font-style: italic"><span style="color: #9A1900">/* cli-1.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from cli-1.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span>g_option_co
<span style="font-weight: bold"><span style="color: #000000">ntext_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>


<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">gboolean</span> append<span style="color: #990000">;</span>
<span style="color: #008080">gboolean</span> append <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">gboolean</span> verbose<span style="color: #990000">;</span>
<span style="color: #008080">gboolean</span> verbose <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">gboolean</span> op_long<span style="color: #990000">;</span>
<span style="color: #008080">gboolean</span> op_long <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> gchar<span style="color: #990000">*</span> filename<span style="color: #990000">;</span>
gchar<span style="color: #990000">*</span> filename <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> gchar<span style="color: #990000">*</span> longextra<span style="color: #990000">;</span>
gchar<span style="color: #990000">*</span> longextra <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> gchar<span style="color: #990000">**</span> sources<span style="color: #990000">;</span>
gchar<span style="color: #990000">**</span> sources <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GOptionEntry</span> options<span style="color: #990000">[</span><span style="color: #993399">7</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{{</span><span style="color: #FF0000">"append"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>append<span style="color: #990000">,</span>
<span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>verbose<span style="color: #990000">,</span> <span style="color: #FF0000">"Set</span>
<span style="color: #FF0000">verbose mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_FILENAME<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>filename<span style="color: #990000">,</span> <span style="color: #FF0000">"Use F</span>
<span style="color: #FF0000">file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>op_long<span style="color: #990000">,</span> <span style="color: #FF0000">"Set long mode"</span>
<span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_STRING<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>longextra<span style="color: #990000">,</span> <span style="color: #FF0000">"Set longe</span>
<span style="color: #FF0000">xtra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">""</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_FILENAME_ARRAY<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>sources<span style="color: #990000">,</span> NULL
<span style="color: #990000">,</span> <span style="color: #FF0000">"FILE..."</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>NULL<span style="color: #FF0000">}}</span><span style="color: #990000">;</span>

<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp4__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp18_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp20_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp22_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp24_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp27_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp30_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp30__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> _tmp1_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp3_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp4_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp4__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp5_ <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    _tmp6_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_path_get_basename</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">);</span>
    _tmp7_ <span style="color: #990000">=</span> _tmp6_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp7_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">);</span>
    <span style="color: #FF0000">{</span>
        GOptionContext<span style="color: #990000">*</span> opt_context <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp11_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_option_context_new</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
        opt_context <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_set_help_enabled</span></span> <span style="color: #990000">(</span>_tmp9_<span style="color: #990000">,</span> TRUE<span style="color: #990000">);</span>
        _tmp10_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_add_main_entries</span></span> <span style="color: #990000">(</span>_tmp10_<span style="color: #990000">,</span> options<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        _tmp11_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_parse</span></span> <span style="color: #990000">(</span>_tmp11_<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain <span style="color: #990000">==</span> G_OPTION_ERROR<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_option_error<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: unexpected error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FIL
E__<span style="color: #990000">,</span> __LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">)</span>
<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_option_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp12_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp13_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp14_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp15_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp16_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp16__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp17_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp12_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp13_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp14_ <span style="color: #990000">=</span> _tmp13_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp12_<span style="color: #990000">,</span> <span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp14_<span style="color: #990000">);</span>
        _tmp15_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp16_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
        _tmp16__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
        _tmp17_ <span style="color: #990000">=</span> _tmp16_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp15_<span style="color: #990000">,</span> <span style="color: #FF0000">"Run '%s --help' to see a full list of available comma</span>
<span style="color: #FF0000">nd line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp17_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    _tmp18_ <span style="color: #990000">=</span> verbose<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp18_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp19_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp19_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp19_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp20_ <span style="color: #990000">=</span> append<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp20_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp21_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp21_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp21_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp22_ <span style="color: #990000">=</span> op_long<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp22_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp23_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp23_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp23_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp24_ <span style="color: #990000">=</span> filename<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp24_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp25_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp26_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp25_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp26_ <span style="color: #990000">=</span> filename<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp25_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp26_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp27_ <span style="color: #990000">=</span> longextra<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp27_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp28_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp29_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp28_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp29_ <span style="color: #990000">=</span> longextra<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp28_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp29_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp30_ <span style="color: #990000">=</span> sources<span style="color: #990000">;</span>
    _tmp30__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>sources<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp30_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">gint</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp31_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp31__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        _tmp31_ <span style="color: #990000">=</span> sources<span style="color: #990000">;</span>
        _tmp31__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>sources<span style="color: #990000">);</span>
        <span style="color: #FF0000">{</span>
            gchar<span style="color: #990000">**</span> s_collection <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_collection_length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> _s_collection_size_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            s_collection <span style="color: #990000">=</span> _tmp31_<span style="color: #990000">;</span>
            s_collection_length1 <span style="color: #990000">=</span> _tmp31__length1<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> s_it <span style="color: #990000">&lt;</span> _tmp31__length1<span style="color: #990000">;</span> s_it <span style="color: #990000">=</span> s_it <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                gchar<span style="color: #990000">*</span> _tmp32_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                gchar<span style="color: #990000">*</span> s <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                _tmp32_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup</span></span> <span style="color: #990000">(</span>s_collection<span style="color: #990000">[</span>s_it<span style="color: #990000">]);</span>
                s <span style="color: #990000">=</span> _tmp32_<span style="color: #990000">;</span>
                <span style="color: #FF0000">{</span>
                    FILE<span style="color: #990000">*</span> _tmp33_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp34_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp35_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp36_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    _tmp33_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
                    _tmp34_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    _tmp35_ <span style="color: #990000">=</span> s<span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp33_<span style="color: #990000">,</span> <span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp34_<span style="color: #990000">,</span> _tmp35_<span style="color: #990000">);</span>
                    _tmp36_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    i <span style="color: #990000">=</span> _tmp36_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>s<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> length<span style="color: #990000">;</span>
    length <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(((</span>gpointer<span style="color: #990000">*)</span> array<span style="color: #990000">)[</span>length<span style="color: #990000">])</span> <span style="color: #FF0000">{</span>
            length<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> length<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>Since no OOP techniques are used, the resulting C code does not have GObject
related macros.</p></div>
<div class="paragraph"><p>But some libraries from GLib are used, the resulting C code has automatically
generated memory management codes such as <code>_g_option_context_free0</code>,
<code>_g_error_free0</code>, and <code>_g_free0</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_outside_of_class_2">OOP style (main outside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>cli-2.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Cli</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> append <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> verbose <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> op_long <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> filename <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> longextra <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// sources is a string array containing all non-option arguments</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// https://mail.gnome.org/archives/vala-list/2009-March/msg00090.html</span></span>
    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>array_length <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> array_null_terminated <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span><span style="color: #990000">[]</span> sources<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> OptionEntry<span style="color: #990000">[]</span> options <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"append"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> append<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> verbose<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set verbose mode"</span><span style="color: #990000">,</span>    <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"file"</span><span style="color: #990000">,</span>    <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> filename<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Use F file"</span><span style="color: #990000">,</span>         <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"long"</span><span style="color: #990000">,</span>      <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> op_long<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set long mode"</span><span style="color: #990000">,</span>      <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>STRING<span style="color: #990000">,</span>   <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> longextra<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set longextra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span>    <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME_ARRAY<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> sources<span style="color: #990000">,</span>
            <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span>                <span style="color: #FF0000">"FILE..."</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// parse command line</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">// parse command line options with GLib</span></span>
            <span style="color: #009900">var</span> opt_context <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">OptionContext</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_help_enabled</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_main_entries</span></span> <span style="color: #990000">(</span>options<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">OptionError</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span>
    <span style="color: #FF0000">"Run '%s --help' to see a full list of available command line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// print variables</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>verbose<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>append<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>op_long<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>filename <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> filename<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>longextra <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> longextra<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sources <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span> s <span style="color: #008080">in</span> sources<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> s<span style="color: #990000">);</span>
                i<span style="color: #990000">++;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// initialize locale</span></span>
    Intl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LocaleCategory<span style="color: #990000">.</span>ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-style: italic"><span style="color: #9A1900">//</span></span>
    stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
    stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> Path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_basename</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]));</span>

    <span style="color: #009900">var</span> cli <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Cli</span></span> <span style="color: #990000">();</span>
    cli<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span>args<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> cli<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above example skips specifying <code>GLib</code> for the parent class since it is
the default for Vala.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>cli-2.vala</code> to create the ELF object <code>cli-2</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/cli-2' '/path/to/vala/cli-2.vala.c' -I/usr/include/glib-2.0 ...
$ ./cli-2 -avf BOGUS.txt --long --longextra=FOO X1 X2
command  = ./cli-2
basename = cli-2
Cli: verbose ON
Cli: appemd ON
Cli: long ON
Cli: file = BOGUS.txt
Cli: longextra = FOO
sources[0]=X1
sources[1]=X2
$ ./cli-2 -b
command  = ./cli-2
basename = cli-2
Unknown option -b
Run './cli-2 --help' to see a full list of available command line options.
$ ./cli-2 --help
command  = ./cli-2
basename = cli-2
Usage:
  cli-2 [OPTION...] FILE... - Cli

Help Options:
  -h, --help        Show help options

Application Options:
  -a, --append      Set append mode
  -v, --verbose     Set verbose mode
  -f, --file=F      Use F file
  --long            Set long mode
  --longextra=M     Set longextra to M</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
<span style="color: #993399">86</span> cli<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala
<span style="color: #993399">323</span> cli<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> cli<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold  # tab <span style="color: #990000">=&gt;</span> <span style="color: #993399">4</span> spaces
<span style="font-style: italic"><span style="color: #9A1900">/* cli-2.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from cli-2.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_CLI</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> Cli<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> CliClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_CLI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_CLI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> CliClass
<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Cli</span> Cli<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliClass</span> CliClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliPrivate</span> CliPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span>g_option_co
<span style="font-weight: bold"><span style="color: #000000">ntext_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Cli</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    CliPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> cli_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_append<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_append <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_verbose<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_verbose <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_op_long<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_op_long <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_filename<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_filename <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_longextra<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_longextra <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">**</span> cli_sources<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">**</span> cli_sources <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    CLI_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GOptionEntry</span> CLI_options<span style="color: #990000">[</span><span style="color: #993399">7</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{{</span><span style="color: #FF0000">"append"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE
<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_append<span style="color: #990000">,</span> <span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span>
<span style="color: #990000">&amp;</span>cli_verbose<span style="color: #990000">,</span> <span style="color: #FF0000">"Set verbose mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_FILENAME<span style="color: #990000">,</span>
 <span style="color: #990000">&amp;</span>cli_filename<span style="color: #990000">,</span> <span style="color: #FF0000">"Use F file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>c
li_op_long<span style="color: #990000">,</span> <span style="color: #FF0000">"Set long mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_STR
ING<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_longextra<span style="color: #990000">,</span> <span style="color: #FF0000">"Set longextra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">""</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG
_FILENAME_ARRAY<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_sources<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="color: #FF0000">"FILE..."</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>NULL<span style="color: #FF0000">}}</span><span style="color: #990000">;</span>

<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">{</span>
        GOptionContext<span style="color: #990000">*</span> opt_context <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_option_context_new</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
        opt_context <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_set_help_enabled</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> TRUE<span style="color: #990000">);</span>
        _tmp2_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_add_main_entries</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> CLI_options<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        _tmp3_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_parse</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain <span style="color: #990000">==</span> G_OPTION_ERROR<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_option_error<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: unexpected error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FIL
E__<span style="color: #990000">,</span> __LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">)</span>
<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_option_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp8__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp4_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> _tmp5_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">,</span> <span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
        _tmp8__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">,</span> <span style="color: #FF0000">"Run '%s --help' to see a full list of available comman</span>
<span style="color: #FF0000">d line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp9_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp0_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp2_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp4_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp12_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp12__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> cli_verbose<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp2_ <span style="color: #990000">=</span> cli_append<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp4_ <span style="color: #990000">=</span> cli_op_long<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp6_ <span style="color: #990000">=</span> cli_filename<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp6_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp7_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> cli_filename<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp8_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp9_ <span style="color: #990000">=</span> cli_longextra<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp9_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp11_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp11_ <span style="color: #990000">=</span> cli_longextra<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp10_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp11_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp12_ <span style="color: #990000">=</span> cli_sources<span style="color: #990000">;</span>
    _tmp12__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>cli_sources<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp12_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">gint</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp13_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp13__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        _tmp13_ <span style="color: #990000">=</span> cli_sources<span style="color: #990000">;</span>
        _tmp13__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>cli_sources<span style="color: #990000">);</span>
        <span style="color: #FF0000">{</span>
            gchar<span style="color: #990000">**</span> s_collection <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_collection_length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> _s_collection_size_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            s_collection <span style="color: #990000">=</span> _tmp13_<span style="color: #990000">;</span>
            s_collection_length1 <span style="color: #990000">=</span> _tmp13__length1<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> s_it <span style="color: #990000">&lt;</span> _tmp13__length1<span style="color: #990000">;</span> s_it <span style="color: #990000">=</span> s_it <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                gchar<span style="color: #990000">*</span> _tmp14_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                gchar<span style="color: #990000">*</span> s <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                _tmp14_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup</span></span> <span style="color: #990000">(</span>s_collection<span style="color: #990000">[</span>s_it<span style="color: #990000">]);</span>
                s <span style="color: #990000">=</span> _tmp14_<span style="color: #990000">;</span>
                <span style="color: #FF0000">{</span>
                    FILE<span style="color: #990000">*</span> _tmp15_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp16_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp17_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp18_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    _tmp15_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
                    _tmp16_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    _tmp17_ <span style="color: #990000">=</span> s<span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp15_<span style="color: #990000">,</span> <span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp16_<span style="color: #990000">,</span> _tmp17_<span style="color: #990000">);</span>
                    _tmp18_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    i <span style="color: #990000">=</span> _tmp18_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>s<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Cli <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span>TYPE_CLI<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_class_init</span></span> <span style="color: #990000">(</span>CliClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    cli_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> cli_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_instance_init</span></span> <span style="color: #990000">(</span>Cli <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Cli <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_CLI<span style="color: #990000">,</span> Cli<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>cli_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> cli_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>cli_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>CliClass<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseI
nitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> cli_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClas
sFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInitFunc<span style="color: #990000">)</span> cli_instance_ini
t<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> cli_type_id<span style="color: #990000">;</span>
        cli_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_ty
pe_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>cli_type_id__volatile<span style="color: #990000">,</span> cli_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> cli_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp4__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Cli<span style="color: #990000">*</span> cli <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Cli<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp9__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp10_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> _tmp1_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp3_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp4_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp4__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp5_ <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    _tmp6_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_path_get_basename</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">);</span>
    _tmp7_ <span style="color: #990000">=</span> _tmp6_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp7_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">);</span>
    _tmp8_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">();</span>
    cli <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">;</span>
    _tmp9_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp9__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">,</span> _tmp9_<span style="color: #990000">,</span> _tmp9__length1<span style="color: #990000">);</span>
    _tmp10_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> _tmp10_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> length<span style="color: #990000">;</span>
    length <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(((</span>gpointer<span style="color: #990000">*)</span> array<span style="color: #990000">)[</span>length<span style="color: #990000">])</span> <span style="color: #FF0000">{</span>
            length<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> length<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>cli</code>, <code>CLI</code>, <code>Cli</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>cli_get_type()</code>: returning GType of object CLI
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_inside_of_class_2">OOP style (main inside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>cli-3.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Cli</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> append <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> verbose <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">bool</span> op_long <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> filename <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span> longextra <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">// sources is a string array containing all non-option arguments</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// https://mail.gnome.org/archives/vala-list/2009-March/msg00090.html</span></span>
    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>array_length <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">,</span> array_null_terminated <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">string</span><span style="color: #990000">[]</span> sources<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> OptionEntry<span style="color: #990000">[]</span> options <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"append"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> append<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> verbose<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set verbose mode"</span><span style="color: #990000">,</span>    <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"file"</span><span style="color: #990000">,</span>    <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> filename<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Use F file"</span><span style="color: #990000">,</span>         <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"long"</span><span style="color: #990000">,</span>      <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>NONE<span style="color: #990000">,</span>     <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> op_long<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set long mode"</span><span style="color: #990000">,</span>      <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>STRING<span style="color: #990000">,</span>   <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> longextra<span style="color: #990000">,</span>
            <span style="color: #FF0000">"Set longextra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span>    <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> OptionArg<span style="color: #990000">.</span>FILENAME_ARRAY<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> sources<span style="color: #990000">,</span>
            <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span>                <span style="color: #FF0000">"FILE..."</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// parse command line</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">// parse command line options with GLib</span></span>
            <span style="color: #009900">var</span> opt_context <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">OptionContext</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_help_enabled</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_main_entries</span></span> <span style="color: #990000">(</span>options<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
            opt_context<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">OptionError</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span>
    <span style="color: #FF0000">"Run '%s --help' to see a full list of available command line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// print variables</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>verbose<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>append<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>op_long<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>filename <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> filename<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>longextra <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> longextra<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>sources <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">int</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span> s <span style="color: #008080">in</span> sources<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> s<span style="color: #990000">);</span>
                i<span style="color: #990000">++;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// initialize locale</span></span>
        Intl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LocaleCategory<span style="color: #990000">.</span>ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
        <span style="font-style: italic"><span style="color: #9A1900">//</span></span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> Path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_basename</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]));</span>

        <span style="color: #009900">var</span> cli <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Cli</span></span> <span style="color: #990000">();</span>
        cli<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span> <span style="color: #990000">(</span>args<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> cli<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above example skips specifying <code>GLib</code> for the parent class since it is
the default for Vala.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>cli-3.vala</code> to create the ELF object <code>cli-3</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
cc -o '/path/to/vala/cli-3' '/path/to/vala/cli-3.vala.c' -I/usr/include/glib-2.0 ...
$ ./cli-3 -avf BOGUS.txt --long --longextra=FOO X1 X2
command  = ./cli-3
basename = cli-3
Cli: verbose ON
Cli: appemd ON
Cli: long ON
Cli: file = BOGUS.txt
Cli: longextra = FOO
sources[0]=X1
sources[1]=X2
$ ./cli-3 -b
command  = ./cli-3
basename = cli-3
Unknown option -b
Run './cli-3 --help' to see a full list of available command line options.
$ ./cli-3 --help
command  = ./cli-3
basename = cli-3
Usage:
  cli-3 [OPTION...] FILE... - Cli

Help Options:
  -h, --help        Show help options

Application Options:
  -a, --append      Set append mode
  -v, --verbose     Set verbose mode
  -f, --file=F      Use F file
  --long            Set long mode
  --longextra=M     Set longextra to M</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> cli<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
<span style="color: #993399">87</span> cli<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala
<span style="color: #993399">323</span> cli<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> cli<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold  # tab <span style="color: #990000">=&gt;</span> <span style="color: #993399">4</span> spaces
<span style="font-style: italic"><span style="color: #9A1900">/* cli-3.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from cli-3.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_CLI</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> Cli<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> CliClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_CLI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_CLI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">CLI_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_CLI<span style="color: #990000">,</span> CliClass
<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Cli</span> Cli<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliClass</span> CliClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliPrivate</span> CliPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span>g_option_co
<span style="font-weight: bold"><span style="color: #000000">ntext_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Cli</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    CliPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_CliClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> cli_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_append<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_append <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_verbose<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_verbose <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_op_long<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gboolean</span> cli_op_long <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_filename<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_filename <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_longextra<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">*</span> cli_longextra <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">**</span> cli_sources<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> gchar<span style="color: #990000">**</span> cli_sources <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    CLI_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GOptionEntry</span> CLI_options<span style="color: #990000">[</span><span style="color: #993399">7</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{{</span><span style="color: #FF0000">"append"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE
<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_append<span style="color: #990000">,</span> <span style="color: #FF0000">"Set append mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"verbose"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'v'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span>
<span style="color: #990000">&amp;</span>cli_verbose<span style="color: #990000">,</span> <span style="color: #FF0000">"Set verbose mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">'f'</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_FILENAME<span style="color: #990000">,</span>
 <span style="color: #990000">&amp;</span>cli_filename<span style="color: #990000">,</span> <span style="color: #FF0000">"Use F file"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"F"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_NONE<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>c
li_op_long<span style="color: #990000">,</span> <span style="color: #FF0000">"Set long mode"</span><span style="color: #990000">,</span> NULL<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">"longextra"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG_STR
ING<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_longextra<span style="color: #990000">,</span> <span style="color: #FF0000">"Set longextra to M"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"M"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span><span style="color: #FF0000">""</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>gchar<span style="color: #990000">)</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> G_OPTION_ARG
_FILENAME_ARRAY<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>cli_sources<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="color: #FF0000">"FILE..."</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>NULL<span style="color: #FF0000">}}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">{</span>
        GOptionContext<span style="color: #990000">*</span> opt_context <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GOptionContext<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_option_context_new</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"- Cli"</span><span style="color: #990000">);</span>
        opt_context <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_set_help_enabled</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> TRUE<span style="color: #990000">);</span>
        _tmp2_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_add_main_entries</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> CLI_options<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        _tmp3_ <span style="color: #990000">=</span> opt_context<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">g_option_context_parse</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain <span style="color: #990000">==</span> G_OPTION_ERROR<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_option_error<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: unexpected error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FIL
E__<span style="color: #990000">,</span> __LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">)</span>
<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_option_context_free0</span></span> <span style="color: #990000">(</span>opt_context<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_option_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp8__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp4_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> _tmp5_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">,</span> <span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
        _tmp8__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">,</span> <span style="color: #FF0000">"Run '%s --help' to see a full list of available comman</span>
<span style="color: #FF0000">d line options.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp9_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp0_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp2_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="color: #008080">gboolean</span> _tmp4_ <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp12_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp12__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> cli_verbose<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: verbose ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp2_ <span style="color: #990000">=</span> cli_append<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: appemd ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp4_ <span style="color: #990000">=</span> cli_op_long<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: long ON</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp6_ <span style="color: #990000">=</span> cli_filename<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp6_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp7_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> cli_filename<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: file = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp8_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp9_ <span style="color: #990000">=</span> cli_longextra<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp9_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        FILE<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp11_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
        _tmp11_ <span style="color: #990000">=</span> cli_longextra<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp10_<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli: longextra = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp11_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    _tmp12_ <span style="color: #990000">=</span> cli_sources<span style="color: #990000">;</span>
    _tmp12__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>cli_sources<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>_tmp12_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">gint</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        gchar<span style="color: #990000">**</span> _tmp13_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="color: #008080">gint</span> _tmp13__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        _tmp13_ <span style="color: #990000">=</span> cli_sources<span style="color: #990000">;</span>
        _tmp13__length1 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span>cli_sources<span style="color: #990000">);</span>
        <span style="color: #FF0000">{</span>
            gchar<span style="color: #990000">**</span> s_collection <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_collection_length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> _s_collection_size_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            <span style="color: #008080">gint</span> s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
            s_collection <span style="color: #990000">=</span> _tmp13_<span style="color: #990000">;</span>
            s_collection_length1 <span style="color: #990000">=</span> _tmp13__length1<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>s_it <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> s_it <span style="color: #990000">&lt;</span> _tmp13__length1<span style="color: #990000">;</span> s_it <span style="color: #990000">=</span> s_it <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                gchar<span style="color: #990000">*</span> _tmp14_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                gchar<span style="color: #990000">*</span> s <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                _tmp14_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup</span></span> <span style="color: #990000">(</span>s_collection<span style="color: #990000">[</span>s_it<span style="color: #990000">]);</span>
                s <span style="color: #990000">=</span> _tmp14_<span style="color: #990000">;</span>
                <span style="color: #FF0000">{</span>
                    FILE<span style="color: #990000">*</span> _tmp15_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp16_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp17_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
                    <span style="color: #008080">gint</span> _tmp18_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
                    _tmp15_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
                    _tmp16_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    _tmp17_ <span style="color: #990000">=</span> s<span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp15_<span style="color: #990000">,</span> <span style="color: #FF0000">"sources[%i]=%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp16_<span style="color: #990000">,</span> _tmp17_<span style="color: #990000">);</span>
                    _tmp18_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
                    i <span style="color: #990000">=</span> _tmp18_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
                    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>s<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">cli_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    FILE<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp4__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Cli<span style="color: #990000">*</span> cli <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Cli<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp9__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp10_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span> <span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> _tmp1_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">,</span> <span style="color: #FF0000">"command  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp3_ <span style="color: #990000">=</span> stdout<span style="color: #990000">;</span>
    _tmp4_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp4__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    _tmp5_ <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">];</span>
    _tmp6_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_path_get_basename</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">);</span>
    _tmp7_ <span style="color: #990000">=</span> _tmp6_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"basename = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp7_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">);</span>
    _tmp8_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">();</span>
    cli <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">;</span>
    _tmp9_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp9__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">cli_parse</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">,</span> _tmp9_<span style="color: #990000">,</span> _tmp9__length1<span style="color: #990000">);</span>
    _tmp10_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">cli_run</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> _tmp10_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>cli<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">cli_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Cli <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>Cli<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Cli<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cli_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">cli_construct</span></span> <span style="color: #990000">(</span>TYPE_CLI<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_class_init</span></span> <span style="color: #990000">(</span>CliClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    cli_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> cli_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_instance_init</span></span> <span style="color: #990000">(</span>Cli <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">cli_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Cli <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_CLI<span style="color: #990000">,</span> Cli<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>cli_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">cli_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> cli_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>cli_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>CliClass<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseI
nitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> cli_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClas
sFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>Cli<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInitFunc<span style="color: #990000">)</span> cli_instance_ini
t<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> cli_type_id<span style="color: #990000">;</span>
        cli_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"Cli"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_ty
pe_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>cli_type_id__volatile<span style="color: #990000">,</span> cli_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> cli_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_array_length</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> length<span style="color: #990000">;</span>
    length <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>array<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(((</span>gpointer<span style="color: #990000">*)</span> array<span style="color: #990000">)[</span>length<span style="color: #990000">])</span> <span style="color: #FF0000">{</span>
            length<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> length<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>cli</code>, <code>CLI</code>, <code>Cli</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>cli_get_type()</code>: returning GType of object CLI
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fibonacci_numbers">Fibonacci numbers</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <a href="http://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci numbers</a> are a
sequence of integers, starting with 0, 1 and continuing 1, 2, 3, 5, 8, 13, &#8230;,
each new number being the sum of the previous two.</p></div>
<div class="paragraph"><p>Let&#8217;s check simple code snippets to obtain Fibonacci numbers implemented in
different languages to study the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
basic while-loop syntax
</p>
</li>
<li>
<p>
integer overflow behavior
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_shell_3">Shell</h3>
<div class="paragraph"><p>Before we start, let&#8217;s check the integer overflow behavior of the shell on the
64-bit GNU/Linux platform.</p></div>
<div class="listingblock">
<div class="title">Dash behavior for the integer overflow etc.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #993399">4611686018427387904</span>    <span style="color: #993399">4611686018427387904</span>
$ echo <span style="color: #FF0000">"$(echo 2^63-1 | bc)  $((9223372036854775807))"</span>
<span style="color: #993399">9223372036854775807</span>  <span style="color: #993399">9223372036854775807</span>
$ echo <span style="color: #FF0000">"$(echo 2^63 | bc)    $((9223372036854775808))"</span>
<span style="color: #993399">9223372036854775808</span>    <span style="color: #993399">9223372036854775807</span>
$ echo <span style="color: #FF0000">"$(echo 2^64-1 | bc) $((18446744073709551615))"</span>
<span style="color: #993399">18446744073709551615</span> <span style="color: #993399">9223372036854775807</span>
$ echo <span style="color: #FF0000">"$(echo 2^64 | bc)   $((18446744073709551616))"</span>
<span style="color: #993399">18446744073709551616</span>   <span style="color: #993399">9223372036854775807</span>
$ echo <span style="color: #FF0000">"$((2**62))"</span>
/path/to/sh<span style="color: #990000">/../..</span>/bin/p<span style="color: #990000">:</span> <span style="color: #993399">1</span><span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">eval</span></span><span style="color: #990000">:</span> arithmetic expression<span style="color: #990000">:</span> expecting primary<span style="color: #990000">:</span> <span style="color: #FF0000">"2**</span>
<span style="color: #FF0000">62"</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Bash behavior for the integer overflow etc.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #993399">4611686018427387904</span>    <span style="color: #993399">4611686018427387904</span>
$ echo <span style="color: #FF0000">"$(echo 2^63-1 | bc)  $((9223372036854775807))"</span>
<span style="color: #993399">9223372036854775807</span>  <span style="color: #993399">9223372036854775807</span>
$ echo <span style="color: #FF0000">"$(echo 2^63 | bc)    $((9223372036854775808))"</span>
<span style="color: #993399">9223372036854775808</span>    -<span style="color: #993399">9223372036854775808</span>
$ echo <span style="color: #FF0000">"$(echo 2^64-1 | bc) $((18446744073709551615))"</span>
<span style="color: #993399">18446744073709551615</span> -<span style="color: #993399">1</span>
$ echo <span style="color: #FF0000">"$(echo 2^64 | bc)   $((18446744073709551616))"</span>
<span style="color: #993399">18446744073709551616</span>   <span style="color: #993399">0</span>
$ echo <span style="color: #FF0000">"$((2**62))"</span>
<span style="color: #993399">4611686018427387904</span></tt></pre></div></div>
<div class="paragraph"><p>The arithmetic expression always returns the largest positive integer when overflows for Dash.</p></div>
<div class="paragraph"><p>The "<code>**</code>" operator for arithmetic expression in "<code>$((...))</code>" is not POSIX but an usable extension for Bash.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">For arbitrary precision calculation, always use "<code>bc</code>".</td>
</tr></table>
</div>
<div class="paragraph"><p>Here is a shell program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the shell script: fibo</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="color: #009900">N</span><span style="color: #990000">=</span><span style="color: #FF0000">"$1"</span>
<span style="color: #009900">A</span><span style="color: #990000">=</span><span style="color: #993399">0</span>
<span style="color: #009900">B</span><span style="color: #990000">=</span><span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">[</span> <span style="color: #FF0000">"$B"</span> -lt <span style="color: #FF0000">"$N"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    echo <span style="color: #FF0000">"$B"</span>
    <span style="color: #009900">C</span><span style="color: #990000">=</span><span style="color: #009900">$B</span>
    <span style="color: #009900">B</span><span style="color: #990000">=</span><span style="color: #009900">$(($A+$B))</span>
    <span style="color: #009900">A</span><span style="color: #990000">=</span><span style="color: #009900">$C</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #FF0000">"$B"</span> -lt <span style="color: #FF0000">"0"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        echo <span style="color: #FF0000">"E: OVER FLOW at $B, stopped."</span>
        <span style="font-weight: bold"><span style="color: #0000FF">exit</span></span> <span style="color: #993399">1</span>
    <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">done</span></span></tt></pre></div></div>
<div class="paragraph"><p>Even with some overflow protection is coded in this to avoid infinite loop, if
you provide an argument to "<code>./fibo</code>" which is larger than "<code>$(echo '2^63' | bc)</code>"
then this program will fail in a cryptic way.</p></div>
<div class="listingblock">
<div class="title">Error with the integer overflow for the shell script</div>
<div class="content">
<pre><code>160500643816367088
259695496911122585
420196140727489673
679891637638612258
1100087778366101931
1779979416004714189
2880067194370816120
4660046610375530309
7540113804746346429
E: OVER FLOW at -6246583658587674878, stopped.
$ ./fibo "$(echo 2^63 | bc)"|tail
./fibo: 5: [: Illegal number: 9223372036854775808</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Do not abuse shell code when integer overflow may occur.  Its response to the overflow is cryptic.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_python_3">Python</h3>
<div class="paragraph"><p>Here is a Python program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Python script: fibo</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
n <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
a<span style="color: #990000">,</span> b <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> b <span style="color: #990000">&lt;</span> n<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>b<span style="color: #990000">)</span>
    a<span style="color: #990000">,</span> b <span style="color: #990000">=</span> b<span style="color: #990000">,</span> a <span style="color: #990000">+</span> b</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Python3 integer supports the arbitrary precision number which does not overflow :-)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lua_3">Lua</h3>
<div class="paragraph"><p>Here is a Lua program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Lua script: fibo</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>lua
    n <span style="color: #990000">=</span> arg<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">+</span><span style="color: #993399">0</span><span style="color: #990000">;</span>
    a <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    b <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> b <span style="color: #990000">&lt;</span> n <span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
        <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>b<span style="color: #990000">);</span>
        a<span style="color: #990000">,</span> b <span style="color: #990000">=</span> b<span style="color: #990000">,</span> a <span style="color: #990000">+</span> b<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Lua automatically converts large integer numbers to the double type.</p></div>
<div class="listingblock">
<div class="title">Behavior with the large integer for the Lua script</div>
<div class="content">
<pre><code>27777890035288
44945570212853
72723460248141
1.1766903046099e+14
1.9039249070914e+14
3.0806152117013e+14
4.9845401187926e+14
8.0651553304939e+14
1.3049695449287e+15
2.111485077978e+15</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Be careful with the behavior of Lua for large integer numbers :-)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_perl_3">Perl</h3>
<div class="paragraph"><p>Here is a Perl program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Perl script: fibo</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>perl <span style="color: #990000">-</span>w
    $n <span style="color: #990000">=</span> <span style="color: #FF0000">"$ARGV[0]"</span> <span style="color: #990000">+</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    $a <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    $b <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> $b <span style="color: #990000">&lt;</span> $n <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        print <span style="color: #FF0000">"$b\n"</span><span style="color: #990000">;</span>
        $c <span style="color: #990000">=</span> $b<span style="color: #990000">;</span>
        $b <span style="color: #990000">=</span> $a <span style="color: #990000">+</span> $b<span style="color: #990000">;</span>
        $a <span style="color: #990000">=</span> $c<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Perl automatically converts large integer numbers to the double type.</p></div>
<div class="listingblock">
<div class="title">Behavior with the large integer for the Perl script</div>
<div class="content">
<pre><code>420196140727489673
679891637638612258
1100087778366101931
1779979416004714189
2880067194370816120
4660046610375530309
7540113804746346429
12200160415121876738
1.97402742198682e+19
3.19404346349901e+19</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Be careful with the behavior of Perl for large integer numbers :-)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_c_5">C</h3>
<div class="paragraph"><p>Before we start, let&#8217;s check the integer overflow behavior of "<code>strtol</code>" on the
64-bit GNU/Linux platform using simple test code.  (This is more like how Dash
behaves as of 2013.)</p></div>
<div class="listingblock">
<div class="title">C long behavior for the integer overflow</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">strtol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Parsed as %ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile and test this C code.</p></div>
<div class="listingblock">
<div class="title">Testing the C <code>strtol</code> with the integer overflow</div>
<div class="content">
<pre><code>$ ./strtol-test 9223372036854775807
Parsed as 9223372036854775807
$ ./strtol-test 9223372036854775808
Parsed as 9223372036854775807
$ ./strtol-test 18446744073709551615
Parsed as 9223372036854775807
$ ./strtol-test 18446744073709551616
Parsed as 9223372036854775807</code></pre>
</div></div>
<div class="paragraph"><p>The C <code>strtol</code> always returns the largest positive integer when overflows,</p></div>
<div class="paragraph"><p>Here is a C program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the C: fibo.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">strtol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="color: #009900">long</span> a <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #009900">long</span> b <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #009900">long</span> c<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>b <span style="color: #990000">&lt;</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> b<span style="color: #990000">);</span>
        c <span style="color: #990000">=</span> b<span style="color: #990000">;</span>
        b <span style="color: #990000">=</span> a <span style="color: #990000">+</span> b<span style="color: #990000">;</span>
        a <span style="color: #990000">=</span> c<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>b <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: overflow %ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> b<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The C long sufferes overflow and needs to be dealt carefully.</p></div>
<div class="listingblock">
<div class="title">Error with the integer overflow for C</div>
<div class="content">
<pre><code>160500643816367088
259695496911122585
420196140727489673
679891637638612258
1100087778366101931
1779979416004714189
2880067194370816120
4660046610375530309
7540113804746346429
E: overflow -6246583658587674878</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Be careful with overflow.</td>
</tr></table>
</div>
<div class="paragraph"><p>The size of C variables are platform dependent.  Let&#8217;s check it with simple program.</p></div>
<div class="listingblock">
<div class="title">Source code for the C: checksize.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span>type<span style="color: #990000">,</span> var<span style="color: #990000">)</span>    <span style="color: #990000">\</span>
    <span style="color: #008080">type</span> var <span style="color: #990000">;</span> <span style="color: #990000">\</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"The size of '%s' is %li Byte(s).</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> #type<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>var<span style="color: #990000">))</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">char</span><span style="color: #990000">,</span> varchar<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">short</span><span style="color: #990000">,</span> varshort<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span><span style="color: #990000">,</span> varint<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span><span style="color: #990000">,</span> varlong<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> <span style="color: #009900">long</span><span style="color: #990000">,</span> varlonglong<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">float</span><span style="color: #990000">,</span> varfloat<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span><span style="color: #990000">,</span> vardouble<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">checksize</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> <span style="color: #009900">double</span><span style="color: #990000">,</span> varlongdouble<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Size of variables on C</div>
<div class="content">
<pre><code>Linux 3.16.0-4-amd64 x86_64 GNU/Linux
$ gcc -Wall -o checksize checksize.c
$ ./checksize
The size of 'char' is 1 Byte(s).
The size of 'short' is 2 Byte(s).
The size of 'int' is 4 Byte(s).
The size of 'long' is 8 Byte(s).
The size of 'long long' is 8 Byte(s).
The size of 'float' is 4 Byte(s).
The size of 'double' is 8 Byte(s).
The size of 'long double' is 16 Byte(s).</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_vala_3">Vala</h3>
<div class="paragraph"><p>Here is a vala program for the Fibonacci numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Vala: fibo.vala</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n <span style="color: #990000">=</span> <span style="color: #009900">long</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #009900">long</span> a <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #009900">long</span> b <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #009900">long</span> c<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>b <span style="color: #990000">&lt;</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> b<span style="color: #990000">);</span>
        c <span style="color: #990000">=</span> b<span style="color: #990000">;</span>
        b <span style="color: #990000">=</span> a <span style="color: #990000">+</span> b<span style="color: #990000">;</span>
        a <span style="color: #990000">=</span> c<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>b <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: overflow %ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> b<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The vala long (=C long) sufferes overflow and needs to be dealt carefully.</p></div>
<div class="listingblock">
<div class="title">Error with the integer overflow for Vala</div>
<div class="content">
<pre><code>$ ./fibo "$(echo 2^63-1 | bc)"|tail
160500643816367088
259695496911122585
420196140727489673
679891637638612258
1100087778366101931
1779979416004714189
2880067194370816120
4660046610375530309
7540113804746346429
E: overflow -6246583658587674878</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Be careful with overflow.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prime_numbers">Prime numbers</h2>
<div class="sectionbody">
<div class="paragraph"><p>A <a href="http://en.wikipedia.org/wiki/Prime_number">prime number</a> (or a prime) is a
natural number greater than 1 that has no positive divisors other than 1 and
itself.</p></div>
<div class="paragraph"><p>Let&#8217;s check simple code snippets to obtain prime numbers via the same trial
division algorithm implemented in different languages to study the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
basic for-loop syntax
</p>
</li>
<li>
<p>
relative execution speed
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please note this algorhism to obtain prime numbers is not the best one.</p></div>
<div class="sect2">
<h3 id="_shell_4">Shell</h3>
<div class="paragraph"><p>Here is a shell program to search the prime numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Shell script: prime</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="color: #009900">N_MAX</span><span style="color: #990000">=</span><span style="color: #009900">$1</span>
<span style="color: #009900">P</span><span style="color: #990000">=</span><span style="color: #FF0000">""</span> <span style="font-style: italic"><span style="color: #9A1900"># list containing all primes found</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> N <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="color: #009900">$(</span>seq <span style="color: #993399">2</span> <span style="color: #009900">$N_MAX</span><span style="color: #990000">);</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="color: #009900">FLAG_PRIME</span><span style="color: #990000">=</span><span style="color: #993399">1</span> <span style="font-style: italic"><span style="color: #9A1900"># True</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># search for all pimes found</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> I <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="color: #009900">$P</span><span style="color: #990000">;</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
        <span style="color: #009900">N_DIV_I</span><span style="color: #990000">=</span><span style="color: #009900">$(</span><span style="color: #990000">(</span><span style="color: #009900">$N</span> <span style="color: #990000">/</span> <span style="color: #009900">$I</span><span style="color: #990000">))</span>
        <span style="color: #009900">N_MOD_I</span><span style="color: #990000">=</span><span style="color: #009900">$(</span><span style="color: #990000">(</span><span style="color: #009900">$N</span> <span style="color: #990000">%</span> <span style="color: #009900">$I</span><span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #009900">$N_MOD_I</span> <span style="color: #990000">=</span> <span style="color: #993399">0</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            <span style="color: #009900">FLAG_PRIME</span><span style="color: #990000">=</span><span style="color: #993399">0</span> <span style="font-style: italic"><span style="color: #9A1900"># False</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900"># found not to be prime</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #009900">$N_DIV_I</span> -lt <span style="color: #009900">$I</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900"># no use doing more i-loop if N &lt; I*I</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">done</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #009900">$FLAG_PRIME</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span> <span style="color: #990000">]</span> <span style="color: #990000">;</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        <span style="color: #009900">P</span><span style="color: #990000">=</span><span style="color: #FF0000">"$P $N"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">done</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># space separated to line break separated</span></span>
echo <span style="color: #FF0000">"$P"</span> <span style="color: #990000">|</span>xargs -n<span style="color: #993399">1</span> echo</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s check time to compute prime numbers up to some numbers.</p></div>
<div class="listingblock">
<div class="title">Behavior of the shell script</div>
<div class="content">
<pre><code>real 15.56
user 13.11
sys 0.26</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_python_4">Python</h3>
<div class="paragraph"><p>Here is a Python program for the prime numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Python script: prime</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
p <span style="color: #990000">=</span> <span style="color: #990000">[]</span> <span style="font-style: italic"><span style="color: #9A1900"># list containing all primes found</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> n <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> n_max<span style="color: #990000">):</span>
    flag_prime <span style="color: #990000">=</span> True
    <span style="font-style: italic"><span style="color: #9A1900"># search for all pimes found</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> p<span style="color: #990000">:</span>
        <span style="color: #990000">(</span>n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">)</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">divmod</span></span><span style="color: #990000">(</span>n<span style="color: #990000">,</span>i<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">:</span>
            flag_prime <span style="color: #990000">=</span> False
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900"># found not to be prime</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900"># no loop over i if n &lt; i*i</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> flag_prime<span style="color: #990000">:</span>
        p<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>n<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> p<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the Perl script</div>
<div class="content">
<pre><code>real 0.09
user 0.09
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 2.74
user 2.74
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lua_4">Lua</h3>
<div class="paragraph"><p>Here is a Lua program for the prime numbers with BASIC style "<code>for</code>".</p></div>
<div class="listingblock">
<div class="title">Source code for the Lua script: prime</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>lua
n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">tonumber</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
True <span style="color: #990000">=</span> <span style="color: #993399">1</span>
False <span style="color: #990000">=</span> <span style="color: #993399">0</span>
p <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">-- list containing all primes found</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">,</span> n_max <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    flag_prime <span style="color: #990000">=</span> True
    <span style="font-style: italic"><span style="color: #9A1900">-- search for all pimes found</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> ii <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>#p<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">[</span>ii<span style="color: #990000">]</span>
        n_div_i <span style="color: #990000">=</span> math<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">floor</span></span><span style="color: #990000">(</span>n <span style="color: #990000">/</span> i<span style="color: #990000">)</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            flag_prime <span style="color: #990000">=</span> False
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900">-- found not to be prime</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_div_i <span style="color: #990000">&lt;</span> i <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900">-- no use doing more i-loop if n &lt; i*i</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> flag_prime <span style="color: #990000">==</span> True <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        table<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">insert</span></span><span style="color: #990000">(</span>p<span style="color: #990000">,</span>n<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> ii <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>#p<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>p<span style="color: #990000">[</span>ii<span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span></tt></pre></div></div>
<div class="paragraph"><p>Here is an alternative Lua program with "`for &#8230; in `" and a iterator function.</p></div>
<div class="listingblock">
<div class="title">Source code for the Lua script with "`for &#8230; in `": prime0</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>lua
n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">tonumber</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
True <span style="color: #990000">=</span> <span style="color: #993399">1</span>
False <span style="color: #990000">=</span> <span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">iter</span></span><span style="color: #990000">(</span>a<span style="color: #990000">)</span> <span style="font-style: italic"><span style="color: #9A1900">-- ordered iterator</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">local</span></span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">function</span></span><span style="color: #990000">()</span>
    i <span style="color: #990000">=</span> i <span style="color: #990000">+</span> <span style="color: #993399">1</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> a<span style="color: #990000">[</span>i<span style="color: #990000">]</span>
  <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
p <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">-- list containing all primes found</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">,</span> n_max <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    flag_prime <span style="color: #990000">=</span> True
    <span style="font-style: italic"><span style="color: #9A1900">-- search for all pimes found</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">iter</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
        n_div_i <span style="color: #990000">=</span> math<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">floor</span></span><span style="color: #990000">(</span>n <span style="color: #990000">/</span> i<span style="color: #990000">)</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            flag_prime <span style="color: #990000">=</span> False
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900">-- found not to be prime</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n_div_i <span style="color: #990000">&lt;</span> i <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span> <span style="font-style: italic"><span style="color: #9A1900">-- no use doing more i-loop if n &lt; i*i</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> flag_prime <span style="color: #990000">==</span> True <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        table<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">insert</span></span><span style="color: #990000">(</span>p<span style="color: #990000">,</span>n<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">iter</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span>
    <span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the Lua script</div>
<div class="content">
<pre><code>real 0.11
user 0.11
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 2.93
user 2.93
sys 0.00
$ /usr/bin/time -p ./prime0 "$(echo 2^20 | bc)"&gt;/dev/null
real 2.99
user 2.99
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_perl_4">Perl</h3>
<div class="paragraph"><p>Here is a Perl program for the prime numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the Perl script: prime</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #990000">!/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>perl <span style="color: #990000">-</span>w
use constant <span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
use constant <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>  <span style="color: #990000">=&gt;</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
$n_max <span style="color: #990000">=</span> <span style="color: #FF0000">"$ARGV[0]"</span> <span style="color: #990000">+</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
@p <span style="color: #990000">=</span> <span style="color: #990000">();</span> # list containing all primes found
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>$n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> $n <span style="color: #990000">&lt;</span> $n_max<span style="color: #990000">;</span> $n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
    $flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
    # search <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> all pimes found
    foreach $i <span style="color: #990000">(</span>@p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        $n_div_i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>$n <span style="color: #990000">/</span> $i<span style="color: #990000">);</span>
        $n_mod_i <span style="color: #990000">=</span> $n <span style="color: #990000">%</span> $i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>$n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            # found to be non<span style="color: #990000">-</span>prime
            $flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
            last<span style="color: #990000">;</span> # found <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> to be prime
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>$n_div_i <span style="color: #990000">&lt;</span> $i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            last<span style="color: #990000">;</span> # no use doing more i<span style="color: #990000">-</span>loop <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> n <span style="color: #990000">&lt;</span> i<span style="color: #990000">*</span>i
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>$flag_prime <span style="color: #990000">==</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        push <span style="color: #990000">(</span>@p<span style="color: #990000">,</span> $n<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
foreach $i <span style="color: #990000">(</span>@p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    print <span style="color: #FF0000">"$i\n"</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the Perl script</div>
<div class="content">
<pre><code>real 0.09
user 0.09
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 2.74
user 2.74
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c_6">C</h3>
<div class="sect3">
<h4 id="_c_with_the_array">C with the array</h4>
<div class="paragraph"><p>Here is a C program with the array for the prime numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the C program with the array: prime.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> ARRAY_SIZE <span style="color: #993399">100000000</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #009900">long</span> j <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #009900">long</span> p<span style="color: #990000">[</span>ARRAY_SIZE<span style="color: #990000">];</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> k<span style="color: #990000">,</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag_prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> n <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">;</span> n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        flag_prime <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* search for all pimes found */</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>k <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> k <span style="color: #990000">&lt;</span> j<span style="color: #990000">;</span> k<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
            i <span style="color: #990000">=</span> p<span style="color: #990000">[</span>k<span style="color: #990000">];</span>
            n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
            n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                flag_prime <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>flag_prime <span style="color: #990000">==</span> TRUE<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            p<span style="color: #990000">[</span>j<span style="color: #990000">]=</span>n<span style="color: #990000">;</span>
            j<span style="color: #990000">++;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>j<span style="color: #990000">&gt;</span>ARRAY_SIZE<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: Overflow array after %ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">[</span>j<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>k<span style="color: #990000">=</span><span style="color: #993399">1</span><span style="color: #990000">;</span> k <span style="color: #990000">&lt;</span> j<span style="color: #990000">;</span> k<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">[</span>k<span style="color: #990000">]);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile this into a binary executable.</p></div>
<div class="listingblock">
<div class="title">Compilation of the C program with the array</div>
<div class="content">
<pre><code></code></pre>
</div></div>
<div class="listingblock">
<div class="title">Behavior of the C program with the array</div>
<div class="content">
<pre><code>Command terminated by signal 11
real 0.00
user 0.00
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
Command terminated by signal 11
real 0.00
user 0.00
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_c_with_the_list">C with the list</h4>
<div class="paragraph"><p>Here is a C program with the list for the prime numbers.</p></div>
<div class="listingblock">
<div class="title">Source code for the C program with the list: prime.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL <span style="color: #990000">;</span> p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> n <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">;</span> n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            q<span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
            q<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>head <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                head <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                tail<span style="color: #990000">-&gt;</span>next<span style="color: #990000">=</span>q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL<span style="color: #990000">;</span> p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL<span style="color: #990000">;</span> q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">),</span> p <span style="color: #990000">=</span> q<span style="color: #990000">)</span> <span style="color: #FF0000">{}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">It is a good practice to free memory properly to avoid <a href="http://en.wikipedia.org/wiki/C_dynamic_memory_allocation#Common_errors">common errors in C dynamic memory allocation</a> even when OS may take care.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile this into a binary executable.</p></div>
<div class="listingblock">
<div class="title">Compilation of the C program with the list</div>
<div class="content">
<pre><code></code></pre>
</div></div>
<div class="listingblock">
<div class="title">Behavior of the C program with the list</div>
<div class="content">
<pre><code>real 0.00
user 0.00
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 0.13
user 0.13
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_c_with_the_list_variants">C with the list (variants)</h4>
<div class="paragraph"><p>Since this is very good example to learn C with the dynamic memory allocation, I made a combination code of several styles.</p></div>
<div class="listingblock">
<div class="title">Source code for the C program with the list: prime-all.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE<span style="color: #990000">==</span><span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> primelist<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#elif</span></span> STYLE<span style="color: #990000">==</span><span style="color: #993399">2</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE <span style="color: #990000">==</span> <span style="color: #993399">4</span>
    p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL <span style="color: #990000">;</span> p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE <span style="color: #990000">==</span> <span style="color: #993399">4</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE <span style="color: #990000">==</span> <span style="color: #993399">4</span>
    n <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>n <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        n<span style="color: #990000">++;</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> n <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">;</span> n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE <span style="color: #990000">==</span> <span style="color: #993399">3</span>
            q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">malloc</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
            q<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
            q<span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
            q<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>head <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                head <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                tail<span style="color: #990000">-&gt;</span>next<span style="color: #990000">=</span>q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> STYLE <span style="color: #990000">==</span> <span style="color: #993399">4</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL<span style="color: #990000">;</span> p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">=</span> head<span style="color: #990000">;</span> p <span style="color: #990000">!=</span> NULL<span style="color: #990000">;</span> q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">),</span> p <span style="color: #990000">=</span> q<span style="color: #990000">)</span> <span style="color: #FF0000">{}</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This code uses CPP macro to change its style.</p></div>
<div class="ulist"><ul>
<li>
<p>
"<code>#define STYLE 0</code>" enables the basic style of the <code>struct</code> and <code>typedef</code> combination.
</p>
</li>
<li>
<p>
"<code>#define STYLE 1</code>" enables the shorthand style of the <code>struct</code> and <code>typedef</code> combination.
</p>
</li>
<li>
<p>
"<code>#define STYLE 2</code>" enables the alternative style of the <code>struct</code> and <code>typedef</code> combination using the <code>typedef</code> feature allowing the incomplete type. (Vala generated C code uses this style.)
</p>
</li>
<li>
<p>
"<code>#define STYLE 3</code>" enables the alternative style of memory allocation using <code>malloc</code> instead of <code>calloc</code>.
</p>
</li>
<li>
<p>
"<code>#define STYLE 4</code>" enables the <code>while</code>-loop style instead of <code>for</code>-loop.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here, I used the <code>_primelist</code> tag for <code>struct</code> to distinguish from the
<code>primelist</code> identifier for <code>typedef</code>.   The <code>_primelist</code> tags can be replaced
with <code>primelist</code> without problem in C since <code>struct</code> tags and typedefs are in
separate namespaces in C (But C++ is a different story &#8230;).</p></div>
<div class="paragraph"><p>The first 3 memory allocation styles generate exactly the same code.  The
difference between <code>calloc</code> and <code>malloc</code> codes is because only <code>calloc</code> sets
the allocated memory to zero.</p></div>
<div class="paragraph"><p>The "<code>-D NAME=DEFINITION</code>" compiler option is processed effectively as
"<code>#define NAME DEFINITION</code>" at the top of the source. (See more in the info
page for CPP.)</p></div>
<div class="paragraph"><p>Let&#8217;s compile this into 5 binaries using this "<code>-D NAME=DEFINITION</code>" compiler
option.</p></div>
<div class="listingblock">
<div class="title">Compilation of the C program with the list in several styles</div>
<div class="content">
<pre><code>$ gcc -O9 -Wall -D'STYLE=1' -o prime1 prime-all.c
$ gcc -O9 -Wall -D'STYLE=2' -o prime2 prime-all.c
$ gcc -O9 -Wall -D'STYLE=3' -o prime3 prime-all.c
$ gcc -O9 -Wall -D'STYLE=4' -o prime4 prime-all.c</code></pre>
</div></div>
<div class="paragraph"><p>All these generated binary executable programs work the same (i.e., the same execution speed).</p></div>
<div class="paragraph"><p>The <code>prime-all.c</code> code can be simplified to <code>prime.c</code> by removing preprocessor conditionals with <code>unifdef</code>(1).</p></div>
<div class="listingblock">
<div class="title">Removal of preprocessor conditionals from <code>prime-all.c</code></div>
<div class="content">
<pre><code>$ unifdef -D'STYLE=1' -o prime1.c prime-all.c
$ unifdef -D'STYLE=2' -o prime2.c prime-all.c
$ unifdef -D'STYLE=3' -o prime3.c prime-all.c
$ unifdef -D'STYLE=4' -o prime4.c prime-all.c</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_vala_glib">Vala (Glib)</h3>
<div class="paragraph"><p>Here is a Vala program for the prime numbers using only Glib.</p></div>
<div class="paragraph"><p>(This is a bad program example. I know this is problematic only after making this program and analyzing the problem I faced. See <a href="#_benchmark">Prime: Benchmark</a>.)</p></div>
<div class="listingblock">
<div class="title">Source code for the Vala program: prime.vala</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n_max <span style="color: #990000">=</span> <span style="color: #009900">long</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #009900">var</span> p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> List<span style="color: #990000">&lt;</span><span style="color: #009900">long</span><span style="color: #990000">&gt;</span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> n <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">;</span> n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">bool</span> flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">// search for all pimes found</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> i <span style="color: #008080">in</span> p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">long</span> n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
            <span style="color: #009900">long</span> n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// found not to be prime</span></span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// no use doing more i-loop if n &lt; i*i</span></span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>flag_prime <span style="color: #990000">==</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            p<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>n<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> i <span style="color: #008080">in</span> p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%lld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the Vala program</div>
<div class="content">
<pre><code>real 0.05
user 0.05
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 7.11
user 7.10
sys 0.00</code></pre>
</div></div>
<div class="paragraph"><p>Havoc Pennington said "<a href="https://mail.gnome.org/archives/gtk-devel-list/2000-October/msg00059.html">g_list_last() and g_list_append() are defined to be O(n) operations; they are not fast for long lists. GList is modeled on the lists found in Scheme, Haskell, etc. which behave the same way.</a>"  I should have known &#8230;</p></div>
</div>
<div class="sect2">
<h3 id="_vala_gee">Vala (Gee)</h3>
<div class="paragraph"><p>Here is a Vala program for the prime numbers using <a href="https://live.gnome.org/Libgee">Gee</a>.</p></div>
<div class="paragraph"><p>(This is an improved program example over previous Vala (GLib) one. See <a href="#_benchmark">Prime: Benchmark</a>.)</p></div>
<div class="paragraph"><p><code>ArrayList&lt;G&gt;</code> provided by Gee is used instead of <code>List&lt;G&gt;</code> provided by Glib.  This type of list structure is very fast for adding data at the end of the list.</p></div>
<div class="listingblock">
<div class="title">Source code for the Vala program: prime.vala</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gee<span style="color: #990000">;</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> n_max <span style="color: #990000">=</span> <span style="color: #009900">long</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span>args<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #009900">var</span> p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> ArrayList<span style="color: #990000">&lt;</span><span style="color: #009900">long</span><span style="color: #990000">&gt;</span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> n <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">;</span> n<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">bool</span> flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>
        <span style="font-style: italic"><span style="color: #9A1900">// search for all pimes found</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> i <span style="color: #008080">in</span> p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">long</span> n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
            <span style="color: #009900">long</span> n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                flag_prime <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// found not to be prime</span></span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// no use doing more i-loop if n &lt; i*i</span></span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>flag_prime <span style="color: #990000">==</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            p<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>n<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span> <span style="color: #990000">(</span><span style="color: #009900">long</span> i <span style="color: #008080">in</span> p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stdout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%lld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the Vala program</div>
<div class="content">
<pre><code>real 0.01
user 0.01
sys 0.00
$ /usr/bin/time -p ./prime "$(echo 2^20 | bc)"&gt;/dev/null
real 0.47
user 0.47
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_benchmark">Benchmark</h3>
<div class="paragraph"><p>Here are benchmark results of various program languages.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Speed benchmark of various program languages</caption>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<thead>
<tr>
<th align="left" valign="top">Program</th>
<th align="left" valign="top"> real(2^16) </th>
<th align="left" valign="top"> user(2^16) </th>
<th align="left" valign="top"> sys(2^16) </th>
<th align="left" valign="top"> real(2^20) </th>
<th align="left" valign="top"> user(2^20) </th>
<th align="left" valign="top"> sys(2^20)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Shell</p></td>
<td align="left" valign="top"><p class="table">15.56</p></td>
<td align="left" valign="top"><p class="table">13.11</p></td>
<td align="left" valign="top"><p class="table">0.26</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Python</p></td>
<td align="left" valign="top"><p class="table">0.12</p></td>
<td align="left" valign="top"><p class="table">0.12</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">3.91</p></td>
<td align="left" valign="top"><p class="table">3.90</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lua</p></td>
<td align="left" valign="top"><p class="table">0.11</p></td>
<td align="left" valign="top"><p class="table">0.11</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">2.93</p></td>
<td align="left" valign="top"><p class="table">2.93</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lua (for &#8230; in)</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
<td align="left" valign="top"><p class="table">&#8201;&#8212;&#8201;</p></td>
<td align="left" valign="top"><p class="table">2.99</p></td>
<td align="left" valign="top"><p class="table">2.99</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Perl</p></td>
<td align="left" valign="top"><p class="table">0.09</p></td>
<td align="left" valign="top"><p class="table">0.09</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">2.74</p></td>
<td align="left" valign="top"><p class="table">2.74</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">C (array)</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">C (list)</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.13</p></td>
<td align="left" valign="top"><p class="table">0.13</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Vala (glib)</p></td>
<td align="left" valign="top"><p class="table">0.05</p></td>
<td align="left" valign="top"><p class="table">0.05</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">7.11</p></td>
<td align="left" valign="top"><p class="table">7.10</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Vala (gee)</p></td>
<td align="left" valign="top"><p class="table">0.01</p></td>
<td align="left" valign="top"><p class="table">0.01</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">0.47</p></td>
<td align="left" valign="top"><p class="table">0.47</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Here, the time reported by the <code>/usr/bin/time -p</code> command is in POSIX standard 1003.2 style:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>real</code>: Elapsed real (wall clock) time used by the process, in seconds.
</p>
</li>
<li>
<p>
<code>user</code>: Total number of CPU-seconds that the process used directly (in user mode), in seconds.
</p>
</li>
<li>
<p>
<code>sys</code>: Total number of CPU-seconds used by the system on behalf of the process (in kernel mode), in seconds.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please disregard minor differences such as 20% since this benchmark is not
meant to be very accurate.</p></div>
<div class="paragraph"><p>The speed differences are several orders of magnitudes.</p></div>
<div class="paragraph"><p>A code written in any compiler language is faster than one written in any interpreter in normal situation.</p></div>
<div class="paragraph"><p>But looking at <code>real (2^20)</code> case, the Vala program with GLib result is very
odd. For now, let me just say "The root cause is the way GLib is used.  There
are many operations to add an item at the end of the long list. This is slow
o(n) operation."</p></div>
<div class="paragraph"><p>This will be analyzed in <a href="#_profiling_prime">Profiling prime</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The use of the compiler does not guarantee the faster code.  Algorithm is important.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_process">Process</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are some practice results to play with
<a href="http://en.wikipedia.org/wiki/Process_(computing)">process</a> and
<a href="http://en.wikipedia.org/wiki/Inter-process_communication">inter process communication (IPC)</a>
(<a href="http://en.wikipedia.org/wiki/Unix_signal">signal</a> and <a href="http://en.wikipedia.org/wiki/Network_socket">network socket</a>)
on Debian wheezy.</p></div>
<div class="sect2">
<h3 id="_signal">Signal</h3>
<div class="paragraph"><p>Signal is explained in <code>signal</code>(7).</p></div>
<div class="paragraph"><p>Here are default actions for notable signals.</p></div>
<div class="ulist"><ul>
<li>
<p>
Default action is to terminate the process.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>SIGHUP</code> = 1 : Death of controlling process
</p>
</li>
<li>
<p>
<code>SIGINT</code> = 2 : Interrupt from keyboard (Ctrl-<code>C</code>)
</p>
</li>
<li>
<p>
<code>SIGKILL</code> = 9 : Kill signal (<strong>non-trappable</strong>)
</p>
</li>
<li>
<p>
<code>SIGALRM</code> = 14 : Timer signal from alarm(2)
</p>
</li>
<li>
<p>
<code>SIGTERM</code> = 15 : Termination signal (default for <code>kill</code>)
</p>
</li>
<li>
<p>
<code>SIGUSR1</code> = 10 : User-defined signal 1
</p>
</li>
<li>
<p>
<code>SIGUSR2</code> = 12 : User-defined signal 2
</p>
</li>
</ul></div>
</li>
<li>
<p>
Default action is to terminate the process and dump core.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>SIGQUIT</code> = 3 : Quit from keyboard (Ctrl-<code>\</code>)
</p>
</li>
<li>
<p>
<code>SIGTRAP</code> = 5 : Trace/breakpoint trap
</p>
</li>
<li>
<p>
<code>SIGSEGV</code> = 11 : Invalid memory reference
</p>
</li>
</ul></div>
</li>
<li>
<p>
Default action is to continue the process
</p>
<div class="ulist"><ul>
<li>
<p>
<code>SIGCONT</code> = 18 : Continue if stopped
</p>
</li>
</ul></div>
</li>
<li>
<p>
Default action is to stop the process.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>SIGSTOP</code> = 19 : Stop process (<strong>non-trappable</strong>)
</p>
</li>
<li>
<p>
<code>SIGTSTP</code> = 20 : Stop typed at tty (Ctrl-<code>Z</code>)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Default action is to ignore the signal.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>SIGWINCH</code> = 28 : Gracefully shutdown the worker processes (httpd, non-POSIX)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>I can check signal assignment situation quickly with the Bash builtin "<code>kill -l</code>"
command.  (Not with other shells and command!)</p></div>
<div class="listingblock">
<div class="title">List of signal names and signal numbers with the Bash builtin "<code>kill -l</code>"</div>
<div class="content">
<pre><code> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP
 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1
11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR
31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Please note that <code>SIGABRT</code> and <code>SIGIOT</code> share the same signal value 6; and
<code>SIGIO</code> and <code>SIGLOST</code> share the same signal value 29.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_shell_kill">Shell: kill</h3>
<div class="paragraph"><p>The <code>kill</code> commands behave differently depending on which one used.  Let&#8217;s
check their syntax to send signals.</p></div>
<div class="listingblock">
<div class="title">The example of <code>kill</code> commands</div>
<div class="content">
<pre><code>kill: usage: kill [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill
-l [sigspec]
$ dash -c kill
dash: 1: kill: Usage: kill [-s sigspec | -signum | -sigspec] [pid | job]... or
kill -l [exitstatus]
$ /bin/kill

Usage:
 kill [options] &lt;pid&gt; [...]

Options:
 &lt;pid&gt; [...]            send signal to every &lt;pid&gt; listed
 -&lt;signal&gt;, -s, --signal &lt;signal&gt;
                        specify the &lt;signal&gt; to be sent
 -l, --list=[&lt;signal&gt;]  list all signal names, or convert one to a name
 -L, --table            list all signal names in a nice table

 -h, --help     display this help and exit
 -V, --version  output version information and exit

For more details see kill(1).
$ bash -c "kill -l 15"
TERM
$ dash -c "kill -l 15"
TERM
$ /bin/kill -l15
TERM</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Only the Bash builtin <code>kill</code> can use jobspec such as <code>%1</code> as its argument.
</p>
</li>
<li>
<p>
If signal number argument is given to "<code>/bin/kill -l</code>", there should be no space before it.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_shell_trap">Shell: trap</h3>
<div class="paragraph"><p>The <code>trap</code> command can trap signals.</p></div>
<div class="listingblock">
<div class="title">Example shell code with trap and infinite loop.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-weight: bold"><span style="color: #000000">trap_hup()</span></span> {
    echo <span style="color: #FF0000">"SIGHUP detected."</span>
}
<span style="font-weight: bold"><span style="color: #0000FF">trap</span></span> trap_hup HUP
<span style="font-weight: bold"><span style="color: #0000FF">trap</span></span> <span style="color: #FF0000">"echo 'SIGTSTP detected.'"</span> TSTP
<span style="font-weight: bold"><span style="color: #0000FF">trap</span></span> <span style="color: #FF0000">""</span> TERM
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span> <span style="font-weight: bold"><span style="color: #0000FF">do</span></span> sleep <span style="color: #993399">0.01</span><span style="color: #990000">;</span><span style="font-weight: bold"><span style="color: #0000FF">done</span></span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s play with this on the Bash shell.</p></div>
<div class="listingblock">
<div class="title">Example of kill used with <code>./sigtrap</code></div>
<div class="content">
<pre><code>$ ./sigtrap &amp;
[1] 12692
$ kill -s HUP %1
SIGHUP detected.
$ kill -s TSTP %1
SIGTSTP detected.
$ kill -n 1 %1
SIGHUP detected.
$ kill -1 %1
SIGHUP detected.
$ ps
  PID TTY          TIME CMD
12589 pts/9    00:00:00 bash
12692 pts/9    00:00:31 sigtrap
12697 pts/9    00:00:00 ps
$ jobs
[1]+  Running                 ./sigtrap &amp;
$ kill -s INT %1
$ jobs
[1]+  Interrupt               ./sigtrap
$ jobs
$ dash
$ ./sigtrap &amp;
$ ps
  PID TTY          TIME CMD
12589 pts/9    00:00:00 bash
12705 pts/9    00:00:00 dash
12710 pts/9    00:00:10 sigtrap
12712 pts/9    00:00:00 ps
$ kill -s INT 12710
$ ps
  PID TTY          TIME CMD
12589 pts/9    00:00:00 bash
12705 pts/9    00:00:00 dash
12733 pts/9    00:00:00 ps
[1] + Interrupt                  ./sigtrap
$ ps
  PID TTY          TIME CMD
12589 pts/9    00:00:00 bash
12705 pts/9    00:00:00 dash
12734 pts/9    00:00:00 ps</code></pre>
</div></div>
<div class="paragraph"><p>If you are not on the Bash shell, you have to use PID "<code>10951</code>", instead of jobspec "<code>%1</code>".</p></div>
<div class="paragraph"><p>When writing a shell script which is usually the Dash shell, PID changes every
invocation.  The use of <code>kill</code> is non-trivial for such case.  So we use the
<code>killall</code>(1) command instead.</p></div>
<div class="listingblock">
<div class="title">Example of <code>killall</code> used with <code>./sigtrap</code></div>
<div class="content">
<pre><code>$ ps
  PID TTY          TIME CMD
 7128 pts/3    00:00:00 sh
 7129 pts/3    00:00:00 sh
 7130 pts/3    00:00:00 sigtrap
 7131 pts/3    00:00:00 ps
 7132 pts/3    00:00:00 sleep
$ jobs
[1] + Running
$ killall -s HUP sigtrap
SIGHUP detected.
$ killall -s TSTP sigtrap
SIGTSTP detected.
$ killall -s 1 sigtrap
SIGHUP detected.
$ killall -HUP sigtrap
$ ps
  PID TTY          TIME CMD
 7128 pts/3    00:00:00 sh
 7129 pts/3    00:00:00 sh
 7130 pts/3    00:00:00 sigtrap
 7191 pts/3    00:00:00 sleep
 7195 pts/3    00:00:00 ps
$ jobs
[1] + Running
$ killall -s TERM sigtrap
$ ps
SIGHUP detected.
  PID TTY          TIME CMD
 7128 pts/3    00:00:00 sh
 7129 pts/3    00:00:00 sh
 7130 pts/3    00:00:00 sigtrap
 7197 pts/3    00:00:00 ps
$ jobs
[1] + Running
$ killall -s KILL sigtrap
$ ps
  PID TTY          TIME CMD
 7128 pts/3    00:00:00 sh
 7129 pts/3    00:00:00 sh
 7198 pts/3    00:00:00 sleep
 7200 pts/3    00:00:00 ps
$ jobs
[1] + Killed</code></pre>
</div></div>
<div class="paragraph"><p>The most common use of the <code>trap</code> command is to set up a hook script for the
program <a href="http://en.wikipedia.org/wiki/Exit_(operating_system)">exit</a>.  Here a special signal <code>EXIT</code> is used in addition to other normal
signals with the <code>trap</code> command.  This <code>EXIT</code> signal is raised when shell
script itself exits without external signals.</p></div>
<div class="listingblock">
<div class="title">Example shell code with trap and remove a file.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">set</span></span> -x
<span style="font-weight: bold"><span style="color: #0000FF">trap</span></span> <span style="color: #FF0000">'echo "Exit! Removing foo.tmp."; rm foo.tmp'</span> EXIT HUP INT TERM
touch foo<span style="color: #990000">.</span>tmp
<span style="font-style: italic"><span style="color: #9A1900"># actual code to use foo.tmp</span></span>
ls -l foo<span style="color: #990000">.</span>tmp
sleep <span style="color: #993399">1</span> <span style="font-style: italic"><span style="color: #9A1900"># timing to ensure ls output</span></span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s play with this.</p></div>
<div class="listingblock">
<div class="title">Example of <code>./traprm</code></div>
<div class="content">
<pre><code>ls: cannot access foo.tmp: No such file or directory
$ ./traprm
+ trap echo "Exit! Removing foo.tmp."; rm foo.tmp EXIT HUP INT TERM
+ touch foo.tmp
+ ls -l foo.tmp
-rw-rw-r-- 1 osamu osamu 0 Aug 20 23:25 foo.tmp
+ sleep 1
+ echo Exit! Removing foo.tmp.
Exit! Removing foo.tmp.
+ rm foo.tmp
$ ls -l foo.tmp
ls: cannot access foo.tmp: No such file or directory</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_shell_new_process">Shell: new process</h3>
<div class="paragraph"><p>Shell can start a new process easily by:</p></div>
<div class="ulist"><ul>
<li>
<p>
starting another shell program as a command.
</p>
</li>
<li>
<p>
starting a block of shell code list enclosed in <code>( ... )</code> as subshell.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use of <code>&amp;</code> after starting the new process enables the current shell to
continue processing the subsequent part of the current shell and the new
process in parrallel.  It moves the new process to the background.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use the alternative syntax of a block of shell code list enclosed in
<code>{ ... ; }</code> to execute them in the current shell environment.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_python_new_process">Python: new process</h3>
<div class="paragraph"><p>Python can start a new process easily by:</p></div>
<div class="ulist"><ul>
<li>
<p>
starting a command "<code>foo</code>" using the <code>os.system("foo")</code> function after "<code>import os</code>".
</p>
</li>
<li>
<p>
starting a command "<code>foo</code>" using the <code>os.popen("foo")</code> function after "<code>import os</code>".
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The new subprocess module can be used to replace many process related
modules and functions to make them more secure easily.  See
<a href="http://docs.python.org/3.3/library/subprocess.html">subprocess  Subprocess management</a></td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lua_new_process">Lua: new process</h3>
<div class="paragraph"><p>Lua can start a new process easily by:</p></div>
<div class="ulist"><ul>
<li>
<p>
starting a command "<code>foo</code>" using the <code>os.execute("foo")</code>.
</p>
</li>
<li>
<p>
starting a command "<code>foo</code>" using the <code>io.popen("foo")</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_c_new_process">C: new process</h3>
<div class="paragraph"><p>Let&#8217;s execute a command as a new process from the C program in 3 ways.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>system</code>(3) : The <code>system()</code> function starts a command by calling "<code>/bin/sh -c</code>" command, and returns after its completion.  During execution of the command, <code>SIGCHLD</code> will be blocked, and <code>SIGINT</code> and <code>SIGQUIT</code> will be ignored.
</p>
</li>
<li>
<p>
<code>popen</code>(3) : The <code>popen()</code> function opens a process by creating a <a href="http://en.wikipedia.org/wiki/Anonymous_pipe">pipe</a>(read-only or write-only), <a href="http://en.wikipedia.org/wiki/Fork_(operating_system)">forking</a>, and invoking the shell.
</p>
</li>
<li>
<p>
<code>fork</code>(2) + <code>exec</code>(3) : The <code>fork()</code> function creates a new process by duplicating the calling process.  The <code>exec()</code> family of functions replaces the current process image with a new process image.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_c_system">C: system</h4>
<div class="paragraph"><p>Let&#8217;s start a command from the C program with <code>system</code>(3) while checking environment variables.</p></div>
<div class="listingblock">
<div class="title">Command execution: <code>system.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit getenv system */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* [f]printf perror */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"main    HOME    = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"HOME"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"main    PATH    = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"PATH"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"main    TERM    = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"TERM"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"main    DISPLAY = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"DISPLAY"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"--- Let's fake shell command prompt with system</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"$ ls -li system.c</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">system</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ls -li system.c"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>./system</code></div>
<div class="content">
<pre><code>$ ./system
main    HOME    = /home/osamu
main    PATH    = /path/to/c/../../bin:(CURDIR)/bin:(CURDIR)/bin:/home/osamu/bin:...
main    TERM    = dumb
main    DISPLAY = :0
--- Let's fake shell command prompt with system
$ ls -li system.c
4252301 -rw-rw-r-- 1 osamu osamu 545 Mar 12  2013 system.c</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_c_popen">C: popen</h4>
<div class="paragraph"><p>Let&#8217;s start a child process with <code>popen</code>(3) and pass messages via pipe from the <a href="http://en.wikipedia.org/wiki/Child_process">child process</a> to the <a href="http://en.wikipedia.org/wiki/Parent_process">parent process</a>.</p></div>
<div class="listingblock">
<div class="title">Command execution: <code>popen.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit getenv */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* [f]printf perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* getpid getppid fork exec sleep */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* getpid getppid */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    FILE<span style="color: #990000">*</span> f<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span> p<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> size<span style="color: #990000">;</span>
    p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">malloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1024</span><span style="color: #990000">);</span>
    size <span style="color: #990000">=</span> <span style="color: #990000">(</span>size_t<span style="color: #990000">)</span> <span style="color: #993399">1024</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"main    PID     = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"main    PPID    = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getppid</span></span><span style="color: #990000">());</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"--- Let's fake shell command prompt with popen.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"$ ls -li *.c; echo PPID=$PPID; echo PID=$$</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">popen</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ls -li *.c; echo PPID=$PPID; echo PID=$$"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"r"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>f <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: popen"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"--- Let's print result of popen.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">getline</span></span><span style="color: #990000">(&amp;</span>p<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>size<span style="color: #990000">,</span> f<span style="color: #990000">)</span> <span style="color: #990000">&gt;=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"%s"</span><span style="color: #990000">,</span> p<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">pclose</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>./popen</code></div>
<div class="content">
<pre><code>$ echo PID=$$
PID=6863
$ echo PPID=$PPID
PPID=6862
$ ./popen
main    PID     = 6874
main    PPID    = 6863
--- Let's fake shell command prompt with popen.
$ ls -li *.c; echo PPID=$PPID; echo PID=$$
--- Let's print result of popen.
4252303 -rw-rw-r-- 1 osamu osamu 2056 Mar 12  2013 forkexec.c
4252298 -rw-rw-r-- 1 osamu osamu  942 Mar 12  2013 popen.c
4252305 -rw-rw-r-- 1 osamu osamu 1292 Mar 17  2013 sigaction.c
4252302 -rw-rw-r-- 1 osamu osamu  723 Mar 16  2013 signal.c
4252301 -rw-rw-r-- 1 osamu osamu  545 Mar 12  2013 system.c
PPID=6874
PID=6875
$ ./popen 2&gt;/dev/null
$ ./popen &gt;/dev/null
main    PID     = 6880
main    PPID    = 6863
--- Let's fake shell command prompt with popen.
$ ls -li *.c; echo PPID=$PPID; echo PID=$$
--- Let's print result of popen.
4252303 -rw-rw-r-- 1 osamu osamu 2056 Mar 12  2013 forkexec.c
4252298 -rw-rw-r-- 1 osamu osamu  942 Mar 12  2013 popen.c
4252305 -rw-rw-r-- 1 osamu osamu 1292 Mar 17  2013 sigaction.c
4252302 -rw-rw-r-- 1 osamu osamu  723 Mar 16  2013 signal.c
4252301 -rw-rw-r-- 1 osamu osamu  545 Mar 12  2013 system.c
PPID=6880
PID=6881</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_c_fork_exec">C: fork + exec</h4>
<div class="paragraph"><p>Let&#8217;s start a child process with <code>fork</code>(2) and pass messages from the <a href="http://en.wikipedia.org/wiki/Child_process">child process</a> to the <a href="http://en.wikipedia.org/wiki/Parent_process">parent process</a> via pipe.</p></div>
<div class="listingblock">
<div class="title">Fork and exec example: <code>forkexec.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit getenv */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* [f]printf perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* strlen */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* getpid getppid fork exec sleep */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* getpid getppid wait */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/wait.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* wait */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">pid_t</span> p<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> pipefd<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">],</span> e<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> buf<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span> b <span style="color: #990000">=</span> <span style="color: #FF0000">"MESSAGE: passed from child to parent via pipe</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  PID     = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  PPID    = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getppid</span></span><span style="color: #990000">());</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pipe</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>   <span style="font-style: italic"><span style="color: #9A1900">/* create pipe */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: pipe"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"--- Let's fork ...</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fork</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Fork error</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>p <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>    <span style="font-style: italic"><span style="color: #9A1900">/* child process */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* Close unused read end fd */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"child   PID     = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"child   PPID    = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getppid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"child   write to pipe</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> b<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>b<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">dup2</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> STDOUT_FILENO<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"child&gt;  ls -l forkexec.c</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        e <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">execlp</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/bin/ls"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"ls"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"-l"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"forkexec.c"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* execute ls -l */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* Close used write end fd */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">_exit</span></span><span style="color: #990000">(</span>e<span style="color: #990000">);</span>           <span style="font-style: italic"><span style="color: #9A1900">/* idiom to end child process "immediately" */</span></span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>                <span style="font-style: italic"><span style="color: #9A1900">/* parent process */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* Close unused write end fd */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  PID     = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  PPID    = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getppid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  forked  = %d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  read from pipe</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">read</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">],</span> <span style="color: #990000">&amp;</span>buf<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>STDERR_FILENO<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>buf<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>pipefd<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* Close used read end fd */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">wait</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">);</span>         <span style="font-style: italic"><span style="color: #9A1900">/* Wait for child */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"parent  child exited.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>./forkexec</code></div>
<div class="content">
<pre><code>$ ./forkexec
parent  PID     = 6997
parent  PPID    = 6986
--- Let's fork ...
parent  PID     = 6997
parent  PPID    = 6986
parent  forked  = 6998
parent  read from pipe
child   PID     = 6998
child   PPID    = 6997
child   write to pipe
MESSAGE: passed from child to parent via pipe
child&gt;  ls -l forkexec.c
-rw-rw-r-- 1 osamu osamu 2056 Mar 12  2013 forkexec.c
parent  child exited.
$
$ ./forkexec 2&gt;/dev/null
child   PID     = 7000
child   PPID    = 6999
child   write to pipe
$
$ ./forkexec &gt;/dev/null
parent  PID     = 7001
parent  PPID    = 6986
--- Let's fork ...
parent  PID     = 7001
parent  PPID    = 6986
parent  forked  = 7002
parent  read from pipe
MESSAGE: passed from child to parent via pipe
-rw-rw-r-- 1 osamu osamu 2056 Mar 12  2013 forkexec.c
parent  child exited.</code></pre>
</div></div>
<div class="paragraph"><p>This last method uses the <code>exec</code>(3) family of functions with various argument usages.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>l</code>-suffix: <code>execl</code>, <code>execlp</code>, <code>execle</code>
</p>
<div class="ulist"><ul>
<li>
<p>
The argument list available to the new program is directly used as the later part of the arguments.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>v</code>-suffix: <code>execv</code>, <code>execvp</code>, <code>execvpe</code>
</p>
<div class="ulist"><ul>
<li>
<p>
An array of pointers to null-terminated strings are used to represent the argument list available to the new program.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>p</code>-suffix: <code>execlp</code> <code>execvp</code>, <code>execvpe</code>
</p>
<div class="ulist"><ul>
<li>
<p>
This indicates that the function duplicates the shell function for searching an executable file indicated by the <code>$PATH</code> environment variable.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>e</code>-suffix : <code>execle</code> <code>execvpe</code>
</p>
<div class="ulist"><ul>
<li>
<p>
This indicates that the function specifys the environment of the executed program via the argument <code>envp</code>.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_c_signal_macro">C: signal macro</h3>
<div class="paragraph"><p>Since the signal number assignment is system dependent, we should use macro to specify signal in the C program.</p></div>
<div class="listingblock">
<div class="title">Signal macros defined in <code>/usr/include/asm/signal.h</code>.</div>
<div class="content">
<pre><code>#define SIGHUP           1
#define SIGINT           2
#define SIGQUIT          3
#define SIGILL           4
#define SIGTRAP          5
#define SIGABRT          6
#define SIGIOT           6
#define SIGBUS           7
#define SIGFPE           8
#define SIGKILL          9
#define SIGUSR1         10
#define SIGSEGV         11
#define SIGUSR2         12
#define SIGPIPE         13
#define SIGALRM         14
#define SIGTERM         15
#define SIGSTKFLT       16
#define SIGCHLD         17
#define SIGCONT         18
#define SIGSTOP         19
#define SIGTSTP         20
#define SIGTTIN         21
#define SIGTTOU         22
#define SIGURG          23
#define SIGXCPU         24
#define SIGXFSZ         25
#define SIGVTALRM       26
#define SIGPROF         27
#define SIGWINCH        28
#define SIGIO           29
#define SIGLOST         29
#define SIGPWR          30
#define SIGSYS          31
#define SIGRTMIN        32</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c_signal_2">C: signal(2)</h3>
<div class="paragraph"><p>For the simplicity, I start with the traditional <code>signal</code>(2).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The POSIX.1 <code>sigaction</code>(2) is more portable than the <code>signal</code>(2).
The effects of <code>signal</code>(2) in a multithreaded process are unspecified.  See
<code>signal</code>(2) for details.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Signal example: <code>signal.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* [f]printf perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;signal.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* signal */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* getpid pause */</span></span>

<span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">handler</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> signum<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">=== SIGNAL %d handler ===</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> signum<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"First round ... ignored.  Next round activated.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">signal</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> SIG_DFL<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* set signal behavior to default */</span></span>
<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"PID=%d"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">signal</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> handler<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* set signal behavior to handler */</span></span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">signal</span></span><span style="color: #990000">(</span>SIGHUP<span style="color: #990000">,</span> SIG_IGN<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* set signal behavior to ignore */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">pause</span></span><span style="color: #990000">();</span>    <span style="font-style: italic"><span style="color: #9A1900">/* waiting for signal */</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>./signal</code>, etc.</div>
<div class="content">
<pre><code>$ ./signal &amp;
$  jobs
[1] + Running
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6906  6895  0  80   0 -  1018 -      pts/3    00:00:00 signal
0 R  1000  6913  6911  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s INT signal
PID=6906
=== SIGNAL 2 handler ===
First round ... ignored.  Next round activated.
Killed signal(6906) with signal 2
$  jobs
[1] + Running
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6906  6895  0  80   0 -  1018 -      pts/3    00:00:00 signal
0 R  1000  6926  6924  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s INT signal
Killed signal(6906) with signal 2
$  jobs
[1] + Interrupt
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 R  1000  6939  6937  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ ./signal &amp;
$  jobs
[1] + Running
$ ./signal &amp;
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6940  6895  0  80   0 -  1018 -      pts/3    00:00:00 signal
0 R  1000  6947  6945  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s HUP signal
Killed signal(6940) with signal 1
$  jobs
[1] + Running
$ ./signal &amp;
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6940  6895  0  80   0 -  1018 -      pts/3    00:00:00 signal
0 R  1000  6960  6958  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s KILL signal
Killed signal(6940) with signal 9
$  jobs
[1] + Killed
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6894  6893  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6895  6894  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 R  1000  6973  6971  0  80   0 -  2654 -      pts/3    00:00:00 ps</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c_sigaction_2">C: sigaction(2)</h3>
<div class="paragraph"><p>Let&#8217;s try basically the same with the new <code>sigaction</code>(2) while preventing the
reentrant signal situation.</p></div>
<div class="listingblock">
<div class="title">Signal example: <code>sigaction.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* [f]printf perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;signal.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* signaction */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* getpid pause */</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">sigaction</span> saint<span style="color: #990000">,</span> sahup<span style="color: #990000">;</span>

<span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">handler</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> signum<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">=== SIGNAL %d handler ===</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> signum<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"First round ... ignored.  Next round activated.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    saint<span style="color: #990000">.</span>sa_handler <span style="color: #990000">=</span> SIG_DFL<span style="color: #990000">;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* signal behavior to default */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaction</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>saint<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* set signal */</span></span>

<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"PID=%d"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
    saint<span style="color: #990000">.</span>sa_flags <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>             <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigemptyset</span></span><span style="color: #990000">(&amp;</span>saint<span style="color: #990000">.</span>sa_mask<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">/* create a open mask */</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">/* sigaddset(&amp;saint.sa_mask, SIGINT); no need since no SA_NODEFER */</span></span>
    saint<span style="color: #990000">.</span>sa_handler <span style="color: #990000">=</span> handler<span style="color: #990000">;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* signal behavior to handler */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaction</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>saint<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* set signal */</span></span>

    sahup<span style="color: #990000">.</span>sa_flags <span style="color: #990000">=</span> SA_NODEFER<span style="color: #990000">;</span>    <span style="font-style: italic"><span style="color: #9A1900">/* set SA_NODEFER */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigemptyset</span></span><span style="color: #990000">(&amp;</span>sahup<span style="color: #990000">.</span>sa_mask<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">/* create a open mask */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaddset</span></span><span style="color: #990000">(&amp;</span>sahup<span style="color: #990000">.</span>sa_mask<span style="color: #990000">,</span> SIGHUP<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* mask SIGHUP since SA_NODEFER */</span></span>
    sahup<span style="color: #990000">.</span>sa_handler <span style="color: #990000">=</span> SIG_IGN<span style="color: #990000">;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* signal behavior to ignore */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaction</span></span><span style="color: #990000">(</span>SIGHUP<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>sahup<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* set signal */</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">pause</span></span><span style="color: #990000">();</span>    <span style="font-style: italic"><span style="color: #9A1900">/* waiting for signal */</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>./sigaction</code>, etc.</div>
<div class="content">
<pre><code>$ ./sigaction &amp;
$  jobs
[1] + Running
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6733  6722  0  80   0 -  1018 -      pts/3    00:00:00 sigaction
0 R  1000  6740  6738  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s INT sigaction
PID=6733
=== SIGNAL 2 handler ===
First round ... ignored.  Next round activated.
Killed sigaction(6733) with signal 2
$  jobs
[1] + Running
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6733  6722  0  80   0 -  1018 -      pts/3    00:00:00 sigaction
0 R  1000  6753  6751  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s INT sigaction
Killed sigaction(6733) with signal 2
$  jobs
[1] + Interrupt
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 R  1000  6766  6764  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ ./sigaction &amp;
$  jobs
[1] + Running
$ ./sigaction &amp;
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6767  6722  0  80   0 -  1018 -      pts/3    00:00:00 sigaction
0 R  1000  6774  6772  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s HUP sigaction
Killed sigaction(6767) with signal 1
$  jobs
[1] + Running
$ ./sigaction &amp;
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6767  6722  0  80   0 -  1018 -      pts/3    00:00:00 sigaction
0 R  1000  6787  6785  0  80   0 -  2654 -      pts/3    00:00:00 ps
$ killall -v -s KILL sigaction
Killed sigaction(6767) with signal 9
$  jobs
[1] + Killed
$ ps -l
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000  6721  6720  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 S  1000  6722  6721  0  80   0 -  1082 -      pts/3    00:00:00 sh
0 R  1000  6800  6798  0  80   0 -  2654 -      pts/3    00:00:00 ps</code></pre>
</div></div>
<div class="paragraph"><p>In above example, <code>SA_NODEFER</code> was set for the <code>SIGHUP</code> side of code just to
show how to prevent reentrant signal situation explicitly by the <code>sigaddset</code>(3)
command.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You can set up fine grained signal mask with the <code>sigprocmask</code>(3).</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_httpd_in_c">httpd in C</h3>
<div class="paragraph"><p>Let&#8217;s try coding a simple httpd server program, <code>httpd6</code>.  This can provide good
insight into how the httpd server works with the bottom up approach.  Here is the
design guide line I used.</p></div>
<div class="ulist"><ul>
<li>
<p>
IPv6 protocol.
</p>
</li>
<li>
<p>
the port number as the first argument (required, range=1024-60000)
</p>
</li>
<li>
<p>
the document root path as the optional second argument.
</p>
</li>
<li>
<p>
the default document root path as "~/public_html"
</p>
</li>
<li>
<p>
no CGI script support
</p>
</li>
<li>
<p>
no "<code>..</code>" in the URL string for security.
</p>
</li>
<li>
<p>
write simple for the easier to understand code.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">See
<a href="http://www.ibm.com/developerworks/systems/library/es-nweb/index.html">nweb: a
tiny, safe Web server (static pages only)</a> for IPv4 protocol example code.  It
comes with detailed explanation on how things work.  (My example is basically a
rewrite for IPv6 in my coding style.)</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Common header : <code>common.h</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>          <span style="font-style: italic"><span style="color: #9A1900">/* [fs]printf */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>         <span style="font-style: italic"><span style="color: #9A1900">/* exit getpid getenv */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>         <span style="font-style: italic"><span style="color: #9A1900">/* strncmp */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>         <span style="font-style: italic"><span style="color: #9A1900">/* lseek read write fork sleep */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* lseek getpid BSD_portability */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>          <span style="font-style: italic"><span style="color: #9A1900">/* errno */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fcntl.h&gt;</span>          <span style="font-style: italic"><span style="color: #9A1900">/* open close */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;signal.h&gt;</span>         <span style="font-style: italic"><span style="color: #9A1900">/* sigaction */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/socket.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* socket bind listen accept */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;arpa/inet.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* htonl htons */</span></span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> WEB_ROOT    <span style="color: #FF0000">"public_html/"</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LOG_FILE    <span style="color: #FF0000">"httpd6.log"</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> MAXFD       <span style="color: #993399">32</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> MAXBACKLOG  <span style="color: #993399">64</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">PIPE_BUF</span></span>    <span style="color: #990000">(</span><span style="color: #993399">8</span><span style="color: #990000">*</span><span style="color: #993399">1024</span><span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900">/* provide "FILE *f;" by the caller routine */</span></span>
<span style="font-style: italic"><span style="color: #9A1900">/* ## is GNU extension to allow zero __VA_ARGS__ */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span>fmt<span style="color: #990000">,</span> <span style="color: #990000">...)</span>  <span style="color: #990000">\</span>
    f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>LOG_FILE<span style="color: #990000">,</span> <span style="color: #FF0000">"a"</span><span style="color: #990000">);\</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>f<span style="color: #990000">,</span> fmt<span style="color: #990000">,</span> ##__VA_ARGS__<span style="color: #990000">);\</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fflush</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);\</span>
    <span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);\</span>
    <span style="font-weight: bold"><span style="color: #000000">sync</span></span><span style="color: #990000">();</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">httpd6</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> fdsock<span style="color: #990000">,</span> <span style="color: #009900">int</span> hit<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This is a common header file.  Most notable is a macro <code>log_printf</code> which
enables to write to the log file with <code>printf</code> syntax.</p></div>
<div class="listingblock">
<div class="title">Routine to daemonize httpd6: <code>main.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"common.h"</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>f<span style="color: #990000">;</span>              <span style="font-style: italic"><span style="color: #9A1900">/* for log_printf */</span></span>
    <span style="color: #009900">int</span> port<span style="color: #990000">,</span> fdbl<span style="color: #990000">,</span> hit<span style="color: #990000">,</span> fdsock<span style="color: #990000">,</span> pid<span style="color: #990000">,</span> i<span style="color: #990000">;</span>
    <span style="color: #008080">socklen_t</span> addrlen<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">sockaddr_in6</span> client_address<span style="color: #990000">,</span> server_address<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">sigaction</span> sacld<span style="color: #990000">,</span> sahup<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">&lt;</span> <span style="color: #993399">1</span> <span style="color: #990000">||</span> argc <span style="color: #990000">&gt;</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Mini-httpd6:</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Usage: httpd6 [port [PATH]]</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">==</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        port <span style="color: #990000">=</span> <span style="color: #993399">8080</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span><span style="color: #009900">int</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">6</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: port is more than 5 digits.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        port <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atoi</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>port <span style="color: #990000">&lt;</span> <span style="color: #993399">1024</span> <span style="color: #990000">||</span> port <span style="color: #990000">&gt;</span> <span style="color: #993399">60000</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: Invalid port number as argument. "</span>
                <span style="color: #FF0000">"Try 1024-60000.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">==</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span><span style="color: #009900">int</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">])</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">81</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: PATH is more than 80 chars.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">chdir</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]))</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: Can not change to directory %s.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span> <span style="font-style: italic"><span style="color: #9A1900">/* default argc = 1 or 2 */</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">chdir</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"HOME"</span><span style="color: #990000">)))</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: Can not change to directory %s.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"HOME"</span><span style="color: #990000">));</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">chdir</span></span><span style="color: #990000">(</span>WEB_ROOT<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"E: Can not change to directory %s.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                WEB_ROOT<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    sacld<span style="color: #990000">.</span>sa_flags <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>             <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigemptyset</span></span><span style="color: #990000">(&amp;</span>sacld<span style="color: #990000">.</span>sa_mask<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">/* create a open mask */</span></span>
    sacld<span style="color: #990000">.</span>sa_handler <span style="color: #990000">=</span> SIG_IGN<span style="color: #990000">;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* ignore child death */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaction</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>sacld<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* set signal */</span></span>
    sahup<span style="color: #990000">.</span>sa_flags <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>             <span style="font-style: italic"><span style="color: #9A1900">/* default */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigemptyset</span></span><span style="color: #990000">(&amp;</span>sahup<span style="color: #990000">.</span>sa_mask<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">/* create a open mask */</span></span>
    sahup<span style="color: #990000">.</span>sa_handler <span style="color: #990000">=</span> SIG_IGN<span style="color: #990000">;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* ignore terminal hungup */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">sigaction</span></span><span style="color: #990000">(</span>SIGINT<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>sahup<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">/* set signal */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> MAXFD<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>            <span style="font-style: italic"><span style="color: #9A1900">/* close STDIN, STDOUT, ... */</span></span>
    <span style="color: #FF0000">}</span>
    pid <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fork</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>pid <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: fork, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>pid <span style="color: #990000">!=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"I: Sucessfully daemonize httpd6.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>        <span style="font-style: italic"><span style="color: #9A1900">/* parent exit and deamonize */</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">setpgrp</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>                <span style="font-style: italic"><span style="color: #9A1900">/* set PGID of child to PGID of parent */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: setgrp, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LOG: httpd starting with parent pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
    fdbl <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">socket</span></span><span style="color: #990000">(</span>AF_INET6<span style="color: #990000">,</span> SOCK_STREAM<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>fdbl <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: socket, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    server_address<span style="color: #990000">.</span>sin6_family <span style="color: #990000">=</span> AF_INET6<span style="color: #990000">;</span>              <span style="font-style: italic"><span style="color: #9A1900">/* IPV6 , see ip(7)*/</span></span>
    server_address<span style="color: #990000">.</span>sin6_addr <span style="color: #990000">=</span> in6addr_any<span style="color: #990000">;</span>
    server_address<span style="color: #990000">.</span>sin6_port <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">htons</span></span><span style="color: #990000">(</span>port<span style="color: #990000">);</span>             <span style="font-style: italic"><span style="color: #9A1900">/* host to network */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">bind</span></span><span style="color: #990000">(</span>fdbl<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">sockaddr</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;</span>server_address<span style="color: #990000">,</span>
            <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>server_address<span style="color: #990000">))</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: bind, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LOG: bind: with IPv6 accept, port=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> port<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">listen</span></span><span style="color: #990000">(</span>fdbl<span style="color: #990000">,</span> MAXBACKLOG<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: listen, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LOG: httpd successfuly bind and listen at port %i.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> port<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>hit <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> <span style="color: #990000">;</span> hit<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        addrlen <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>client_address<span style="color: #990000">);</span>
        fdsock <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">(</span>fdbl<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">sockaddr</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;</span>client_address<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>addrlen<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>fdsock <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: accept, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LOG: httpd hit=%i.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">);</span>
        pid <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fork</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>pid <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: fork, %s, exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>pid <span style="color: #990000">!=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">);</span>                   <span style="font-style: italic"><span style="color: #9A1900">/* parent */</span></span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdbl<span style="color: #990000">);</span>                     <span style="font-style: italic"><span style="color: #9A1900">/* child */</span></span>
            <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"LOG: httpd forked child pid=%i.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
            <span style="font-weight: bold"><span style="color: #000000">httpd6</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> hit<span style="color: #990000">);</span>                     <span style="font-style: italic"><span style="color: #9A1900">/* no return */</span></span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This essentially starts a daemonized <code>httpd6</code> process.  The daemonized <code>httpd6</code>
process is the infinite loop routine.  It creates a
<a href="http://en.wikipedia.org/wiki/Network_socket">network socket</a> and listens to the
TCP connection port specified on the command line and assume IPv6 connection.
Every time` httpd6` is hit, it starts a child process to handle the HTTP
request.</p></div>
<div class="listingblock">
<div class="title">Main routine providing httpd6: <code>httpd6.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"common.h"</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">httpd6</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> fdsock<span style="color: #990000">,</span> <span style="color: #009900">int</span> hit<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span> buf<span style="color: #990000">[</span>PIPE_BUF <span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">];</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>f<span style="color: #990000">;</span>              <span style="font-style: italic"><span style="color: #9A1900">/* for log_printf */</span></span>
    <span style="color: #008080">ssize_t</span> r<span style="color: #990000">,</span> i<span style="color: #990000">,</span> j<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> l<span style="color: #990000">,</span> m<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> fd<span style="color: #990000">,</span> k<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">pair</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">char</span> <span style="color: #990000">*</span>ext<span style="color: #990000">;</span>
        <span style="color: #009900">char</span> <span style="color: #990000">*</span>filetype<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">pair</span> extlist<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"html"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"text/html"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"htm"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"text/html"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"css"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"text/css"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"js"</span><span style="color: #990000">,</span>   <span style="color: #FF0000">"text/javascript"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"jpeg"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"image/jpeg"</span><span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"jpg"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/jpg"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"png"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/png"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"gif"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/gif"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"ico"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/ico"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"gz"</span><span style="color: #990000">,</span>   <span style="color: #FF0000">"image/gz"</span>  <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"xz"</span><span style="color: #990000">,</span>   <span style="color: #FF0000">"image/xz"</span>  <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"tar"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/tar"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span><span style="color: #FF0000">"zip"</span><span style="color: #990000">,</span>  <span style="color: #FF0000">"image/zip"</span> <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">{</span>NULL<span style="color: #990000">,</span> NULL<span style="color: #FF0000">}}</span><span style="color: #990000">;</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* messages */</span></span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>mes403 <span style="color: #990000">=</span>
<span style="color: #FF0000">"HTTP/1.1 403 Forbidden</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Content-Length: 185</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Connection: close</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Content-Type: text/html</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;html&gt;&lt;head&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;title&gt;403 Forbidden&lt;/title&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;/head&gt;&lt;body&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;h1&gt;Forbidden&lt;/h1&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"The requested URL, file type or operation is forbidden on this webserver.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;/body&gt;&lt;/html&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>

    <span style="color: #009900">char</span> <span style="color: #990000">*</span>mes404 <span style="color: #990000">=</span>
<span style="color: #FF0000">"HTTP/1.1 404 Not Found</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Content-Length: 136</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Connection: close</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Content-Type: text/html</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;html&gt;&lt;head&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;title&gt;404 Not Found&lt;/title&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;/head&gt;&lt;body&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;h1&gt;Not Found&lt;/h1&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"The requested URL was not found on this server.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"&lt;/body&gt;&lt;/html&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>

    <span style="color: #009900">char</span> <span style="color: #990000">*</span>http_header <span style="color: #990000">=</span>
<span style="color: #FF0000">"HTTP/1.1 200 OK</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Server: httpd</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Content-Length: %ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Connection: close</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"Content-Type: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
<span style="color: #FF0000">"charset=utf-8</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">/* Start of the routine to handle the HTTP request*/</span></span>
    r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">read</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> buf<span style="color: #990000">,</span> PIPE_BUF<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>r <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: system call: read, "</span>
                <span style="color: #FF0000">"%s, hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">strerror</span></span><span style="color: #990000">(</span>errno<span style="color: #990000">),</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>r <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> mes403<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>mes403<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: 403 Forbidden: zero length request, "</span>
                <span style="color: #FF0000">"hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    buf<span style="color: #990000">[</span>r<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'</span><span style="color: #CC33CC">\0</span><span style="color: #FF0000">'</span><span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* null terminated */</span></span>
    r<span style="color: #990000">++;</span>            <span style="font-style: italic"><span style="color: #9A1900">/* size of buf used */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> r<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>buf<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'</span><span style="color: #CC33CC">\r</span><span style="color: #FF0000">'</span> <span style="color: #990000">||</span> buf<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            buf<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'_'</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"READ(%d): %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> buf<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">strncmp</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="color: #FF0000">"GET "</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">strncmp</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="color: #FF0000">"get "</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> mes403<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>mes403<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: 403 Forbidden: Only simple GET supported, "</span>
                <span style="color: #FF0000">"hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* string is "GET /FILE_PATH " + other extras */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">4</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> r<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>buf<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">' '</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>buf<span style="color: #990000">[</span>i <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'/'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(&amp;</span>buf<span style="color: #990000">[</span>i<span style="color: #990000">],</span> <span style="color: #FF0000">"index.html"</span><span style="color: #990000">);</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                buf<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'</span><span style="color: #CC33CC">\0</span><span style="color: #FF0000">'</span><span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>j <span style="color: #990000">=</span> <span style="color: #993399">4</span><span style="color: #990000">;</span> j <span style="color: #990000">&lt;</span> i <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> j<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>buf<span style="color: #990000">[</span>j<span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'.'</span> <span style="color: #990000">&amp;&amp;</span> buf<span style="color: #990000">[</span>j <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'.'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> mes403<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>mes403<span style="color: #990000">));</span>
            <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: 403 Forbidden: URL with </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">..</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000"> is illegal, "</span>
                    <span style="color: #FF0000">"hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    l <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>k <span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>ext <span style="color: #990000">!=</span> NULL<span style="color: #990000">;</span> k<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        m <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>ext<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span><span style="font-weight: bold"><span style="color: #000000">strncmp</span></span><span style="color: #990000">(&amp;</span>buf<span style="color: #990000">[</span>l <span style="color: #990000">-</span> m<span style="color: #990000">],</span> extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>ext<span style="color: #990000">,</span> m<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>ext <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> mes403<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>mes403<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: 403 Forbidden: file extension type is illegal, "</span>
                <span style="color: #FF0000">"hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"SEND(%d): %s as %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>buf<span style="color: #990000">[</span><span style="color: #993399">5</span><span style="color: #990000">],</span> extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>filetype<span style="color: #990000">);</span>
    fd <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(&amp;</span>buf<span style="color: #990000">[</span><span style="color: #993399">5</span><span style="color: #990000">],</span> O_RDONLY<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* open the file for reading */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>fd <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> mes404<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>mes404<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ERROR: 404 Not Found: failed to open file, "</span>
                <span style="color: #FF0000">"hit=%d exiting pid=%d.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">getpid</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    l <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lseek</span></span><span style="color: #990000">(</span>fd<span style="color: #990000">,</span> <span style="color: #990000">(</span>off_t<span style="color: #990000">)</span><span style="color: #993399">0</span><span style="color: #990000">,</span> SEEK_END<span style="color: #990000">);</span>      <span style="font-style: italic"><span style="color: #9A1900">/* file length */</span></span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">lseek</span></span><span style="color: #990000">(</span>fd<span style="color: #990000">,</span> <span style="color: #990000">(</span>off_t<span style="color: #990000">)</span><span style="color: #993399">0</span><span style="color: #990000">,</span> SEEK_SET<span style="color: #990000">);</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">sprintf</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> http_header<span style="color: #990000">,</span> l<span style="color: #990000">,</span> extlist<span style="color: #990000">[</span>k<span style="color: #990000">].</span>filetype<span style="color: #990000">);</span>
    <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> buf<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">strlen</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">));</span> <span style="font-style: italic"><span style="color: #9A1900">/* send header */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((</span>r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">read</span></span><span style="color: #990000">(</span>fd<span style="color: #990000">,</span> buf<span style="color: #990000">,</span> PIPE_BUF<span style="color: #990000">))</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">,</span> buf<span style="color: #990000">,</span> r<span style="color: #990000">);</span>       <span style="font-style: italic"><span style="color: #9A1900">/* send file in block */</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">sleep</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">);</span>               <span style="font-style: italic"><span style="color: #9A1900">/* allow socket to drain before signal */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdsock<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">log_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"CLOSE(%d)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> hit<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>     <span style="font-style: italic"><span style="color: #9A1900">/* terminate child */</span></span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This is the routine to handle the HTTP request in the child process of the
daemon.  Since I put HTML protocol related text data in the codes, this is very
top heavy.  But this is relatively simple :-)</p></div>
<div class="paragraph"><p>You can see this <code>httpd6</code> can serve as IPv6 web server.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./httpd6 8080 ../01_static
$ wget localhost:8080
--2013-03-25 21:57:02--  http://localhost:8080/
Resolving localhost (localhost)... ::1, 127.0.0.1
Connecting to localhost (localhost)|::1|:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2175 (2.1K) [text/html]
Saving to: index.html

     0K ..                                                    100% 86.8M=0s

2013-03-25 21:57:02 (86.8 MB/s) - index.html saved [2175/2175]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_httpd_in_python">httpd in Python</h3>
<div class="paragraph"><p>Coding in the Python environment provides us with bigger building blocks to
work with than that in the C environment.</p></div>
<div class="paragraph"><p>The <code>http.server</code> module in the Python3 library contains basic HTTP server classes.  Let&#8217;s use this.</p></div>
<div class="paragraph"><p>Just like the <code>argparse</code> module in <a href="#_python_2">CLI programs: Python</a>, I read
the library source comments to get good idea.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ /usr/bin/python3 -q
&gt;&gt;&gt; print(sys.path)
['', '/usr/lib/python3.2', '/usr/lib/python3.2/plat-linux2', '/usr/lib/python3.2
/lib-dynload', '/usr/local/lib/python3.2/dist-packages', '/usr/lib/python3/dist-
packages']
&gt;&gt;&gt; import http.server
&gt;&gt;&gt; print (http.server.__file__)
/usr/lib/python3.2/http/server.py
&gt;&gt;&gt; exit()
$ head /usr/lib/python3.2/http/server.py
"""HTTP server classes.

Note: BaseHTTPRequestHandler doesn't implement any HTTP request; see
SimpleHTTPRequestHandler for simple implementations of GET, HEAD and POST,
and CGIHTTPRequestHandler for CGI scripts.

It does, however, optionally implement HTTP/1.1 persistent connections,
as of version 0.3.

Notes on CGIHTTPRequestHandler</code></pre>
</div></div>
<div class="paragraph"><p>The <code>test</code> function towards the end of the <code>/usr/lib/python3.2/http/server.py</code>
file seems to be good template to start with if its HTTP handler is changed to
<code>SimpleHTTPRequestHandler</code>.</p></div>
<div class="listingblock">
<div class="title">Simple Python HTTP server: <code>httpd</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> http<span style="color: #990000">.</span>server
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>HandlerClass <span style="color: #990000">=</span> http<span style="color: #990000">.</span>server<span style="color: #990000">.</span>BaseHTTPRequestHandler<span style="color: #990000">,</span>
         ServerClass <span style="color: #990000">=</span> http<span style="color: #990000">.</span>server<span style="color: #990000">.</span>HTTPServer<span style="color: #990000">,</span> protocol<span style="color: #990000">=</span><span style="color: #FF0000">"HTTP/1.0"</span><span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">    """Test the HTTP request handler class.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">    This runs an HTTP server on port 8080 (or the first command line</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    argument).</span></span>

<span style="font-style: italic"><span style="color: #9A1900">    """</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">:]:</span>
        port <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
        port <span style="color: #990000">=</span> <span style="color: #993399">8080</span>
    server_address <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #FF0000">''</span><span style="color: #990000">,</span> port<span style="color: #990000">)</span>

    HandlerClass<span style="color: #990000">.</span>protocol_version <span style="color: #990000">=</span> protocol
    httpd <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ServerClass</span></span><span style="color: #990000">(</span>server_address<span style="color: #990000">,</span> HandlerClass<span style="color: #990000">)</span>

    sa <span style="color: #990000">=</span> httpd<span style="color: #990000">.</span>socket<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getsockname</span></span><span style="color: #990000">()</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Serving HTTP on"</span><span style="color: #990000">,</span> sa<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">],</span> <span style="color: #FF0000">"port"</span><span style="color: #990000">,</span> sa<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #FF0000">"..."</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        httpd<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">serve_forever</span></span><span style="color: #990000">()</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> KeyboardInterrupt<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"\nKeyboard interrupt received, exiting."</span><span style="color: #990000">)</span>
        httpd<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">server_close</span></span><span style="color: #990000">()</span>
        sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>HandlerClass<span style="color: #990000">=</span>http<span style="color: #990000">.</span>server<span style="color: #990000">.</span>SimpleHTTPRequestHandler<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>You can see this <code>httpd</code> can serve as IPv4 web server.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./httpd 8080 &amp;
Serving HTTP on 0.0.0.0 port 8080 ...
$ wget -O index2.html localhost:8080
--2013-03-25 22:03:26--  http://localhost:8080/
Resolving localhost (localhost)... ::1, 127.0.0.1
Connecting to localhost (localhost)|::1|:8080... failed: Connection refused.
Connecting to localhost (localhost)|127.0.0.1|:8080... connected.
127.0.0.1 - - [25/Mar/2013 22:03:27] "GET / HTTP/1.1" 200 -
HTTP request sent, awaiting response... 200 OK
Length: 2175 (2.1K) [text/html]
Saving to: index2.html

     0K ..                                                    100% 5.23M=0s

2013-03-25 22:03:26 (5.23 MB/s) - index2.html saved [2175/2175]</code></pre>
</div></div>
<div class="paragraph"><p>See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/library/http.server.html">"http.server  HTTP servers" in "The Python Standard Library "</a>
</p>
</li>
<li>
<p>
<a href="http://wiki.python.org/moin/BaseHttpServer">"BaseHttpServer" in "The Python Wiki"</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gcc">GCC</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <code>gccintro</code> package provides a good tutorial "Introduction to GCC by Brian
J. Gough" for the GCC basics to compile C programs.</p></div>
<div class="sect2">
<h3 id="_gcc_version">GCC version</h3>
<div class="paragraph"><p>Check gcc version and defaults:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 4.9.2-10' --with-b...
Thread model: posix
gcc version 4.9.2 (Debian 4.9.2-10)</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_basic_options">Basic options</h3>
<div class="paragraph"><p>Basic GCC syntax from the top few lines of its manpage:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>gcc [-c|-S|-E] [-std=standard]
    [-g] [-pg] [-Olevel]
    [-Wwarn...] [-pedantic]
    [-Idir...] [-Ldir...]
    [-Dmacro[=defn]...] [-Umacro]
    [-foption...] [-mmachine-option...]
    [-o outfile] [@file] infile...</code></pre>
</div></div>
<div class="paragraph"><p>The manpage for gcc is too long.  Here are the part I should remember.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>-c</code> :        preprocess=Yes compile=Yes assemble=Yes link=No
</p>
</li>
<li>
<p>
<code>-S</code> :        preprocess=Yes compile=Yes assemble=No  link=No
</p>
</li>
<li>
<p>
<code>-E</code> :        preprocess=Yes compile=No  assemble=No  link=No
</p>
</li>
<li>
<p>
<code>-std=standard</code> : specify standard conformance
</p>
<div class="ulist"><ul>
<li>
<p>
C   : <code>-ansi</code> is <code>-std=c89</code> , default is <code>-std=gnu89</code>
</p>
</li>
<li>
<p>
C++ : <code>-ansi</code> is <code>-std=c++98</code> , default is <code>-std=gnu++98</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>-Wall</code> :     enables all the warnings.
</p>
</li>
<li>
<p>
<code>-pedantic</code> : warnings by strict ISO C and ISO C++ conformance
</p>
</li>
<li>
<p>
<code>-g</code>    :     produce debug information for <code>gdb</code>(1)
</p>
</li>
<li>
<p>
<code>-pg</code>   :     produce extra code for <code>gprof</code>(1)
</p>
</li>
<li>
<p>
<code>-O0</code>   :     no optimization
</p>
</li>
<li>
<p>
<code>-O1</code>   :     some optimization
</p>
</li>
<li>
<p>
<code>-O2</code>   :     lots of optimization
</p>
</li>
<li>
<p>
<code>-O3</code>   :     yet more optimization
</p>
</li>
<li>
<p>
<code>-I&lt;dir&gt;</code>     : search the &lt;dir&gt; directory for header files
</p>
</li>
<li>
<p>
<code>-L&lt;dir&gt;</code>     : search the &lt;dir&gt; directory for library files
</p>
</li>
<li>
<p>
<code>-l&lt;library&gt;</code> : search the &lt;library&gt; library when linking
</p>
</li>
<li>
<p>
<code>-D&lt;macro&gt;[=&lt;defn&gt;]</code> : predefine the &lt;macro&gt; macro (&lt;defn&gt; or 1)
</p>
</li>
<li>
<p>
<code>-U&lt;macro&gt;</code>        : undefine the &lt;macro&gt; macro
</p>
</li>
<li>
<p>
<code>-f&lt;option&gt;</code>  : set the &lt;option&gt; machine-independent flag
</p>
</li>
<li>
<p>
<code>-m&lt;machine-option&gt;</code> : set the &lt;machine-option&gt; machine-dependent flag
</p>
</li>
<li>
<p>
<code>-o&lt;outfile&gt;</code> :  output in the &lt;outfile&gt; file
</p>
</li>
<li>
<p>
<code>@&lt;file&gt;</code> : read command-line options from &lt;file&gt;.
</p>
</li>
<li>
<p>
<code>-v</code>         verbose output. (list defined symbols etc.)
</p>
</li>
<li>
<p>
<code>-Q</code>         compiler print out each function name etc.
</p>
</li>
<li>
<p>
<code>-Wp,&lt;option&gt;</code> : pass option as an &lt;option&gt; directly to the preprocessor.
</p>
</li>
<li>
<p>
<code>-Wa,&lt;option&gt;</code> : pass option as an &lt;option&gt; directly to the assembler.
</p>
</li>
<li>
<p>
<code>-Wl,&lt;option&gt;</code> : pass option as an &lt;option&gt; directly to the linker.
</p>
</li>
<li>
<p>
<code>-fpic</code>        : generate position-independent code (smaller code)
</p>
</li>
<li>
<p>
<code>-fPIC</code>        : generate position-independent code (larger code)
</p>
</li>
<li>
<p>
<code>-fpie</code>        : generated code for position independent executable (smaller code)
</p>
</li>
<li>
<p>
<code>-fPIE</code>        : generated code for position independent executable (larger code)
</p>
</li>
<li>
<p>
<code>-pie</code>         : generated position independent executable (smaller code, linker option)
</p>
</li>
<li>
<p>
<code>-PIE</code>         : generated position independent executable (larger code, linker option)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please note that <code>gcc</code> uses no space after the command switch and a single leading <code>-</code> even for long option.</p></div>
<div class="paragraph"><p>The current C defualt is <code>-std=gnu90</code> which is GNU dialect of ISO C90 including some C99 features.</p></div>
<div class="paragraph"><p>The current C++ defualt is <code>-std=gnu++98</code> which is GNU dialect of 1998 ISO C++ standard plus amendments including some C++11 features.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The meaning of <code>inline</code> in C is different between the default <code>-std=gnu90</code> and the rest of the world (<code>-std=gnu99|-std=c99|...</code>).  See <a href="http://gcc.gnu.org/onlinedocs/gcc/Inline.html">An Inline Function is As Fast As a Macro</a>.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_assembler_code">Assembler code</h3>
<div class="paragraph"><p>The GCC with the <code>-S</code> option produces the assembler code output written in the
AT&amp;T assembler style as shown in the "Hello World!" example.</p></div>
<div class="paragraph"><p>It is not so difficult to grock roghly what the GCC generated assembler code
does.  (Writing some code in the assembler from scratch requires serious
knowledge.)</p></div>
<div class="paragraph"><p>Some basic register names, command mnemonic names, and command mnemonic suffix
conventions need to be noted.</p></div>
<div class="ulist"><ul>
<li>
<p>
Command mnemonic names and quasi-C equivalents:
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>mov op1, op2</code>" : "<code>op2 = op1</code>"
</p>
</li>
<li>
<p>
"<code>mov (op1), op2</code>" : "<code>op2 = *op1</code>"
</p>
</li>
<li>
<p>
"<code>lea (op1), op2</code>" : "<code>op2 = op1</code>" (load effective address)
</p>
</li>
<li>
<p>
"<code>add op1, op2</code>" : "<code>op2 += op1</code>"
</p>
</li>
<li>
<p>
"<code>sub op1, op2</code>" : "<code>op2 -= op1</code>"
</p>
</li>
<li>
<p>
"<code>test op1, op2</code>" : set flags based on "<code>op2 &amp; op1</code>"
</p>
</li>
<li>
<p>
"<code>cmp op1, op2</code>" : set flags based on "<code>op2 - op1</code>"
</p>
</li>
<li>
<p>
"<code>call op1</code>" : call function at <code>op1</code>
</p>
<div class="ulist"><ul>
<li>
<p>
Push the next instruction address <code>%rip + 2</code> to the stack and jump to the <code>op1</code> address
</p>
</li>
</ul></div>
</li>
<li>
<p>
"<code>ret</code>" : return to the callee procedure
</p>
<div class="ulist"><ul>
<li>
<p>
Pop the next instruction address <code>%rip</code> from the stack.
</p>
</li>
</ul></div>
</li>
<li>
<p>
"<code>jmp op</code>" : jump unconditional to <code>op</code>
</p>
</li>
<li>
<p>
"<code>je op</code>" : jump equal to to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jne op</code>" : jump not-equal to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jg op</code>" : jump greater to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jge op</code>" : jump greater-or-equal to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jl op</code>" : jump less to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jle op</code>" : jump less-or-equal to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jz op</code>" : jump zero to <code>op</code>
</p>
</li>
<li>
<p>
"<code>jnz op</code>" : jump non-zero to <code>op</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Command mnemonic suffix indicating data width:
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>b</code>" : 8 bit (byte)
</p>
</li>
<li>
<p>
"<code>w</code>" : 16 bit (word)
</p>
</li>
<li>
<p>
"<code>l</code>" : 32 bit (long)
</p>
</li>
<li>
<p>
"<code>q</code>" : 64 bit (quadruple word)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Command mnemonic arguments:
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>$</code>" : immediate value following
</p>
</li>
<li>
<p>
"<code>Offs(Base,Index,Scale)</code>" : the value stored at the address <code>Base + Index * Scale + Offs</code> (where, <code>Scale</code> = 1, 2, 4, 8).
</p>
</li>
</ul></div>
</li>
<li>
<p>
Register names and their data width:
</p>
<div class="ulist"><ul>
<li>
<p>
64 bit: <code>%rax</code>, <code>%rbx</code>, <code>%rcx</code>, <code>%rdx</code>, <code>%rdi</code>, <code>%rsi</code>, <code>%rbp</code>, <code>%rsp</code>, &#8230;
</p>
</li>
<li>
<p>
32 bit: <code>%eax</code>, <code>%ebx</code>, <code>%ecx</code>, <code>%edx</code>, <code>%edi</code>, <code>%esi</code>, <code>%ebp</code>, <code>%esp</code>, &#8230;
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">"<code>mov op1, op2</code>" moves data "<code>op1</code> &#8594; <code>op2</code>" in the AT&amp;T assembler style
(GCC default); while "<code>mov op1, op2</code>" moves data "<code>op1</code> &#8592; <code>op2</code>" in the Intel
assembler style (NASM default).  These are in the opposite order.</td>
</tr></table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. Examples of assembly codes</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top">AT&amp;T                              </th>
<th align="left" valign="top">Intel                      </th>
<th align="left" valign="top"> quasi-C</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>movq $0x12345678, %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, 12345678h</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = 0x12345678</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>movq $0xff, %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, 0ffh</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = 0xff</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>movq -8(%rbp), %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, [rbp-8]</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = *(rbp - 8)</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>movq -0x10(%rbp, %rdx, 8), %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, [rbp+rdx*8-10h]</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = *(rbp + rdx * 8 - 0x10)</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>movq (%rcx), %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, [rcx]</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = *(rcx)</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>movq %rcx, %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>mov rax, rcx</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = rcx</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>leaq 8(,%rcx,8), %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>lea rax, [rcx*8+8]</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = rcx * 8 + 8</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>leaq (%rbx,%rcx,4), %rax</code></p></td>
<td align="left" valign="top"><p class="table"><code>lea rax, [rbx+rcx*4]</code></p></td>
<td align="left" valign="top"><p class="table"><code>rax = rbx + rcx * 4</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Some basic 64-bit (= 8 bytes) integer ABI conventions under the <code>x86-64</code> (<code>amd64</code>) Linux need to be noted.</p></div>
<div class="ulist"><ul>
<li>
<p>
registers for function call return values
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>%rax</code>" : the 1st function return integer value (a.k.a. accumulator register)
</p>
</li>
<li>
<p>
"<code>%rdx</code>" : the 2nd function return integer value (a.k.a. data register)
</p>
</li>
<li>
<p>
"<code>%xmm0</code>" : the 1st function return double precision floating point value (128-bit <a href="http://en.wikipedia.org/wiki/SSE2">SSE2</a> register)
</p>
</li>
<li>
<p>
"<code>%xmm1</code>" : the 2nd function return double precision floating point value (128-bit <a href="http://en.wikipedia.org/wiki/SSE2">SSE2</a> register)
</p>
</li>
</ul></div>
</li>
<li>
<p>
registers for managing the stack
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>%rsp</code>" : the stack pointer to the top of the stack. (<code>%rsp</code> a.k.a. stack pointer register)
</p>
</li>
<li>
<p>
"<code>%rbp</code>" : the frame pointing to the base of the stack frame. (<code>%rbp</code> a.k.a. stack base pointer register)
</p>
</li>
</ul></div>
</li>
<li>
<p>
temporary registers
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>%r10</code>", "<code>%r11</code>", "<code>%xmm8</code>" - "<code>%xmm15</code>"
</p>
</li>
</ul></div>
</li>
<li>
<p>
callee-saved registers
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>%rbx</code>", "<code>%r12</code>" - "<code>%r15</code>"
</p>
</li>
</ul></div>
</li>
<li>
<p>
registers to pass function arguments
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>%rdi</code>" : the 1st function argument integer passed (a.k.a. destination index register)
</p>
</li>
<li>
<p>
"<code>%rsi</code>" : the 2nd function argument integer passed (a.k.a. source index register)
</p>
</li>
<li>
<p>
"<code>%rdx</code>" : the 3rd function argument integer passed (a.k.a. data register)
</p>
</li>
<li>
<p>
"<code>%rcx</code>" : the 4th function argument integer passed (a.k.a. counter register)
</p>
</li>
<li>
<p>
"<code>%r8</code>"  : the 5th function argument integer passed
</p>
</li>
<li>
<p>
"<code>%r9</code>"  : the 6th function argument integer passed
</p>
</li>
<li>
<p>
"<code>%xmm2</code>" - "<code>%xmm7</code>" : the function argument floating point passed
</p>
</li>
</ul></div>
</li>
<li>
<p>
stack data usages (the stack grows from the high address to the low address)
</p>
<div class="ulist"><ul>
<li>
<p>
stack "<code>*(%rbp + 8*(n-5))</code>" : the last (n-th) function argument passed
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
<li>
<p>
stack "<code>*(%rbp + 16)</code>" : the 7th function argument passed
</p>
</li>
<li>
<p>
stack "<code>*(%rbp + 8)</code>" : the function return address
</p>
</li>
<li>
<p>
stack "<code>*(%rbp)</code>" : the old <code>%rbp</code> value (<code>%rbp</code>: frame pointer)
</p>
</li>
<li>
<p>
stack "<code>*(%rbp - 8)</code>" : the 1st local variable
</p>
</li>
<li>
<p>
stack "<code>*(%rbp - 16)</code>" : the 2nd local variable
</p>
</li>
<li>
<p>
stack "<code>*(%rbp - 24)</code>" : the 3rd local variable
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
<li>
<p>
stack "<code>*(%rsp)</code>"  : the top local variable (<code>%rsp</code>: stack pointer)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>There are some memory alignment requirements of x86-64 under GCC/Linux.</p></div>
<div class="ulist"><ul>
<li>
<p>
8-byte aligned: long, double, pointer
</p>
</li>
<li>
<p>
16-byte aligned: SSE2 instructions, long double
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">These register usages and function call conventions are architecture and
OS specific.  For example, i386 passes all function arguments in the stack by
pushing them in the right-to-left order.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">There are some strange situation on <code>fdivp</code> and <code>fdivrp</code>:
<a href="http://bugs.debian.org/372528">Debian Bug #372528: as/i386: reverses fdivp and fdivrp</a></td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_string_in_c_function">String in C function</h3>
<div class="paragraph"><p>This tricky problem of string in C function becomes simple when you inspect
the code under the assembler.</p></div>
<div class="paragraph"><p>Here is a C code <code>string-array.c</code> which manipulates a string.</p></div>
<div class="listingblock">
<div class="title">string-array.c with "char[]"</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span> foo<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">"abcdefgh"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Before foo[] = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> foo<span style="color: #990000">);</span>
    foo<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'@'</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"After  foo[] = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> foo<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This <code>string-array.c</code> compiles fine and runs without problem.</p></div>
<div class="listingblock">
<div class="title">Compile and run of string-array.c</div>
<div class="content">
<pre><code>$ ./string-array
Before foo[] = 'abcdefgh'

After  foo[] = 'abc@efgh'</code></pre>
</div></div>
<div class="paragraph"><p>Here is a similar looking buggy C code <code>string-pointer.c</code>.</p></div>
<div class="listingblock">
<div class="title">string-pointer.c with "char *"</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span><span style="color: #990000">*</span> bar <span style="color: #990000">=</span> <span style="color: #FF0000">"abcdefgh"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Before bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> bar<span style="color: #990000">);</span>
    bar<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'@'</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"After  bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> bar<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This <code>string-pointer.c</code> compiles fine but fails to run.</p></div>
<div class="listingblock">
<div class="title">Compile and run of string-pointer.c</div>
<div class="content">
<pre><code>$ ./string-pointer
Segmentation fault</code></pre>
</div></div>
<div class="paragraph"><p>This reason can be elucidated by looking into their assembler codes by
compiling with the <code>-S</code> option.</p></div>
<div class="listingblock">
<div class="title">Assembler code from string-array.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat string<span style="color: #990000">-</span>array<span style="color: #990000">.</span>s
<span style="font-weight: bold"><span style="color: #000080">    .file</span></span>    <span style="color: #FF0000">"string-array.c"</span>
<span style="font-weight: bold"><span style="color: #000080">    .section</span></span>    <span style="color: #990000">.</span>rodata
<span style="font-weight: bold"><span style="color: #000080">.LC0</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .string</span></span>    <span style="color: #FF0000">"Before foo[] = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="font-weight: bold"><span style="color: #000080">.LC1</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .string</span></span>    <span style="color: #FF0000">"After  foo[] = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="font-weight: bold"><span style="color: #000080">    .text</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .globl</span></span>    main
<span style="font-weight: bold"><span style="color: #000080">    .type</span></span>    main<span style="color: #990000">,</span> @function
<span style="font-weight: bold"><span style="color: #000080">main:</span></span>
<span style="font-weight: bold"><span style="color: #000080">.LFB2</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_startproc
    pushq    <span style="color: #990000">%</span>rbp
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa_offset <span style="color: #993399">16</span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_offset <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">16</span>
    movq    <span style="color: #990000">%</span>rsp<span style="color: #990000">,</span> <span style="color: #990000">%</span>rbp
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa_register <span style="color: #993399">6</span>
    subq    $<span style="color: #993399">32</span><span style="color: #990000">,</span> <span style="color: #990000">%</span>rsp
    movl    <span style="color: #990000">%</span><span style="color: #009900">edi</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">20</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movq    <span style="color: #990000">%</span>rsi<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">32</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movabsq    $<span style="color: #993399">7523094288207667809</span><span style="color: #990000">,</span> <span style="color: #990000">%</span>rax
    movq    <span style="color: #990000">%</span>rax<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">16</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movb    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">8</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    leaq    <span style="color: #990000">-</span><span style="color: #993399">16</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">),</span> <span style="color: #990000">%</span>rax
    movq    <span style="color: #990000">%</span>rax<span style="color: #990000">,</span> <span style="color: #990000">%</span>rsi
    movl    $<span style="color: #990000">.</span>LC<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">edi</span>
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">call</span></span>    printf
    movb    $<span style="color: #993399">64</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">13</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    leaq    <span style="color: #990000">-</span><span style="color: #993399">16</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">),</span> <span style="color: #990000">%</span>rax
    movq    <span style="color: #990000">%</span>rax<span style="color: #990000">,</span> <span style="color: #990000">%</span>rsi
    movl    $<span style="color: #990000">.</span>LC<span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">edi</span>
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">call</span></span>    printf
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">leave</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa <span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #993399">8</span>
    <span style="font-weight: bold"><span style="color: #0000FF">ret</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_endproc
<span style="font-weight: bold"><span style="color: #000080">.LFE2</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .size</span></span>    main<span style="color: #990000">,</span> <span style="color: #990000">.-</span>main
<span style="font-weight: bold"><span style="color: #000080">    .ident</span></span>    <span style="color: #FF0000">"GCC: (Debian 4.9.2-10) 4.9.2"</span>
<span style="font-weight: bold"><span style="color: #000080">    .section</span></span>    <span style="color: #990000">.</span>note<span style="color: #990000">.</span>GNU<span style="color: #990000">-</span>stack<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">,</span>@progbits</tt></pre></div></div>
<div class="paragraph"><p>Here, upon execution of main function, the stack space for storing <code>data[]</code> is
dynamically secured and the value of "<code>abcdefgh</code>" is stored into the stack
space by the somewhat obfuscated assignment operation as below:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>        movl    $<span style="color: #993399">1684234849</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">16</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
        movl    $<span style="color: #993399">1751606885</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">12</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
local data: low address = address pointed by <code>%rbp</code> with offset -16
</p>
<div class="ulist"><ul>
<li>
<p>
1684234849 = 0x64636261
</p>
</li>
<li>
<p>
,, = <code>'d'</code> * 0x1000000 + <code>'c'</code> * 0x10000 + <code>'b'</code> * 0x100 + <code>'a'</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
local data: high address = address pointed by <code>%rbp</code> with offset -12
</p>
<div class="ulist"><ul>
<li>
<p>
1751606885 = 0x68676665
</p>
</li>
<li>
<p>
,, = <code>'h'</code> * 0x1000000 + <code>'g'</code> * 0x10000 + <code>'f'</code> * 0x100 + <code>'e'</code>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Please note x86-64 (=amd64) is little endian architecture (LSB first memory mapping) thus <code>'a'</code> = 0x61 comes first in the stack.</p></div>
<div class="listingblock">
<div class="title">Assembler code from string-pointer.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat string<span style="color: #990000">-</span>pointer<span style="color: #990000">.</span>s
<span style="font-weight: bold"><span style="color: #000080">    .file</span></span>    <span style="color: #FF0000">"string-pointer.c"</span>
<span style="font-weight: bold"><span style="color: #000080">    .section</span></span>    <span style="color: #990000">.</span>rodata
<span style="font-weight: bold"><span style="color: #000080">.LC0</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .string</span></span>    <span style="color: #FF0000">"abcdefgh"</span>
<span style="font-weight: bold"><span style="color: #000080">.LC1</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .string</span></span>    <span style="color: #FF0000">"Before bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="font-weight: bold"><span style="color: #000080">.LC2</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .string</span></span>    <span style="color: #FF0000">"After  bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span>
<span style="font-weight: bold"><span style="color: #000080">    .text</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .globl</span></span>    main
<span style="font-weight: bold"><span style="color: #000080">    .type</span></span>    main<span style="color: #990000">,</span> @function
<span style="font-weight: bold"><span style="color: #000080">main:</span></span>
<span style="font-weight: bold"><span style="color: #000080">.LFB2</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_startproc
    pushq    <span style="color: #990000">%</span>rbp
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa_offset <span style="color: #993399">16</span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_offset <span style="color: #993399">6</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">16</span>
    movq    <span style="color: #990000">%</span>rsp<span style="color: #990000">,</span> <span style="color: #990000">%</span>rbp
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa_register <span style="color: #993399">6</span>
    subq    $<span style="color: #993399">32</span><span style="color: #990000">,</span> <span style="color: #990000">%</span>rsp
    movl    <span style="color: #990000">%</span><span style="color: #009900">edi</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">20</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movq    <span style="color: #990000">%</span>rsi<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">32</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movq    $<span style="color: #990000">.</span>LC<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">8</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">)</span>
    movq    <span style="color: #990000">-</span><span style="color: #993399">8</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">),</span> <span style="color: #990000">%</span>rax
    movq    <span style="color: #990000">%</span>rax<span style="color: #990000">,</span> <span style="color: #990000">%</span>rsi
    movl    $<span style="color: #990000">.</span>LC<span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">edi</span>
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">call</span></span>    printf
    movq    <span style="color: #990000">-</span><span style="color: #993399">8</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">),</span> <span style="color: #990000">%</span>rax
    addq    $<span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #990000">%</span>rax
    movb    $<span style="color: #993399">64</span><span style="color: #990000">,</span> <span style="color: #990000">(%</span>rax<span style="color: #990000">)</span>
    movq    <span style="color: #990000">-</span><span style="color: #993399">8</span><span style="color: #990000">(%</span>rbp<span style="color: #990000">),</span> <span style="color: #990000">%</span>rax
    movq    <span style="color: #990000">%</span>rax<span style="color: #990000">,</span> <span style="color: #990000">%</span>rsi
    movl    $<span style="color: #990000">.</span>LC<span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">edi</span>
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">call</span></span>    printf
    movl    $<span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">%</span><span style="color: #009900">eax</span>
    <span style="font-weight: bold"><span style="color: #0000FF">leave</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_def_cfa <span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #993399">8</span>
    <span style="font-weight: bold"><span style="color: #0000FF">ret</span></span>
<span style="font-weight: bold"><span style="color: #000080">    .cfi</span></span>_endproc
<span style="font-weight: bold"><span style="color: #000080">.LFE2</span></span><span style="color: #990000">:</span>
<span style="font-weight: bold"><span style="color: #000080">    .size</span></span>    main<span style="color: #990000">,</span> <span style="color: #990000">.-</span>main
<span style="font-weight: bold"><span style="color: #000080">    .ident</span></span>    <span style="color: #FF0000">"GCC: (Debian 4.9.2-10) 4.9.2"</span>
<span style="font-weight: bold"><span style="color: #000080">    .section</span></span>    <span style="color: #990000">.</span>note<span style="color: #990000">.</span>GNU<span style="color: #990000">-</span>stack<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">,</span>@progbits</tt></pre></div></div>
<div class="paragraph"><p>Here, the value of "<code>abcdefgh</code>" is stored in the section marked as <code>.rodata</code>,
i.e., read-only.  So the <code>./string-pointer</code> command tries to overwrite this
read-only data and causes segmentation error.</p></div>
<div class="paragraph"><p>This execution time error can be moved to compilation time error by adding
"<code>const</code>" to the line defining the string.</p></div>
<div class="listingblock">
<div class="title">Compile error for string-const-pointer.c with "const char *"</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span><span style="color: #990000">*</span> bar <span style="color: #990000">=</span> <span style="color: #FF0000">"abcdefgh"</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Before bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> bar<span style="color: #990000">);</span>
    bar<span style="color: #990000">[</span><span style="color: #993399">3</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'@'</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"After  bar* = '%s'</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> bar<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>This <code>string-const-pointer.c</code> fails to compile.</p></div>
<div class="listingblock">
<div class="title">Compile error of string-const-pointer.c</div>
<div class="content">
<pre><code>string-const-pointer.c: In function main:
string-const-pointer.c:8:12: error: assignment of read-only location *(bar + 3u)...
     bar[3] = '@';
            ^</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_buffer_overflow_protection">Buffer overflow protection</h3>
<div class="paragraph"><p>Enabling macro <code>_FORTIFY_SOURCE</code> with <code>-D</code> option substitutes high risk
functions in the GNU <code>libc</code> library to protect against the buffer overflow
risk.  This requires <code>gcc</code> to be run with <code>-O1</code> or higher optimization.  This
works on all CPU architectures as long as the source code is linked to the GNU
<code>libc</code> library.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>-D_FORTIFY_SOURCE=2 -O2</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>GCC&#8217;s Stack Smashing Protector (SSP) to protect against the buffer overflow
risk of unknown cause was developed by IBM and originally called ProPolice.
This only works on some CPU architectures.  SSP can be enabled by the GCC flag:</p></div>
<div class="ulist"><ul>
<li>
<p>
SSP on for all: <code>-fstack-protector-all</code>
</p>
</li>
<li>
<p>
SSP on: <code>-fstack-protector</code>
</p>
</li>
<li>
<p>
SSP off: <code>-fno-stack-protector</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s try these compiler options using an example <code>bof.c</code> code having the buffer overflow risk.</p></div>
<div class="listingblock">
<div class="title">bof.c with the buffer overflow risk:</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> DESTLEN <span style="color: #993399">8</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span> dest<span style="color: #990000">[</span>DESTLEN<span style="color: #990000">];</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">==</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"&gt;&gt;&gt; Before the possible buffer over flow &gt;&gt;&gt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(</span>dest<span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"&lt;&lt;&lt; After the possible buffer over flow &lt;&lt;&lt;</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span><span style="color: #FF0000">"Usage: %s ARG</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span><span style="color: #FF0000">"  Length(ARG) &lt; %i bytes</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> DESTLEN<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Buffer overflow protection: None</div>
<div class="content">
<pre><code>$ ./bof-unsafe "0123456789"
&gt;&gt;&gt; Before the possible buffer over flow &gt;&gt;&gt;
&lt;&lt;&lt; After the possible buffer over flow &lt;&lt;&lt;</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Buffer overflow protection: <code>-D_FORTIFY_SOURCE=2</code></div>
<div class="content">
<pre><code>$ ./bof-fortify "0123456789"
*** buffer overflow detected ***: ./bof-fortify terminated
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x731ff)[0x7f41f15621ff]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7f41f15e54c7]
/lib/x86_64-linux-gnu/libc.so.6(+0xf46e0)[0x7f41f15e36e0]
./bof-fortify[0x400578]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7f41f1510b45]
./bof-fortify[0x4005f5]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 10646544                           /path/to...
00600000-00601000 rw-p 00000000 08:01 10646544                           /path/to...
0206d000-0208e000 rw-p 00000000 00:00 0                                  [heap]
7f41f12d9000-7f41f12ef000 r-xp 00000000 08:01 5373972                    /lib/x86...
7f41f12ef000-7f41f14ee000 ---p 00016000 08:01 5373972                    /lib/x86...
7f41f14ee000-7f41f14ef000 rw-p 00015000 08:01 5373972                    /lib/x86...
7f41f14ef000-7f41f168e000 r-xp 00000000 08:01 5374250                    /lib/x86...
7f41f168e000-7f41f188e000 ---p 0019f000 08:01 5374250                    /lib/x86...
7f41f188e000-7f41f1892000 r--p 0019f000 08:01 5374250                    /lib/x86...
7f41f1892000-7f41f1894000 rw-p 001a3000 08:01 5374250                    /lib/x86...
7f41f1894000-7f41f1898000 rw-p 00000000 00:00 0
7f41f1898000-7f41f18b8000 r-xp 00000000 08:01 5374060                    /lib/x86...
7f41f1a8a000-7f41f1a8d000 rw-p 00000000 00:00 0
7f41f1ab4000-7f41f1ab8000 rw-p 00000000 00:00 0
7f41f1ab8000-7f41f1ab9000 r--p 00020000 08:01 5374060                    /lib/x86...
7f41f1ab9000-7f41f1aba000 rw-p 00021000 08:01 5374060                    /lib/x86...
7f41f1aba000-7f41f1abb000 rw-p 00000000 00:00 0
7ffed559c000-7ffed55bd000 rw-p 00000000 00:00 0                          [stack]
7ffed55de000-7ffed55e0000 r-xp 00000000 00:00 0                          [vdso]
7ffed55e0000-7ffed55e2000 r--p 00000000 00:00 0                          [vvar]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscal...
&gt;&gt;&gt; Before the possible buffer over flow &gt;&gt;&gt;
Aborted</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Buffer overflow protection: <code>-fstack-protector --param=ssp-buffer-size=4</code></div>
<div class="content">
<pre><code>$ ./bof-safe "0123456789"
*** stack smashing detected ***: ./bof-safe terminated
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x731ff)[0x7f228cbfe1ff]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7f228cc814c7]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x0)[0x7f228cc81490]
./bof-safe[0x40073b]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7f228cbacb45]
./bof-safe[0x4005b9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 10646546                           /path/to...
00600000-00601000 rw-p 00000000 08:01 10646546                           /path/to...
01aa8000-01ac9000 rw-p 00000000 00:00 0                                  [heap]
7f228c975000-7f228c98b000 r-xp 00000000 08:01 5373972                    /lib/x86...
7f228c98b000-7f228cb8a000 ---p 00016000 08:01 5373972                    /lib/x86...
7f228cb8a000-7f228cb8b000 rw-p 00015000 08:01 5373972                    /lib/x86...
7f228cb8b000-7f228cd2a000 r-xp 00000000 08:01 5374250                    /lib/x86...
7f228cd2a000-7f228cf2a000 ---p 0019f000 08:01 5374250                    /lib/x86...
7f228cf2a000-7f228cf2e000 r--p 0019f000 08:01 5374250                    /lib/x86...
7f228cf2e000-7f228cf30000 rw-p 001a3000 08:01 5374250                    /lib/x86...
7f228cf30000-7f228cf34000 rw-p 00000000 00:00 0
7f228cf34000-7f228cf54000 r-xp 00000000 08:01 5374060                    /lib/x86...
7f228d126000-7f228d129000 rw-p 00000000 00:00 0
7f228d150000-7f228d154000 rw-p 00000000 00:00 0
7f228d154000-7f228d155000 r--p 00020000 08:01 5374060                    /lib/x86...
7f228d155000-7f228d156000 rw-p 00021000 08:01 5374060                    /lib/x86...
7f228d156000-7f228d157000 rw-p 00000000 00:00 0
7ffec52db000-7ffec52fc000 rw-p 00000000 00:00 0                          [stack]
7ffec5336000-7ffec5338000 r-xp 00000000 00:00 0                          [vdso]
7ffec5338000-7ffec533a000 r--p 00000000 00:00 0                          [vvar]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscal...
&gt;&gt;&gt; Before the possible buffer over flow &gt;&gt;&gt;
&lt;&lt;&lt; After the possible buffer over flow &lt;&lt;&lt;
Aborted</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Buffer overflow protection: <code>-fstack-protector-all</code></div>
<div class="content">
<pre><code>$ ./bof-safest "0123456789"
*** stack smashing detected ***: ./bof-safest terminated
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x731ff)[0x7fb36049a1ff]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7fb36051d4c7]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x0)[0x7fb36051d490]
./bof-safest[0x40073b]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7fb360448b45]
./bof-safest[0x4005b9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 10646548                           /path/to...
00600000-00601000 rw-p 00000000 08:01 10646548                           /path/to...
008dc000-008fd000 rw-p 00000000 00:00 0                                  [heap]
7fb360211000-7fb360227000 r-xp 00000000 08:01 5373972                    /lib/x86...
7fb360227000-7fb360426000 ---p 00016000 08:01 5373972                    /lib/x86...
7fb360426000-7fb360427000 rw-p 00015000 08:01 5373972                    /lib/x86...
7fb360427000-7fb3605c6000 r-xp 00000000 08:01 5374250                    /lib/x86...
7fb3605c6000-7fb3607c6000 ---p 0019f000 08:01 5374250                    /lib/x86...
7fb3607c6000-7fb3607ca000 r--p 0019f000 08:01 5374250                    /lib/x86...
7fb3607ca000-7fb3607cc000 rw-p 001a3000 08:01 5374250                    /lib/x86...
7fb3607cc000-7fb3607d0000 rw-p 00000000 00:00 0
7fb3607d0000-7fb3607f0000 r-xp 00000000 08:01 5374060                    /lib/x86...
7fb3609c2000-7fb3609c5000 rw-p 00000000 00:00 0
7fb3609ec000-7fb3609f0000 rw-p 00000000 00:00 0
7fb3609f0000-7fb3609f1000 r--p 00020000 08:01 5374060                    /lib/x86...
7fb3609f1000-7fb3609f2000 rw-p 00021000 08:01 5374060                    /lib/x86...
7fb3609f2000-7fb3609f3000 rw-p 00000000 00:00 0
7fff31e61000-7fff31e82000 rw-p 00000000 00:00 0                          [stack]
7fff31fb8000-7fff31fba000 r-xp 00000000 00:00 0                          [vdso]
7fff31fba000-7fff31fbc000 r--p 00000000 00:00 0                          [vvar]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscal...
&gt;&gt;&gt; Before the possible buffer over flow &gt;&gt;&gt;
&lt;&lt;&lt; After the possible buffer over flow &lt;&lt;&lt;
Aborted</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Buffer_overflow_protection">http://en.wikipedia.org/wiki/Buffer_overflow_protection</a>
</p>
</li>
<li>
<p>
<a href="http://www.research.ibm.com/trl/projects/security/ssp/">GCC extension for protecting applications from stack-smashing attacks</a> (IBM Research, August 22, 2005)
</p>
</li>
<li>
<p>
<a href="http://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/c904.html">http://www.ipa.go.jp/security/awareness/vendor/programmingv2/contents/c904.html</a> (Japanese: Part of secure programing course by IPA, Japanese government funded.)
</p>
</li>
<li>
<p>
"Introduction to GCC by Brian J. Gough" in the <a href="http://packages.qa.debian.org/g/gccintro.html">gccintro</a> package.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_library">Library</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_static_and_dynamic_libraries">Static and dynamic libraries</h3>
<div class="paragraph"><p>Compiling source while stopping at object file can be done with the <code>-c</code> option.
You can bunch such object files into a single archive/object.  This is called library.</p></div>
<div class="ulist"><ul>
<li>
<p>
static library: <code>libfoo.a</code>
</p>
<div class="ulist"><ul>
<li>
<p>
simple archive of object files (<code>*.o</code>) as "<code>ar rcs libfoo.a *.o</code>"
</p>
</li>
<li>
<p>
*.a may be used just like bunch of <code>*.o</code> files while linking.
</p>
</li>
</ul></div>
</li>
<li>
<p>
dynamic library: <code>libfoo.so</code>
</p>
<div class="ulist"><ul>
<li>
<p>
all object files (<code>*.o</code>) compiled with <code>gcc</code> option <code>-fPIC</code>.
</p>
</li>
<li>
<p>
shared object file created by "<code>gcc -shared -Wl,-soname,libfoo.so.1 -o libfoo.so.1.0 *.o</code>".
</p>
</li>
<li>
<p>
associated symbolic links created by "<code>ldconfig</code>".
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In order to load a library file with the GCC <code>-l</code> option, its name must
start with <code>lib</code>.</td>
</tr></table>
</div>
<div class="paragraph"><p>I do not go in details here but the <code>gccintro</code> package provides a good tutorial
"Introduction to GCC by Brian J. Gough" with examples.</p></div>
<div class="paragraph"><p>See also:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://people.redhat.com/drepper/dsohowto.pdf">How To Write Shared Libraries</a> by Ulrich Drepper (2011-12-10)
</p>
</li>
<li>
<p>
<a href="http://people.redhat.com/drepper/goodpractice.pdf">Good Practices in Library Design, Implementation, and Maintenance</a> by Ulrich Drepper (2002-03-07)
</p>
</li>
<li>
<p>
<a href="http://people.redhat.com/drepper/symbol-versioning">ELF Symbol Versioning</a> by Ulrich Drepper
</p>
</li>
<li>
<p>
<a href="http://www.eyrie.org/~eagle/notes/rpath.html">Shared Library Search Paths</a> by Russ Allbery (2011-11-11)
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/RpathIssue">RPATH issue</a> (wiki.debian.org)
</p>
</li>
<li>
<p>
Dynamic Linking in Linux and Windows <a href="http://www.symantec.com/connect/articles/dynamic-linking-linux-and-windows-part-one">part one</a> and <a href="http://www.symantec.com/connect/articles/dynamic-linking-linux-and-windows-part-two">part two</a> by Reji Thomas and Bhasker Reddy (2010-11-02)
</p>
</li>
<li>
<p>
<a href="http://static.usenix.org/publications/library/proceedings/als00/2000papers/papers/full_papers/browndavid/browndavid_html/">Library Interface Versioning in Solaris and Linux</a> by David J. Brown and Karl Runge (October 2010-10-10)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/library/l-lpic1-v3-102-3/">Learn Linux, 101: Manage shared libraries</a> by Ian Shields (IBM DW, Date: 31 Aug 2011)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/library/l-setup-sharedlibs-pr/">Practice: Manage shared libraries</a> by Tracy Bost (IBM DW, Date: 21 Jun 2011)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/library/l-dynamic-libraries/">Anatomy of Linux dynamic libraries</a> by M. Tim Jones (IBM DW, Date:  20 Aug 2008)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/library/l-shared/">Use shared objects on Linux</a> by Sachin Agrawal (IBM DW, Date:  11 May 2004)
</p>
</li>
<li>
<p>
<a href="http://tldp.org/HOWTO/Program-Library-HOWTO/">Program Library HOWTO</a> by David A. Wheeler (TLDP, 11 April 2003)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/library/l-shobj/">Shared objects for the object disoriented!</a> by Ashish Bansal (IBM DW, Date:  01 Apr 2001)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_gnu_c_library">GNU C Library</h3>
<div class="paragraph"><p>The Debian <code>libc6:amd64</code> package offeres
<a href="http://en.wikipedia.org/wiki/Embedded_GLIBC">embedded GNU C library</a> which
contains the standard libraries that are used by nearly all programs on the
system.</p></div>
<div class="listingblock">
<div class="title">Shared libraries offered by the <code>libc6:amd64</code> package.</div>
<div class="content">
<pre><code>/lib/x86_64-linux-gnu/libthread_db-1.0.so
/lib/x86_64-linux-gnu/ld-2.19.so
/lib/x86_64-linux-gnu/libBrokenLocale-2.19.so
/lib/x86_64-linux-gnu/libdl-2.19.so
/lib/x86_64-linux-gnu/libutil-2.19.so
/lib/x86_64-linux-gnu/libnss_files-2.19.so
/lib/x86_64-linux-gnu/libnss_nis-2.19.so
/lib/x86_64-linux-gnu/libresolv-2.19.so
/lib/x86_64-linux-gnu/libSegFault.so
/lib/x86_64-linux-gnu/libcidn-2.19.so
/lib/x86_64-linux-gnu/libnss_dns-2.19.so
/lib/x86_64-linux-gnu/libpthread-2.19.so
/lib/x86_64-linux-gnu/librt-2.19.so
/lib/x86_64-linux-gnu/libcrypt-2.19.so
/lib/x86_64-linux-gnu/libnss_compat-2.19.so
/lib/x86_64-linux-gnu/libmemusage.so
/lib/x86_64-linux-gnu/libnss_nisplus-2.19.so
/lib/x86_64-linux-gnu/libm-2.19.so
/lib/x86_64-linux-gnu/libc-2.19.so
/lib/x86_64-linux-gnu/libpcprofile.so
/lib/x86_64-linux-gnu/libanl-2.19.so
/lib/x86_64-linux-gnu/libnss_hesiod-2.19.so
/lib/x86_64-linux-gnu/libnsl-2.19.so</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_libc">libc</h3>
<div class="paragraph"><p>Most of the standard C library functions are included in the <code>libc</code> library.</p></div>
<div class="paragraph"><p>You do not mention linking to the <code>libc</code> library explicitly using the <code>-l</code> option to GCC.  It is always linked.</p></div>
<div class="paragraph"><p>Most of the basic functions of the <code>libc</code> library are explained in many C
programing tutorials such as "The C programming Language, by B. W. Kerninghan
and Dennis M. Ritchie".  I will skip most of those mentioned in such tutorials.</p></div>
<div class="paragraph"><p><a href="http://www.gnu.org/software/libc/manual/">The GNU C Library</a> manual is also good source of information.</p></div>
</div>
<div class="sect2">
<h3 id="_libc_macro">libc: macro</h3>
<div class="paragraph"><p>There are some macros defined in the <code>libc</code> library.  They tend to make
programs easier to read.</p></div>
<div class="listingblock">
<div class="title">Macro for exit status.</div>
<div class="content">
<pre><code>#define    EXIT_FAILURE    1    /* Failing exit status.  */
#define    EXIT_SUCCESS    0    /* Successful exit status.  */</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The exit status value matches with the shell convention.  But some
programs return <code>-1</code> as the non-zero value instead of <code>1</code> when errors are
encountered.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Defining <code>TRUE</code> and <code>FALSE</code> macros as the Boolean context values for <code>1</code>
and <code>0</code> are popular in the C program.  They are not defined in the <code>libc</code>
library.  So normally, user has to define them.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_libc_error_h">libc: error.h</h3>
<div class="paragraph"><p>Here are some notable items for the error handling of the <code>libc</code> library.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <code>errno</code> integer variable is set to non-zero value when library functions encounter the error.
</p>
</li>
<li>
<p>
The <code>strerror(errno)</code> function returns a pointer to a string that describes the meaning of the error for <code>errno</code>.
</p>
</li>
<li>
<p>
The <code>perror("foo")</code> produces a message on the standard error output for <code>errno</code> with <code>"foo: &lt;error message&gt;"</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The macros for the error are explained in the manpage <code>errno</code>(3).</p></div>
<div class="paragraph"><p>The values of the macros for the error are defined in <code>&lt;errno.h&gt;</code> header file which is a bit convoluted.  Arch dependent symlinks are marked as (*).:</p></div>
<div class="tableblock">
<table rules="rows"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="41%" />
<col width="16%" />
<col width="41%" />
<tbody>
<tr>
<td rowspan="2" align="left" valign="middle"><p class="table"><code>&lt;errno.h&gt;</code></p></td>
<td align="left" valign="top"><p class="table">defines</p></td>
<td align="left" valign="top"><p class="table">"<code>extern int errno;</code>".</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">includes</p></td>
<td align="left" valign="top"><p class="table"><code>&lt;bits/errno.h&gt;</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;bits/errno.h&gt;</code> (*)</p></td>
<td align="left" valign="top"><p class="table">includes</p></td>
<td align="left" valign="top"><p class="table"><code>&lt;linux/errno.h&gt;</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;linux/errno.h&gt;</code></p></td>
<td align="left" valign="top"><p class="table">includes</p></td>
<td align="left" valign="top"><p class="table"><code>&lt;asm/errno.h&gt;</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;asm/errno.h&gt;</code> (*)</p></td>
<td align="left" valign="top"><p class="table">includes</p></td>
<td align="left" valign="top"><p class="table"><code>&lt;asm-generic/errno.h&gt;</code>.</p></td>
</tr>
<tr>
<td rowspan="2" align="left" valign="middle"><p class="table"><code>&lt;asm-generic/errno.h&gt;</code></p></td>
<td align="left" valign="top"><p class="table">defines</p></td>
<td align="left" valign="top"><p class="table">many error values.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">includes</p></td>
<td align="left" valign="top"><p class="table"><code>&lt;asm-generic/errno-base.h&gt;</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;asm-generic/errno-base.h&gt;</code></p></td>
<td align="left" valign="top"><p class="table">defines</p></td>
<td align="left" valign="top"><p class="table">important error values from 1 to 34.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Make sure to include <code>&lt;error.h&gt;</code> in the header if a program needs to
deal with the <code>libc</code> library generated errors.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_libc_string_operations">libc: string operations</h3>
<div class="paragraph"><p>Unfortunately, some C string functions are known to be troublemakers.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 3. Safe coding recommendations by busybox coders</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">troublemaker functions</p></td>
<td align="left" valign="top"><p class="table">overrun concerns</p></td>
<td align="left" valign="top"><p class="table">recommendation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>strcpy</code>(3)</p></td>
<td align="left" valign="top"><p class="table"><code>dest</code> string</p></td>
<td align="left" valign="top"><p class="table"><code>safe_strncpy</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>strncpy</code>(3)</p></td>
<td align="left" valign="top"><p class="table">may fail to 0-terminate <code>dst</code></p></td>
<td align="left" valign="top"><p class="table"><code>safe_strncpy</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>strcat</code>(3)</p></td>
<td align="left" valign="top"><p class="table"><code>dest</code> string</p></td>
<td align="left" valign="top"><p class="table"><code>strncat</code>(3)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>gets</code>(3)</p></td>
<td align="left" valign="top"><p class="table">string it gets</p></td>
<td align="left" valign="top"><p class="table"><code>fgets</code>(3)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>getwd</code>(3)</p></td>
<td align="left" valign="top"><p class="table"><code>buf</code> string</p></td>
<td align="left" valign="top"><p class="table"><code>getcwd</code>(3)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>[v]sprintf</code>(3)</p></td>
<td align="left" valign="top"><p class="table"><code>str</code> buffer</p></td>
<td align="left" valign="top"><p class="table"><code>[v]snprintf</code>(3)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>realpath</code>(3)</p></td>
<td align="left" valign="top"><p class="table"><code>path</code> buffer</p></td>
<td align="left" valign="top"><p class="table">use with <code>pathconf</code>(3)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>[vf]scanf</code>(3)</p></td>
<td align="left" valign="top"><p class="table">its arguments</p></td>
<td align="left" valign="top"><p class="table">just avoid it</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Although <code>[vf]scanf</code>(3) are marked as "just avoid it", it is not the end of the
world for the coding of the <code>scanf</code>-like logic.</p></div>
<div class="paragraph"><p>The combination of <code>getline</code>(3) and <code>sscanf</code>(3) is the most portable solution
for the safe <code>scanf</code> alternative.  If the incoming data is not delimited by the
newline "<code>\n</code>" code, <code>getdelim</code>(3) may alternatively be used in place of
<code>getline</code>(3).</p></div>
<div class="paragraph"><p>The use the "<code>m</code>" flag in the format string, as described in <code>scanf</code>(3) is the
other solution for the safe <code>scanf</code> alternative. (You need newer POSIX.1-2008
complient <code>libc</code>.)  It uses "<code>[vf]scanf("%ms", &amp;char)</code>" with <code>free</code> instead of
"<code>[vf]scanf("%s", char)</code>" alone.</p></div>
</div>
<div class="sect2">
<h3 id="_libc_safe_strncpy">libc: safe_strncpy</h3>
<div class="paragraph"><p>The <code>safe_strncpy</code> recommended by busybox coders is essentially the 0-terminate
guranteed <code>strncpy</code> with the safe data length.  Since it is missing in the
<code>libc</code> library, it should be emulated by adding a custom function definition
as:</p></div>
<div class="listingblock">
<div class="title">Alternative safe string copy function <code>safe_strncpy</code>: <code>safe_strncpy.c</code>.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="color: #009900">char</span><span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">safe_strncpy</span></span><span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*</span>dst<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>src<span style="color: #990000">,</span> <span style="color: #008080">size_t</span> size<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>size <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> dst<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        size<span style="color: #990000">--;</span>
        dst<span style="color: #990000">[</span>size<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'</span><span style="color: #CC33CC">\0</span><span style="color: #FF0000">'</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">strncpy</span></span><span style="color: #990000">(</span>dst<span style="color: #990000">,</span> src<span style="color: #990000">,</span> size<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Alternative safe string copy function <code>safe_strncpy</code>: <code>safe_strncpy.h</code>.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">char</span><span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">safe_strncpy</span></span><span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*</span>dst<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>src<span style="color: #990000">,</span> <span style="color: #008080">size_t</span> size<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s test string copy functions: <code>strcpy</code>, <code>strncpy</code>, and <code>safe_strncpy</code>.</p></div>
<div class="listingblock">
<div class="title">Test code for string copy functions: <code>test_strcpy.c</code>.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"safe_strncpy.h"</span>

<span style="color: #009900">char</span> s1<span style="color: #990000">[</span><span style="color: #993399">10</span><span style="color: #990000">],</span> s2<span style="color: #990000">[</span><span style="color: #993399">10</span><span style="color: #990000">];</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>sc1 <span style="color: #990000">=</span> <span style="color: #FF0000">"0123456789"</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* 11 bytes */</span></span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>sc2 <span style="color: #990000">=</span> <span style="color: #FF0000">"I gotcha!"</span><span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* 10 bytes */</span></span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Constant strings"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">sc1 = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> sc1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">sc2 = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> sc2<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">safe_strncpy</span></span><span style="color: #990000">(</span>s1<span style="color: #990000">,</span> sc1<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">safe_strncpy</span></span><span style="color: #990000">(</span>s2<span style="color: #990000">,</span> sc2<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Copied strings: safe_strncpy</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
        <span style="color: #FF0000">"</span><span style="color: #CC33CC">\t\t</span><span style="color: #FF0000">It should drop 9 at the end to be safe."</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s1  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s2  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s2<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">strncpy</span></span><span style="color: #990000">(</span>s1<span style="color: #990000">,</span> sc1<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Copied strings: strncpy(s1, sc1, 10)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
        <span style="color: #FF0000">"</span><span style="color: #CC33CC">\t\t</span><span style="color: #FF0000">printf(..., s1) can not stop at the end."</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s1  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s2  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s2<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(</span>s1<span style="color: #990000">,</span> sc1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Copied strings: strcpy(s1, sc1)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
        <span style="color: #FF0000">"</span><span style="color: #CC33CC">\t\t</span><span style="color: #FF0000">strcpy overwrites onto s2."</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s1  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\t</span><span style="color: #FF0000">s2  = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> s2<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Test result of string copy functions by <code>test_strcpy.c</code>.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #990000">./</span>test_strcpy
Constant strings
    sc1 <span style="color: #990000">=</span> <span style="color: #993399">0123456789</span>
    sc2 <span style="color: #990000">=</span> <span style="color: #008080">I</span> gotcha<span style="color: #990000">!</span>
<span style="color: #008080">Copied</span> strings<span style="color: #990000">:</span> safe_strncpy
        It should drop <span style="color: #993399">9</span> at the end to <span style="color: #008080">be</span> safe<span style="color: #990000">.</span>
    s1  <span style="color: #990000">=</span> <span style="color: #993399">012345678</span>
    s2  <span style="color: #990000">=</span> <span style="color: #008080">I</span> gotcha<span style="color: #990000">!</span>
<span style="color: #008080">Copied</span> strings<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">strncpy</span></span><span style="color: #990000">(</span>s1<span style="color: #990000">,</span> sc1<span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(...,</span> s1<span style="color: #990000">)</span> can not stop at <span style="color: #008080">the</span> end<span style="color: #990000">.</span>
    s1  <span style="color: #990000">=</span> <span style="color: #993399">0123456789</span>
    s2  <span style="color: #990000">=</span> <span style="color: #008080">I</span> gotcha<span style="color: #990000">!</span>
<span style="color: #008080">Copied</span> strings<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">strcpy</span></span><span style="color: #990000">(</span>s1<span style="color: #990000">,</span> sc1<span style="color: #990000">)</span>
        strcpy overwrites <span style="color: #008080">onto</span> s2<span style="color: #990000">.</span>
    s1  <span style="color: #990000">=</span> <span style="color: #993399">0123456789</span>
    s2  <span style="color: #990000">=</span> <span style="color: #008080">I</span> gotcha<span style="color: #990000">!</span></tt></pre></div></div>
<div class="paragraph"><p>Only <code>safe_strncpy</code> works safely as seen above.</p></div>
</div>
<div class="sect2">
<h3 id="_libc_file_operations">libc: file operations</h3>
<div class="paragraph"><p>File operation in C can be done with different levels.</p></div>
<div class="ulist"><ul>
<li>
<p>
low level file descriptor based operations:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>open</code>(2): open and possibly create the file and return a new file descriptor
</p>
</li>
<li>
<p>
<code>close</code>(2): close the file descriptor
</p>
</li>
<li>
<p>
<code>lseak</code>(2): reposition read/write file offset associated with the file descriptor
</p>
</li>
<li>
<p>
<code>read</code>(2): read from the file descriptor
</p>
</li>
<li>
<p>
<code>write</code>(2): write to the file descriptor
</p>
</li>
<li>
<p>
<code>mmap</code>(2): map file associated with the file descriptor into memory
</p>
</li>
<li>
<p>
<code>fcntl</code>(2): manipulate file descriptor
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Predefined file descriptor macros</div>
<div class="content">
<pre><code>#define    STDIN_FILENO    0    /* Standard input.  */
#define    STDOUT_FILENO    1    /* Standard output.  */
#define    STDERR_FILENO    2    /* Standard error output.  */</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
high level stream IO based operations:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>fopen</code>(3): open and possibly create the file and associate the stream with the file
</p>
</li>
<li>
<p>
<code>fclose</code>(3): close the stream
</p>
</li>
<li>
<p>
<code>feof</code>(3):  test the end-of-file indicator for the stream
</p>
</li>
<li>
<p>
<code>ferror</code>(3): test the error indicator for the stream
</p>
</li>
<li>
<p>
<code>getc</code>(3): read a character from the binary stream
</p>
</li>
<li>
<p>
<code>putc</code>(3): write a character to the binary stream
</p>
</li>
<li>
<p>
<code>fread</code>(3): read blocks of data from the binary stream
</p>
</li>
<li>
<p>
<code>fwrite</code>(3): write blocks of data to the binary stream
</p>
</li>
<li>
<p>
<code>fprintf</code>(3): formatted text stream output conversion
</p>
</li>
<li>
<p>
<code>fscanf</code>(3): formatted text stream input conversion
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Predefined file stream macros</div>
<div class="content">
<pre><code>#define stdin stdin
#define stdout stdout
#define stderr stderr</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s learn fundamentals of file operation by creating simple codes such as
<a href="#_libc_size_of_a_file">size of a file</a> or <a href="#_libc_copy_a_file">copy a file</a>.
These example codes are not meant to be the fastest nor the shortest code.</p></div>
</div>
<div class="sect2">
<h3 id="_libc_size_of_a_file">libc: size of a file</h3>
<div class="paragraph"><p>We can think of 4 different methods to obtain the size of a file.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>char</strong> : read and count characters
</p>
</li>
<li>
<p>
<strong>block</strong> : read blocks and count characters
</p>
</li>
<li>
<p>
<strong>lseek</strong> : move file offset and count characters
</p>
</li>
<li>
<p>
<strong>stat</strong> : obtain file size from the directory it belongs
</p>
</li>
</ul></div>
<div class="paragraph"><p>Since <strong>stat</strong> method works only for real files but not for symlinks, <strong>lseek</strong>
method seems to be the most popular one used.</p></div>
<div class="paragraph"><p>Here are benchmark results of these methods using <code>perf</code> (See <a href="#_perf">Debug: level 4: perf</a>).</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 4. Speed benchmark of various methods to obtain the file size.</caption>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<thead>
<tr>
<th align="left" valign="top">Performance counter stats</th>
<th align="left" valign="top">char</th>
<th align="left" valign="top">block</th>
<th align="left" valign="top">lseek</th>
<th align="left" valign="top">stat</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">seconds time elapsed</p></td>
<td align="left" valign="top"><p class="table">0.060168937</p></td>
<td align="left" valign="top"><p class="table">0.004092420</p></td>
<td align="left" valign="top"><p class="table">0.002638296</p></td>
<td align="left" valign="top"><p class="table">0.002588425</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">task-clock</p></td>
<td align="left" valign="top"><p class="table">59.126037</p></td>
<td align="left" valign="top"><p class="table">3.051782</p></td>
<td align="left" valign="top"><p class="table">1.616662</p></td>
<td align="left" valign="top"><p class="table">1.634113</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">context-switches</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cpu-migrations</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">page-faults</p></td>
<td align="left" valign="top"><p class="table">193</p></td>
<td align="left" valign="top"><p class="table">193</p></td>
<td align="left" valign="top"><p class="table">191</p></td>
<td align="left" valign="top"><p class="table">191</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cycles</p></td>
<td align="left" valign="top"><p class="table">154,305,859</p></td>
<td align="left" valign="top"><p class="table">2,428,799</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
<td align="left" valign="top"><p class="table">1,297,107</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-frontend</p></td>
<td align="left" valign="top"><p class="table">32,413,607</p></td>
<td align="left" valign="top"><p class="table">1,237,525</p></td>
<td align="left" valign="top"><p class="table">787,158</p></td>
<td align="left" valign="top"><p class="table">805,663</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-backend</p></td>
<td align="left" valign="top"><p class="table">3,089,296</p></td>
<td align="left" valign="top"><p class="table">828,200</p></td>
<td align="left" valign="top"><p class="table">612,162</p></td>
<td align="left" valign="top"><p class="table">627,711</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branches</p></td>
<td align="left" valign="top"><p class="table">87,138,178</p></td>
<td align="left" valign="top"><p class="table">382,322</p></td>
<td align="left" valign="top"><p class="table">209,395</p></td>
<td align="left" valign="top"><p class="table">208,836</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branch-misses</p></td>
<td align="left" valign="top"><p class="table">14,795</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
<td align="left" valign="top"><p class="table">9,023</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>If you wish to do more than just counting characters, other methods may give
good starting point for such programs.  I will list all the source of <code>size.c</code> as below.</p></div>
<div class="listingblock">
<div class="title">Read size of a file (char)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fcntl.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/stat.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* open lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>f<span style="color: #990000">;</span>
    <span style="color: #008080">off_t</span> size <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need a filename as an argument.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #FF0000">"r"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>f <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(;;)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">fgetc</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">ferror</span></span><span style="color: #990000">(</span>f<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Error reading input file"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">feof</span></span><span style="color: #990000">(</span>f<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            size <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>f<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">File size: %'zi</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> size<span style="color: #990000">));</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Read size of a file (block)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* exit, malloc */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror, freed */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">BUFFSIZE</span></span> <span style="color: #990000">(</span><span style="color: #993399">1024</span><span style="color: #990000">*</span><span style="color: #993399">4</span><span style="color: #990000">)</span>
<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>f<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> n <span style="color: #990000">=</span> BUFFSIZE<span style="color: #990000">,</span> i<span style="color: #990000">,</span> size <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need a filename as an argument.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>buf <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">malloc</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not make a buffer"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #FF0000">"r"</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(;;)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fread</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> n<span style="color: #990000">,</span> f<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">ferror</span></span><span style="color: #990000">(</span>f<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Error reading input file"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            size <span style="color: #990000">+=</span> i<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>f<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">File size: %'zi</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> size<span style="color: #990000">));</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Read size of a file (lseek)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fcntl.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/stat.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* open, lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> fd<span style="color: #990000">;</span>
    <span style="color: #008080">off_t</span> size<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need a filename as an argument.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fd <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> O_RDONLY<span style="color: #990000">))</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    size <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lseek</span></span><span style="color: #990000">(</span>fd<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> SEEK_END<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">File size: %'zi</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> size<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Read size of a file (stat)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* stat */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/stat.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* stat */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* stat */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">stat</span> st<span style="color: #990000">;</span>
    <span style="color: #008080">off_t</span> size<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need a filename as an argument.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">stat</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #990000">&amp;</span>st<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not stat input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    size <span style="color: #990000">=</span> st<span style="color: #990000">.</span>st_size<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">File size: %'zi</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> size<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>All the above example can be compiled as follows.</p></div>
<div class="listingblock">
<div class="title">Example of compiling <code>size.c</code>.</div>
<div class="content">
<pre><code>$ gcc -Wall -o size size.c</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_libc_copy_a_file">libc: copy a file</h3>
<div class="paragraph"><p>We can think of 5 different methods to copy a file.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>char</strong> : copy a character at a time
</p>
</li>
<li>
<p>
<strong>block</strong> : copy a block (4 KiB) at a time
</p>
</li>
<li>
<p>
<strong>block big</strong> : copy a block (4 MiB) at a time
</p>
</li>
<li>
<p>
<strong>mmap memcpy</strong> : use <code>mmap</code>(2) to map input and output files while copying data with <code>memcpy</code>(3).
</p>
</li>
<li>
<p>
<strong>mmap write</strong> : use <code>mmap</code>(2) to map input file while writing data with <code>write</code>(2) from the memory.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here are benchmark results of these methods using <code>perf</code> (See <a href="#_perf">Debug: level 4: perf</a>).</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 5. Speed benchmark of various methods to copy a large file about 2.4 MiB.</caption>
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="left" valign="top">Performance counter stats</th>
<th align="left" valign="top">char</th>
<th align="left" valign="top">block</th>
<th align="left" valign="top">block big</th>
<th align="left" valign="top">mmap memcpy</th>
<th align="left" valign="top">mmap write</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">seconds time elapsed</p></td>
<td align="left" valign="top"><p class="table">0.089096423</p></td>
<td align="left" valign="top"><p class="table">0.015654253</p></td>
<td align="left" valign="top"><p class="table">0.016963338</p></td>
<td align="left" valign="top"><p class="table">0.018813373</p></td>
<td align="left" valign="top"><p class="table">0.018040972</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">task-clock</p></td>
<td align="left" valign="top"><p class="table">78.600617</p></td>
<td align="left" valign="top"><p class="table">5.916846</p></td>
<td align="left" valign="top"><p class="table">7.286212</p></td>
<td align="left" valign="top"><p class="table">8.114573</p></td>
<td align="left" valign="top"><p class="table">6.747344</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">context-switches</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cpu-migrations</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">page-faults</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">715</p></td>
<td align="left" valign="top"><p class="table">1,283</p></td>
<td align="left" valign="top"><p class="table">694</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cycles</p></td>
<td align="left" valign="top"><p class="table">213,622,432</p></td>
<td align="left" valign="top"><p class="table">8,787,602</p></td>
<td align="left" valign="top"><p class="table">9,975,035</p></td>
<td align="left" valign="top"><p class="table">9,506,449</p></td>
<td align="left" valign="top"><p class="table">8,258,812</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-frontend</p></td>
<td align="left" valign="top"><p class="table">46,249,968</p></td>
<td align="left" valign="top"><p class="table">5,289,960</p></td>
<td align="left" valign="top"><p class="table">4,939,101</p></td>
<td align="left" valign="top"><p class="table">4,771,343</p></td>
<td align="left" valign="top"><p class="table">4,421,422</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-backend</p></td>
<td align="left" valign="top"><p class="table">8,069,075</p></td>
<td align="left" valign="top"><p class="table">3,617,957</p></td>
<td align="left" valign="top"><p class="table">3,660,122</p></td>
<td align="left" valign="top"><p class="table">3,965,894</p></td>
<td align="left" valign="top"><p class="table">3,223,960</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branches</p></td>
<td align="left" valign="top"><p class="table">118,042,429</p></td>
<td align="left" valign="top"><p class="table">1,614,855</p></td>
<td align="left" valign="top"><p class="table">1,639,492</p></td>
<td align="left" valign="top"><p class="table">1,555,953</p></td>
<td align="left" valign="top"><p class="table">1,442,130</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branch-misses</p></td>
<td align="left" valign="top"><p class="table">20,800</p></td>
<td align="left" valign="top"><p class="table">12,048</p></td>
<td align="left" valign="top"><p class="table">10,295</p></td>
<td align="left" valign="top"><p class="table">8,539</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 6. Speed benchmark of various methods to copy a small file about 2 KiB.</caption>
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="left" valign="top">Performance counter stats</th>
<th align="left" valign="top">char</th>
<th align="left" valign="top">block</th>
<th align="left" valign="top">block big</th>
<th align="left" valign="top">mmap memcpy</th>
<th align="left" valign="top">mmap write</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">seconds time elapsed</p></td>
<td align="left" valign="top"><p class="table">0.002350776</p></td>
<td align="left" valign="top"><p class="table">0.001894332</p></td>
<td align="left" valign="top"><p class="table">0.001848917</p></td>
<td align="left" valign="top"><p class="table">0.002023421</p></td>
<td align="left" valign="top"><p class="table">0.002016262</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">task-clock</p></td>
<td align="left" valign="top"><p class="table">1.335467</p></td>
<td align="left" valign="top"><p class="table">1.008275</p></td>
<td align="left" valign="top"><p class="table">0.954096</p></td>
<td align="left" valign="top"><p class="table">1.053580</p></td>
<td align="left" valign="top"><p class="table">1.013171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">context-switches</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cpu-migrations</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">page-faults</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">132</p></td>
<td align="left" valign="top"><p class="table">117</p></td>
<td align="left" valign="top"><p class="table">111</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cycles</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
<td align="left" valign="top"><p class="table">731,955</p></td>
<td align="left" valign="top"><p class="table">769,188</p></td>
<td align="left" valign="top"><p class="table">606,346</p></td>
<td align="left" valign="top"><p class="table">616,053</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-frontend</p></td>
<td align="left" valign="top"><p class="table">696,792</p></td>
<td align="left" valign="top"><p class="table">625,996</p></td>
<td align="left" valign="top"><p class="table">648,758</p></td>
<td align="left" valign="top"><p class="table">579,552</p></td>
<td align="left" valign="top"><p class="table">552,678</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-backend</p></td>
<td align="left" valign="top"><p class="table">536,087</p></td>
<td align="left" valign="top"><p class="table">495,138</p></td>
<td align="left" valign="top"><p class="table">513,756</p></td>
<td align="left" valign="top"><p class="table">455,248</p></td>
<td align="left" valign="top"><p class="table">434,162</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branches</p></td>
<td align="left" valign="top"><p class="table">153,252</p></td>
<td align="left" valign="top"><p class="table">125,526</p></td>
<td align="left" valign="top"><p class="table">127,090</p></td>
<td align="left" valign="top"><p class="table">102,813</p></td>
<td align="left" valign="top"><p class="table">99,467</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branch-misses</p></td>
<td align="left" valign="top"><p class="table">3,292</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
<td align="left" valign="top"><p class="table">2,232</p></td>
<td align="left" valign="top"><p class="table">2,474</p></td>
<td align="left" valign="top"><p class="table">&lt;not counted&gt;</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The <strong>char</strong> method works the slowest as expected.</p></div>
<div class="paragraph"><p>The <strong>block</strong> method works slightly faster than all other methods excluding the
<strong>char</strong> method which is significantly slower.</p></div>
<div class="paragraph"><p>If you wish to do more than just copying a file, other methods may give good
starting point for such programs.  For example, if many programs access the
same file simultaneously, use of <code>mmap</code>(2) should have major advantage over
simple block method.  I will list all the source of <code>cp.c</code> as below.</p></div>
<div class="listingblock">
<div class="title">Read copy a file (char)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>fi<span style="color: #990000">,</span> <span style="color: #990000">*</span>fo<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need 2 filenames as arguments.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fi <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #FF0000">"r"</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fo <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">],</span> <span style="color: #FF0000">"w"</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(;;)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getc</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">ferror</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Error reading input file"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">feof</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">putc</span></span><span style="color: #990000">(</span>i<span style="color: #990000">,</span> fo<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>fo<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Copy a file (block)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* exit, malloc */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror, freed */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">BUFFSIZE</span></span> <span style="color: #990000">(</span><span style="color: #993399">1024</span><span style="color: #990000">*</span><span style="color: #993399">4</span><span style="color: #990000">)</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">FILE</span> <span style="color: #990000">*</span>fi<span style="color: #990000">,</span> <span style="color: #990000">*</span>fo<span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> n <span style="color: #990000">=</span> BUFFSIZE<span style="color: #990000">,</span> i<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need 2 filenames as arguments.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fi <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #FF0000">"r"</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fo <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fopen</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">],</span> <span style="color: #FF0000">"w"</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>buf <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #009900">char</span> <span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">malloc</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not make a buffer"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(;;)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">fread</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> n<span style="color: #990000">,</span> fi<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">ferror</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Error reading input file"</span><span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fwrite</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> fo<span style="color: #990000">)</span> <span style="color: #990000">!=</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Error writing output file"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>fi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fclose</span></span><span style="color: #990000">(</span>fo<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Copy a file (big block) replaces <code>#define BUFFSIZE (1024*4)</code> in the above with
<code>#define BUFFSIZE (1024*1024*4)</code>.</p></div>
<div class="listingblock">
<div class="title">Copy a file (mmap+memcpy)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* exit, malloc */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fcntl.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* lseek, write */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/stat.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* open, lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/mman.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* mmap */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* memcpy */</span></span>
<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> fdi<span style="color: #990000">,</span> fdo<span style="color: #990000">;</span>
    <span style="color: #009900">void</span> <span style="color: #990000">*</span>src<span style="color: #990000">,</span> <span style="color: #990000">*</span>dst<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> size<span style="color: #990000">;</span>
    <span style="color: #008080">ssize_t</span> offset<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need 2 filenames as arguments.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fdi <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> O_RDONLY<span style="color: #990000">))</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    size <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lseek</span></span><span style="color: #990000">(</span>fdi<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> SEEK_END<span style="color: #990000">);</span>
    src <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">mmap</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> size<span style="color: #990000">,</span> PROT_READ<span style="color: #990000">,</span> MAP_SHARED<span style="color: #990000">,</span> fdi<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>src <span style="color: #990000">==</span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not map input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fdo <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">],</span> O_CREAT <span style="color: #990000">|</span> O_RDWR <span style="color: #990000">|</span> O_TRUNC<span style="color: #990000">,</span> <span style="color: #993399">00666</span><span style="color: #990000">))</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    offset <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lseek</span></span><span style="color: #990000">(</span>fdo<span style="color: #990000">,</span> size <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">,</span> SEEK_SET<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>offset <span style="color: #990000">==</span> <span style="color: #990000">(</span>ssize_t<span style="color: #990000">)</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: lseek() error"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    offset <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdo<span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* dummy write at the end */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>offset <span style="color: #990000">==</span> <span style="color: #990000">(</span>ssize_t<span style="color: #990000">)</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: write() error"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    dst <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">mmap</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> size<span style="color: #990000">,</span> PROT_WRITE<span style="color: #990000">,</span> MAP_SHARED<span style="color: #990000">,</span> fdo<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>dst <span style="color: #990000">==</span> MAP_FAILED<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not map output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">memcpy</span></span><span style="color: #990000">(</span>dst<span style="color: #990000">,</span> src<span style="color: #990000">,</span> size<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">munmap</span></span><span style="color: #990000">(</span>src<span style="color: #990000">,</span> size<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not unmap input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">munmap</span></span><span style="color: #990000">(</span>dst<span style="color: #990000">,</span> size<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not unmap output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdo<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The dummy <code>write</code> of 1 byte of 0 to the output file after <code>lseek</code> is the
idiom to set the size of the output file with <code>mmap</code>(2).  It will be
overwritten by the subsequent <code>memcpy</code>(3).</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Copy a file (mmap+write)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* exit, malloc */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* printf, perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;errno.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* perror */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;fcntl.h&gt;</span>      <span style="font-style: italic"><span style="color: #9A1900">/* open */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* stat */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/types.h&gt;</span>  <span style="font-style: italic"><span style="color: #9A1900">/* open, lseek */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/stat.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* open stat */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;sys/mman.h&gt;</span>   <span style="font-style: italic"><span style="color: #9A1900">/* mmap */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* setlocale */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>     <span style="font-style: italic"><span style="color: #9A1900">/* memcpy */</span></span>
<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> fdi<span style="color: #990000">,</span> fdo<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">stat</span> st<span style="color: #990000">;</span>
    <span style="color: #009900">void</span> <span style="color: #990000">*</span>src<span style="color: #990000">;</span>
    <span style="color: #008080">size_t</span> size<span style="color: #990000">;</span>
    <span style="color: #008080">ssize_t</span> offset<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">!=</span> <span style="color: #993399">3</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Need 2 filenames as arguments.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fdi <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> O_RDONLY<span style="color: #990000">))</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">stat</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">],</span> <span style="color: #990000">&amp;</span>st<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not stat input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    size <span style="color: #990000">=</span> st<span style="color: #990000">.</span>st_size<span style="color: #990000">;</span>
    src <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">mmap</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">,</span> size<span style="color: #990000">,</span> PROT_READ<span style="color: #990000">,</span> MAP_SHARED<span style="color: #990000">,</span> fdi<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>src <span style="color: #990000">==</span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not map input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>fdo <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">],</span> O_CREAT <span style="color: #990000">|</span> O_RDWR <span style="color: #990000">|</span> O_TRUNC<span style="color: #990000">,</span> <span style="color: #993399">00666</span><span style="color: #990000">))</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not open output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    offset <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>fdo<span style="color: #990000">,</span> src<span style="color: #990000">,</span> size<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>offset <span style="color: #990000">==</span> <span style="color: #990000">(</span>ssize_t<span style="color: #990000">)</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: write() error"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">munmap</span></span><span style="color: #990000">(</span>src<span style="color: #990000">,</span> size<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not unmap input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdi<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close input file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">(</span>fdo<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">perror</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"E: Can not close output file"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Example of compiling <code>cp.c</code>.</div>
<div class="content">
<pre><code>$ gcc -Wall -o cp cp.c</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_libc_setlocale">libc: setlocale</h3>
<div class="paragraph"><p>For decimal conversion functions provided by the <code>libc</code> library such as
<code>printf</code>(3), the 3-digit-grouping behavior depends on the locale.  Use
<code>setlocale</code>(3) to set the locale.</p></div>
<div class="listingblock">
<div class="title">Localization example of <code>printf</code> as <code>lprintf.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/* vi:set ts=4 sts=4 expandtab: */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;locale.h&gt;</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">*</span> argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> n <span style="color: #990000">=</span> <span style="color: #993399">12345678</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"init        %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"init        %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">""</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"env         %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"env         %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">"C"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C           %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C           %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">"en_US.UTF-8"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"en_US.UTF-8 %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"en_US.UTF-8 %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">"fr_FR.UTF-8"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"fr_FR.UTF-8 %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"fr_FR.UTF-8 %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">"de_DE.UTF-8"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"de_DE.UTF-8 %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"de_DE.UTF-8 %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">setlocale</span></span><span style="color: #990000">(</span>LC_ALL<span style="color: #990000">,</span><span style="color: #FF0000">"ja_JP.UTF-8"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ja_JP.UTF-8 %%i  -&gt; %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"ja_JP.UTF-8 %%'i -&gt; %'i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Run <code>lprintf</code></div>
<div class="content">
<pre><code>$ ./lprintf
init        %i  -&gt; 12345678
init        %'i -&gt; 12345678
env         %i  -&gt; 12345678
env         %'i -&gt; 12,345,678
C           %i  -&gt; 12345678
C           %'i -&gt; 12345678
en_US.UTF-8 %i  -&gt; 12345678
en_US.UTF-8 %'i -&gt; 12,345,678
fr_FR.UTF-8 %i  -&gt; 12345678
fr_FR.UTF-8 %'i -&gt; 12 345 678
de_DE.UTF-8 %i  -&gt; 12345678
de_DE.UTF-8 %'i -&gt; 12.345.678
ja_JP.UTF-8 %i  -&gt; 12345678
ja_JP.UTF-8 %'i -&gt; 12,345,678</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The text translation mechanism also uses the locale.  See <code>gettext</code>(3) and "<code>info gettext</code>".</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_libm">libm</h3>
<div class="paragraph"><p>Although most of standard C library functions are included in the <code>libc</code> library,
some math related library functions are in the separate <code>libm</code> library.</p></div>
<div class="paragraph"><p>So such program requires to be linked not just to <code>libc</code> but also to <code>libm</code>.</p></div>
<div class="paragraph"><p>Let&#8217;s consider <code>math.c</code> to calculate <code>sin(60 degree)</code>.</p></div>
<div class="listingblock">
<div class="title">Source code: math.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;math.h&gt;</span>
<span style="color: #009900">double</span>
<span style="font-weight: bold"><span style="color: #000000">sindeg</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">sin</span></span><span style="color: #990000">(</span>x <span style="color: #990000">*</span> <span style="color: #993399">3.141592</span> <span style="color: #990000">/</span> <span style="color: #993399">180.0</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> x<span style="color: #990000">,</span> y<span style="color: #990000">;</span>
    x <span style="color: #990000">=</span> <span style="color: #993399">60.0</span><span style="color: #990000">;</span>
    y <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">sindeg</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"angle = %f degree, sin(angle) = %f</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>math.c</code> while linking to the <code>libm</code> library to create an ELF executable object <code>math</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./math
angle = 60.000000 degree, sin(angle) = 0.866025</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The linked library is specified after the <code>-l</code> option to GCC while removing the leading <code>lib</code> from the library name.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s list linked libraries to the ELF executable object <code>hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>    linux-vdso.so.1 (0x00007ffcdb54d000)
    libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f4c7ff9e000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4c7fbf5000)
    /lib64/ld-linux-x86-64.so.2 (0x00007f4c8029f000)</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<code>linux-vdso.so.1</code> : Linux Virtual Dynamic Shared Object
</p>
</li>
<li>
<p>
<code>libm.so.6</code> : The GNU C Library (glibc, support math functions)
</p>
</li>
<li>
<p>
<code>libc.so.6</code> : The GNU C Library (glibc)
</p>
</li>
<li>
<p>
<code>/lib64/ld-linux-x86-64.so.2</code> :  dynamic linker/loader
</p>
</li>
</ul></div>
<div class="paragraph"><p>We can split <code>math.c</code> into 3 files and compile each code piece.</p></div>
<div class="listingblock">
<div class="title">Source code: math-main.c containing the main() function only</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"sindeg.h"</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> x<span style="color: #990000">,</span> y<span style="color: #990000">;</span>
    x <span style="color: #990000">=</span> <span style="color: #993399">60.0</span><span style="color: #990000">;</span>
    y <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">sindeg</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"angle = %f degree, sin(angle) = %f</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Source code: sindeg.c containing the sindeg() function only</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;math.h&gt;</span>
<span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">sindeg</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">sin</span></span><span style="color: #990000">(</span>x <span style="color: #990000">*</span> <span style="color: #993399">3.141592</span> <span style="color: #990000">/</span> <span style="color: #993399">180.0</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Source code: sindeg.h containing the header information of sindeg()</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">sindeg</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> x<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile these into separate object files (<code>*.o</code> files) with the <code>-c</code> option
and link them into a executable <code>math-main</code> specified with the <code>-o</code> option.</p></div>
<div class="listingblock">
<div class="title">Building math-main via separate object files and running it.</div>
<div class="content">
<pre><code>$ gcc -Wall -c sindeg.c
$ gcc -Wall -o math-main math-main.o sindeg.o -lm
$ ./math-main
angle = 60.000000 degree, sin(angle) = 0.866025</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_libdl">libdl</h3>
<div class="paragraph"><p><code>libdl</code> provides the following generic functions for the dynamic loader.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>dlopen</code>(3): POSIX
</p>
</li>
<li>
<p>
<code>dlerror</code>(3): POSIX
</p>
</li>
<li>
<p>
<code>dlsym</code>(3): POSIX
</p>
</li>
<li>
<p>
<code>dlclose</code>(3): POSIX
</p>
</li>
<li>
<p>
<code>dladdr</code>(3): Glibc extensions
</p>
</li>
<li>
<p>
<code>dlvsym</code>(3): Glibc extensions
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s convert <code>math.c</code> to <code>math-dl.c</code> which uses <code>libm</code> via dynamic linking
loader provided by <code>libdl</code>.  Here, function names prefixed with <code>v</code> are defined
as wrappers for the <code>dlopen</code>, <code>dlsym</code>, and <code>dlclose</code> functions providing
verbose error reporting.  So the core is just <code>main()</code>.</p></div>
<div class="listingblock">
<div class="title">Source code: math-dl.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;dlfcn.h&gt;</span>

<span style="color: #009900">void</span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">vdlopen</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>filename<span style="color: #990000">,</span> <span style="color: #009900">int</span> flag<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">void</span> <span style="color: #990000">*</span>dl_handle<span style="color: #990000">;</span>
    dl_handle <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">dlopen</span></span><span style="color: #990000">(</span>filename<span style="color: #990000">,</span> RTLD_LAZY<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>dl_handle<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Load %s library, error: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> filename<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dlerror</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Load %s library, success!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> filename<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> dl_handle<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">vdlsym</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span>handle<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>symbol<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> <span style="color: #990000">(*</span>func<span style="color: #990000">)(</span><span style="color: #009900">double</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/* Yep ... this is only for double */</span></span>
    func <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">dlsym</span></span><span style="color: #990000">(</span>handle<span style="color: #990000">,</span> symbol<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>func<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Load %s symbol, error: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> symbol<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dlerror</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Load %s symbol, success!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> symbol<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> func<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">vdlclose</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span>handle<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">dlclose</span></span><span style="color: #990000">(</span>handle<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Unload error %i: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dlerror</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Unload, success!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> i<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> x<span style="color: #990000">,</span> y<span style="color: #990000">;</span>
    x <span style="color: #990000">=</span> <span style="color: #993399">60.0</span><span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>lib <span style="color: #990000">=</span> <span style="color: #FF0000">"libm.so"</span><span style="color: #990000">;</span>
    <span style="color: #009900">char</span> <span style="color: #990000">*</span>method <span style="color: #990000">=</span> <span style="color: #FF0000">"sin"</span><span style="color: #990000">;</span>
    <span style="color: #009900">void</span> <span style="color: #990000">*</span>dl_handle<span style="color: #990000">;</span>
    <span style="color: #009900">double</span> <span style="color: #990000">(*</span>func<span style="color: #990000">)(</span><span style="color: #009900">double</span><span style="color: #990000">);</span>
    dl_handle <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">vdlopen</span></span><span style="color: #990000">(</span>lib<span style="color: #990000">,</span> RTLD_LAZY<span style="color: #990000">);</span>
    func <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">vdlsym</span></span><span style="color: #990000">(</span>dl_handle<span style="color: #990000">,</span> method<span style="color: #990000">);</span>
    y <span style="color: #990000">=</span> <span style="color: #990000">(*</span>func<span style="color: #990000">)(</span>x <span style="color: #990000">*</span> <span style="color: #993399">3.141592</span> <span style="color: #990000">/</span> <span style="color: #993399">180.0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"angle = %f degree, sin(angle) = %f</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> x<span style="color: #990000">,</span> y<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">vdlclose</span></span><span style="color: #990000">(</span>dl_handle<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile this <code>math-dl.c</code> by not directly linking to <code>libm</code> but to <code>libdl</code>.</p></div>
<div class="listingblock">
<div class="title">Building math-dl and running it.</div>
<div class="content">
<pre><code>$ ./math-dl
Load libm.so library, success!
Load sin symbol, success!
angle = 60.000000 degree, sin(angle) = 0.866025
Unload, success!</code></pre>
</div></div>
<div class="paragraph"><p>The <code>-rdynamic</code> option is used to add all symbols to the dynamic symbol table
to permit backtraces with the use of dlopen.  The <code>-ldl</code> option is for the
<code>libdl.so</code> library.  You do not need the <code>-lm</code> option here but need <code>libm.so</code>
library installed in the system.</p></div>
</div>
<div class="sect2">
<h3 id="_libpthread">libpthread</h3>
<div class="paragraph"><p>The <a href="http://en.wikipedia.org/wiki/Thread_(computing)">thread</a> can efficiently implement parallelism for shared memory multiprocessor architectures, such as SMPs.  The thread creation does not copy ever resources like the <a href="http://en.wikipedia.org/wiki/Fork-exec">fork-exec</a> multiprocessing mechanism of the UNIX-like system.  <a href="http://en.wikipedia.org/wiki/POSIX_Threads">POSIX thread</a> is supported by the modern GNU/Linux (with [Linux kernel 2.6 or newer]) with the <code>libpthread</code> library.  Here are some references and tutorials.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://computing.llnl.gov/tutorials/parallel_comp/">Introduction to Parallel Computing</a>
</p>
</li>
<li>
<p>
<a href="https://computing.llnl.gov/tutorials/pthreads/">POSIX Threads Programming</a>
</p>
</li>
<li>
<p>
<a href="http://www.gentoo.org/doc/en/articles/l-posix1.xml">POSIX threads explained</a> (updated, based on <a href="http://www.ibm.com/developerworks/library/l-posix1/">IBM developerWorks: POSIX threads explained</a>.)
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">We should focus on reading tutorials which are written after the <a href="http://en.wikipedia.org/wiki/Native_POSIX_Thread_Library">native POSIX thread library (NPTL)</a> support.  This means tutorial should be newer than 2006.</td>
</tr></table>
</div>
<div class="paragraph"><p>The actual execution speed of a program on the modern CPU can be affected by many issues other than the utilization of CPU cores:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Out-of-order_execution">Out-of-order execution</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Instruction-level_parallelism">Instruction-level parallelism</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Instruction_pipeline">Instruction pipeline</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/CPU_cache">CPU cache</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Cache_coherence">Cache coherence</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Amdahl's_law">Amdahl&#8217;s law</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>I am no expert to tell how all these fit together.  But seeing is believing. Let&#8217;s use a touched-up C programs to list prime numbers based on <code>while</code>-loop style in <a href="#_c_with_the_list_variants">C with the list (variants)</a> to to experiment with the POSIX thread programing.  This algorithm has some sequential nature.  So the task of partitioning the program into parallel and mostly independent code is non-trivial.  The observed execution time figures are significantly different.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>prime5.c</code>: fast
</p>
<div class="ulist"><ul>
<li>
<p>
single-threaded program, a uninterrupted tight code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>prime6.c</code>: slow
</p>
<div class="ulist"><ul>
<li>
<p>
multi-threaded program, a thread started for each integer.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>prime7.c</code>: very slow
</p>
<div class="ulist"><ul>
<li>
<p>
multi-threaded program, fixed number of threads are started and controlled via <a href="http://en.wikipedia.org/wiki/Semaphore_(programming)">semaphore</a>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>prime8.c</code>: very fast
</p>
<div class="ulist"><ul>
<li>
<p>
multi-threaded program, fixed number of threads are started only for the time consuming large number portion while each thread is written as a uninterrupted tight code.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Here is a benchmark results of execution times for these programs listed below.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 7. Speed benchmark of various program languages</caption>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<thead>
<tr>
<th align="left" valign="top">Program</th>
<th align="left" valign="top"> real(2^20) </th>
<th align="left" valign="top"> user(2^20) </th>
<th align="left" valign="top"> sys(2^20) </th>
<th align="left" valign="top"> real(2^24) </th>
<th align="left" valign="top"> user(2^24) </th>
<th align="left" valign="top"> sys(2^24)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>prime5.c</code></p></td>
<td align="left" valign="top"><p class="table">0.13</p></td>
<td align="left" valign="top"><p class="table">0.13</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">4.94</p></td>
<td align="left" valign="top"><p class="table">4.94</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>prime6.c</code></p></td>
<td align="left" valign="top"><p class="table">0.21</p></td>
<td align="left" valign="top"><p class="table">0.08</p></td>
<td align="left" valign="top"><p class="table">0.44</p></td>
<td align="left" valign="top"><p class="table">3.44</p></td>
<td align="left" valign="top"><p class="table">1.46</p></td>
<td align="left" valign="top"><p class="table">7.05</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>prime7.c</code></p></td>
<td align="left" valign="top"><p class="table">0.09</p></td>
<td align="left" valign="top"><p class="table">0.04</p></td>
<td align="left" valign="top"><p class="table">0.24</p></td>
<td align="left" valign="top"><p class="table">1.51</p></td>
<td align="left" valign="top"><p class="table">0.90</p></td>
<td align="left" valign="top"><p class="table">3.56</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>prime8.c</code></p></td>
<td align="left" valign="top"><p class="table">0.04</p></td>
<td align="left" valign="top"><p class="table">0.14</p></td>
<td align="left" valign="top"><p class="table">0.00</p></td>
<td align="left" valign="top"><p class="table">1.62</p></td>
<td align="left" valign="top"><p class="table">5.30</p></td>
<td align="left" valign="top"><p class="table">0.04</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Here, the time reported by the <code>/usr/bin/time -p</code> command is in POSIX standard 1003.2 style:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>real</code>: Elapsed real (wall clock) time used by the process, in seconds.
</p>
</li>
<li>
<p>
<code>user</code>: Total number of CPU-seconds that the process used directly (in user mode), in seconds.
</p>
</li>
<li>
<p>
<code>sys</code>: Total number of CPU-seconds used by the system on behalf of the process (in kernel mode), in seconds.
</p>
</li>
</ul></div>
<div class="paragraph"><p>It seems that the <code>user</code> time and the <code>sys</code> time add up all multi-threaded time figures so they may end up in larger figure than the <code>real</code> time figure for multi-threaded programs.  There are a similar <code>sar</code> command offered by the <code>sysstat</code> and <code>atsar</code> packages which has more functionalities.  But if you are looking for more insight for the time, you should consider using the <code>perf</code> command. See <a href="#_perf">Debug: level 2; perf</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Unless properly used, the use of the thread mechanism does not guarantee the faster code.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_code_prime5_c_code_single_threaded_program_a_uninterrupted_tight_code"><code>prime5.c</code>: single-threaded program, a uninterrupted tight code.</h4>
<div class="listingblock">
<div class="title">Source code for the C program: prime5.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
    p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
    tail <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>n <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        n<span style="color: #990000">++;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            q<span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
            tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">);</span>
            p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the C program: <code>prime5.c</code></div>
<div class="content">
<pre><code>real 0.13
user 0.13
sys 0.00
$ /usr/bin/time -p ./prime5 "$(echo 2^24 | bc)"&gt;/dev/null
real 4.94
user 4.94
sys 0.00</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_code_prime6_c_code_multi_threaded_program_a_thread_started_for_each_integer"><code>prime6.c</code>: multi-threaded program, a thread started for each integer.</h4>
<div class="listingblock">
<div class="title">Source code for the Vala program: prime6.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;semaphore.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;pthread.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TMAX <span style="color: #993399">64L</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">pthread_t</span>           th<span style="color: #990000">;</span>
    <span style="color: #009900">int</span>                 flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> thdata<span style="color: #990000">;</span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="color: #008080">thdata</span>       thd<span style="color: #990000">[</span>TMAX<span style="color: #990000">];</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
    p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">,</span> m<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="font-style: italic"><span style="color: #9A1900">/* thdata = calloc(TMAX, sizeof(thdata)); */</span></span>
    head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
    tail <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* last number checking for prime */</span></span>
    m <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* last number checked  for prime */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>m <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">-</span> m <span style="color: #990000">&lt;</span> TMAX<span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&lt;=</span> m <span style="color: #990000">*</span> m<span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            n <span style="color: #990000">=</span> n <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* start checkprime(n) */</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_create</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>n<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>th<span style="color: #990000">,</span>
                        NULL<span style="color: #990000">,</span>
                        <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> checkprime<span style="color: #990000">,</span>
                        <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> n<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error creating thread at %li</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> n<span style="color: #990000">);</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">-</span> m <span style="color: #990000">&gt;=</span> TMAX<span style="color: #990000">)</span> <span style="color: #990000">||</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&gt;</span> m <span style="color: #990000">*</span> m<span style="color: #990000">)</span> <span style="color: #990000">||</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&gt;</span> n_max<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            m<span style="color: #990000">++;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* close checkprime(m) */</span></span>
            <span style="font-weight: bold"><span style="color: #000000">pthread_join</span></span><span style="color: #990000">(</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>th<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>flag<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>flag<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-style: italic"><span style="color: #9A1900">/* if prime, update list with m */</span></span>
                q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
                    tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                    tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> m<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* free(p); */</span></span>
            p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the C program: <code>prime6.c</code></div>
<div class="content">
<pre><code>real 0.21
user 0.08
sys 0.44
$ /usr/bin/time -p ./prime6 "$(echo 2^20 | bc)"&gt;/dev/null
real 3.44
user 1.46
sys 7.05</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_code_prime7_c_code_multi_threaded_program_fixed_number_of_threads_are_started_and_controlled_via_a_href_http_en_wikipedia_org_wiki_semaphore__programming_semaphore_a"><code>prime7.c</code>: multi-threaded program, fixed number of threads are started and controlled via <a href="http://en.wikipedia.org/wiki/Semaphore_(programming)">semaphore</a>.</h4>
<div class="listingblock">
<div class="title">Source code for the Vala program: prime7.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;semaphore.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;pthread.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TMAX <span style="color: #993399">64L</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">pthread_t</span>           th<span style="color: #990000">;</span>
    <span style="color: #009900">long</span>                n<span style="color: #990000">;</span>
    <span style="color: #009900">int</span>                 flag<span style="color: #990000">;</span>
    <span style="color: #008080">sem_t</span>               read_ready<span style="color: #990000">;</span>
    <span style="color: #008080">sem_t</span>               read_done<span style="color: #990000">;</span>
    <span style="color: #008080">sem_t</span>               write_ready<span style="color: #990000">;</span>
    <span style="color: #008080">sem_t</span>               write_done<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> thdata<span style="color: #990000">;</span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="color: #008080">thdata</span>       thd<span style="color: #990000">[</span>TMAX<span style="color: #990000">];</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
    p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">subthread</span></span><span style="color: #990000">(</span><span style="color: #008080">thdata</span> <span style="color: #990000">*</span>thd<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_post</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">-&gt;</span>read_ready<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_wait</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">-&gt;</span>read_done<span style="color: #990000">));</span>
        thd<span style="color: #990000">-&gt;</span>flag <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>thd<span style="color: #990000">-&gt;</span>n<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_post</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">-&gt;</span>write_ready<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_wait</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">-&gt;</span>write_done<span style="color: #990000">));</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">,</span> m<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
    tail <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span>i<span style="color: #990000">&lt;</span>TMAX<span style="color: #990000">;</span>i<span style="color: #990000">++)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_init</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>read_ready<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_init</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>read_done<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_init</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>write_ready<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">sem_init</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>write_done<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_create</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">,</span>
                NULL<span style="color: #990000">,</span>
                <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> subthread<span style="color: #990000">,</span>
                <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">])</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error creating thread at %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* last number started   checking of prime*/</span></span>
    m <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* last number completed checking of prime */</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>m <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">-</span> m <span style="color: #990000">&lt;</span> TMAX<span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&lt;=</span> m <span style="color: #990000">*</span> m<span style="color: #990000">)</span> <span style="color: #990000">&amp;&amp;</span> <span style="color: #990000">(</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            n <span style="color: #990000">=</span> n <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* start checkprime(n) */</span></span>
            <span style="font-weight: bold"><span style="color: #000000">sem_wait</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">[</span>n<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>read_ready<span style="color: #990000">));</span>
            thd<span style="color: #990000">[</span>n<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>n <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #000000">sem_post</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">[</span>n<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>read_done<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">((</span>n <span style="color: #990000">+</span> <span style="color: #993399">1</span> <span style="color: #990000">-</span> m <span style="color: #990000">&gt;=</span> TMAX<span style="color: #990000">)</span> <span style="color: #990000">||</span> <span style="color: #990000">(</span>n <span style="color: #990000">&gt;=</span> m <span style="color: #990000">*</span> m<span style="color: #990000">)</span> <span style="color: #990000">||</span> <span style="color: #990000">(</span>n <span style="color: #990000">&gt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            m<span style="color: #990000">++;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* close checkprime(m) */</span></span>
            <span style="font-weight: bold"><span style="color: #000000">sem_wait</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>write_ready<span style="color: #990000">));</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>flag<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-style: italic"><span style="color: #9A1900">/* if prime, update list with m */</span></span>
                q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
                    tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                    tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> m<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            <span style="font-weight: bold"><span style="color: #000000">sem_post</span></span><span style="color: #990000">(&amp;(</span>thd<span style="color: #990000">[</span>m<span style="color: #990000">%</span>TMAX<span style="color: #990000">].</span>write_done<span style="color: #990000">));</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span>i<span style="color: #990000">&lt;</span>TMAX<span style="color: #990000">;</span>i<span style="color: #990000">++)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_cancel</span></span><span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error canseling thread at %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>

    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
            <span style="font-style: italic"><span style="color: #9A1900">/* free(p); */</span></span>
            p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the C program: <code>prime7.c</code></div>
<div class="content">
<pre><code>real 0.09
user 0.04
sys 0.24
$ /usr/bin/time -p ./prime7 "$(echo 2^20 | bc)"&gt;/dev/null
real 1.51
user 0.90
sys 3.56</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_code_prime8_c_code_multi_threaded_program_fixed_number_of_threads_are_started_only_for_the_time_consuming_large_number_portion_while_each_thread_is_written_as_a_uninterrupted_tight_code"><code>prime8.c</code>: multi-threaded program, fixed number of threads are started only for the time consuming large number portion while each thread is written as a uninterrupted tight code.</h4>
<div class="listingblock">
<div class="title">Source code for the Vala program: prime8.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;semaphore.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;pthread.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TMAX <span style="color: #993399">64L</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>

<span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">pthread_t</span>           th<span style="color: #990000">;</span>
    <span style="color: #009900">long</span>                n0<span style="color: #990000">;</span>
    <span style="color: #009900">long</span>                n1<span style="color: #990000">;</span>
    <span style="color: #008080">primelist</span>           <span style="color: #990000">*</span>head<span style="color: #990000">;</span>
    <span style="color: #008080">primelist</span>           <span style="color: #990000">*</span>tail<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> thdata<span style="color: #990000">;</span>

<span style="color: #008080">thdata</span>       thd<span style="color: #990000">[</span>TMAX<span style="color: #990000">];</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
    flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
    p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
        n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
        n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
        <span style="color: #FF0000">}</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">subthread</span></span><span style="color: #990000">(</span><span style="color: #008080">thdata</span> <span style="color: #990000">*</span>thd<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">long</span> i<span style="color: #990000">;</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    thd<span style="color: #990000">-&gt;</span>head <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> thd<span style="color: #990000">-&gt;</span>n0<span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> thd<span style="color: #990000">-&gt;</span>n1<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>i<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
            q<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>thd<span style="color: #990000">-&gt;</span>head<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                thd<span style="color: #990000">-&gt;</span>head <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                p<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
                p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            <span style="color: #FF0000">}</span>
            thd<span style="color: #990000">-&gt;</span>tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
    <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">,</span> i<span style="color: #990000">,</span> nd<span style="color: #990000">;</span>
    n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
    tail <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
    tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">((</span>n <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #990000">(</span>n <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        n<span style="color: #990000">++;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            q<span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
            tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
            tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    nd <span style="color: #990000">=</span> <span style="color: #990000">(</span>n_max <span style="color: #990000">-</span> n <span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #990000">(</span><span style="color: #009900">long</span><span style="color: #990000">)</span> TMAX <span style="color: #990000">+</span> <span style="color: #993399">1L</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> TMAX<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* TMAX thread of checkprime loop */</span></span>
        thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n0 <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
        thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">=</span> n <span style="color: #990000">+</span> nd<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">&gt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">=</span> n_max<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        n <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_create</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">,</span>
                NULL<span style="color: #990000">,</span>
                <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> subthread<span style="color: #990000">,</span>
                <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">])</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error creating thread at %li</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> TMAX<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* TMAX thread of checkprime loop */</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_join</span></span><span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error joining thread at %li</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>head<span style="color: #990000">;</span>
        tail <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>tail<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
        p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">);</span>
            p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">Behavior of the C program: <code>prime8.c</code></div>
<div class="content">
<pre><code>real 0.04
user 0.14
sys 0.00
$ /usr/bin/time -p ./prime8 "$(echo 2^24 | bc)"&gt;/dev/null
real 1.62
user 5.30
sys 0.04</code></pre>
</div></div>
<div class="paragraph"><p>Actually, this program is buggy for smaller than 1090.  We will debug this later.</p></div>
<div class="listingblock">
<div class="title">Buggy behavior of the C program for 1090: <code>prime8.c</code></div>
<div class="content">
<pre><code>Segmentation fault
139
$ ./prime8 "1091"&gt;/dev/null; echo $?
0</code></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elf">ELF</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this chapter, I will play with
<a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> files
generated from the same <code>hello.c</code> program file as the one in the
<a href="#_c">Hello World: C</a> with the debug information to learn how it works.</p></div>
<div class="paragraph"><p>See the following for the he <a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
The wikipedia: <a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a>
</p>
</li>
<li>
<p>
The man page <code>elf</code>(5).
</p>
</li>
<li>
<p>
<a href="http://www.iecc.com/linker/">Linkers and Loaders</a> (draft) for their mechanism.
</p>
</li>
<li>
<p>
<a href="http://www.ualberta.ca/CNS/RESEARCH/LinuxClusters/mem.html">Understanding Memory</a> for mechanism of the memory system on Linux.
</p>
</li>
<li>
<p>
<a href="http://www.acsu.buffalo.edu/~charngda/elf.html">Executable and Linkable Format (ELF)</a>
</p>
</li>
<li>
<p>
<a href="http://www.acsu.buffalo.edu/~charngda/bfd.html">GNU Binutils and BFD</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>An ELF file has two views:</p></div>
<div class="ulist"><ul>
<li>
<p>
The section header lists the set of sections of the binary. (<code>readelf -S</code>)
</p>
</li>
<li>
<p>
The program header shows the segments used at run-time. (<code>readelf -l</code>)
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Both <code>readelf</code> and <code>objdump</code> offer similar functions.  The <code>readelf</code>
command exists independently of the BFD library, so if there is a bug in the
BFD <code>objdump</code> command then <code>readelf</code> will not be affected.  Only the <code>objdump</code>
command can do disassemble.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="_compile_hello_gdb">Compile hello-gdb</h3>
<div class="paragraph"><p>Let&#8217;s compile the <code>hello.c</code> program file into the
<a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> executable
<code>hello-gdb</code> with the additional flags.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>-g</code> flag produces debugging information in the operating system&#8217;s native format (<a href="http://en.wikipedia.org/wiki/DWARF">DWARF</a> on GNU/Linux).
</p>
</li>
<li>
<p>
<code>-v</code> flag produces verbose output of the commands executed to run the stages of compilation.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 4.9.2-10' --with-
bugurl=file:///usr/share/doc/gcc-4.9/README.Bugs --enable-languages=c,c++,java,g
o,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.9 --enable-shared --e
nable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-
threads=posix --with-gxx-include-dir=/usr/include/c++/4.9 --libdir=/usr/lib --en
able-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable
-libstdcxx-time=yes --enable-gnu-unique-object --disable-vtable-verify --enable-
plugin --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enabl
e-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64/jre --enable-
java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64 --with-jvm-j
ar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-4.9-amd64 --with-arch-directory=amd64
 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multia
rch --with-arch-32=i586 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enabl
e-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gn
u --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.9.2 (Debian 4.9.2-10)
COLLECT_GCC_OPTIONS='-v' '-Wall' '-g' '-o' 'hello-gdb' '-mtune=generic' '-march=
x86-64'
 /usr/lib/gcc/x86_64-linux-gnu/4.9/cc1 -quiet -v -imultiarch x86_64-linux-gnu he
llo.c -quiet -dumpbase hello.c -mtune=generic -march=x86-64 -auxbase hello -g -W
all -version -o /tmp/ccEXR8HG.s
GNU C (Debian 4.9.2-10) version 4.9.2 (x86_64-linux-gnu)
    compiled by GNU C version 4.9.2, GMP version 6.0.0, MPFR version 3.1.2-p3, M
PC version 1.0.2
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
ignoring nonexistent directory "/usr/lib/gcc/x86_64-linux-gnu/4.9/../../../../x8
6_64-linux-gnu/include"
#include "..." search starts here:
#include &lt;...&gt; search starts here:
 /usr/lib/gcc/x86_64-linux-gnu/4.9/include
 /usr/local/include
 /usr/lib/gcc/x86_64-linux-gnu/4.9/include-fixed
 /usr/include/x86_64-linux-gnu
 /usr/include
End of search list.
GNU C (Debian 4.9.2-10) version 4.9.2 (x86_64-linux-gnu)
    compiled by GNU C version 4.9.2, GMP version 6.0.0, MPFR version 3.1.2-p3, M
PC version 1.0.2
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
Compiler executable checksum: dc5310582b2a0cacbb4cea323963a0c0
COLLECT_GCC_OPTIONS='-v' '-Wall' '-g' '-o' 'hello-gdb' '-mtune=generic' '-march=
x86-64'
 as -v --64 -o /tmp/cc3KqqLL.o /tmp/ccEXR8HG.s
GNU assembler version 2.25 (x86_64-linux-gnu) using BFD version (GNU Binutils fo
r Debian) 2.25
COMPILER_PATH=/usr/lib/gcc/x86_64-linux-gnu/4.9/:/usr/lib/gcc/x86_64-linux-gnu/4
.9/:/usr/lib/gcc/x86_64-linux-gnu/:/usr/lib/gcc/x86_64-linux-gnu/4.9/:/usr/lib/g
cc/x86_64-linux-gnu/
LIBRARY_PATH=/usr/lib/gcc/x86_64-linux-gnu/4.9/:/usr/lib/gcc/x86_64-linux-gnu/4.
9/../../../x86_64-linux-gnu/:/usr/lib/gcc/x86_64-linux-gnu/4.9/../../../../lib/:
/lib/x86_64-linux-gnu/:/lib/../lib/:/usr/lib/x86_64-linux-gnu/:/usr/lib/../lib/:
/usr/lib/gcc/x86_64-linux-gnu/4.9/../../../:/lib/:/usr/lib/
COLLECT_GCC_OPTIONS='-v' '-Wall' '-g' '-o' 'hello-gdb' '-mtune=generic' '-march=
x86-64'
 /usr/lib/gcc/x86_64-linux-gnu/4.9/collect2 -plugin /usr/lib/gcc/x86_64-linux-gn
u/4.9/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper
 -plugin-opt=-fresolution=/tmp/cc04NkPQ.res -plugin-opt=-pass-through=-lgcc -plu
gin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-th
rough=-lgcc -plugin-opt=-pass-through=-lgcc_s --sysroot=/ --build-id --eh-frame-
hdr -m elf_x86_64 --hash-style=gnu -dynamic-linker /lib64/ld-linux-x86-64.so.2 -
o hello-gdb /usr/lib/gcc/x86_64-linux-gnu/4.9/../../../x86_64-linux-gnu/crt1.o /
usr/lib/gcc/x86_64-linux-gnu/4.9/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x
86_64-linux-gnu/4.9/crtbegin.o -L/usr/lib/gcc/x86_64-linux-gnu/4.9 -L/usr/lib/gc
c/x86_64-linux-gnu/4.9/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu
/4.9/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-lin
ux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/4.9/../../.. /tmp/cc3Kq
qLL.o -lgcc --as-needed -lgcc_s --no-as-needed -lc -lgcc --as-needed -lgcc_s --n
o-as-needed /usr/lib/gcc/x86_64-linux-gnu/4.9/crtend.o /usr/lib/gcc/x86_64-linux
-gnu/4.9/../../../x86_64-linux-gnu/crtn.o</code></pre>
</div></div>
<div class="paragraph"><p>Here the <code>gcc</code> command steps through 3 stages of compilation with 3 sub-commands:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>/usr/lib/gcc/x86_64-linux-gnu/4.7/cc1</code> which is roughly the <code>gcc -S</code> command (Compiler from the C code to the assembler code).
</p>
</li>
<li>
<p>
<code>as</code> which is the assembler. (The <code>gcc -c</code> stops after this.)
</p>
</li>
<li>
<p>
<code>/usr/lib/gcc/x86_64-linux-gnu/4.7/collect2</code> which is roughly equivalent of the good old <code>ld</code> (linker).
</p>
</li>
</ul></div>
<div class="paragraph"><p>FYI:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/path/to/c/../../bin/p: 1: eval: /usr/lib/gcc/x86_64-linux-gnu/4.7/cc1: not foun
d
$ /usr/lib/gcc/x86_64-linux-gnu/4.7/cc1 --help=C
/path/to/c/../../bin/p: 1: eval: /usr/lib/gcc/x86_64-linux-gnu/4.7/cc1: not foun
d
   ... (snip)
$ /usr/lib/gcc/x86_64-linux-gnu/4.7/collect2 --help
/path/to/c/../../bin/p: 1: eval: /usr/lib/gcc/x86_64-linux-gnu/4.7/collect2: not
 found
   ... (snip)</code></pre>
</div></div>
<div class="paragraph"><p>In order to understand how linker works to create an executable from an object file, let me make the <code>hello.o</code> and <code>hello-gdb.o</code> ELF object files with the <code>gcc -c</code> command.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ gcc -Wall -g -o hello-gdb.o -c hello.c</code></pre>
</div></div>
<div class="paragraph"><p>So including the <code>hello</code> file generated in <a href="#_c">Hello World!: C</a>, we have 4 ELF files to play with.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 8. Summary of options and generated files from <code>hello.c</code>.</caption>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
<thead>
<tr>
<th colspan="2" align="left" valign="top"> object file </th>
<th colspan="2" align="left" valign="top"> executable file</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>option</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>file</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>option</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>file</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-c</code></p></td>
<td align="left" valign="top"><p class="table"><code>hello.o</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"><code>hello</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-c -g</code></p></td>
<td align="left" valign="top"><p class="table"><code>hello-gdb.o</code></p></td>
<td align="left" valign="top"><p class="table"><code>-g</code></p></td>
<td align="left" valign="top"><p class="table"><code>hello-gdb</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_size">size</h3>
<div class="paragraph"><p>Here is the size of the ELF files.</p></div>
<div class="listingblock">
<div class="title">Size of the ELF file generated from <code>hello.c</code>.</div>
<div class="content">
<pre><code>-rwxrwxr-x 1 osamu osamu 6696 Aug 20 23:23 hello
-rwxrwxr-x 1 osamu osamu 7728 Aug 20 23:23 hello-gdb
-rw-rw-r-- 1 osamu osamu 3304 Aug 20 23:23 hello-gdb.o
-rw-rw-r-- 1 osamu osamu 1488 Aug 20 23:23 hello.o
$ size  hello.o hello hello-gdb.o hello-gdb
   text       data        bss        dec        hex    filename
     91          0          0         91         5b    hello.o
   1216        560          8       1784        6f8    hello
     91          0          0         91         5b    hello-gdb.o
   1216        560          8       1784        6f8    hello-gdb</code></pre>
</div></div>
<div class="paragraph"><p>The GNU <code>size</code> command lists the section sizes&#8201;&#8212;&#8201;and the total size&#8201;&#8212;&#8201;for each of the object or archive files in its argument list.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <code>text</code> column is the size of the executable instructions of a program in the decimal expression.
</p>
</li>
<li>
<p>
The <code>data</code> column is the size of the initialized data that contribute to the program&#8217;s memory image in the decimal expression.
</p>
</li>
<li>
<p>
The <code>bss</code> column is the size of the uninitialized data that contributes to the program&#8217;s memory image in the decimal expression.
</p>
</li>
<li>
<p>
The <code>dec</code> column is the total size of the <code>text</code>, <code>data</code>, and <code>bss</code> sections in the decimal expression.
</p>
</li>
<li>
<p>
The <code>hex</code> column is the total size of the <code>text</code>, <code>data</code>, and <code>bss</code> sections in the hexadecimal expression.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Since the difference between <code>hello</code> and <code>hello-gdb</code> is the debug information, they share the same values with <code>size</code>(1) but their file size is different with <code>ls</code>(1).</p></div>
<div class="paragraph"><p>The <code>text</code> column of <code>hello-gdb</code> is much larger than that of <code>hello-gdb.o</code> since the linker seems to link few additional object files such as <code>crt1.o</code>, <code>crti.o</code>, etc.</p></div>
<div class="paragraph"><p>These will be elucidated from the following results.</p></div>
</div>
<div class="sect2">
<h3 id="_readelf_file_header">readelf --file-header</h3>
<div class="paragraph"><p>Here are the ELF file header of the <code>hello</code> file.</p></div>
<div class="listingblock">
<div class="title">ELF file Header of the <code>hello</code> file.</div>
<div class="content">
<pre><code>ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              REL (Relocatable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          0 (bytes into file)
  Start of section headers:          656 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           0 (bytes)
  Number of program headers:         0
  Size of section headers:           64 (bytes)
  Number of section headers:         13
  Section header string table index: 10</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content"><code>-h</code> = <code>--file-header</code></td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compare the ELF file headers of the compiled <code>hello.c</code>.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 9. ELF file headers of the compiled <code>hello.c</code></caption>
<col width="33%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="left" valign="top">Item </th>
<th align="left" valign="top"><code>hello.o</code> </th>
<th align="left" valign="top"><code>hello-gdb.o</code> </th>
<th align="left" valign="top"><code>hello</code> </th>
<th align="left" valign="top"><code>hello-gdb</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Magic</p></td>
<td colspan="4" align="left" valign="top"><p class="table">7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Class</p></td>
<td colspan="4" align="left" valign="top"><p class="table">ELF64</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Data</p></td>
<td colspan="4" align="left" valign="top"><p class="table">2&#8217;s complement, little endian</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Version (EI_VERSION)</p></td>
<td colspan="4" align="left" valign="top"><p class="table">1 (current)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">OS/ABI</p></td>
<td colspan="4" align="left" valign="top"><p class="table">UNIX - System V</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ABI Version</p></td>
<td colspan="4" align="left" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Type</p></td>
<td colspan="2" align="left" valign="top"><p class="table">REL (Relocatable file)</p></td>
<td colspan="2" align="left" valign="top"><p class="table">EXEC (Executable file)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Machine</p></td>
<td colspan="4" align="left" valign="top"><p class="table">Advanced Micro Devices X86-64</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Version (e_version)</p></td>
<td align="left" valign="top"><p class="table">0x1</p></td>
<td align="left" valign="top"><p class="table">0x1</p></td>
<td align="left" valign="top"><p class="table">0x1</p></td>
<td align="left" valign="top"><p class="table">0x1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Entry point address</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
<td align="left" valign="top"><p class="table">0x400410</p></td>
<td align="left" valign="top"><p class="table">0x400410</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Start of program headers (bytes into file)</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Start of section headers (bytes into file)</p></td>
<td align="left" valign="top"><p class="table">656</p></td>
<td align="left" valign="top"><p class="table">1960</p></td>
<td align="left" valign="top"><p class="table">4776</p></td>
<td align="left" valign="top"><p class="table">5488</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Flags</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
<td align="left" valign="top"><p class="table">0x0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Size of this header (bytes)</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Size of program headers (bytes)</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">56</p></td>
<td align="left" valign="top"><p class="table">56</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of program headers</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Size of section headers (bytes)</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of section headers</p></td>
<td align="left" valign="top"><p class="table">13</p></td>
<td align="left" valign="top"><p class="table">21</p></td>
<td align="left" valign="top"><p class="table">30</p></td>
<td align="left" valign="top"><p class="table">35</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Section header string table index</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
<td align="left" valign="top"><p class="table">18</p></td>
<td align="left" valign="top"><p class="table">27</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_readelf_sections">readelf --sections</h3>
<div class="paragraph"><p>The section header lists the set of sections of the binary.</p></div>
<div class="paragraph"><p>Here are the sections in these ELF files.</p></div>
<div class="listingblock">
<div class="title">Sections of the <code>hello-gdb</code> file.</div>
<div class="content">
<pre><code>There are 35 section headers, starting at offset 0x1570:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .interp           PROGBITS         0000000000400200  00000200
       000000000000001c  0000000000000000   A       0     0     1
  [ 2] .note.ABI-tag     NOTE             000000000040021c  0000021c
       0000000000000020  0000000000000000   A       0     0     4
  [ 3] .note.gnu.build-i NOTE             000000000040023c  0000023c
       0000000000000024  0000000000000000   A       0     0     4
  [ 4] .gnu.hash         GNU_HASH         0000000000400260  00000260
       000000000000001c  0000000000000000   A       5     0     8
  [ 5] .dynsym           DYNSYM           0000000000400280  00000280
       0000000000000060  0000000000000018   A       6     1     8
  [ 6] .dynstr           STRTAB           00000000004002e0  000002e0
       000000000000003d  0000000000000000   A       0     0     1
  [ 7] .gnu.version      VERSYM           000000000040031e  0000031e
       0000000000000008  0000000000000002   A       5     0     2
  [ 8] .gnu.version_r    VERNEED          0000000000400328  00000328
       0000000000000020  0000000000000000   A       6     1     8
  [ 9] .rela.dyn         RELA             0000000000400348  00000348
       0000000000000018  0000000000000018   A       5     0     8
  [10] .rela.plt         RELA             0000000000400360  00000360
       0000000000000048  0000000000000018  AI       5    12     8
  [11] .init             PROGBITS         00000000004003a8  000003a8
       000000000000001a  0000000000000000  AX       0     0     4
  [12] .plt              PROGBITS         00000000004003d0  000003d0
       0000000000000040  0000000000000010  AX       0     0     16
  [13] .text             PROGBITS         0000000000400410  00000410
       0000000000000182  0000000000000000  AX       0     0     16
  [14] .fini             PROGBITS         0000000000400594  00000594
       0000000000000009  0000000000000000  AX       0     0     4
  [15] .rodata           PROGBITS         00000000004005a0  000005a0
       0000000000000012  0000000000000000   A       0     0     4
  [16] .eh_frame_hdr     PROGBITS         00000000004005b4  000005b4
       0000000000000034  0000000000000000   A       0     0     4
  [17] .eh_frame         PROGBITS         00000000004005e8  000005e8
       00000000000000f4  0000000000000000   A       0     0     8
  [18] .init_array       INIT_ARRAY       00000000006006e0  000006e0
       0000000000000008  0000000000000000  WA       0     0     8
  [19] .fini_array       FINI_ARRAY       00000000006006e8  000006e8
       0000000000000008  0000000000000000  WA       0     0     8
  [20] .jcr              PROGBITS         00000000006006f0  000006f0
       0000000000000008  0000000000000000  WA       0     0     8
  [21] .dynamic          DYNAMIC          00000000006006f8  000006f8
       00000000000001d0  0000000000000010  WA       6     0     8
  [22] .got              PROGBITS         00000000006008c8  000008c8
       0000000000000008  0000000000000008  WA       0     0     8
  [23] .got.plt          PROGBITS         00000000006008d0  000008d0
       0000000000000030  0000000000000008  WA       0     0     8
  [24] .data             PROGBITS         0000000000600900  00000900
       0000000000000010  0000000000000000  WA       0     0     8
  [25] .bss              NOBITS           0000000000600910  00000910
       0000000000000008  0000000000000000  WA       0     0     1
  [26] .comment          PROGBITS         0000000000000000  00000910
       0000000000000039  0000000000000001  MS       0     0     1
  [27] .debug_aranges    PROGBITS         0000000000000000  00000949
       0000000000000030  0000000000000000           0     0     1
  [28] .debug_info       PROGBITS         0000000000000000  00000979
       000000000000009f  0000000000000000           0     0     1
  [29] .debug_abbrev     PROGBITS         0000000000000000  00000a18
       0000000000000042  0000000000000000           0     0     1
  [30] .debug_line       PROGBITS         0000000000000000  00000a5a
       000000000000003c  0000000000000000           0     0     1
  [31] .debug_str        PROGBITS         0000000000000000  00000a96
       00000000000000c3  0000000000000001  MS       0     0     1
  [32] .shstrtab         STRTAB           0000000000000000  00000b59
       0000000000000148  0000000000000000           0     0     1
  [33] .symtab           SYMTAB           0000000000000000  00000ca8
       0000000000000690  0000000000000018          34    50     8
  [34] .strtab           STRTAB           0000000000000000  00001338
       0000000000000237  0000000000000000           0     0     1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content"><code>-S</code> = <code>--sections</code> = <code>--section-headers</code></td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compare the ELF file sections of the compiled <code>hello.c</code>.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 10. ELF file sections of the compiled <code>hello.c</code></caption>
<col width="18%" />
<col width="18%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<thead>
<tr>
<th align="left" valign="top">section </th>
<th align="left" valign="top">type </th>
<th align="left" valign="top"><code>hello.o</code> </th>
<th align="left" valign="top"> <code>hello-gdb.o</code> </th>
<th align="left" valign="top"><code>hello</code> </th>
<th align="left" valign="top"> <code>hello-gdb</code> </th>
<th align="left" valign="top"> <code>size</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">NULL</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.interp</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x1c</p></td>
<td align="left" valign="top"><p class="table">0x1c</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.note.ABI-tag</p></td>
<td align="left" valign="top"><p class="table">NOTE</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x20</p></td>
<td align="left" valign="top"><p class="table">0x20</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.note.gnu.build-i</p></td>
<td align="left" valign="top"><p class="table">NOTE</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x24</p></td>
<td align="left" valign="top"><p class="table">0x24</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.dynsym</p></td>
<td align="left" valign="top"><p class="table">DYNSYM</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x60</p></td>
<td align="left" valign="top"><p class="table">0x60</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.dynstr</p></td>
<td align="left" valign="top"><p class="table">STRTAB</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x3d</p></td>
<td align="left" valign="top"><p class="table">0x3d</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.gnu.hash</p></td>
<td align="left" valign="top"><p class="table">GNU_HASH</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x1c</p></td>
<td align="left" valign="top"><p class="table">0x1c</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.gnu.version</p></td>
<td align="left" valign="top"><p class="table">VERSYM</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.gnu.version_r</p></td>
<td align="left" valign="top"><p class="table">VERNEED</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x20</p></td>
<td align="left" valign="top"><p class="table">0x20</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.rela.dyn</p></td>
<td align="left" valign="top"><p class="table">RELA</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x18</p></td>
<td align="left" valign="top"><p class="table">0x18</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.rela.plt</p></td>
<td align="left" valign="top"><p class="table">RELA</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x48</p></td>
<td align="left" valign="top"><p class="table">0x48</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.init</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x1a</p></td>
<td align="left" valign="top"><p class="table">0x1a</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.plt</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x40</p></td>
<td align="left" valign="top"><p class="table">0x40</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.text</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">0x15</p></td>
<td align="left" valign="top"><p class="table">0x15</p></td>
<td align="left" valign="top"><p class="table">0x182</p></td>
<td align="left" valign="top"><p class="table">0x182</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.fini</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x9</p></td>
<td align="left" valign="top"><p class="table">0x9</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.rodata</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">0xe</p></td>
<td align="left" valign="top"><p class="table">0xe</p></td>
<td align="left" valign="top"><p class="table">0x12</p></td>
<td align="left" valign="top"><p class="table">0x12</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.eh_frame</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">0x38</p></td>
<td align="left" valign="top"><p class="table">0x38</p></td>
<td align="left" valign="top"><p class="table">0xf4</p></td>
<td align="left" valign="top"><p class="table">0xf4</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.eh_frame_hdr</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x34</p></td>
<td align="left" valign="top"><p class="table">0x34</p></td>
<td align="left" valign="top"><p class="table">text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.dynamic</p></td>
<td align="left" valign="top"><p class="table">DYNAMIC</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x1d0</p></td>
<td align="left" valign="top"><p class="table">0x1d0</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.got</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.got.plt</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x30</p></td>
<td align="left" valign="top"><p class="table">0x30</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.data</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0x10</p></td>
<td align="left" valign="top"><p class="table">0x10</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.jcr</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.fini_array</p></td>
<td align="left" valign="top"><p class="table">FINI_ARRAY</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.init_array</p></td>
<td align="left" valign="top"><p class="table">INIT_ARRAY</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.bss</p></td>
<td align="left" valign="top"><p class="table">NOBITS</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">0x8</p></td>
<td align="left" valign="top"><p class="table">bss</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.comment</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">0x1e</p></td>
<td align="left" valign="top"><p class="table">0x1e</p></td>
<td align="left" valign="top"><p class="table">0x39</p></td>
<td align="left" valign="top"><p class="table">0x39</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.debug_info</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x9f</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x9f</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.debug_abbrev</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x42</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x42</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.debug_aranges</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x30</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x30</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.debug_line</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x3c</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0x3c</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.debug_str</p></td>
<td align="left" valign="top"><p class="table">PROGBITS</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0xfc</p></td>
<td align="left" valign="top"><p class="table">N/A</p></td>
<td align="left" valign="top"><p class="table">0xc3</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.symtab</p></td>
<td align="left" valign="top"><p class="table">SYMTAB</p></td>
<td align="left" valign="top"><p class="table">0x108</p></td>
<td align="left" valign="top"><p class="table">0x180</p></td>
<td align="left" valign="top"><p class="table">0x618</p></td>
<td align="left" valign="top"><p class="table">0x690</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.strtab</p></td>
<td align="left" valign="top"><p class="table">STRTAB</p></td>
<td align="left" valign="top"><p class="table">0x13</p></td>
<td align="left" valign="top"><p class="table">0x13</p></td>
<td align="left" valign="top"><p class="table">0x237</p></td>
<td align="left" valign="top"><p class="table">0x237</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">.shstrtab</p></td>
<td align="left" valign="top"><p class="table">STRTAB</p></td>
<td align="left" valign="top"><p class="table">0x61</p></td>
<td align="left" valign="top"><p class="table">0xb0</p></td>
<td align="left" valign="top"><p class="table">0x108</p></td>
<td align="left" valign="top"><p class="table">0x148</p></td>
<td align="left" valign="top"><p class="table">???</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Here, N/A stands for "not available".</p></div>
<div class="paragraph"><p>Let&#8217;s compaire the <code>.text</code> size reported by <code>size</code> and <code>readelf -S</code>.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 11. Comparison of the reported size.</caption>
<col width="14%" />
<col width="28%" />
<col width="57%" />
<thead>
<tr>
<th align="left" valign="top"> <strong>file</strong>    </th>
<th align="left" valign="top"> <strong>size</strong>                </th>
<th align="left" valign="top"> <strong>readelf</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>hello.o</code></p></td>
<td align="left" valign="top"><p class="table"><strong>text</strong> = 91 = 0x5b</p></td>
<td align="left" valign="top"><p class="table"><strong>.text</strong> + <strong>.rodata</strong> + <strong>.eh_frame</strong> = 0x5b</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>hello</code></p></td>
<td align="left" valign="top"><p class="table"><strong>text</strong> = 1350 = 0x546</p></td>
<td align="left" valign="top"><p class="table">all marked <code>text</code> in <code>size</code> column = 0x53b = 1339 (11 bytes mismatch)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>hello</code></p></td>
<td align="left" valign="top"><p class="table"><strong>data</strong> = 568 = 0x238</p></td>
<td align="left" valign="top"><p class="table"><strong>.dynamic</strong> + <strong>.got</strong> + <strong>.got.plt</strong> + <strong>.data</strong> + <strong>.jcr</strong> + <strong>.fini_array</strong> + <strong>.init.array</strong> = 0x238</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>hello</code></p></td>
<td align="left" valign="top"><p class="table"><strong>bss</strong>  = 4   = 0x4</p></td>
<td align="left" valign="top"><p class="table"><strong>.bss</strong>  = 0x4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>FIXME: Why different?</p></div>
<div class="paragraph"><p>Here you see some additional sections marked as <code>.debug_*</code> exist since you compiled the <code>hello-gdb.o</code> and <code>hello-gdb</code> files with the <code>-g</code> option.  The <code>hello.o</code> and <code>hello</code> files do not have these debug sections.</p></div>
<div class="paragraph"><p>Various sections are described in the man page <code>elf</code>(5) after "Various sections hold program and control information:".</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <code>objdump -h</code> outputs very similar results.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_readelf_segments">readelf --segments</h3>
<div class="paragraph"><p>The program header shows the segments used at run-time.  So this is only available for the ELF executable files.</p></div>
<div class="paragraph"><p>Here are the program headers (=segments) in these ELF files.</p></div>
<div class="listingblock">
<div class="title">Program headers of the <code>hello</code> file.</div>
<div class="content">
<pre><code>Elf file type is EXEC (Executable file)
Entry point 0x400410
There are 8 program headers, starting at offset 64

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040
                 0x00000000000001c0 0x00000000000001c0  R E    8
  INTERP         0x0000000000000200 0x0000000000400200 0x0000000000400200
                 0x000000000000001c 0x000000000000001c  R      1
      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000
                 0x00000000000006dc 0x00000000000006dc  R E    200000
  LOAD           0x00000000000006e0 0x00000000006006e0 0x00000000006006e0
                 0x0000000000000230 0x0000000000000238  RW     200000
  DYNAMIC        0x00000000000006f8 0x00000000006006f8 0x00000000006006f8
                 0x00000000000001d0 0x00000000000001d0  RW     8
  NOTE           0x000000000000021c 0x000000000040021c 0x000000000040021c
                 0x0000000000000044 0x0000000000000044  R      4
  GNU_EH_FRAME   0x00000000000005b4 0x00000000004005b4 0x00000000004005b4
                 0x0000000000000034 0x0000000000000034  R      4
  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x0000000000000000 0x0000000000000000  RW     10

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gn
u.version .gnu.version_r .rela.dyn .rela.plt .init .plt .text .fini .rodata .eh_
frame_hdr .eh_frame
   03     .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag .note.gnu.build-id
   06     .eh_frame_hdr
   07</code></pre>
</div></div>
<div class="paragraph"><p>Segment headers of the <code>hello-gdb</code> file is the same as that of the <code>hello</code> file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content"><code>-l</code> = <code>--segments</code> = <code>--program-headers</code></td>
</tr></table>
</div>
<div class="paragraph"><p>Various sections are described mostly in the man page <code>elf</code>(5) under <code>p_type</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>PHDR</code> is for the program header table.
</p>
</li>
<li>
<p>
<code>INTERP</code> is for the interpreter path ASCIIZ string for starting the executable file.
</p>
</li>
<li>
<p>
<code>LOAD</code> is for the loadable segment. (may be repeated)
</p>
</li>
<li>
<p>
<code>DYNAMIC</code> is for the dynamic linking information.
</p>
</li>
<li>
<p>
<code>NOTE</code> is for auxiliary information.
</p>
</li>
<li>
<p>
<code>GNU_EH_FRAME</code> is for exception handling. (DWARF, see <a href="http://refspecs.linuxfoundation.org/LSB_3.0.0/LSB-Core-generic/LSB-Core-generic/ehframechpt.html">LSB Exception Frames</a>)
</p>
</li>
<li>
<p>
<code>GNU_STACK</code> is for the controling the stack on Linux. (GNU extension)
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <code>objdump -p</code> outputs somewhat similar results.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_hexdump">hexdump</h3>
<div class="paragraph"><p>Here is a plain hexadecimal dump of the entire <code>hello-gdb</code> file.  (some parts trimmed)</p></div>
<div class="listingblock">
<div class="title">Hexdump of the <code>hello-gdb</code> file.</div>
<div class="content">
<pre><code>00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  02 00 3e 00 01 00 00 00  10 04 40 00 00 00 00 00  |..&gt;.......@.....|
   ... (snip)
00000200  2f 6c 69 62 36 34 2f 6c  64 2d 6c 69 6e 75 78 2d  |/lib64/ld-linux-|
00000210  78 38 36 2d 36 34 2e 73  6f 2e 32 00 04 00 00 00  |x86-64.so.2.....|
00000220  10 00 00 00 01 00 00 00  47 4e 55 00 00 00 00 00  |........GNU.....|
00000230  02 00 00 00 06 00 00 00  20 00 00 00 04 00 00 00  |........ .......|
00000240  14 00 00 00 03 00 00 00  47 4e 55 00 aa da 9e e0  |........GNU.....|
00000250  cf 0b 8d 68 e4 52 9c dc  99 07 f7 62 53 5c 2e c9  |...h.R.....bS\..|
00000260  01 00 00 00 01 00 00 00  01 00 00 00 00 00 00 00  |................|
   ... (snip)
00000300  6e 00 5f 5f 67 6d 6f 6e  5f 73 74 61 72 74 5f 5f  |n.__gmon_start__|
00000310  00 47 4c 49 42 43 5f 32  2e 32 2e 35 00 00 00 00  |.GLIBC_2.2.5....|
00000320  02 00 02 00 00 00 00 00  01 00 01 00 01 00 00 00  |................|
00000330  10 00 00 00 00 00 00 00  75 1a 69 09 00 00 02 00  |........u.i.....|
00000340  31 00 00 00 00 00 00 00  c8 08 60 00 00 00 00 00  |1.........`.....|
00000350  06 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
00000360  e8 08 60 00 00 00 00 00  07 00 00 00 01 00 00 00  |..`.............|
00000370  00 00 00 00 00 00 00 00  f0 08 60 00 00 00 00 00  |..........`.....|
00000380  07 00 00 00 02 00 00 00  00 00 00 00 00 00 00 00  |................|
   ... (snip)</code></pre>
</div></div>
<div class="paragraph"><p>Here is a nicer hexadecimal dump with all sections clearly marked by the <code>objdump</code> command for the <code>hello-gdb</code> ELF object.</p></div>
<div class="listingblock">
<div class="title">Hexadecimal dump for all sections of the <code>hello-gdb</code> ELF object.</div>
<div class="content">
<pre><code>hello-gdb:     file format elf64-x86-64

Contents of section .interp:
 400200 2f6c6962 36342f6c 642d6c69 6e75782d  /lib64/ld-linux-
 400210 7838362d 36342e73 6f2e3200           x86-64.so.2.
Contents of section .note.ABI-tag:
 40021c 04000000 10000000 01000000 474e5500  ............GNU.
 40022c 00000000 02000000 06000000 20000000  ............ ...
Contents of section .note.gnu.build-id:
 40023c 04000000 14000000 03000000 474e5500  ............GNU.
 40024c aada9ee0 cf0b8d68 e4529cdc 9907f762  .......h.R.....b
 40025c 535c2ec9                             S\..
Contents of section .gnu.hash:
 400260 01000000 01000000 01000000 00000000  ................
 400270 00000000 00000000 00000000           ............
Contents of section .dynsym:
 400280 00000000 00000000 00000000 00000000  ................
 400290 00000000 00000000 0b000000 12000000  ................
   ... (snip)</code></pre>
</div></div>
<div class="paragraph"><p>Here is another hexadecimal dump for a section by the <code>readelf</code> command for the <code>hello-gdb</code> ELF object.</p></div>
<div class="listingblock">
<div class="title">Hexadecimal dump for the <code>.text</code> section of the <code>hello-gdb</code> ELF object.</div>
<div class="content">
<pre><code>Hex dump of section '.text':
  0x00400410 31ed4989 d15e4889 e24883e4 f0505449 1.I..^H..H...PTI
  0x00400420 c7c09005 400048c7 c1200540 0048c7c7 ....@.H.. .@.H..
  0x00400430 06054000 e8b7ffff fff4660f 1f440000 ..@.......f..D..
  0x00400440 b8170960 0055482d 10096000 4883f80e ...`.UH-..`.H...
  0x00400450 4889e576 1bb80000 00004885 c074115d H..v......H..t.]
  0x00400460 bf100960 00ffe066 0f1f8400 00000000 ...`...f........
  0x00400470 5dc36666 6666662e 0f1f8400 00000000 ].fffff.........
  0x00400480 be100960 00554881 ee100960 0048c1fe ...`.UH....`.H..
  0x00400490 034889e5 4889f048 c1e83f48 01c648d1 .H..H..H..?H..H.
  0x004004a0 fe7415b8 00000000 4885c074 0b5dbf10 .t......H..t.]..
  0x004004b0 096000ff e00f1f00 5dc3660f 1f440000 .`......].f..D..
  0x004004c0 803d4904 20000075 11554889 e5e86eff .=I. ..u.UH...n.
  0x004004d0 ffff5dc6 05360420 0001f3c3 0f1f4000 ..]..6. ......@.
  0x004004e0 bff00660 0048833f 007505eb 930f1f00 ...`.H.?.u......
  0x004004f0 b8000000 004885c0 74f15548 89e5ffd0 .....H..t.UH....
  0x00400500 5de97aff ffff5548 89e5bfa4 054000e8 ].z...UH.....@..
  0x00400510 ccfeffff b8000000 005dc30f 1f440000 .........]...D..
  0x00400520 41574189 ff415649 89f64155 4989d541 AWA..AVI..AUI..A
  0x00400530 544c8d25 a8012000 55488d2d a8012000 TL.%.. .UH.-.. .
  0x00400540 534c29e5 31db48c1 fd034883 ec08e855 SL).1.H...H....U
  0x00400550 feffff48 85ed741e 0f1f8400 00000000 ...H..t.........
  0x00400560 4c89ea4c 89f64489 ff41ff14 dc4883c3 L..L..D..A...H..
  0x00400570 014839eb 75ea4883 c4085b5d 415c415d .H9.u.H...[]A\A]
  0x00400580 415e415f c366662e 0f1f8400 00000000 A^A_.ff.........
  0x00400590 f3c3                                ..</code></pre>
</div></div>
<div class="paragraph"><p>As expected, these are all almost incomprehensible for human.</p></div>
<div class="paragraph"><p>The <code>readelf</code> and <code>objdump</code> commands display the correct
<a href="http://en.wikipedia.org/wiki/Virtual_memory">virtual memory</a> address for the ELF
object after this is loaded to the memory.  The base address to load this is at
0x400000 (4 MiB) for GNU/Linux(amd64 = X86-64).  The above plain hexadecimal
dump displays the physical address in the file and does not count this base
address offset in the
<a href="http://en.wikipedia.org/wiki/Virtual_memory">virtual memory</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_readelf_a">readelf -a</h3>
<div class="paragraph"><p>Here are all non-debug contents by the <code>readelf</code> command of the <code>hello-gdb</code> ELF object.</p></div>
<div class="listingblock">
<div class="title">All contents by the <code>readelf</code> command for the <code>hello-gdb</code> ELF object.</div>
<div class="content">
<pre><code>ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x400410
  Start of program headers:          64 (bytes into file)
  Start of section headers:          5488 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         8
  Size of section headers:           64 (bytes)
  Number of section headers:         35
  Section header string table index: 32

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .interp           PROGBITS         0000000000400200  00000200
       000000000000001c  0000000000000000   A       0     0     1
  [ 2] .note.ABI-tag     NOTE             000000000040021c  0000021c
       0000000000000020  0000000000000000   A       0     0     4
  [ 3] .note.gnu.build-i NOTE             000000000040023c  0000023c
       0000000000000024  0000000000000000   A       0     0     4
  [ 4] .gnu.hash         GNU_HASH         0000000000400260  00000260
       000000000000001c  0000000000000000   A       5     0     8
  [ 5] .dynsym           DYNSYM           0000000000400280  00000280
       0000000000000060  0000000000000018   A       6     1     8
  [ 6] .dynstr           STRTAB           00000000004002e0  000002e0
       000000000000003d  0000000000000000   A       0     0     1
  [ 7] .gnu.version      VERSYM           000000000040031e  0000031e
       0000000000000008  0000000000000002   A       5     0     2
  [ 8] .gnu.version_r    VERNEED          0000000000400328  00000328
       0000000000000020  0000000000000000   A       6     1     8
  [ 9] .rela.dyn         RELA             0000000000400348  00000348
       0000000000000018  0000000000000018   A       5     0     8
  [10] .rela.plt         RELA             0000000000400360  00000360
       0000000000000048  0000000000000018  AI       5    12     8
  [11] .init             PROGBITS         00000000004003a8  000003a8
       000000000000001a  0000000000000000  AX       0     0     4
  [12] .plt              PROGBITS         00000000004003d0  000003d0
       0000000000000040  0000000000000010  AX       0     0     16
  [13] .text             PROGBITS         0000000000400410  00000410
       0000000000000182  0000000000000000  AX       0     0     16
  [14] .fini             PROGBITS         0000000000400594  00000594
       0000000000000009  0000000000000000  AX       0     0     4
  [15] .rodata           PROGBITS         00000000004005a0  000005a0
       0000000000000012  0000000000000000   A       0     0     4
  [16] .eh_frame_hdr     PROGBITS         00000000004005b4  000005b4
       0000000000000034  0000000000000000   A       0     0     4
  [17] .eh_frame         PROGBITS         00000000004005e8  000005e8
       00000000000000f4  0000000000000000   A       0     0     8
  [18] .init_array       INIT_ARRAY       00000000006006e0  000006e0
       0000000000000008  0000000000000000  WA       0     0     8
  [19] .fini_array       FINI_ARRAY       00000000006006e8  000006e8
       0000000000000008  0000000000000000  WA       0     0     8
  [20] .jcr              PROGBITS         00000000006006f0  000006f0
       0000000000000008  0000000000000000  WA       0     0     8
  [21] .dynamic          DYNAMIC          00000000006006f8  000006f8
       00000000000001d0  0000000000000010  WA       6     0     8
  [22] .got              PROGBITS         00000000006008c8  000008c8
       0000000000000008  0000000000000008  WA       0     0     8
  [23] .got.plt          PROGBITS         00000000006008d0  000008d0
       0000000000000030  0000000000000008  WA       0     0     8
  [24] .data             PROGBITS         0000000000600900  00000900
       0000000000000010  0000000000000000  WA       0     0     8
  [25] .bss              NOBITS           0000000000600910  00000910
       0000000000000008  0000000000000000  WA       0     0     1
  [26] .comment          PROGBITS         0000000000000000  00000910
       0000000000000039  0000000000000001  MS       0     0     1
  [27] .debug_aranges    PROGBITS         0000000000000000  00000949
       0000000000000030  0000000000000000           0     0     1
  [28] .debug_info       PROGBITS         0000000000000000  00000979
       000000000000009f  0000000000000000           0     0     1
  [29] .debug_abbrev     PROGBITS         0000000000000000  00000a18
       0000000000000042  0000000000000000           0     0     1
  [30] .debug_line       PROGBITS         0000000000000000  00000a5a
       000000000000003c  0000000000000000           0     0     1
  [31] .debug_str        PROGBITS         0000000000000000  00000a96
       00000000000000c3  0000000000000001  MS       0     0     1
  [32] .shstrtab         STRTAB           0000000000000000  00000b59
       0000000000000148  0000000000000000           0     0     1
  [33] .symtab           SYMTAB           0000000000000000  00000ca8
       0000000000000690  0000000000000018          34    50     8
  [34] .strtab           STRTAB           0000000000000000  00001338
       0000000000000237  0000000000000000           0     0     1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)

There are no section groups in this file.

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040
                 0x00000000000001c0 0x00000000000001c0  R E    8
  INTERP         0x0000000000000200 0x0000000000400200 0x0000000000400200
                 0x000000000000001c 0x000000000000001c  R      1
      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000
                 0x00000000000006dc 0x00000000000006dc  R E    200000
  LOAD           0x00000000000006e0 0x00000000006006e0 0x00000000006006e0
                 0x0000000000000230 0x0000000000000238  RW     200000
  DYNAMIC        0x00000000000006f8 0x00000000006006f8 0x00000000006006f8
                 0x00000000000001d0 0x00000000000001d0  RW     8
  NOTE           0x000000000000021c 0x000000000040021c 0x000000000040021c
                 0x0000000000000044 0x0000000000000044  R      4
  GNU_EH_FRAME   0x00000000000005b4 0x00000000004005b4 0x00000000004005b4
                 0x0000000000000034 0x0000000000000034  R      4
  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x0000000000000000 0x0000000000000000  RW     10

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gn
u.version .gnu.version_r .rela.dyn .rela.plt .init .plt .text .fini .rodata .eh_
frame_hdr .eh_frame
   03     .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss
   04     .dynamic
   05     .note.ABI-tag .note.gnu.build-id
   06     .eh_frame_hdr
   07

Dynamic section at offset 0x6f8 contains 24 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x4003a8
 0x000000000000000d (FINI)               0x400594
 0x0000000000000019 (INIT_ARRAY)         0x6006e0
 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)
 0x000000000000001a (FINI_ARRAY)         0x6006e8
 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)
 0x000000006ffffef5 (GNU_HASH)           0x400260
 0x0000000000000005 (STRTAB)             0x4002e0
 0x0000000000000006 (SYMTAB)             0x400280
 0x000000000000000a (STRSZ)              61 (bytes)
 0x000000000000000b (SYMENT)             24 (bytes)
 0x0000000000000015 (DEBUG)              0x0
 0x0000000000000003 (PLTGOT)             0x6008d0
 0x0000000000000002 (PLTRELSZ)           72 (bytes)
 0x0000000000000014 (PLTREL)             RELA
 0x0000000000000017 (JMPREL)             0x400360
 0x0000000000000007 (RELA)               0x400348
 0x0000000000000008 (RELASZ)             24 (bytes)
 0x0000000000000009 (RELAENT)            24 (bytes)
 0x000000006ffffffe (VERNEED)            0x400328
 0x000000006fffffff (VERNEEDNUM)         1
 0x000000006ffffff0 (VERSYM)             0x40031e
 0x0000000000000000 (NULL)               0x0

Relocation section '.rela.dyn' at offset 0x348 contains 1 entries:
  Offset          Info           Type           Sym. Value    Sym. Name + Addend
0000006008c8  000300000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0

Relocation section '.rela.plt' at offset 0x360 contains 3 entries:
  Offset          Info           Type           Sym. Value    Sym. Name + Addend
0000006008e8  000100000007 R_X86_64_JUMP_SLO 0000000000000000 puts + 0
0000006008f0  000200000007 R_X86_64_JUMP_SLO 0000000000000000 __libc_start_main
+ 0
0000006008f8  000300000007 R_X86_64_JUMP_SLO 0000000000000000 __gmon_start__ + 0

The decoding of unwind sections for machine type Advanced Micro Devices X86-64 i
s not currently supported.

Symbol table '.dynsym' contains 4 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND puts@GLIBC_2.2.5 (2)
     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLI
BC_2.2.5 (2)
     3: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__

Symbol table '.symtab' contains 70 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000400200     0 SECTION LOCAL  DEFAULT    1
     2: 000000000040021c     0 SECTION LOCAL  DEFAULT    2
     3: 000000000040023c     0 SECTION LOCAL  DEFAULT    3
     4: 0000000000400260     0 SECTION LOCAL  DEFAULT    4
     5: 0000000000400280     0 SECTION LOCAL  DEFAULT    5
     6: 00000000004002e0     0 SECTION LOCAL  DEFAULT    6
     7: 000000000040031e     0 SECTION LOCAL  DEFAULT    7
     8: 0000000000400328     0 SECTION LOCAL  DEFAULT    8
     9: 0000000000400348     0 SECTION LOCAL  DEFAULT    9
    10: 0000000000400360     0 SECTION LOCAL  DEFAULT   10
    11: 00000000004003a8     0 SECTION LOCAL  DEFAULT   11
    12: 00000000004003d0     0 SECTION LOCAL  DEFAULT   12
    13: 0000000000400410     0 SECTION LOCAL  DEFAULT   13
    14: 0000000000400594     0 SECTION LOCAL  DEFAULT   14
    15: 00000000004005a0     0 SECTION LOCAL  DEFAULT   15
    16: 00000000004005b4     0 SECTION LOCAL  DEFAULT   16
    17: 00000000004005e8     0 SECTION LOCAL  DEFAULT   17
    18: 00000000006006e0     0 SECTION LOCAL  DEFAULT   18
    19: 00000000006006e8     0 SECTION LOCAL  DEFAULT   19
    20: 00000000006006f0     0 SECTION LOCAL  DEFAULT   20
    21: 00000000006006f8     0 SECTION LOCAL  DEFAULT   21
    22: 00000000006008c8     0 SECTION LOCAL  DEFAULT   22
    23: 00000000006008d0     0 SECTION LOCAL  DEFAULT   23
    24: 0000000000600900     0 SECTION LOCAL  DEFAULT   24
    25: 0000000000600910     0 SECTION LOCAL  DEFAULT   25
    26: 0000000000000000     0 SECTION LOCAL  DEFAULT   26
    27: 0000000000000000     0 SECTION LOCAL  DEFAULT   27
    28: 0000000000000000     0 SECTION LOCAL  DEFAULT   28
    29: 0000000000000000     0 SECTION LOCAL  DEFAULT   29
    30: 0000000000000000     0 SECTION LOCAL  DEFAULT   30
    31: 0000000000000000     0 SECTION LOCAL  DEFAULT   31
    32: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    33: 00000000006006f0     0 OBJECT  LOCAL  DEFAULT   20 __JCR_LIST__
    34: 0000000000400440     0 FUNC    LOCAL  DEFAULT   13 deregister_tm_clones
    35: 0000000000400480     0 FUNC    LOCAL  DEFAULT   13 register_tm_clones
    36: 00000000004004c0     0 FUNC    LOCAL  DEFAULT   13 __do_global_dtors_aux
    37: 0000000000600910     1 OBJECT  LOCAL  DEFAULT   25 completed.6661
    38: 00000000006006e8     0 OBJECT  LOCAL  DEFAULT   19 __do_global_dtors_aux
_fin
    39: 00000000004004e0     0 FUNC    LOCAL  DEFAULT   13 frame_dummy
    40: 00000000006006e0     0 OBJECT  LOCAL  DEFAULT   18 __frame_dummy_init_ar
ray_
    41: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS hello.c
    42: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    43: 00000000004006d8     0 OBJECT  LOCAL  DEFAULT   17 __FRAME_END__
    44: 00000000006006f0     0 OBJECT  LOCAL  DEFAULT   20 __JCR_END__
    45: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS
    46: 00000000006006e8     0 NOTYPE  LOCAL  DEFAULT   18 __init_array_end
    47: 00000000006006f8     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC
    48: 00000000006006e0     0 NOTYPE  LOCAL  DEFAULT   18 __init_array_start
    49: 00000000006008d0     0 OBJECT  LOCAL  DEFAULT   23 _GLOBAL_OFFSET_TABLE_
    50: 0000000000400590     2 FUNC    GLOBAL DEFAULT   13 __libc_csu_fini
    51: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMClon
eTab
    52: 0000000000600900     0 NOTYPE  WEAK   DEFAULT   24 data_start
    53: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND puts@@GLIBC_2.2.5
    54: 0000000000600910     0 NOTYPE  GLOBAL DEFAULT   24 _edata
    55: 0000000000400594     0 FUNC    GLOBAL DEFAULT   14 _fini
    56: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@@GL
IBC_
    57: 0000000000600900     0 NOTYPE  GLOBAL DEFAULT   24 __data_start
    58: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
    59: 0000000000600908     0 OBJECT  GLOBAL HIDDEN    24 __dso_handle
    60: 00000000004005a0     4 OBJECT  GLOBAL DEFAULT   15 _IO_stdin_used
    61: 0000000000400520   101 FUNC    GLOBAL DEFAULT   13 __libc_csu_init
    62: 0000000000600918     0 NOTYPE  GLOBAL DEFAULT   25 _end
    63: 0000000000400410     0 FUNC    GLOBAL DEFAULT   13 _start
    64: 0000000000600910     0 NOTYPE  GLOBAL DEFAULT   25 __bss_start
    65: 0000000000400506    21 FUNC    GLOBAL DEFAULT   13 main
    66: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _Jv_RegisterClasses
    67: 0000000000600910     0 OBJECT  GLOBAL HIDDEN    24 __TMC_END__
    68: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneT
able
    69: 00000000004003a8     0 FUNC    GLOBAL DEFAULT   11 _init

Version symbols section '.gnu.version' contains 4 entries:
 Addr: 000000000040031e  Offset: 0x00031e  Link: 5 (.dynsym)
  000:   0 (*local*)       2 (GLIBC_2.2.5)   2 (GLIBC_2.2.5)   0 (*local*)

Version needs section '.gnu.version_r' contains 1 entries:
 Addr: 0x0000000000400328  Offset: 0x000328  Link: 6 (.dynstr)
  000000: Version: 1  File: libc.so.6  Cnt: 1
  0x0010:   Name: GLIBC_2.2.5  Flags: none  Version: 2

Displaying notes found at file offset 0x0000021c with length 0x00000020:
  Owner                 Data size    Description
  GNU                  0x00000010    NT_GNU_ABI_TAG (ABI version tag)
    OS: Linux, ABI: 2.6.32

Displaying notes found at file offset 0x0000023c with length 0x00000024:
  Owner                 Data size    Description
  GNU                  0x00000014    NT_GNU_BUILD_ID (unique build ID bitstring)
    Build ID: aada9ee0cf0b8d68e4529cdc9907f762535c2ec9</code></pre>
</div></div>
<div class="paragraph"><p>The ELF file data structure is clearly analyzed excluding the debug contents.</p></div>
<div class="paragraph"><p>The code content of the program is not disassembled.</p></div>
</div>
<div class="sect2">
<h3 id="_readelf_wl">readelf -wL</h3>
<div class="paragraph"><p>The <code>readelf -wL</code> command lists the decoded dump of debug contents of section <code>.debug_line</code>.</p></div>
<div class="paragraph"><p>It lists the source file name with path.  Then each C source line nember is matched with its starting address.</p></div>
<div class="paragraph"><p>For the <code>hello-gdb</code> ELF object, the <code>readelf -wL</code> command lists the C source line numbers as follows.</p></div>
<div class="listingblock">
<div class="title">All the source line numbers listed by the <code>readelf -wL</code> command for the <code>hello-gdb</code> ELF object.</div>
<div class="content">
<pre><code>Decoded dump of debug contents of section .debug_line:

CU: hello.c:
File name                            Line number    Starting address
hello.c                                        5            0x400506
hello.c                                        6            0x40050a
hello.c                                        7            0x400514
hello.c                                        8            0x400519</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <code>objdump -WL</code> outputs very similar results. (The upper case W!)</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">All debug contents can be displayed at once by the <code>readelf -w</code> (or <code>objdump -W</code>) command.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_objdump_d">objdump -d</h3>
<div class="paragraph"><p>Here is a disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb.o</code> ELF object.</p></div>
<div class="listingblock">
<div class="title">Disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb.o</code> ELF object.</div>
<div class="content">
<pre><code>hello-gdb.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;main&gt;:
   0:    55                       push   %rbp
   1:    48 89 e5                 mov    %rsp,%rbp
   4:    bf 00 00 00 00           mov    $0x0,%edi
   9:    e8 00 00 00 00           callq  e &lt;main+0xe&gt;
   e:    b8 00 00 00 00           mov    $0x0,%eax
  13:    5d                       pop    %rbp
  14:    c3                       retq</code></pre>
</div></div>
<div class="paragraph"><p>Now we see the binary code in the readable assembler format.</p></div>
<div class="paragraph"><p>Since code is not linked, some address data are left as 0 which will be filled by the linker.</p></div>
<div class="paragraph"><p>Here is a disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb</code> ELF object.</p></div>
<div class="listingblock">
<div class="title">Disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb</code> ELF object.</div>
<div class="content">
<pre><code>hello-gdb:     file format elf64-x86-64


Disassembly of section .init:

00000000004003a8 &lt;_init&gt;:
  4003a8:    48 83 ec 08              sub    $0x8,%rsp
  4003ac:    48 8b 05 15 05 20 00     mov    0x200515(%rip),%rax        # 6008c8
 &lt;_DYNAMIC+0x1d0&gt;
  4003b3:    48 85 c0                 test   %rax,%rax
  4003b6:    74 05                    je     4003bd &lt;_init+0x15&gt;
  4003b8:    e8 43 00 00 00           callq  400400 &lt;__gmon_start__@plt&gt;
  4003bd:    48 83 c4 08              add    $0x8,%rsp
  4003c1:    c3                       retq

Disassembly of section .plt:

00000000004003d0 &lt;puts@plt-0x10&gt;:
  4003d0:    ff 35 02 05 20 00        pushq  0x200502(%rip)        # 6008d8 &lt;_GL
OBAL_OFFSET_TABLE_+0x8&gt;
  4003d6:    ff 25 04 05 20 00        jmpq   *0x200504(%rip)        # 6008e0 &lt;_G
LOBAL_OFFSET_TABLE_+0x10&gt;
  4003dc:    0f 1f 40 00              nopl   0x0(%rax)

00000000004003e0 &lt;puts@plt&gt;:
  4003e0:    ff 25 02 05 20 00        jmpq   *0x200502(%rip)        # 6008e8 &lt;_G
LOBAL_OFFSET_TABLE_+0x18&gt;
  4003e6:    68 00 00 00 00           pushq  $0x0
  4003eb:    e9 e0 ff ff ff           jmpq   4003d0 &lt;_init+0x28&gt;

00000000004003f0 &lt;__libc_start_main@plt&gt;:
  4003f0:    ff 25 fa 04 20 00        jmpq   *0x2004fa(%rip)        # 6008f0 &lt;_G
LOBAL_OFFSET_TABLE_+0x20&gt;
  4003f6:    68 01 00 00 00           pushq  $0x1
  4003fb:    e9 d0 ff ff ff           jmpq   4003d0 &lt;_init+0x28&gt;

0000000000400400 &lt;__gmon_start__@plt&gt;:
  400400:    ff 25 f2 04 20 00        jmpq   *0x2004f2(%rip)        # 6008f8 &lt;_G
LOBAL_OFFSET_TABLE_+0x28&gt;
  400406:    68 02 00 00 00           pushq  $0x2
  40040b:    e9 c0 ff ff ff           jmpq   4003d0 &lt;_init+0x28&gt;

Disassembly of section .text:

0000000000400410 &lt;_start&gt;:
  400410:    31 ed                    xor    %ebp,%ebp
  400412:    49 89 d1                 mov    %rdx,%r9
  400415:    5e                       pop    %rsi
  400416:    48 89 e2                 mov    %rsp,%rdx
  400419:    48 83 e4 f0              and    $0xfffffffffffffff0,%rsp
  40041d:    50                       push   %rax
  40041e:    54                       push   %rsp
  40041f:    49 c7 c0 90 05 40 00     mov    $0x400590,%r8
  400426:    48 c7 c1 20 05 40 00     mov    $0x400520,%rcx
  40042d:    48 c7 c7 06 05 40 00     mov    $0x400506,%rdi
  400434:    e8 b7 ff ff ff           callq  4003f0 &lt;__libc_start_main@plt&gt;
  400439:    f4                       hlt
  40043a:    66 0f 1f 44 00 00        nopw   0x0(%rax,%rax,1)

0000000000400440 &lt;deregister_tm_clones&gt;:
  400440:    b8 17 09 60 00           mov    $0x600917,%eax
  400445:    55                       push   %rbp
  400446:    48 2d 10 09 60 00        sub    $0x600910,%rax
  40044c:    48 83 f8 0e              cmp    $0xe,%rax
  400450:    48 89 e5                 mov    %rsp,%rbp
  400453:    76 1b                    jbe    400470 &lt;deregister_tm_clones+0x30&gt;
  400455:    b8 00 00 00 00           mov    $0x0,%eax
  40045a:    48 85 c0                 test   %rax,%rax
  40045d:    74 11                    je     400470 &lt;deregister_tm_clones+0x30&gt;
  40045f:    5d                       pop    %rbp
  400460:    bf 10 09 60 00           mov    $0x600910,%edi
  400465:    ff e0                    jmpq   *%rax
  400467:    66 0f 1f 84 00 00 00     nopw   0x0(%rax,%rax,1)
  40046e:    00 00
  400470:    5d                       pop    %rbp
  400471:    c3                       retq
  400472:    66 66 66 66 66 2e 0f     data16 data16 data16 data16 nopw %cs:0x0(%
rax,%rax,1)
  400479:    1f 84 00 00 00 00 00

0000000000400480 &lt;register_tm_clones&gt;:
  400480:    be 10 09 60 00           mov    $0x600910,%esi
  400485:    55                       push   %rbp
  400486:    48 81 ee 10 09 60 00     sub    $0x600910,%rsi
  40048d:    48 c1 fe 03              sar    $0x3,%rsi
  400491:    48 89 e5                 mov    %rsp,%rbp
  400494:    48 89 f0                 mov    %rsi,%rax
  400497:    48 c1 e8 3f              shr    $0x3f,%rax
  40049b:    48 01 c6                 add    %rax,%rsi
  40049e:    48 d1 fe                 sar    %rsi
  4004a1:    74 15                    je     4004b8 &lt;register_tm_clones+0x38&gt;
  4004a3:    b8 00 00 00 00           mov    $0x0,%eax
  4004a8:    48 85 c0                 test   %rax,%rax
  4004ab:    74 0b                    je     4004b8 &lt;register_tm_clones+0x38&gt;
  4004ad:    5d                       pop    %rbp
  4004ae:    bf 10 09 60 00           mov    $0x600910,%edi
  4004b3:    ff e0                    jmpq   *%rax
  4004b5:    0f 1f 00                 nopl   (%rax)
  4004b8:    5d                       pop    %rbp
  4004b9:    c3                       retq
  4004ba:    66 0f 1f 44 00 00        nopw   0x0(%rax,%rax,1)

00000000004004c0 &lt;__do_global_dtors_aux&gt;:
  4004c0:    80 3d 49 04 20 00 00     cmpb   $0x0,0x200449(%rip)        # 600910
 &lt;__TMC_END__&gt;
  4004c7:    75 11                    jne    4004da &lt;__do_global_dtors_aux+0x1a&gt;
  4004c9:    55                       push   %rbp
  4004ca:    48 89 e5                 mov    %rsp,%rbp
  4004cd:    e8 6e ff ff ff           callq  400440 &lt;deregister_tm_clones&gt;
  4004d2:    5d                       pop    %rbp
  4004d3:    c6 05 36 04 20 00 01     movb   $0x1,0x200436(%rip)        # 600910
 &lt;__TMC_END__&gt;
  4004da:    f3 c3                    repz retq
  4004dc:    0f 1f 40 00              nopl   0x0(%rax)

00000000004004e0 &lt;frame_dummy&gt;:
  4004e0:    bf f0 06 60 00           mov    $0x6006f0,%edi
  4004e5:    48 83 3f 00              cmpq   $0x0,(%rdi)
  4004e9:    75 05                    jne    4004f0 &lt;frame_dummy+0x10&gt;
  4004eb:    eb 93                    jmp    400480 &lt;register_tm_clones&gt;
  4004ed:    0f 1f 00                 nopl   (%rax)
  4004f0:    b8 00 00 00 00           mov    $0x0,%eax
  4004f5:    48 85 c0                 test   %rax,%rax
  4004f8:    74 f1                    je     4004eb &lt;frame_dummy+0xb&gt;
  4004fa:    55                       push   %rbp
  4004fb:    48 89 e5                 mov    %rsp,%rbp
  4004fe:    ff d0                    callq  *%rax
  400500:    5d                       pop    %rbp
  400501:    e9 7a ff ff ff           jmpq   400480 &lt;register_tm_clones&gt;

0000000000400506 &lt;main&gt;:
  400506:    55                       push   %rbp
  400507:    48 89 e5                 mov    %rsp,%rbp
  40050a:    bf a4 05 40 00           mov    $0x4005a4,%edi
  40050f:    e8 cc fe ff ff           callq  4003e0 &lt;puts@plt&gt;
  400514:    b8 00 00 00 00           mov    $0x0,%eax
  400519:    5d                       pop    %rbp
  40051a:    c3                       retq
  40051b:    0f 1f 44 00 00           nopl   0x0(%rax,%rax,1)

0000000000400520 &lt;__libc_csu_init&gt;:
  400520:    41 57                    push   %r15
  400522:    41 89 ff                 mov    %edi,%r15d
  400525:    41 56                    push   %r14
  400527:    49 89 f6                 mov    %rsi,%r14
  40052a:    41 55                    push   %r13
  40052c:    49 89 d5                 mov    %rdx,%r13
  40052f:    41 54                    push   %r12
  400531:    4c 8d 25 a8 01 20 00     lea    0x2001a8(%rip),%r12        # 6006e0
 &lt;__frame_dummy_init_array_entry&gt;
  400538:    55                       push   %rbp
  400539:    48 8d 2d a8 01 20 00     lea    0x2001a8(%rip),%rbp        # 6006e8
 &lt;__init_array_end&gt;
  400540:    53                       push   %rbx
  400541:    4c 29 e5                 sub    %r12,%rbp
  400544:    31 db                    xor    %ebx,%ebx
  400546:    48 c1 fd 03              sar    $0x3,%rbp
  40054a:    48 83 ec 08              sub    $0x8,%rsp
  40054e:    e8 55 fe ff ff           callq  4003a8 &lt;_init&gt;
  400553:    48 85 ed                 test   %rbp,%rbp
  400556:    74 1e                    je     400576 &lt;__libc_csu_init+0x56&gt;
  400558:    0f 1f 84 00 00 00 00     nopl   0x0(%rax,%rax,1)
  40055f:    00
  400560:    4c 89 ea                 mov    %r13,%rdx
  400563:    4c 89 f6                 mov    %r14,%rsi
  400566:    44 89 ff                 mov    %r15d,%edi
  400569:    41 ff 14 dc              callq  *(%r12,%rbx,8)
  40056d:    48 83 c3 01              add    $0x1,%rbx
  400571:    48 39 eb                 cmp    %rbp,%rbx
  400574:    75 ea                    jne    400560 &lt;__libc_csu_init+0x40&gt;
  400576:    48 83 c4 08              add    $0x8,%rsp
  40057a:    5b                       pop    %rbx
  40057b:    5d                       pop    %rbp
  40057c:    41 5c                    pop    %r12
  40057e:    41 5d                    pop    %r13
  400580:    41 5e                    pop    %r14
  400582:    41 5f                    pop    %r15
  400584:    c3                       retq
  400585:    66 66 2e 0f 1f 84 00     data16 nopw %cs:0x0(%rax,%rax,1)
  40058c:    00 00 00 00

0000000000400590 &lt;__libc_csu_fini&gt;:
  400590:    f3 c3                    repz retq

Disassembly of section .fini:

0000000000400594 &lt;_fini&gt;:
  400594:    48 83 ec 08              sub    $0x8,%rsp
  400598:    48 83 c4 08              add    $0x8,%rsp
  40059c:    c3                       retq</code></pre>
</div></div>
<div class="paragraph"><p>Now we see the binary code in the readable assembler format.</p></div>
<div class="paragraph"><p>You also see many codes in addition to the <code>main</code> function existed in the <code>hello-gdb.o</code> ELF object since the linker seems to link few additional object files such as <code>crt1.o</code>, <code>crti.o</code>, etc.</p></div>
<div class="paragraph"><p>Also some unresolved address references in the <code>hello-gdb.o</code> ELF object is resolved.</p></div>
<div class="paragraph"><p>For example, let&#8217;s trace <code>call puts</code> in the assembler source <code>hello.s</code> as follows.</p></div>
<div class="listingblock">
<div class="title">Code to <code>call puts</code> in the <code>hello.s</code>. (No address resolution)</div>
<div class="content">
<pre><code>    call    puts</code></pre>
</div></div>
<div class="paragraph"><p>We see the following for the relocatable object <code>hello-gdb.o</code>.</p></div>
<div class="listingblock">
<div class="title">Code to <code>call puts</code> in the <code>hello-gdb.o</code>. (No address resolution)</div>
<div class="content">
<pre><code>     9:    e8 00 00 00 00           callq  e &lt;main+0xe&gt;</code></pre>
</div></div>
<div class="paragraph"><p>We see the following for the executable <code>hello-gdb</code>.</p></div>
<div class="listingblock">
<div class="title">Code to <code>call puts</code> in the <code>hello-gdb</code>. (Address resolved)</div>
<div class="content">
<pre><code>4005b5:    e8 d6 fe ff ff           callq  400490 &lt;puts@plt&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Later we will see the following under GDB.</p></div>
<div class="listingblock">
<div class="title">Code to <code>call puts</code> in the <code>hello-gdb</code> viewed from <code>(gdb) disassembler/r main</code>. (Address resolved)</div>
<div class="content">
<pre><code>0x00000000004005b5 &lt;+9&gt;:        e8 d6 fe ff ff  callq  0x400490 &lt;puts@plt&gt;</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_objdump_s">objdump -S</h3>
<div class="paragraph"><p>Here is a disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb.o</code> ELF object with the original C source code.</p></div>
<div class="listingblock">
<div class="title">Disassembled code dump by the <code>objdump</code> command for the <code>hello-gdb.o</code> ELF object with the original C source code.</div>
<div class="content">
<pre><code>hello-gdb.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;main&gt;:
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
/* my first C program */
int main()
{
   0:    55                       push   %rbp
   1:    48 89 e5                 mov    %rsp,%rbp
    printf("Hello, world!\n");
   4:    bf 00 00 00 00           mov    $0x0,%edi
   9:    e8 00 00 00 00           callq  e &lt;main+0xe&gt;
    return EXIT_SUCCESS;
   e:    b8 00 00 00 00           mov    $0x0,%eax
}
  13:    5d                       pop    %rbp
  14:    c3                       retq</code></pre>
</div></div>
<div class="paragraph"><p>The ELF file only contains the location of the original C source code and correspondence to lines in it.</p></div>
<div class="paragraph"><p>Since code is not linked, some address data are left as 0 which will be filled by the linker.</p></div>
<div class="paragraph"><p>If you run <code>objdump -S hello-gdb</code>, you get a long disassembled list with the original C source code.  Its addresses are resolved.</p></div>
</div>
<div class="sect2">
<h3 id="_core_dump">Core dump</h3>
<div class="paragraph"><p>When a user-process crashes, traditional Unix-like systems create a <code>core</code> file
in the current directory if it is enabled.  This is called
<a href="http://en.wikipedia.org/wiki/Core_dump">core dump</a> file which records the state
of the working memory of the crashed user-process program.  It is stored in the
ELF file format on Linux.</p></div>
<div class="paragraph"><p>In order to enable the creation of this <code>core</code> file, you need to set the core
file size to <code>unlimited</code> with the shell&#8217;s <code>ulimit -c unlimited</code> command in
advance.</p></div>
<div class="listingblock">
<div class="title">Set the core file size to <code>unlimited</code> with <code>ulimit -c unlimited</code>.</div>
<div class="content">
<pre><code>$ ulimit -c
0
$ ulimit -c unlimited
$ ulimit -c
unlimited</code></pre>
</div></div>
<div class="paragraph"><p>Modern Linux system may behave somewhat differently.  In order to achieve this
simple classical core dump behavior, please ensure the following.</p></div>
<div class="ulist"><ul>
<li>
<p>
Purge packages such as <code>apport-gtk</code> and <code>apport</code>.
</p>
</li>
<li>
<p>
The <code>/proc/sys/kernel/core_pattern</code> file contains <code>core</code>.
</p>
</li>
<li>
<p>
The <code>/proc/sys/kernel/core_uses_pid</code> file contains <code>0</code>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please read the <code>core</code>(5) manpage and the <code>ulimit</code> section in the <code>bash</code>(1)
manpage for more.</p></div>
<div class="paragraph"><p>You can use GDB to inspect the <code>core</code> file as <a href="#_gdb_prime8_gdb">Debug: level 3: gdb prime8-gdb</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_level_1">Debug: level 1</h2>
<div class="sectionbody">
<div class="paragraph"><p>Debugging is the major part of programing.</p></div>
<div class="paragraph"><p>If your code fails by an unknown cause, it is primitive but is often used
technique to embed <strong>logging</strong> codes for key internal parameters.  This logging
must be disabled for the normal program execution.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use the <code>script</code>(1) command to obtain a file copy of the console output.
Piping the <code>COMMAND</code> output as "<code>COMMAND 2&gt;&amp;1 |tee typescript</code>" is an
alternative.</td>
</tr></table>
</div>
<div class="paragraph"><p>If your code assumes something, it is good idea to protect this assumption with
an <strong>assertion</strong> code, i.e., a conditional reporting and aborting code.  If the
assertion code fails, you know you hit a bug.  This is a very effective and
preventive debug method.</p></div>
<div class="paragraph"><p>Let&#8217;s review some cliches used to embed such codes.</p></div>
<div class="sect2">
<h3 id="_shell_logging">Shell logging</h3>
<div class="paragraph"><p>Embedding many "<code>echo "..."</code>" lines works fine to debug short shell programs.</p></div>
<div class="paragraph"><p>But it can get tangled with normal output codes.  So disabling them for
production use and removing them later may not be trivial for larger shell
programs.</p></div>
<div class="paragraph"><p>You can solve this complication by defining a purpose specific <code>debug</code>
function.</p></div>
<div class="paragraph"><p>The <code>cli-log</code> program logs an error message if the variable <code>DEBUG</code> is set.</p></div>
<div class="listingblock">
<div class="title">Example of a shell code <code>cli-log</code> with logging capability.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># Un-comment the following to activate debug messages</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#DEBUG="TRUE"</span></span>
<span style="font-weight: bold"><span style="color: #000000">debug ()</span></span>
{
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> -n <span style="color: #FF0000">"$DEBUG"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
        echo <span style="color: #FF0000">"$@"</span> <span style="color: #990000">&gt;&amp;</span><span style="color: #993399">2</span>
    <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
}
<span style="color: #009900">FOO</span><span style="color: #990000">=</span><span style="color: #009900">$1</span>
<span style="color: #009900">BAR</span><span style="color: #990000">=</span><span style="color: #009900">$2</span>
debug <span style="color: #FF0000">"I: debug log message: FOO=$FOO, BAR=$BAR"</span>
echo <span style="color: #FF0000">"$FOO $BAR!"</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution example of logging for a shell code <code>cli-log</code>.</div>
<div class="content">
<pre><code>Hello World!
$ DEBUG=TRUE ./cli-log Hello World
I: debug log message: FOO=Hello, BAR=World
Hello World!</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Unlike Bash, Dash which offers <code>/bin/sh</code> on the recent Debian system does
     not support <code>$LINENO</code> for wheezy.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_python_logging">Python logging</h3>
<div class="paragraph"><p>Embedding many "<code>print("...")</code>" lines works fine to debug short Python programs.</p></div>
<div class="paragraph"><p>Let&#8217;s try to log in a better way as done for the above shell code.</p></div>
<div class="paragraph"><p>The <code>cli-log</code> program logs an error message if the variable <code>DEBUG</code> is set.</p></div>
<div class="listingblock">
<div class="title">Example of a Python 3 code <code>cli-log</code> with logging capability.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys<span style="color: #990000">,</span>os<span style="color: #990000">,</span>inspect
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
    DEBUG <span style="color: #990000">=</span> os<span style="color: #990000">.</span>environ<span style="color: #990000">[</span><span style="color: #FF0000">"DEBUG"</span><span style="color: #990000">]</span>
<span style="font-weight: bold"><span style="color: #0000FF">except</span></span> KeyError<span style="color: #990000">:</span>
    DEBUG <span style="color: #990000">=</span> <span style="color: #993399">0</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">debug</span></span> <span style="color: #990000">(</span>msg<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">    """Outputs to sys.stderr if DEBUG is non-zero."""</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>DEBUG<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>msg<span style="color: #990000">,</span> file<span style="color: #990000">=</span>sys<span style="color: #990000">.</span>stderr<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">    """Returns the current line number."""</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> inspect<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentframe</span></span><span style="color: #990000">().</span>f_back<span style="color: #990000">.</span>f_lineno

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    foo <span style="color: #990000">=</span> sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span>
    bar <span style="color: #990000">=</span> sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>foo <span style="color: #990000">!=</span> bar<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">debug</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"L: line=%i, foo=%s, bar=%s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">(),</span> foo<span style="color: #990000">,</span> bar<span style="color: #990000">))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>foo <span style="color: #990000">+</span> <span style="color: #FF0000">" "</span> <span style="color: #990000">+</span> bar <span style="color: #990000">+</span><span style="color: #FF0000">'!'</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">On Python 2, you should replace "<code>#!/usr/bin/python3</code>" with
"<code>#!/usr/bin/python</code>"; and "<code>print(msg, file=sys.stderr)</code>" with
"<code>print &gt;&gt; sys.stderr, msg</code>".</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Execution example of logging for a Python code <code>cli-log</code>.</div>
<div class="content">
<pre><code>Hello World!
$ DEBUG=TRUE ./cli-log Hello World
L: line=21, foo=Hello, bar=World
Hello World!</code></pre>
</div></div>
<div class="paragraph"><p>See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/tutorial/stdlib2.html#logging">"Logging" in "The Python Tutorial"</a>
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/3/howto/logging.html">"Logging HOWTO" in "Python HOWTOs"</a>
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/3/howto/logging-cookbook.html">"Logging Cookbook" in "Python HOWTOs"</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_c_logging">C logging</h3>
<div class="paragraph"><p>Embedding many "<code>printf(fmt, ...)</code>" or "<code>fprintf(stderr, fmt, ...)</code>" lines
works fine to debug short C programs.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The <code>unifdef</code> command may be handy for removing these useless debug lines
after finishing the debug, if they are enclosed between a pair of macros such
as <code>#ifdef DEBUG</code> and <code>#endif</code>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s try to log in a better way as done for the above shell and Python codes.</p></div>
<div class="paragraph"><p>I made a generic C header file <code>logerr.h</code> for this purpose.</p></div>
<div class="listingblock">
<div class="title">A C header code <code>logerr.h</code> with logging capability.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#ifdef</span></span> NLOGERR
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>level<span style="color: #990000">,</span>fmt<span style="color: #990000">,...)</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>level<span style="color: #990000">,</span>fmt<span style="color: #990000">,</span> <span style="color: #990000">...)</span> <span style="color: #990000">\</span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>level <span style="color: #990000">&lt;=</span> logerr_level<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="color: #990000">\</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"%s: %s:%d: "</span><span style="color: #990000">,</span> <span style="color: #990000">\</span>
        level <span style="color: #990000">&gt;=</span> <span style="color: #993399">3</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"D"</span> <span style="color: #990000">:</span> level <span style="color: #990000">==</span> <span style="color: #993399">2</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"I"</span> <span style="color: #990000">:</span> level <span style="color: #990000">==</span> <span style="color: #993399">1</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"N"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"W"</span> <span style="color: #990000">,</span> <span style="color: #990000">\</span>
        __FILE__<span style="color: #990000">,</span> __LINE__<span style="color: #990000">);</span> <span style="color: #990000">\</span>
    <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> fmt<span style="color: #990000">,</span> ##__VA_ARGS__<span style="color: #990000">);</span> <span style="color: #990000">\</span>
    <span style="font-weight: bold"><span style="color: #000000">fflush</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">);</span> <span style="color: #990000">\</span>
    <span style="color: #FF0000">}</span> <span style="color: #990000">\</span>
<span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="font-style: italic"><span style="color: #9A1900">/* the single statement cliche to avoid breaking if(...)-construct */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LOGERR_WARN        <span style="color: #993399">0</span>       <span style="font-style: italic"><span style="color: #9A1900">/* W: warning       always */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LOGERR_NOTICE      <span style="color: #993399">1</span>       <span style="font-style: italic"><span style="color: #9A1900">/* N: notice        -v */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LOGERR_INFO        <span style="color: #993399">2</span>       <span style="font-style: italic"><span style="color: #9A1900">/* I: informational -vv */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> LOGERR_DEBUG       <span style="color: #993399">3</span>       <span style="font-style: italic"><span style="color: #9A1900">/* D: debug         -vvv */</span></span>

<span style="color: #009900">int</span> logerr_level <span style="color: #990000">=</span> LOGERR_WARN<span style="color: #990000">;</span>
</tt></pre></div></div>
<div class="paragraph"><p>Here,</p></div>
<div class="ulist"><ul>
<li>
<p>
This <code>logerr</code> macro is safe to use even after <code>if(...)</code>-construct.
</p>
</li>
<li>
<p>
The global variable <code>logerr_level</code> is used to control the logging threadshold of the <code>logerr</code> macro.
</p>
</li>
<li>
<p>
The <code>NLOGERR</code> macro controls deactivation of the <code>logerr</code> macro.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content"><code>do { ... ; } while(0)</code> is another construct frequently used in the macro definition to avoid breaking <code>if(...)</code>-construct.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">GNU extention form of the variadic macro "<code>, ##__VA_ARGS__</code>" is used in place of "<code>, __VA_ARGS__</code>" to deal with the case of zero extra argument.  See <a href="http://gcc.gnu.org/onlinedocs/cpp/Variadic-Macros.html">Variadic Macros</a>.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <code>cli-log.c</code> program logs an error message if the variable <code>DEBUG</code> is set or the <code>-v</code> option is used.</p></div>
<div class="listingblock">
<div class="title">Example of a C code <code>cli-log.c</code> with logging capability.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span> <span style="font-style: italic"><span style="color: #9A1900">/* getopt */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"logerr.h"</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> c<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> logerr_level <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #009900">char</span><span style="color: #990000">*</span> env_debug <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    env_debug <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"DEBUG"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>env_debug<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        logerr_level <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atoi</span></span><span style="color: #990000">(</span>env_debug<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">((</span>c <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">getopt</span></span><span style="color: #990000">(</span>argc<span style="color: #990000">,</span> argv<span style="color: #990000">,</span> <span style="color: #FF0000">"v"</span><span style="color: #990000">))</span> <span style="color: #990000">!=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>c<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #FF0000">'v'</span><span style="color: #990000">:</span>
            logerr_level <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
            <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #008080">        default:</span></span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"unknown option = %c = ascii(0%x)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                    optopt<span style="color: #990000">,</span> optopt<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"return value of getopt() = %c</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> c<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"logerr_level = %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> logerr_level<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>LOGERR_NOTICE<span style="color: #990000">,</span><span style="color: #FF0000">"optind = %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> optind<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>LOGERR_INFO<span style="color: #990000">,</span><span style="color: #FF0000">"argc = %i</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>LOGERR_DEBUG<span style="color: #990000">,</span><span style="color: #FF0000">"argv[0] = %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>optind <span style="color: #990000">+</span> <span style="color: #993399">2</span> <span style="color: #990000">==</span> argc<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s %s!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span>optind<span style="color: #990000">],</span> argv<span style="color: #990000">[</span>optind<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">logerr</span></span><span style="color: #990000">(</span>LOGERR_WARN<span style="color: #990000">,</span><span style="color: #FF0000">"%i arg(s) / 2 args needed</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argc <span style="color: #990000">-</span> optind<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Oops!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Compile and execution example with logging for a C code <code>cli-log.c</code>.</div>
<div class="content">
<pre><code>$ ./cli-log Hello
W: cli-log.c:33: 1 arg(s) / 2 args needed
logerr_level = 0
Oops!
$ ./cli-log Hello World
logerr_level = 0
Hello World!
$ ./cli-log -v Hello World
N: cli-log.c:27: optind = 2
logerr_level = 1
Hello World!
$ ./cli-log -vv Hello World
N: cli-log.c:27: optind = 2
I: cli-log.c:28: argc = 4
logerr_level = 2
Hello World!
$ ./cli-log -vvv Hello World
N: cli-log.c:27: optind = 2
I: cli-log.c:28: argc = 4
D: cli-log.c:29: argv[0] = ./cli-log
logerr_level = 3
Hello World!
$ ./cli-log -vvv Hello World EXT
N: cli-log.c:27: optind = 2
I: cli-log.c:28: argc = 5
D: cli-log.c:29: argv[0] = ./cli-log
W: cli-log.c:33: 3 arg(s) / 2 args needed
logerr_level = 3
Oops!
$ DEBUG=2 ./cli-log -v Hello World
N: cli-log.c:27: optind = 2
I: cli-log.c:28: argc = 4
D: cli-log.c:29: argv[0] = ./cli-log
logerr_level = 3
Hello World!</code></pre>
</div></div>
<div class="paragraph"><p>You can completely remove logging capability in compile time by defining the <code>NLOGERR</code> macro.</p></div>
<div class="listingblock">
<div class="title">Compile and execution example without logging for a C code <code>cli-log.c</code>.</div>
<div class="content">
<pre><code>$ DEBUG=3 ./cli-log-no -vvv Hello World
logerr_level = 6
Hello World!
$ DEBUG=3 ./cli-log-no -vvv Hello
logerr_level = 6
Oops!</code></pre>
</div></div>
<div class="paragraph"><p>If you have some logging lines which are only needed for testing phase, please
enclose them between a pair of macros such as <code>#ifdef TESTERRLOG</code> and <code>#endif</code>
and remove them with the <code>unifdef</code> command.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">For the serious logging, consider using <code>syslog</code>(3).</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_shell_assertion">Shell assertion</h3>
<div class="paragraph"><p>If you know something should not happen, test it to ensure it.</p></div>
<div class="paragraph"><p>The <code>cli-assert</code> program aborts with an error message if the first and the
second arguments do not match.</p></div>
<div class="listingblock">
<div class="title">Example of a shell code <code>cli-assert</code> with assertion.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-weight: bold"><span style="color: #000000">error ()</span></span>
{
    echo <span style="color: #FF0000">"$@"</span> <span style="color: #990000">&gt;&amp;</span><span style="color: #993399">2</span>
    <span style="font-weight: bold"><span style="color: #0000FF">exit</span></span> <span style="color: #993399">1</span>
}
<span style="color: #009900">FOO</span><span style="color: #990000">=</span><span style="color: #009900">$1</span>
<span style="color: #009900">BAR</span><span style="color: #990000">=</span><span style="color: #009900">$2</span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #990000">!</span> <span style="color: #FF0000">"$FOO"</span> <span style="color: #990000">=</span> <span style="color: #FF0000">"$BAR"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
    error <span style="color: #FF0000">"E: FOO and BAR do not match."</span>
<span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
echo <span style="color: #FF0000">"Input matches: $FOO = $BAR"</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution example with assertion for a shell code <code>cli-assert</code>.</div>
<div class="content">
<pre><code>Input matches: apple = apple
$ ./cli-assert apple orange
E: FOO and BAR do not match.</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_python_assertion">Python assertion</h3>
<div class="paragraph"><p>If you know something should not happen, test it to ensure it.</p></div>
<div class="paragraph"><p>The <code>cli-assert</code> program aborts with an error message if the first argument is
not a non-negative value.</p></div>
<div class="listingblock">
<div class="title">Example of a Python code <code>cli-assert</code> with assertion.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
    arg <span style="color: #990000">=</span> sys<span style="color: #990000">.</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">assert</span></span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>arg<span style="color: #990000">)</span> <span style="color: #990000">&gt;=</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #FF0000">"argument should be positive but "</span> <span style="color: #990000">+</span> arg
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"argument is "</span> <span style="color: #990000">+</span> arg<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Execution example with assertion for a Python code <code>cli-assert</code>.</div>
<div class="content">
<pre><code>argument is 1
$ ./cli-assert -1
Traceback (most recent call last):
  File "./cli-assert", line 9, in &lt;module&gt;
    main()
  File "./cli-assert", line 5, in main
    assert int(arg) &gt;= 0, "argument should be positive but " + arg
AssertionError: argument should be positive but -1</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c_assertion">C assertion</h3>
<div class="paragraph"><p>If assertion fails, the C <code>assert</code>(3) macro prints an error message to standard
error and terminates the program by calling abort(3).</p></div>
<div class="paragraph"><p>The <code>cli-assert.c</code> program aborts with an error message if the first and only argument is
not a non-negative value.</p></div>
<div class="listingblock">
<div class="title">Example of a C code <code>cli-assert.c</code> with assertion.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#include &lt;stdlib.h&gt;</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#include &lt;stdio.h&gt;</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#include &lt;assert.h&gt;</span></span>

int <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span>int argc<span style="color: #990000">,</span> char <span style="color: #990000">**</span>argv<span style="color: #990000">)</span>
<span style="color: #990000">{</span>
    int i<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">assert</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">assert</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">==</span> NULL<span style="color: #990000">);</span>
    i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atoi</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">assert</span></span><span style="color: #990000">(</span>i <span style="color: #990000">&gt;=</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">&gt;=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #990000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Argument is a single non-negative value: %i\n"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
    <span style="color: #990000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #990000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Compile and execution example with assertion for a C code <code>cli-assert.c</code>.</div>
<div class="content">
<pre><code>$ ./cli-assert 1
Argument is a single non-negative value: 1
$ ./cli-assert -1
cli-assert: cli-assert.c:11: main: Assertion `i &gt;= 0' failed.
Aborted
$ ./cli-assert
cli-assert: cli-assert.c:8: main: Assertion `argv[1] != ((void *)0)' failed.
Aborted
$ ./cli-assert 1 2
cli-assert: cli-assert.c:9: main: Assertion `argv[2] == ((void *)0)' failed.
Aborted</code></pre>
</div></div>
<div class="paragraph"><p>As for "core dumped", please see <a href="#_core_dump">ELF: Core dump</a>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Never call an expression with side effects as the argument of the C
<code>assert</code>(3) macro if those side effects are essential.  This is because the C
<code>assert</code>(3) macro may be disabled by defining the macro <code>NDEBUG</code> for the
production code and the argument may never be executed when it is needed.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content"><a href="http://lists.debian.org/20771.43161.813488.58458@chiark.greenend.org.uk">Ian Jackson</a>
said "<code>-DNDEBUG</code> is (normally) Evil, Bad and Wrong. &#8230; you shouldn&#8217;t set it.
Even if upstream specify it it can be right to remove it."</td>
</tr></table>
</div>
<div class="paragraph"><p>You can completely remove assertion capability in compile time by defining the <code>NDEBUG</code> macro.</p></div>
<div class="listingblock">
<div class="title">Compile and execution example without asserion for a C code <code>cli-assert.c</code>.</div>
<div class="content">
<pre><code>$ ./cli-assert-no 1
Argument is a single non-negative value: 1
$ ./cli-assert-no -1</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_level_2">Debug: level 2</h2>
<div class="sectionbody">
<div class="paragraph"><p>Tracing program execution to understand the general behavior of the program is
the major part of debugging.</p></div>
<div class="paragraph"><p>There are several ways to trace programs non-interactively without any modifications to the source.</p></div>
<div class="sect2">
<h3 id="_sh_x">sh -x</h3>
<div class="paragraph"><p>All POSIX shell like shells (Bash, Pdksh, Dash, &#8230;) support the <code>-x</code> option to turn on the automatic tracing of the command execution.</p></div>
<div class="paragraph"><p>---
 $ sh -x program.sh
---</p></div>
<div class="paragraph"><p>The tracing of the command execution can be truned on and off by the "<code>set -x</code>" and "<code>set +x</code>" commands, too.</p></div>
</div>
<div class="sect2">
<h3 id="_perl_d_trace">perl -d:Trace</h3>
<div class="paragraph"><p>All Perl scripts can be traced automatically.</p></div>
<div class="paragraph"><p>---
 $ sudo apt-get install libdevel-trace-perl
 $ perl -x program.pl
---</p></div>
<div class="paragraph"><p>The tracing of the command execution can be truned on and off by the "<code>$Devel::Trace::TRACE = 1;</code>" and "<code>$Devel::Trace::TRACE = 0;</code>" commands, too.</p></div>
</div>
<div class="sect2">
<h3 id="_python_m_trace">python -m trace</h3>
<div class="paragraph"><p>All Python scripts can be traced automatically.</p></div>
<div class="paragraph"><p>---
 $ python -m trace --count -C . program.py
---</p></div>
<div class="paragraph"><p>See the <a href="https://docs.python.org/3/library/trace.html">trace</a> module.</p></div>
</div>
<div class="sect2">
<h3 id="_strace">strace</h3>
<div class="paragraph"><p>This is very effective tools to investigate what a program does without
reading its full source at the system calll level.</p></div>
<div class="paragraph"><p>Let&#8217;s investigate how the <code>hello-gdb</code> ELF binary
(see <a href="#_compile_hello_gdb">ELF: Compile hello-gdb</a>) is executed.</p></div>
<div class="paragraph"><p>The trace of the system call is obtained with <code>strace</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>execve("./hello-gdb", ["./hello-gdb"], [/* 62 vars */]) = 0
brk(0)                                  = 0x1799000
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0
4d5919000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=165034, ...}) = 0
mmap(NULL, 165034, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f04d58f0000
close(3)                                = 0
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0P\34\2\0\0\0\0\0"..., 832
) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=1729984, ...}) = 0
mmap(NULL, 3836448, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f
04d5352000
mprotect(0x7f04d54f1000, 2097152, PROT_NONE) = 0
mmap(0x7f04d56f1000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENY
WRITE, 3, 0x19f000) = 0x7f04d56f1000
mmap(0x7f04d56f7000, 14880, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANON
YMOUS, -1, 0) = 0x7f04d56f7000
close(3)                                = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0
4d58ef000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0
4d58ee000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0
4d58ed000
arch_prctl(ARCH_SET_FS, 0x7f04d58ee700) = 0
mprotect(0x7f04d56f1000, 16384, PROT_READ) = 0
mprotect(0x7f04d591b000, 4096, PROT_READ) = 0
munmap(0x7f04d58f0000, 165034)          = 0
fstat(1, {st_mode=S_IFIFO|0600, st_size=0, ...}) = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0
4d5918000
write(1, "Hello, world!\n", 14Hello, world!
)         = 14
exit_group(0)                           = ?
+++ exited with 0 +++</code></pre>
</div></div>
<div class="paragraph"><p>This can get too big to read.</p></div>
<div class="paragraph"><p>The statistics of the system call is obtained with <code>strace -c</code> to get the big picture.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Hello, world!
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
  0.00    0.000000           0         1           read
  0.00    0.000000           0         1           write
  0.00    0.000000           0         2           open
  0.00    0.000000           0         2           close
  0.00    0.000000           0         3           fstat
  0.00    0.000000           0         9           mmap
  0.00    0.000000           0         3           mprotect
  0.00    0.000000           0         1           munmap
  0.00    0.000000           0         1           brk
  0.00    0.000000           0         3         3 access
  0.00    0.000000           0         1           execve
  0.00    0.000000           0         1           arch_prctl
------ ----------- ----------- --------- --------- ----------------
100.00    0.000000                    28         3 total</code></pre>
</div></div>
<div class="paragraph"><p>Now you know which system calls to trace, use <code>strace -e trace=...</code>.  For
example what files are accessed can be done just tracing <code>open</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
open("/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
Hello, world!
+++ exited with 0 +++</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_ltrace">ltrace</h3>
<div class="paragraph"><p>This is very effective tools to investigate what a program does without
reading its full source at the library call level.</p></div>
<div class="paragraph"><p>Let&#8217;s investigate how the <code>hello-gdb</code> ELF binary
(see <a href="#_compile_hello_gdb">ELF: Compile hello-gdb</a>) is executed from a different angle.</p></div>
<div class="paragraph"><p>The trace of the library call is obtained with <code>ltrace</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/path/to/c/../../bin/p: 1: eval: ltrace: not found</code></pre>
</div></div>
<div class="paragraph"><p>The statistics of the library call is obtained with <code>ltrace -c</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>/path/to/c/../../bin/p: 1: eval: ltrace: not found</code></pre>
</div></div>
<div class="paragraph"><p>But the use of <code>ltrace</code> slows down program execution significantly for some
case.  Use it carefully.</p></div>
<div class="paragraph"><p>Here are some similar tracing programs.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>xtrace</code> package: trace communication between X client and server
</p>
</li>
<li>
<p>
<code>latrace</code> package: traces library calls in dynamically linked programs with LD_AUDIT feature
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_level_3">Debug: level 3</h2>
<div class="sectionbody">
<div class="paragraph"><p>The GNU debugger (GDB) make you look into binary programs.</p></div>
<div class="paragraph"><p>If you do not mind reading the code in the assembler, no source code is required.</p></div>
<div class="paragraph"><p>The GDB works even better if the program is compiled with the <code>-g</code> option and
the source code is kept in place on the same machine after the compilation with
the <code>-g</code> option.  See <a href="#_compile_hello_gdb">ELF: Compile hello-gdb</a>.</p></div>
<div class="sect2">
<h3 id="_gdb_commands">GDB commands</h3>
<div class="paragraph"><p>Please have <a href="http://users.ece.utexas.edu/~adnan/gdb-refcard.pdf">GDB QUICK REFERENCE</a> with you.</p></div>
<div class="paragraph"><p>Here are some basic GDB commands.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="11%" />
<col width="55%" />
<thead>
<tr>
<th align="left" valign="top">command                </th>
<th align="left" valign="top">alias  </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>help COMMAND</code></p></td>
<td align="left" valign="top"><p class="table"><code>h</code></p></td>
<td align="left" valign="top"><p class="table">Print help for <code>COMMAND</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>file FILE</code></p></td>
<td align="left" valign="top"><p class="table"><code>fil</code></p></td>
<td align="left" valign="top"><p class="table">Use <code>FILE</code> as the program to be debugged.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>set VAR = EXP</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Evaluate <code>EXP</code> and assign its result to <code>VAR</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>show VAR</code></p></td>
<td align="left" valign="top"><p class="table"><code>sho</code></p></td>
<td align="left" valign="top"><p class="table">Show <code>VAR</code> contents.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>set trace-commands on|off</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Set/reset tracing of GDB CLI commands</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>set substitute-path FROM TO</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Set a substitution rule replacing <code>FROM</code> into <code>TO</code> in source file paths. (<code>unset ...</code>)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>set args ARGS</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Set command arguments <code>ARGS</code> to be used when GDB runs a program to be debugged.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>set env VAR VALUE</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Set environment variable <code>VAR</code> to <code>VALUE</code>. (<code>unset ...</code>)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>directory DIR ...</code></p></td>
<td align="left" valign="top"><p class="table"><code>dir</code></p></td>
<td align="left" valign="top"><p class="table">Add <code>DIR</code> to the search path for source files (<code>:</code> separated). Reset the search path to the default, if invoked without <code>DIR</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>run</code></p></td>
<td align="left" valign="top"><p class="table"><code>r</code></p></td>
<td align="left" valign="top"><p class="table">Start debugged program.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>run ARGS</code></p></td>
<td align="left" valign="top"><p class="table"><code>r</code></p></td>
<td align="left" valign="top"><p class="table">Start debugged program with its command arguments <code>ARGS</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>start</code></p></td>
<td align="left" valign="top"><p class="table"><code>star</code></p></td>
<td align="left" valign="top"><p class="table">Run the debugged program like <code>run</code> but stop at the beginning of <code>main</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>cont</code></p></td>
<td align="left" valign="top"><p class="table"><code>c</code></p></td>
<td align="left" valign="top"><p class="table">Resume execution, after signal or breakpoint.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>next</code></p></td>
<td align="left" valign="top"><p class="table"><code>n</code></p></td>
<td align="left" valign="top"><p class="table">Step to the next source code line (proceed through soubroutine call)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>nexti</code></p></td>
<td align="left" valign="top"><p class="table"><code>ni</code></p></td>
<td align="left" valign="top"><p class="table">Step to the next instruction line (proceed through soubroutine call)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>step</code></p></td>
<td align="left" valign="top"><p class="table"><code>s</code></p></td>
<td align="left" valign="top"><p class="table">Step one source code line, step into subroutine call as needed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>stepi</code></p></td>
<td align="left" valign="top"><p class="table"><code>si</code></p></td>
<td align="left" valign="top"><p class="table">Step one instruction line, step into subroutine call as needed.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>finish</code></p></td>
<td align="left" valign="top"><p class="table"><code>fin</code></p></td>
<td align="left" valign="top"><p class="table">Execute until selected stack frame returns.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>until</code></p></td>
<td align="left" valign="top"><p class="table"><code>u</code></p></td>
<td align="left" valign="top"><p class="table">Execute until the program reaches a source line greater than the current or a specified location within the current frame.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>kill</code></p></td>
<td align="left" valign="top"><p class="table"><code>k</code></p></td>
<td align="left" valign="top"><p class="table">Kill execution of program being debugged.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>quit</code></p></td>
<td align="left" valign="top"><p class="table"><code>q</code></p></td>
<td align="left" valign="top"><p class="table">Exit "<code>gdb</code>".</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>break [FILE:]LINE</code></p></td>
<td align="left" valign="top"><p class="table"><code>b</code></p></td>
<td align="left" valign="top"><p class="table">Set breakpoint at <code>LINE</code> [of <code>FUNCTION</code>].</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>break [FILE:]LINE if COND</code></p></td>
<td align="left" valign="top"><p class="table"><code>b</code></p></td>
<td align="left" valign="top"><p class="table">Set breakpoint at <code>LINE</code> [of <code>FUNCTION</code>] which breaks only if <code>COND</code> is true.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>break * ADDRESS</code></p></td>
<td align="left" valign="top"><p class="table"><code>b</code></p></td>
<td align="left" valign="top"><p class="table">Set breakpoint at <code>ADDRESS</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info break</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">Status of specified breakpoints (all user-settable breakpoints if no argument).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>condition N COND</code></p></td>
<td align="left" valign="top"><p class="table"><code>cond</code></p></td>
<td align="left" valign="top"><p class="table">Specify breakpoint number <code>N</code> to break only if <code>COND</code> is true.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>tbreak [FILE:]LINE</code></p></td>
<td align="left" valign="top"><p class="table"><code>tb</code></p></td>
<td align="left" valign="top"><p class="table">Set a temporary breakpoint at <code>LINE</code> [of <code>FUNCTION</code>].</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>rbreak REGEXP</code></p></td>
<td align="left" valign="top"><p class="table"><code>rb</code></p></td>
<td align="left" valign="top"><p class="table">Set a breakpoint for all functions matching <code>REGEXP</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>clear</code></p></td>
<td align="left" valign="top"><p class="table"><code>cl</code></p></td>
<td align="left" valign="top"><p class="table">Clear breakpoint at specified line or function.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>delete</code></p></td>
<td align="left" valign="top"><p class="table"><code>d</code></p></td>
<td align="left" valign="top"><p class="table">Delete some breakpoints or auto-display expressions.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>enable</code></p></td>
<td align="left" valign="top"><p class="table"><code>en</code></p></td>
<td align="left" valign="top"><p class="table">Enable some breakpoints.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>disable</code></p></td>
<td align="left" valign="top"><p class="table"><code>dis</code></p></td>
<td align="left" valign="top"><p class="table">Disable some breakpoints.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>define NAME</code></p></td>
<td align="left" valign="top"><p class="table"><code>def</code></p></td>
<td align="left" valign="top"><p class="table">Define a new command NAME. End with a <code>end</code> line.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>command N</code></p></td>
<td align="left" valign="top"><p class="table"><code>comm</code></p></td>
<td align="left" valign="top"><p class="table">Set commands to be executed when a breakpoint N is hit. End with a <code>end</code> line.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>ignore N COUNT</code></p></td>
<td align="left" valign="top"><p class="table"><code>ig</code></p></td>
<td align="left" valign="top"><p class="table">Set ignore-count of breakpoint number <code>N</code> to <code>COUNT</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>signal NUM</code></p></td>
<td align="left" valign="top"><p class="table"><code>sig</code></p></td>
<td align="left" valign="top"><p class="table">Resume execution with signal <code>NUM</code>. (without signal if "0")</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>catch EVENT</code></p></td>
<td align="left" valign="top"><p class="table"><code>cat</code></p></td>
<td align="left" valign="top"><p class="table">Set catchpoints to catch <code>EVENT</code>(assert catch exception exec fork syscall throw vfork).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info catch</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">Exceptions that can be caught in the current stack frame</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>trace [FILE:]LINE</code></p></td>
<td align="left" valign="top"><p class="table"><code>tr</code></p></td>
<td align="left" valign="top"><p class="table">Set a tracepoint at <code>LINE</code> [of <code>FUNCTION</code>].</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info trace</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">Specified watchpoints (all watchpoints if no argument).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>watch EXP</code></p></td>
<td align="left" valign="top"><p class="table"><code>wa</code></p></td>
<td align="left" valign="top"><p class="table">Stop execution whenever the value of an <code>EXP</code> changes. If <code>-l</code> is given, the value of a <code>*(EXP)</code> changes.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info watch</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">Specified watchpoints (all watchpoints if no argument).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>list</code></p></td>
<td align="left" valign="top"><p class="table"><code>l</code></p></td>
<td align="left" valign="top"><p class="table">List ten more lines after or around previous listing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>list -</code></p></td>
<td align="left" valign="top"><p class="table"><code>l</code></p></td>
<td align="left" valign="top"><p class="table">List the ten lines before a previous ten-line listing.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>list FROM[,TO]</code></p></td>
<td align="left" valign="top"><p class="table"><code>l</code></p></td>
<td align="left" valign="top"><p class="table">List specified function or line.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>disassemble</code></p></td>
<td align="left" valign="top"><p class="table"><code>disas</code></p></td>
<td align="left" valign="top"><p class="table">Disassemble a specified section of memory.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>disassemble/m</code></p></td>
<td align="left" valign="top"><p class="table"><code>disas</code></p></td>
<td align="left" valign="top"><p class="table">Disassemble a specified section of memory with source lines (if available). (m: more code)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>disassemble/r</code></p></td>
<td align="left" valign="top"><p class="table"><code>disas</code></p></td>
<td align="left" valign="top"><p class="table">Disassemble a specified section of memory with raw instructions in hex. (r: raw code)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">Generic command for showing things about the program being debugged.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info all-reg</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">List of all registers and their contents, for selected stack frame.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info locales</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">List of local variables of current stack frame.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info reg</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">List of integer registers and their contents, for selected stack frame.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>print EXP</code></p></td>
<td align="left" valign="top"><p class="table"><code>p</code></p></td>
<td align="left" valign="top"><p class="table">Print value of expression <code>EXP</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>print/F EXP</code></p></td>
<td align="left" valign="top"><p class="table"><code>p</code></p></td>
<td align="left" valign="top"><p class="table">Print value of expression <code>EXP</code> with <code>F</code> format.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>printf "FMT", EXP, ...</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Print value of expression <code>EXP, ...</code> with C-style FMT.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>print-object</code></p></td>
<td align="left" valign="top"><p class="table"><code>po</code></p></td>
<td align="left" valign="top"><p class="table">Ask an Objective-C object to print itself.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>call FUNC</code></p></td>
<td align="left" valign="top"><p class="table"><code>cal</code></p></td>
<td align="left" valign="top"><p class="table">Call a function <code>FUNC</code> in the program and print its result.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>call/F FUNC</code></p></td>
<td align="left" valign="top"><p class="table"><code>cal</code></p></td>
<td align="left" valign="top"><p class="table">Call a function <code>FUNC</code> in the program and print its result with <code>F</code> format.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>ptype TYPE</code></p></td>
<td align="left" valign="top"><p class="table"><code>pt</code></p></td>
<td align="left" valign="top"><p class="table">Print definition of type <code>TYPE</code>. (unrolls any typedefs)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>whatis EXP</code></p></td>
<td align="left" valign="top"><p class="table"><code>wha</code></p></td>
<td align="left" valign="top"><p class="table">Print data type of expression <code>EXP</code>. (Only one level of typedefs is unrolled.)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>x/NFU</code></p></td>
<td align="left" valign="top"><p class="table"><code>x</code></p></td>
<td align="left" valign="top"><p class="table">Examine memory, <code>N</code> data with <code>F</code> format in <code>U</code> unit</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>backtrace</code></p></td>
<td align="left" valign="top"><p class="table"><code>bt</code></p></td>
<td align="left" valign="top"><p class="table">Print backtrace of all stack frames, or innermost <code>COUNT</code> frames. (<code>where</code> == <code>bt</code>)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>backtrace full</code></p></td>
<td align="left" valign="top"><p class="table"><code>bt f</code></p></td>
<td align="left" valign="top"><p class="table">Print backtrace of all stack frames and the values of the local variables.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>frame</code></p></td>
<td align="left" valign="top"><p class="table"><code>f</code></p></td>
<td align="left" valign="top"><p class="table">Select and print a stack frame.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>down</code></p></td>
<td align="left" valign="top"><p class="table"><code>do</code></p></td>
<td align="left" valign="top"><p class="table">Select and print stack frame called by this one.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>up</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Select and print stack frame that called this one.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>attach PID</code></p></td>
<td align="left" valign="top"><p class="table"><code>at</code></p></td>
<td align="left" valign="top"><p class="table">Attach to a <code>PID</code> process outside of GDB.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>detach</code></p></td>
<td align="left" valign="top"><p class="table"><code>det</code></p></td>
<td align="left" valign="top"><p class="table">Detach a process or file previously attached to GDB.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>target</code></p></td>
<td align="left" valign="top"><p class="table"><code>tar</code></p></td>
<td align="left" valign="top"><p class="table">Connect to a target machine or process.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>overlay</code></p></td>
<td align="left" valign="top"><p class="table"><code>ov</code></p></td>
<td align="left" valign="top"><p class="table">Commands for debugging overlays.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>thread N</code></p></td>
<td align="left" valign="top"><p class="table"><code>t</code></p></td>
<td align="left" valign="top"><p class="table">Switch to the thread number <code>N</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>thread apply N COMMAND</code></p></td>
<td align="left" valign="top"><p class="table"><code>t a</code></p></td>
<td align="left" valign="top"><p class="table">Apply a <code>COMMAND</code> to the thread number <code>N</code>.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>thread apply all COMMAND</code></p></td>
<td align="left" valign="top"><p class="table"><code>t a a</code></p></td>
<td align="left" valign="top"><p class="table">Apply a <code>COMMAND</code> to all threads.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>thread apply all bt full</code></p></td>
<td align="left" valign="top"><p class="table"><code>t a a bt f</code></p></td>
<td align="left" valign="top"><p class="table">Apply <code>bt full</code> to all threads.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info thread</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">List of information on all currently known threads.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>advance</code></p></td>
<td align="left" valign="top"><p class="table"><code>adv</code></p></td>
<td align="left" valign="top"><p class="table">Continue the program up to the specified line or function.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>go</code></p></td>
<td align="left" valign="top"><p class="table"><code>g</code></p></td>
<td align="left" valign="top"><p class="table">Go to an earlier-bookmarked point in the program&#8217;s execution history.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>jump</code></p></td>
<td align="left" valign="top"><p class="table"><code>ju</code></p></td>
<td align="left" valign="top"><p class="table">Continue program being debugged at specified line or address.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>generate-core-file</code></p></td>
<td align="left" valign="top"><p class="table"><code>gcore</code></p></td>
<td align="left" valign="top"><p class="table">Save a core file with the current state of the debugged process.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>shell</code></p></td>
<td align="left" valign="top"><p class="table"><code>!</code></p></td>
<td align="left" valign="top"><p class="table">Execute the rest of the line as a shell command.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>cd DIR</code></p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">Set working directory to <code>DIR</code> for debugger and program being debugged.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>make</code></p></td>
<td align="left" valign="top"><p class="table"><code>mak</code></p></td>
<td align="left" valign="top"><p class="table">Run the "<code>make</code>" program using the rest of the line as arguments.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>pwd</code></p></td>
<td align="left" valign="top"><p class="table"><code>pw</code></p></td>
<td align="left" valign="top"><p class="table">Print working directory.  This is used for your program as well.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>focus</code></p></td>
<td align="left" valign="top"><p class="table"><code>fs</code></p></td>
<td align="left" valign="top"><p class="table">Set focus to the next/prev/src/asm/regs/cmd window. (TUI)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>layout</code></p></td>
<td align="left" valign="top"><p class="table"><code>lo</code></p></td>
<td align="left" valign="top"><p class="table">Change the layout of windows to next/prev/src/asm/split/regs. (TUI)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>info win</code></p></td>
<td align="left" valign="top"><p class="table"><code>i</code></p></td>
<td align="left" valign="top"><p class="table">List of all displayed windows. (TUI)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>winheight W [+|-] VAL</code></p></td>
<td align="left" valign="top"><p class="table"><code>wh</code></p></td>
<td align="left" valign="top"><p class="table">Set the height of a window, W=src/cmd/asm/regs. (TUI)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Formating option <code>F</code> is used with <code>call/F</code>, <code>print/F</code> and <code>x/NFU</code> sequences:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>a</code> address
</p>
</li>
<li>
<p>
<code>c</code> char
</p>
</li>
<li>
<p>
<code>d</code> decimal
</p>
</li>
<li>
<p>
<code>f</code> floating point
</p>
</li>
<li>
<p>
<code>i</code> machine instruction (<code>x</code> command only)
</p>
</li>
<li>
<p>
<code>o</code> octal
</p>
</li>
<li>
<p>
<code>r</code> raw
</p>
</li>
<li>
<p>
<code>s</code> string (<code>x</code> command only)
</p>
</li>
<li>
<p>
<code>t</code> binary(radix two)
</p>
</li>
<li>
<p>
<code>u</code> unsigned decimal
</p>
</li>
<li>
<p>
<code>x</code> hexadecimal
</p>
</li>
</ul></div>
<div class="paragraph"><p>Unit is used with <code>x/NFU</code> sequence:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>b</code> byte
</p>
</li>
<li>
<p>
<code>h</code> half word (2 bytes)
</p>
</li>
<li>
<p>
<code>w</code> word (4 bytes)
</p>
</li>
<li>
<p>
<code>g</code> giant word (8 bytes)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Initialization files:</p></div>
<div class="ulist"><ul>
<li>
<p>
System-wide init file: <code>/etc/gdb/gdbinit</code>
</p>
</li>
<li>
<p>
User provided init files: <code>~/.gdbinit</code> &#8594; <code>./.gdbinit</code>
</p>
</li>
<li>
<p>
<code>-x</code> and <code>-nx</code> options disable default init files.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use the "Return"-key to repeat the last command.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_detached_debugging_symbols">Detached debugging symbols</h3>
<div class="paragraph"><p>The Debian system provided library packages have no debugging symbols in them.</p></div>
<div class="paragraph"><p>The <code>dh_strip</code>(1) is normally used to strip executables, shared libraries, and
some static libraries in those packages.</p></div>
<div class="paragraph"><p>The <code>dh_strip</code>(1) is also used to generate a separate *-dbg package with
"<code>dh_strip --dbg-package=foo-dbg</code>". Newer debhelper(compat&gt;=9) stores its result into a file path based on the build ID.</p></div>
<div class="paragraph"><p>The low level operation to enable detached debugging symbols is described in
the <code>objcopy</code>(1) manpage under "<code>--only-keep-debug</code>" and
"<code>--add-gnu-debuglink</code>".  (You can strip binary with the <code>strip</code>(1) command,
too.)</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 12. Examples for the path to the key file of library and its debugging symbols</caption>
<col width="18%" />
<col width="18%" />
<col width="62%" />
<thead>
<tr>
<th align="left" valign="top">package type </th>
<th align="left" valign="top">package name </th>
<th align="left" valign="top">path to the key file</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">library</p></td>
<td align="left" valign="top"><p class="table"><code>libfoo</code></p></td>
<td align="left" valign="top"><p class="table"><code>/usr/lib/x86_64-linux-gnu/libfoo.so</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">debug symbols (compat&lt;9)</p></td>
<td align="left" valign="top"><p class="table"><code>libfoo-dbg</code></p></td>
<td align="left" valign="top"><p class="table"><code>/usr/lib/debug/lib/x86_64-linux-gnu/libfoo.so</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">debug symbols (compat&gt;=9)</p></td>
<td align="left" valign="top"><p class="table"><code>libfoo-dbg</code></p></td>
<td align="left" valign="top"><p class="table"><code>/usr/lib/debug/lib/.build-id/</code><em>23/c2d7045a2c9d07ceae6b1d056af60adfb0f8e3</em><code>.debug</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>When ever GDB executes a function in the stripped library
<code>/usr/lib/x86_64-linux-gnu/libfoo.so</code> file, GDB shipped with Debian obtains its
debugging symbols from the <code>/usr/lib/debug/lib/x86_64-linux-gnu/libfoo.so</code>
file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Debian wanted to strip debug symbols from the shipped binary packages
while FSF wished to keep them.  This was one of the reason for Debian to become
independent of FSF.  Now we have detached debugging symbol packages which
solves this difference. See <a href="http://debconf6.debconf.org/comas/general/proposals/64.html">Debian&#8217;s Debugging Debacle: the Debrief</a>.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_source_file_path">Source file path</h3>
<div class="paragraph"><p>GDB also use the corresponding C source file path and C source line information
stored in the ELF file as described in <a href="#_readelf_wl">ELF: readelf -wL</a> to
display them at the proper address.</p></div>
<div class="paragraph"><p>GDB searches file, e.g., <code>foo.c</code> as follows without recursion:</p></div>
<div class="ulist"><ul>
<li>
<p>
Exactly <code>foo.c</code> in the current working directory.
</p>
</li>
<li>
<p>
Some file location based on the file location recorded in the ELF file and the <strong>substitution rule</strong>.
</p>
<div class="ulist"><ul>
<li>
<p>
Exactly <code>/usr/src/foo-1.0/lib/foo.c</code> as recorded in the ELF file. (default)
</p>
</li>
<li>
<p>
Exactly <code>/home/bar/foo-1.0/lib/foo.c</code> with "<code>set substitute-path /usr/src /home/bar</code>".
</p>
</li>
</ul></div>
</li>
<li>
<p>
Exactly <code>/mnt/cross/foo.c</code> if the source path is set to <code>/mnt/cross</code>.
</p>
<div class="ulist"><ul>
<li>
<p>
GDB command prompt: "<code>directory /mnt/cross</code>" (<code>:</code> separated list possible)
</p>
</li>
<li>
<p>
GDB command argument: "<code>gdb -d /mnt/cross</code>" (multiple <code>-d</code> options possible)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>If you are debugging a locally compiled binary, the C source file path stored in
the ELF and the actual C source file path should match.  So GDB should have no difficulty
finding them.</p></div>
<div class="paragraph"><p>If you are debugging a packaged binary, you should obtain its corresponding
source package and expand it into a source tree, first.  For this case, the C
source file path stored in the compiled ELF and the actual C source file path
on your system should be different but most likely should share taling portion
of the path.</p></div>
<div class="paragraph"><p>Use of the <strong>substitution rule</strong> is usually the wise choice and the most
elegant one.  But sometimes, it may be required to use a brute force approach:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ gdb $(find src_path -type d -printf '-d %p ') prog</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_gdb_hello_gdb">gdb hello-gdb</h3>
<div class="paragraph"><p>Here we practice to walk through a program <code>hello-gdb</code> with GDB.</p></div>
<div class="paragraph"><p>Let&#8217;s start loading <code>hello-gdb</code> ELF binary generated by GCC with the <code>-g</code>
option in <a href="#_compile_hello_gdb">ELF: Compile hello-gdb</a> to GDB.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>GNU gdb (Debian 7.7.1+dfsg-5) 7.7.1
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from hello-gdb...done.</code></pre>
</div></div>
<div class="paragraph"><p>Now you are at a interactive GDB prompt with <code>(gdb)</code>.</p></div>
<div class="paragraph"><p>Let&#8217;s set up several breakpoints.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) list
1    #include &lt;stdio.h&gt;
2    #include &lt;stdlib.h&gt;
3    /* my first C program */
4    int main()
5    {
6        printf("Hello, world!\n");
7        return EXIT_SUCCESS;
8    }
(gdb) break 3
Breakpoint 1 at 0x40050a: file hello.c, line 3.
(gdb) break 5
Breakpoint 2 at 0x40050a: file hello.c, line 5.
(gdb) break 6
Breakpoint 3 at 0x40050a: file hello.c, line 6.
(gdb) info break
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x000000000040050a in main at hello.c:3
2       breakpoint     keep y   0x000000000040050a in main at hello.c:5
3       breakpoint     keep y   0x000000000040050a in main at hello.c:6</code></pre>
</div></div>
<div class="paragraph"><p>As you see, not all C source lines translate to independent lines.  Breakpoint 3 and 5 stops at the same address.</p></div>
<div class="paragraph"><p>Let&#8217;s run program while stopping at line 3, 5 , and 6.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) run

Breakpoint 1, main () at hello.c:6
6        printf("Hello, world!\n");
(gdb) cont
Hello, world!
[Inferior 1 (process 2661) exited normally]
(gdb) quit
$</code></pre>
</div></div>
<div class="paragraph"><p>Here "inferior" is an object generated by GDB to represent the state of each
program and typically corresponds to a process but more general.</p></div>
<div class="paragraph"><p>Let&#8217;s start again.</p></div>
<div class="ulist"><ul>
<li>
<p>
make sure to install the <code>libc6-dbg:amd64</code> package containing "Embedded GNU C Library: detached debugging symbols".
</p>
</li>
<li>
<p>
start GDB less noisily with the <code>-q</code> option.
</p>
</li>
<li>
<p>
list source in the assembly code in various ways.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name           Version      Architecture Description
+++-==============-============-============-=================================
ii  libc6-dbg:amd6 2.19-18      amd64        GNU C Library: detached debugging
$ gdb -q hello-gdb
(gdb) list
1    #include &lt;stdio.h&gt;
2    #include &lt;stdlib.h&gt;
3    /* my first C program */
4    int main()
5    {
6        printf("Hello, world!\n");
7        return EXIT_SUCCESS;
8    }
(gdb) disas main
Dump of assembler code for function main:
   0x0000000000400506 &lt;+0&gt;:    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    mov    %rsp,%rbp
   0x000000000040050a &lt;+4&gt;:    mov    $0x4005a4,%edi
   0x000000000040050f &lt;+9&gt;:    callq  0x4003e0 &lt;puts@plt&gt;
   0x0000000000400514 &lt;+14&gt;:    mov    $0x0,%eax
   0x0000000000400519 &lt;+19&gt;:    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    retq
End of assembler dump.
(gdb) disas/m main
Dump of assembler code for function main:
5    {
   0x0000000000400506 &lt;+0&gt;:    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    mov    %rsp,%rbp

6        printf("Hello, world!\n");
   0x000000000040050a &lt;+4&gt;:    mov    $0x4005a4,%edi
   0x000000000040050f &lt;+9&gt;:    callq  0x4003e0 &lt;puts@plt&gt;

7        return EXIT_SUCCESS;
   0x0000000000400514 &lt;+14&gt;:    mov    $0x0,%eax

8    }
   0x0000000000400519 &lt;+19&gt;:    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    retq

End of assembler dump.
(gdb) disas/r main
Dump of assembler code for function main:
   0x0000000000400506 &lt;+0&gt;:    55    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    48 89 e5    mov    %rsp,%rbp
   0x000000000040050a &lt;+4&gt;:    bf a4 05 40 00    mov    $0x4005a4,%edi
   0x000000000040050f &lt;+9&gt;:    e8 cc fe ff ff    callq  0x4003e0 &lt;puts@plt&gt;
   0x0000000000400514 &lt;+14&gt;:    b8 00 00 00 00    mov    $0x0,%eax
   0x0000000000400519 &lt;+19&gt;:    5d    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    c3    retq
End of assembler dump.</code></pre>
</div></div>
<div class="paragraph"><p>For GDB, just typing <code>disas</code> is as good as typing <code>disassemble</code>.</p></div>
<div class="paragraph"><p>GDB also supports TAB completion to expand <code>disas</code>+TAB into <code>disassemble</code>.</p></div>
<div class="paragraph"><p>It is quite ammusing to see some hex codes such as <code>c3</code> (ASCII character "]")
in <code>amd64</code> which are the same ones as <code>i386</code> with the same meaning "return from
a function".</p></div>
<div class="paragraph"><p>Let&#8217;s read the assembler code here.  The <code>%rdi</code> register holds the 1st function
argument passed to the <code>puts</code> function according to the ABI described in
<a href="#_assembler_code">GCC: Assembler code</a>.  Its value is set to 0x40067c.</p></div>
<div class="paragraph"><p>Let&#8217;s see what is there using the examine memory command for string.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) x/s 0x40067c
0x40067c:    "d"
(gdb) x/14x 0x40067c
0x40067c:    0x64    0x00    0x00    0x00    0xa0    0xfe    0xff    0xff
0x400684:    0x65    0x00    0x00    0x00    0x00    0x42</code></pre>
</div></div>
<div class="paragraph"><p>OK. This memory data matches the original C function definition.</p></div>
<div class="paragraph"><p>Let&#8217;s trace program execution a bit slowly this time.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) start
Temporary breakpoint 1 at 0x40050a: file hello.c, line 6.

Temporary breakpoint 1, main () at hello.c:6
6        printf("Hello, world!\n");
(gdb) disas/m
Dump of assembler code for function main:
5    {
   0x0000000000400506 &lt;+0&gt;:    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    mov    %rsp,%rbp

6        printf("Hello, world!\n");
=&gt; 0x000000000040050a &lt;+4&gt;:    mov    $0x4005a4,%edi
   0x000000000040050f &lt;+9&gt;:    callq  0x4003e0 &lt;puts@plt&gt;

7        return EXIT_SUCCESS;
   0x0000000000400514 &lt;+14&gt;:    mov    $0x0,%eax

8    }
   0x0000000000400519 &lt;+19&gt;:    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    retq

End of assembler dump.</code></pre>
</div></div>
<div class="paragraph"><p>You are at the start of the <code>main</code> function.</p></div>
<div class="paragraph"><p>There are few basic stepping commands to walk through program with GDB.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <code>next</code> command goes to the next line in the C source without stepping into
the child function.
</p>
</li>
<li>
<p>
The <code>step</code> command goes to the next line in the C source possibly stepping into
the child function.
</p>
</li>
<li>
<p>
The <code>nexti</code> and <code>stepi</code> commands moves slowly by the line based on the
assembler code instead of the C source.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s trace slowly to play with calling of <code>printf</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
Verify initial value of the <code>%edi</code> register with the <code>info reg ...</code> command.
</p>
</li>
<li>
<p>
Move to the next assembler code line with <code>nexti</code>.
</p>
</li>
<li>
<p>
Verify the first function argument value in the <code>%edi</code> register with the <code>info reg ...</code> command.
</p>
</li>
<li>
<p>
Tweak the <code>%edi</code> register value to point 1 byte forward to show the <strong>power of GDB.</strong>
</p>
</li>
<li>
<p>
Verify the updated first function argument value.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) info reg edi
edi            0x1    1
(gdb) nexti
0x000000000040050f    6        printf("Hello, world!\n");
(gdb) disas/m
Dump of assembler code for function main:
5    {
   0x0000000000400506 &lt;+0&gt;:    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    mov    %rsp,%rbp

6        printf("Hello, world!\n");
   0x000000000040050a &lt;+4&gt;:    mov    $0x4005a4,%edi
=&gt; 0x000000000040050f &lt;+9&gt;:    callq  0x4003e0 &lt;puts@plt&gt;

7        return EXIT_SUCCESS;
   0x0000000000400514 &lt;+14&gt;:    mov    $0x0,%eax

8    }
   0x0000000000400519 &lt;+19&gt;:    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    retq

End of assembler dump.
(gdb) info reg edi
edi            0x4005a4    4195748
(gdb) print /x $edi
$1 = 0x4005a4
(gdb) x/s $edi
0x4005a4:    "Hello, world!"
(gdb) set $edi=$edi+1
(gdb) x/s $edi
0x4005a5:    "ello, world!"</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s step into the <code>printf</code> function with <code>step</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) step
_IO_puts (str=0x4005a5 "ello, world!") at ioputs.c:34
34         const char *str;
(gdb) disas/m
Dump of assembler code for function _IO_puts:
34         const char *str;
=&gt; 0x00007ffff7a9e9f0 &lt;+0&gt;:    push   %r12
   0x00007ffff7a9e9f2 &lt;+2&gt;:    mov    %rdi,%r12
   0x00007ffff7a9e9f5 &lt;+5&gt;:    push   %rbp
   0x00007ffff7a9e9f6 &lt;+6&gt;:    push   %rbx

35    {
   0x00007ffff7a9eb19 &lt;+297&gt;:    mov    $0xffffffff,%ebp
   0x00007ffff7a9eb1e &lt;+302&gt;:    jmp    0x7ffff7a9eacc &lt;_IO_puts+220&gt;
   0x00007ffff7a9eb20 &lt;+304&gt;:    mov    %rbx,%rdi
   0x00007ffff7a9eb23 &lt;+307&gt;:    jmpq   0x7ffff7a9ea6a &lt;_IO_puts+122&gt;

36      int result = EOF;
   0x00007ffff7a9e9f7 &lt;+7&gt;:    callq  0x7ffff7ab4c60 &lt;strlen&gt;
   0x00007ffff7a9ea03 &lt;+19&gt;:    mov    %rax,%rbp

37      _IO_size_t len = strlen (str);
   0x00007ffff7a9e9fc &lt;+12&gt;:    mov    0x338d0d(%rip),%rbx        # 0x7ffff7dd77
10 &lt;stdout&gt;
   0x00007ffff7a9ea06 &lt;+22&gt;:    mov    (%rbx),%eax
   0x00007ffff7a9ea08 &lt;+24&gt;:    mov    %rbx,%rdi
   0x00007ffff7a9ea0b &lt;+27&gt;:    and    $0x8000,%eax
   0x00007ffff7a9ea10 &lt;+32&gt;:    jne    0x7ffff7a9ea6f &lt;_IO_puts+127&gt;
   0x00007ffff7a9ea12 &lt;+34&gt;:    mov    0x88(%rbx),%r8
   0x00007ffff7a9ea19 &lt;+41&gt;:    mov    %fs:0x10,%rdx
   0x00007ffff7a9ea22 &lt;+50&gt;:    cmp    0x8(%r8),%rdx
   0x00007ffff7a9ea26 &lt;+54&gt;:    je     0x7ffff7a9eb20 &lt;_IO_puts+304&gt;
   0x00007ffff7a9ea2c &lt;+60&gt;:    mov    $0x1,%esi
   0x00007ffff7a9ea31 &lt;+65&gt;:    cmpl   $0x0,0x33cd9c(%rip)        # 0x7ffff7ddb7
d4 &lt;__libc_multiple_threads&gt;
   0x00007ffff7a9ea38 &lt;+72&gt;:    je     0x7ffff7a9ea47 &lt;_IO_puts+87&gt;
   0x00007ffff7a9ea3a &lt;+74&gt;:    lock cmpxchg %esi,(%r8)
   0x00007ffff7a9ea3f &lt;+79&gt;:    jne    0x7ffff7a9eb7f &lt;_L_lock_47&gt;
   0x00007ffff7a9ea45 &lt;+85&gt;:    jmp    0x7ffff7a9ea51 &lt;_IO_puts+97&gt;
   0x00007ffff7a9ea47 &lt;+87&gt;:    cmpxchg %esi,(%r8)
   0x00007ffff7a9ea4b &lt;+91&gt;:    jne    0x7ffff7a9eb7f &lt;_L_lock_47&gt;
   0x00007ffff7a9ea51 &lt;+97&gt;:    mov    0x88(%rbx),%rax
   0x00007ffff7a9ea58 &lt;+104&gt;:    mov    0x88(%rbx),%r8
   0x00007ffff7a9ea5f &lt;+111&gt;:    mov    0x338caa(%rip),%rdi        # 0x7ffff7dd7
710 &lt;stdout&gt;
   0x00007ffff7a9ea66 &lt;+118&gt;:    mov    %rdx,0x8(%rax)
   0x00007ffff7a9ea6a &lt;+122&gt;:    addl   $0x1,0x4(%r8)

38      _IO_acquire_lock (_IO_stdout);
39
   0x00007ffff7a9eb10 &lt;+288&gt;:    cmp    $0xffffffff,%eax
   0x00007ffff7a9eb13 &lt;+291&gt;:    je     0x7ffff7a9ea87 &lt;_IO_puts+151&gt;

40      if ((_IO_vtable_offset (_IO_stdout) != 0
   0x00007ffff7a9ea6f &lt;+127&gt;:    mov    0xc0(%rdi),%eax
   0x00007ffff7a9ea75 &lt;+133&gt;:    test   %eax,%eax
   0x00007ffff7a9ea77 &lt;+135&gt;:    jne    0x7ffff7a9eb10 &lt;_IO_puts+288&gt;
   0x00007ffff7a9ea7d &lt;+141&gt;:    movl   $0xffffffff,0xc0(%rdi)

41           || _IO_fwide (_IO_stdout, -1) == -1)
   0x00007ffff7a9ea87 &lt;+151&gt;:    mov    0xd8(%rdi),%rax
   0x00007ffff7a9ea8e &lt;+158&gt;:    mov    %rbp,%rdx
   0x00007ffff7a9ea91 &lt;+161&gt;:    mov    %r12,%rsi
   0x00007ffff7a9ea94 &lt;+164&gt;:    callq  *0x38(%rax)
   0x00007ffff7a9ea97 &lt;+167&gt;:    cmp    %rax,%rbp
   0x00007ffff7a9ea9a &lt;+170&gt;:    jne    0x7ffff7a9eb19 &lt;_IO_puts+297&gt;

42          &amp;&amp; _IO_sputn (_IO_stdout, str, len) == len
   0x00007ffff7a9ea9c &lt;+172&gt;:    mov    0x338c6d(%rip),%rdi        # 0x7ffff7dd7
710 &lt;stdout&gt;
   0x00007ffff7a9eaa3 &lt;+179&gt;:    mov    0x28(%rdi),%rax
   0x00007ffff7a9eaa7 &lt;+183&gt;:    cmp    0x30(%rdi),%rax
   0x00007ffff7a9eaab &lt;+187&gt;:    jae    0x7ffff7a9eb28 &lt;_IO_puts+312&gt;
   0x00007ffff7a9eaad &lt;+189&gt;:    lea    0x1(%rax),%rdx
   0x00007ffff7a9eab1 &lt;+193&gt;:    mov    %rdx,0x28(%rdi)
   0x00007ffff7a9eab5 &lt;+197&gt;:    movb   $0xa,(%rax)
   0x00007ffff7a9eb28 &lt;+312&gt;:    mov    $0xa,%esi
   0x00007ffff7a9eb2d &lt;+317&gt;:    callq  0x7ffff7aa8f70 &lt;__GI___overflow&gt;
   0x00007ffff7a9eb32 &lt;+322&gt;:    add    $0x1,%eax
   0x00007ffff7a9eb35 &lt;+325&gt;:    je     0x7ffff7a9eb19 &lt;_IO_puts+297&gt;
   0x00007ffff7a9eb37 &lt;+327&gt;:    jmpq   0x7ffff7a9eab8 &lt;_IO_puts+200&gt;

43          &amp;&amp; _IO_putc_unlocked ('\n', _IO_stdout) != EOF)
   0x00007ffff7a9eab8 &lt;+200&gt;:    add    $0x1,%rbp
   0x00007ffff7a9eabc &lt;+204&gt;:    mov    $0x7fffffff,%eax
   0x00007ffff7a9eac1 &lt;+209&gt;:    cmp    $0x7fffffff,%rbp
   0x00007ffff7a9eac8 &lt;+216&gt;:    cmova  %rax,%rbp

44        result = MIN (INT_MAX, len + 1);
45
46      _IO_release_lock (_IO_stdout);
47      return result;
   0x00007ffff7a9eb05 &lt;+277&gt;:    pop    %rbx
   0x00007ffff7a9eb06 &lt;+278&gt;:    mov    %ebp,%eax
   0x00007ffff7a9eb08 &lt;+280&gt;:    pop    %rbp
   0x00007ffff7a9eb09 &lt;+281&gt;:    pop    %r12
   0x00007ffff7a9eb0b &lt;+283&gt;:    retq
   0x00007ffff7a9eb0c &lt;+284&gt;:    nopl   0x0(%rax)
   0x00007ffff7a9eb3c &lt;+332&gt;:    testl  $0x8000,(%rbx)
   0x00007ffff7a9eb42 &lt;+338&gt;:    mov    %rax,%rsi
   0x00007ffff7a9eb45 &lt;+341&gt;:    jne    0x7ffff7a9eb77 &lt;_IO_puts+391&gt;

End of assembler dump.</code></pre>
</div></div>
<div class="paragraph"><p>Since required detached debugging symbols are properly installed by the
<code>libc6-dbg:amd64</code> package into its proper path
<code>/usr/lib/debug/lib/x86_64-linux-gnu</code>, you see the symbol <code>_IO_puts</code> is
resolved.</p></div>
<div class="paragraph"><p>I used "<code>apt-get source eglibc</code>" to get the source files for the libc library
used on the Debian system and copied the <code>ioputs.c</code> file from the
<code>eglibc-*.**/libio/ioputs.c</code> file into the current directory in advance to
enable the C source code display.  You can blame me going easy but &#8230;</p></div>
<div class="paragraph"><p>Let&#8217;s get out of the <code>_IO_puts</code> function using the <code>finish</code> command which
finishes child function and returns to the parent function.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) finish
main () at hello.c:7
7        return EXIT_SUCCESS;
Value returned is $2 = 13
(gdb) disas/m
Dump of assembler code for function main:
5    {
   0x0000000000400506 &lt;+0&gt;:    push   %rbp
   0x0000000000400507 &lt;+1&gt;:    mov    %rsp,%rbp

6        printf("Hello, world!\n");
   0x000000000040050a &lt;+4&gt;:    mov    $0x4005a4,%edi
   0x000000000040050f &lt;+9&gt;:    callq  0x4003e0 &lt;puts@plt&gt;

7        return EXIT_SUCCESS;
=&gt; 0x0000000000400514 &lt;+14&gt;:    mov    $0x0,%eax

8    }
   0x0000000000400519 &lt;+19&gt;:    pop    %rbp
   0x000000000040051a &lt;+20&gt;:    retq

End of assembler dump.</code></pre>
</div></div>
<div class="paragraph"><p>Now you are back to the <code>main</code> function.</p></div>
<div class="paragraph"><p>Let&#8217;s finish by continuing.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(gdb) cont
ello, world!
[Inferior 1 (process 2698) exited normally]
(gdb) quit
$</code></pre>
</div></div>
<div class="paragraph"><p>Please note that <strong>the program output lacks "H" in "Hello"</strong> since I tweaked the program execution via GDB.</p></div>
<div class="paragraph"><p>This is just a simple walk through but you get roughly what GDB can do.</p></div>
</div>
<div class="sect2">
<h3 id="_gdb_prime8_gdb">gdb prime8-gdb</h3>
<div class="paragraph"><p>The <a href="#_libthread">Library: libthread</a> had a buggy <code>prime8.c</code> code.  Let&#8217;s check what was wrong under GDB.</p></div>
<div class="paragraph"><p>Let&#8217;s compile  <code>prime8.c</code> with <code>-g</code> as <code>prime8-gdb</code> and run it to create the <code>core</code> file as <a href="#_core_dump">ELF: Core dump</a>, then analyze it with GDB.</p></div>
<div class="listingblock">
<div class="title">Compiling <code>prime8.c</code> with <code>-g</code> as <code>prime8-gdb</code> and check core under GDB.</div>
<div class="content">
<pre><code>$ ulimit -c unlimited
$ ./prime8-gdb 1090
Segmentation fault (core dumped)
$ ls -l core
-rw------- 1 osamu osamu 34668544 Aug 20 23:24 core
$ gdb -q prime8-gdb core
[New LWP 30244]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `./prime8-gdb 1090'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000000000400b20 in main (argc=2, argv=0x7ffda6a3eb38) at prime8.c:108
108            tail-&gt;next = thd[i].head;
(gdb) print i
$1 = 63
(gdb) print tail
$2 = (primelist *) 0x0
(gdb) print thd[i].head
$3 = (primelist *) 0x0
(gdb) print thd[i-1].head
$4 = (primelist *) 0x0
(gdb) print thd[i-2].head
$5 = (primelist *) 0x7f2160001b00
(gdb) list
103        for (i=0; i &lt; TMAX; i++) {
104            /* TMAX thread of checkprime loop */
105            if (pthread_join(thd[i].th, (void *) NULL) ) {
106                printf ("E: error joining thread at %li\n", i);
107            }
108            tail-&gt;next = thd[i].head;
109            tail = thd[i].tail;
110        }
111
112        p=head;
(gdb) quit</code></pre>
</div></div>
<div class="paragraph"><p>Alternatively, let&#8217;s run <code>prime8-gdb</code> under GDB.</p></div>
<div class="listingblock">
<div class="title">Compiling <code>prime8.c</code> with <code>-g</code> as <code>prime8-gdb</code> and running it under GDB.</div>
<div class="content">
<pre><code>(gdb) file prime8-gdb
(gdb) run 1090
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
... (snip thread dialog)

Program received signal SIGSEGV, Segmentation fault.
0x0000000000400b20 in main (argc=2, argv=0x7fffffffdef8) at prime8.c:108
108            tail-&gt;next = thd[i].head;
(gdb) print i
$1 = 63
(gdb) print tail
$2 = (primelist *) 0x0
(gdb) print thd[i].head
$3 = (primelist *) 0x0
(gdb) print thd[i-1].head
$4 = (primelist *) 0x0
(gdb) print thd[i-2].head
$5 = (primelist *) 0x7ffff0001f40
(gdb) list
103        for (i=0; i &lt; TMAX; i++) {
104            /* TMAX thread of checkprime loop */
105            if (pthread_join(thd[i].th, (void *) NULL) ) {
106                printf ("E: error joining thread at %li\n", i);
107            }
108            tail-&gt;next = thd[i].head;
109            tail = thd[i].tail;
110        }
111
112        p=head;
(gdb) kill
Kill the program being debugged? (y or n) [answered Y; input not from terminal]
(gdb) quit</code></pre>
</div></div>
<div class="paragraph"><p>I see the cause of the bug clearly in the result of both methods.  Assignment
at <code>prime8.c:108</code> should not be done if no prime numbers were found (returning
<code>NULL</code>) from the calculation in the thread.  So I created <code>prime9.patch</code> to
append only when the thread finds some prime numbers.</p></div>
<div class="listingblock">
<div class="title">Creating and compiling <code>prime9.c</code> with <code>-g</code> as <code>prime9-gdb</code> and running it.</div>
<div class="content">
<pre><code>--- prime8.c    2013-02-23 23:14:45.943466837 +0900
+++ prime9.c    2013-02-23 23:16:41.144054858 +0900
@@ -105,8 +105,10 @@
         if (pthread_join(thd[i].th, (void *) NULL) ) {
             printf ("E: error joining thread at %li\n", i);
         }
-        tail-&gt;next = thd[i].head;
-        tail = thd[i].tail;
+        if (thd[i].head != NULL) { /* prime found */
+            tail-&gt;next = thd[i].head;
+            tail = thd[i].tail;
+        }
     }

     p=head;
$ cp prime8.c prime9.c
$ patch -p0 prime9.c &lt;prime9.patch
patching file prime9.c
$ gcc -g -Wall -lpthread -o prime9-gdb prime9.c
$ ./prime9-gdb "1090"&gt;/dev/null; echo $?
0
$ ./prime9-gdb "4"
2
3
$ ./prime9-gdb "3"
2
3
3
3
3
3
3
3
3
 ... (snip)</code></pre>
</div></div>
<div class="paragraph"><p>Oops, still something is wrong here.  (I see I was careless with iteration boundaries.)</p></div>
<div class="paragraph"><p>Let&#8217;s continue debugging &#8230;</p></div>
</div>
<div class="sect2">
<h3 id="_gdb_prime_gdb">gdb prime-gdb</h3>
<div class="paragraph"><p>Let&#8217;s fix the <code>ptime9.c</code> code by:</p></div>
<div class="ulist"><ul>
<li>
<p>
split this into <code>prime.c</code>, <code>prime.h</code>, <code>checkprime.c</code> and <code>subthread.c</code> files.
</p>
</li>
<li>
<p>
keep each <code>*.c</code> file to contain only one function in it.
</p>
</li>
<li>
<p>
make <code>TMAX</code> as variable <code>tmax</code>.
</p>
</li>
<li>
<p>
fix bugs by carefully going over iteration boundaries.
</p>
</li>
<li>
<p>
use "<code>set trace-commands on</code>" under the batch command execution.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title"><code>prime.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #000000">    1:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"prime.h"</span>
<span style="color: #000000">    2:</span>
<span style="color: #000000">    3:</span> <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
<span style="color: #000000">    4:</span> <span style="color: #008080">thdata</span>       thd<span style="color: #990000">[</span>TMAX<span style="color: #990000">];</span>
<span style="color: #000000">    5:</span>
<span style="color: #000000">    6:</span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">    7:</span>     <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p <span style="color: #990000">=</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="color: #000000">    8:</span>     <span style="color: #009900">long</span> n<span style="color: #990000">,</span> n_max<span style="color: #990000">,</span> i<span style="color: #990000">,</span> nd<span style="color: #990000">,</span> tmax <span style="color: #990000">=</span> TMAX<span style="color: #990000">;</span>
<span style="color: #000000">    9:</span>     n_max <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">atol</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span> <span style="font-style: italic"><span style="color: #9A1900">/* &gt;=3 */</span></span>
<span style="color: #000000">   10:</span>     head <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
<span style="color: #000000">   11:</span>     tail <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
<span style="color: #000000">   12:</span>     tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
<span style="color: #000000">   13:</span>     n <span style="color: #990000">=</span> <span style="color: #993399">2</span><span style="color: #990000">;</span>
<span style="color: #000000">   14:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">((</span>n <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">*</span> <span style="color: #990000">(</span>n <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">&lt;</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   15:</span>         n<span style="color: #990000">++;</span>
<span style="color: #000000">   16:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>n<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   17:</span>             q<span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
<span style="color: #000000">   18:</span>             tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   19:</span>             tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   20:</span>             tail<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> n<span style="color: #990000">;</span>
<span style="color: #000000">   21:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   22:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   23:</span>     nd <span style="color: #990000">=</span> <span style="color: #990000">(</span>n_max <span style="color: #990000">-</span> n <span style="color: #990000">+</span> tmax <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="color: #990000">(</span><span style="color: #009900">long</span><span style="color: #990000">)</span> tmax<span style="color: #990000">;</span>
<span style="color: #000000">   24:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> tmax<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   25:</span>         <span style="font-style: italic"><span style="color: #9A1900">/* tmax thread of checkprime loop */</span></span>
<span style="color: #000000">   26:</span>         thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n0 <span style="color: #990000">=</span> n <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* next unchecked */</span></span>
<span style="color: #000000">   27:</span>         thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">=</span> n <span style="color: #990000">+</span> nd<span style="color: #990000">;</span>
<span style="color: #000000">   28:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">&gt;=</span> n_max<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   29:</span>             thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1 <span style="color: #990000">=</span> n_max<span style="color: #990000">;</span>
<span style="color: #000000">   30:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   31:</span>         n <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>n1<span style="color: #990000">;</span>
<span style="color: #000000">   32:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_create</span></span><span style="color: #990000">(&amp;</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">,</span>
<span style="color: #000000">   33:</span>                 NULL<span style="color: #990000">,</span>
<span style="color: #000000">   34:</span>                 <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> subthread<span style="color: #990000">,</span>
<span style="color: #000000">   35:</span>                 <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> <span style="color: #990000">&amp;(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">])</span> <span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   36:</span>             <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error creating thread at %li</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
<span style="color: #000000">   37:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   38:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   39:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i<span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> tmax<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   40:</span>         <span style="font-style: italic"><span style="color: #9A1900">/* tmax thread of checkprime loop */</span></span>
<span style="color: #000000">   41:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">pthread_join</span></span><span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>th<span style="color: #990000">,</span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*)</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   42:</span>             <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"E: error joining thread at %li</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> i<span style="color: #990000">);</span>
<span style="color: #000000">   43:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   44:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>head <span style="color: #990000">!=</span> NULL<span style="color: #990000">)</span> <span style="color: #FF0000">{</span> <span style="font-style: italic"><span style="color: #9A1900">/* prime found */</span></span>
<span style="color: #000000">   45:</span>             tail<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>head<span style="color: #990000">;</span>
<span style="color: #000000">   46:</span>             tail <span style="color: #990000">=</span> thd<span style="color: #990000">[</span>i<span style="color: #990000">].</span>tail<span style="color: #990000">;</span>
<span style="color: #000000">   47:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   48:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   49:</span>
<span style="color: #000000">   50:</span>     p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
<span style="color: #000000">   51:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   52:</span>         <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%ld</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">);</span>
<span style="color: #000000">   53:</span>         p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
<span style="color: #000000">   54:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   55:</span>     p<span style="color: #990000">=</span>head<span style="color: #990000">;</span>
<span style="color: #000000">   56:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   57:</span>         q <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
<span style="color: #000000">   58:</span>             <span style="font-weight: bold"><span style="color: #000000">free</span></span><span style="color: #990000">(</span>p<span style="color: #990000">);</span>
<span style="color: #000000">   59:</span>             p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   60:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   61:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #000000">   62:</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Here, 3 lines in <code>prime.c</code> have been corrected (bugs!).</p></div>
<div class="ulist"><ul>
<li>
<p>
line 14: "<code>&lt;=</code>" &#8594; "<code>&lt;</code>"
</p>
</li>
<li>
<p>
line 23: adjust the loop stepping.
</p>
</li>
<li>
<p>
line 26: start from the next integer.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title"><code>prime.h</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #000000">    1:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="color: #000000">    2:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="color: #000000">    3:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;semaphore.h&gt;</span>
<span style="color: #000000">    4:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;pthread.h&gt;</span>
<span style="color: #000000">    5:</span> <span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="color: #000000">    6:</span> <span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>
<span style="color: #000000">    7:</span> <span style="font-weight: bold"><span style="color: #000080">#define</span></span> TMAX <span style="color: #993399">64L</span>
<span style="color: #000000">    8:</span>
<span style="color: #000000">    9:</span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   10:</span>     <span style="color: #009900">long</span> prime<span style="color: #990000">;</span>
<span style="color: #000000">   11:</span>     <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> <span style="color: #990000">*</span>next<span style="color: #990000">;</span>
<span style="color: #000000">   12:</span>     <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #000000">   13:</span> <span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_primelist</span> primelist<span style="color: #990000">;</span>
<span style="color: #000000">   14:</span>
<span style="color: #000000">   15:</span> <span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>head<span style="color: #990000">,</span> <span style="color: #990000">*</span>tail<span style="color: #990000">;</span>
<span style="color: #000000">   16:</span>
<span style="color: #000000">   17:</span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   18:</span>     <span style="color: #008080">pthread_t</span>           th<span style="color: #990000">;</span>
<span style="color: #000000">   19:</span>     <span style="color: #009900">long</span>                n0<span style="color: #990000">;</span>
<span style="color: #000000">   20:</span>     <span style="color: #009900">long</span>                n1<span style="color: #990000">;</span>
<span style="color: #000000">   21:</span>     <span style="color: #008080">primelist</span>           <span style="color: #990000">*</span>head<span style="color: #990000">;</span>
<span style="color: #000000">   22:</span>     <span style="color: #008080">primelist</span>           <span style="color: #990000">*</span>tail<span style="color: #990000">;</span>
<span style="color: #000000">   23:</span> <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #000000">   24:</span> <span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_thdata</span> thdata<span style="color: #990000">;</span>
<span style="color: #000000">   25:</span>
<span style="color: #000000">   26:</span> <span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">thdata</span>       thd<span style="color: #990000">[</span>TMAX<span style="color: #990000">];</span>
<span style="color: #000000">   27:</span>
<span style="color: #000000">   28:</span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">);</span>
<span style="color: #000000">   29:</span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">subthread</span></span><span style="color: #990000">(</span><span style="color: #008080">thdata</span> <span style="color: #990000">*</span>thd<span style="color: #990000">);</span>
<span style="color: #000000">   30:</span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>argv<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Please note the use of <code>extern</code> in the <code>prime.h</code>.</p></div>
<div class="paragraph"><p>Then here are supporting sources.</p></div>
<div class="listingblock">
<div class="title"><code>checkprime.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #000000">    1:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"prime.h"</span>
<span style="color: #000000">    2:</span>
<span style="color: #000000">    3:</span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span><span style="color: #009900">long</span> n<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">    4:</span>     <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
<span style="color: #000000">    5:</span>     <span style="color: #009900">long</span> i<span style="color: #990000">,</span> n_div_i<span style="color: #990000">,</span> n_mod_i<span style="color: #990000">;</span>
<span style="color: #000000">    6:</span>     <span style="color: #009900">int</span> flag<span style="color: #990000">;</span>
<span style="color: #000000">    7:</span>     flag <span style="color: #990000">=</span> TRUE<span style="color: #990000">;</span>
<span style="color: #000000">    8:</span>     p <span style="color: #990000">=</span> head<span style="color: #990000">;</span>
<span style="color: #000000">    9:</span>     <span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span>p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   10:</span>         i <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>prime<span style="color: #990000">;</span>
<span style="color: #000000">   11:</span>         n_div_i <span style="color: #990000">=</span> n <span style="color: #990000">/</span> i<span style="color: #990000">;</span>
<span style="color: #000000">   12:</span>         n_mod_i <span style="color: #990000">=</span> n <span style="color: #990000">%</span> i<span style="color: #990000">;</span>
<span style="color: #000000">   13:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_mod_i <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   14:</span>             flag <span style="color: #990000">=</span> FALSE<span style="color: #990000">;</span>
<span style="color: #000000">   15:</span>             <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* found not to be prime */</span></span>
<span style="color: #000000">   16:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   17:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>n_div_i <span style="color: #990000">&lt;</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   18:</span>             <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">/* no use doing more i-loop if n &lt; i*i */</span></span>
<span style="color: #000000">   19:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   20:</span>         p <span style="color: #990000">=</span> p<span style="color: #990000">-&gt;</span>next<span style="color: #990000">;</span>
<span style="color: #000000">   21:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   22:</span>     <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> flag<span style="color: #990000">;</span>
<span style="color: #000000">   23:</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title"><code>subthread.c</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #000000">    1:</span> <span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"prime.h"</span>
<span style="color: #000000">    2:</span>
<span style="color: #000000">    3:</span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">subthread</span></span><span style="color: #990000">(</span><span style="color: #008080">thdata</span> <span style="color: #990000">*</span>thd<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">    4:</span>     <span style="color: #009900">long</span> i<span style="color: #990000">;</span>
<span style="color: #000000">    5:</span>     <span style="color: #008080">primelist</span> <span style="color: #990000">*</span>p<span style="color: #990000">=</span>NULL<span style="color: #990000">,</span> <span style="color: #990000">*</span>q<span style="color: #990000">=</span>NULL<span style="color: #990000">;</span>
<span style="color: #000000">    6:</span>     thd<span style="color: #990000">-&gt;</span>head <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="color: #000000">    7:</span>     <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> thd<span style="color: #990000">-&gt;</span>n0<span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> thd<span style="color: #990000">-&gt;</span>n1<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">    8:</span>         <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">checkprime</span></span><span style="color: #990000">(</span>i<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">    9:</span>             q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">calloc</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>primelist<span style="color: #990000">));</span>
<span style="color: #000000">   10:</span>             q<span style="color: #990000">-&gt;</span>prime <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
<span style="color: #000000">   11:</span>             <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span>thd<span style="color: #990000">-&gt;</span>head<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   12:</span>                 thd<span style="color: #990000">-&gt;</span>head <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   13:</span>                 p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   14:</span>             <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
<span style="color: #000000">   15:</span>                 p<span style="color: #990000">-&gt;</span>next <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   16:</span>                 p <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   17:</span>             <span style="color: #FF0000">}</span>
<span style="color: #000000">   18:</span>             thd<span style="color: #990000">-&gt;</span>tail <span style="color: #990000">=</span> q<span style="color: #990000">;</span>
<span style="color: #000000">   19:</span>         <span style="color: #FF0000">}</span>
<span style="color: #000000">   20:</span>     <span style="color: #FF0000">}</span>
<span style="color: #000000">   21:</span> <span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Now we should have good program.</p></div>
<div class="listingblock">
<div class="title">Compiling <code>prime.c</code> and related files with <code>-g</code> as <code>prime-gdb</code> and running it without hitting bugs.</div>
<div class="content">
<pre><code>$ gcc -g -Wall -lpthread -c checkprime.c
$ gcc -g -Wall -lpthread -c subthread.c
$ gcc -g -Wall -lpthread checkprime.o subthread.o prime.o -o prime-gdb
$ ./prime-gdb "1090"&gt;/dev/null; echo $?
0
$ ./prime-gdb "3"
2
3
$ ./prime-gdb "4"
2
3
$ ./prime-gdb "5"
2
3
5
$ ./prime-gdb "6"
2
3
5</code></pre>
</div></div>
<div class="paragraph"><p>This is running nicely without hitting bugs for all input range.</p></div>
<div class="paragraph"><p>Let&#8217;s run this program under the batch mode of GDB to verify its internal
situation where it used to segfaults.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use of "<code>set trace-commands on</code>" enables tracing of commands under the
batch mode.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="title">Running <code>prime-gdb</code> under GDB. (session #1)</div>
<div class="content">
<pre><code>set trace-commands on
file prime-gdb
set arg 1090
break prime.c:44 if i &gt;= 61
# define macro pre-definition
define xprint
print i
print tail
printf "thd[i].head=%08X\n", thd[i].head
printf "thd[i-1].head=%08X\n", thd[i-1].head
printf "thd[i-2].head=%08X\n", thd[i-2].head
end
# autorun xprint
command 1
xprint
end
# debug run start
run
cont
cont
cont
quit
$ gdb -batch -x prime.1.gdb
+file prime-gdb
+set arg 1090
+break prime.c:44 if i &gt;= 61
Breakpoint 1 at 0x400b08: file prime.c, line 44.
+define xprint
+command 1
+run
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
[New Thread 0x7ffff7815700 (LWP 31101)]
[Thread 0x7ffff7815700 (LWP 31101) exited]
[New Thread 0x7ffff7014700 (LWP 31102)]
[Thread 0x7ffff7014700 (LWP 31102) exited]
[New Thread 0x7ffff6813700 (LWP 31103)]
[New Thread 0x7ffff6012700 (LWP 31104)]
[Thread 0x7ffff6813700 (LWP 31103) exited]
[Thread 0x7ffff6012700 (LWP 31104) exited]
[New Thread 0x7ffff5811700 (LWP 31105)]
 ... (snip)

Breakpoint 1, main (argc=2, argv=0x7fffffffdef8) at prime.c:44
44            if (thd[i].head != NULL) { /* prime found */
+xprint
++print i
$1 = 61
++print tail
$2 = (primelist *) 0x7ffff0001dc0
++printf "thd[i].head=%08X\n", thd[i].head
thd[i].head=F0001DE0
++printf "thd[i-1].head=%08X\n", thd[i-1].head
thd[i-1].head=F0001D80
++printf "thd[i-2].head=%08X\n", thd[i-2].head
thd[i-2].head=F0001D20
+cont

Breakpoint 1, main (argc=2, argv=0x7fffffffdef8) at prime.c:44
44            if (thd[i].head != NULL) { /* prime found */
+xprint
++print i
$3 = 62
++print tail
$4 = (primelist *) 0x7ffff0001de0
++printf "thd[i].head=%08X\n", thd[i].head
thd[i].head=00000000
++printf "thd[i-1].head=%08X\n", thd[i-1].head
thd[i-1].head=F0001DE0
++printf "thd[i-2].head=%08X\n", thd[i-2].head
thd[i-2].head=F0001D80
+cont

Breakpoint 1, main (argc=2, argv=0x7fffffffdef8) at prime.c:44
44            if (thd[i].head != NULL) { /* prime found */
+xprint
++print i
$5 = 63
++print tail
$6 = (primelist *) 0x7ffff0001de0
++printf "thd[i].head=%08X\n", thd[i].head
thd[i].head=00000000
++printf "thd[i-1].head=%08X\n", thd[i-1].head
thd[i-1].head=00000000
++printf "thd[i-2].head=%08X\n", thd[i-2].head
thd[i-2].head=F0001DE0
+cont
2
3
5
7
11
13
... (snip)
1063
1069
1087
[Inferior 1 (process 31097) exited normally]
+quit</code></pre>
</div></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Native_POSIX_Thread_Library">Native POSIX Thread
Library (NTPL)</a> uses
<a href="http://en.wikipedia.org/wiki/Light-weight_process">light-weight process (LWP)</a>
to enable the <a href="http://en.wikipedia.org/wiki/POSIX_Threads">POSIX thread
(pthread)</a> on the modern Linux system.</p></div>
<div class="paragraph"><p>Please note that the breakpoint defined with condition stops just before
the previous segfault location (<code>i = 61, 62, 63</code>).</p></div>
<div class="paragraph"><p>Let&#8217;s run this program again creating a breakpoint at the
start of <code>subthread.c</code>.   Also, let&#8217;s change <code>tmax</code> value from <code>64</code> to <code>4</code>.</p></div>
<div class="listingblock">
<div class="title">Running <code>prime-gdb</code> under GDB. (session #2)</div>
<div class="content">
<pre><code>set trace-commands on
# start program with argument 1090 and stop at the first line
start 1090
# break at the start of  subthread.c
break subthread.c:1
# define macro pre-definition
define xprint
printf "thd-&gt;n0=%08X\n", thd-&gt;n0
printf "thd-&gt;n1=%08X\n", thd-&gt;n1
bt
end
# autorun xprint at breakpoint 2
command 2
xprint
end
# conditional breakpoint
break prime.c:44 if i &gt;= 3
# one time break point
tbreak 16
c
print tmax
set tmax = 4
print tmax
bt full
s
bt f
finish
where f
c
c
c
c
info thread
thread apply all bt
c
print i
c
quit
$ gdb -batch -x prime.2.gdb prime-gdb
+start 1090
Temporary breakpoint 1 at 0x40088c: file prime.c, line 7.
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".

Temporary breakpoint 1, main (argc=2, argv=0x7fffffffdef8) at prime.c:7
7        primelist *p = NULL, *q = NULL;
+break subthread.c:1
Breakpoint 2 at 0x4007c9: file subthread.c, line 1.
+define xprint
+command 2
+break prime.c:44 if i &gt;= 3
Breakpoint 3 at 0x400b08: file prime.c, line 44.
+tbreak 16
Temporary breakpoint 4 at 0x4008fc: file prime.c, line 16.
+c

Temporary breakpoint 4, main (argc=2, argv=0x7fffffffdef8) at prime.c:16
16            if (checkprime(n)) {
+print tmax
$1 = 64
+set tmax = 4
+print tmax
$2 = 4
+bt full
#0  main (argc=2, argv=0x7fffffffdef8) at prime.c:16
        p = 0x0
        q = 0x0
        n = 3
        n_max = 1090
        i = 4195920
        nd = 4197469
        tmax = 4
+s
checkprime (n=3) at checkprime.c:7
7        flag = TRUE;
+bt f
#0  checkprime (n=3) at checkprime.c:7
        p = 0x400650 &lt;_start&gt;
        i = 0
        n_div_i = 1
        n_mod_i = 140737346350094
        flag = 32767
#1  0x0000000000400908 in main (argc=2, argv=0x7fffffffdef8) at prime.c:16
        p = 0x0
        q = 0x0
        n = 3
        n_max = 1090
        i = 4195920
        nd = 4197469
        tmax = 4
+finish
0x0000000000400908 in main (argc=2, argv=0x7fffffffdef8) at prime.c:16
16            if (checkprime(n)) {
Value returned is $3 = 1
+where f
#0  0x0000000000400908 in main (argc=2, argv=0x7fffffffdef8) at prime.c:16
        p = 0x0
        q = 0x0
        n = 3
        n_max = 1090
        i = 4195920
        nd = 4197469
        tmax = 4
+c
[New Thread 0x7ffff7815700 (LWP 31197)]
[Switching to Thread 0x7ffff7815700 (LWP 31197)]

Breakpoint 2, subthread (thd=0x6012c0 &lt;thd&gt;) at subthread.c:5
5        primelist *p=NULL, *q=NULL;
+xprint
++printf "thd-&gt;n0=%08X\n", thd-&gt;n0
thd-&gt;n0=00000024
++printf "thd-&gt;n1=%08X\n", thd-&gt;n1
thd-&gt;n1=0000012B
++bt
#0  subthread (thd=0x6012c0 &lt;thd&gt;) at subthread.c:5
#1  0x00007ffff7bc70a4 in start_thread (arg=0x7ffff7815700) at pthread_create.c:
309
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111
+c
[New Thread 0x7ffff7014700 (LWP 31198)]
[Thread 0x7ffff7815700 (LWP 31197) exited]
[Switching to Thread 0x7ffff7014700 (LWP 31198)]

Breakpoint 2, subthread (thd=0x6012e8 &lt;thd+40&gt;) at subthread.c:5
5        primelist *p=NULL, *q=NULL;
+xprint
++printf "thd-&gt;n0=%08X\n", thd-&gt;n0
thd-&gt;n0=0000012C
++printf "thd-&gt;n1=%08X\n", thd-&gt;n1
thd-&gt;n1=00000233
++bt
#0  subthread (thd=0x6012e8 &lt;thd+40&gt;) at subthread.c:5
#1  0x00007ffff7bc70a4 in start_thread (arg=0x7ffff7014700) at pthread_create.c:
309
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111
+c
[New Thread 0x7ffff6813700 (LWP 31199)]
[Thread 0x7ffff7014700 (LWP 31198) exited]
[Switching to Thread 0x7ffff6813700 (LWP 31199)]

Breakpoint 2, subthread (thd=0x601310 &lt;thd+80&gt;) at subthread.c:5
5        primelist *p=NULL, *q=NULL;
+xprint
++printf "thd-&gt;n0=%08X\n", thd-&gt;n0
thd-&gt;n0=00000234
++printf "thd-&gt;n1=%08X\n", thd-&gt;n1
thd-&gt;n1=0000033B
++bt
#0  subthread (thd=0x601310 &lt;thd+80&gt;) at subthread.c:5
#1  0x00007ffff7bc70a4 in start_thread (arg=0x7ffff6813700) at pthread_create.c:
309
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111
+c
[New Thread 0x7ffff6012700 (LWP 31200)]
[Switching to Thread 0x7ffff6012700 (LWP 31200)]

Breakpoint 2, subthread (thd=0x601338 &lt;thd+120&gt;) at subthread.c:5
5        primelist *p=NULL, *q=NULL;
+xprint
++printf "thd-&gt;n0=%08X\n", thd-&gt;n0
thd-&gt;n0=0000033C
++printf "thd-&gt;n1=%08X\n", thd-&gt;n1
thd-&gt;n1=00000442
++bt
#0  subthread (thd=0x601338 &lt;thd+120&gt;) at subthread.c:5
#1  0x00007ffff7bc70a4 in start_thread (arg=0x7ffff6012700) at pthread_create.c:
309
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111
+info thread
  Id   Target Id         Frame
* 5    Thread 0x7ffff6012700 (LWP 31200) "prime-gdb" subthread (thd=0x601338 &lt;th
d+120&gt;) at subthread.c:5
  4    Thread 0x7ffff6813700 (LWP 31199) "prime-gdb" __GI___nptl_death_event ()
at events.c:31
  1    Thread 0x7ffff7fcb700 (LWP 31193) "prime-gdb" main (argc=2, argv=0x7fffff
ffdef8) at prime.c:44
+thread apply all bt

Thread 5 (Thread 0x7ffff6012700 (LWP 31200)):
+bt
#0  subthread (thd=0x601338 &lt;thd+120&gt;) at subthread.c:5
#1  0x00007ffff7bc70a4 in start_thread (arg=0x7ffff6012700) at pthread_create.c:
309
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111

Thread 4 (Thread 0x7ffff6813700 (LWP 31199)):
+bt
#0  __GI___nptl_death_event () at events.c:31
#1  0x00007ffff7bc724e in start_thread (arg=0x7ffff6813700) at pthread_create.c:
358
#2  0x00007ffff78fc04d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:
111

Thread 1 (Thread 0x7ffff7fcb700 (LWP 31193)):
+bt
#0  main (argc=2, argv=0x7fffffffdef8) at prime.c:44
+c
[Thread 0x7ffff6813700 (LWP 31199) exited]
[Thread 0x7ffff6012700 (LWP 31200) exited]
[Switching to Thread 0x7ffff7fcb700 (LWP 31193)]

Breakpoint 3, main (argc=2, argv=0x7fffffffdef8) at prime.c:44
44            if (thd[i].head != NULL) { /* prime found */
+print i
$4 = 3
+c
2
3
5
7
11
13
... (snip)
1063
1069
1087
[Inferior 1 (process 31193) exited normally]
+quit</code></pre>
</div></div>
<div class="paragraph"><p>Please note the backtrace generated by <code>bt</code>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>bt</code> lists all stack frames of the thread on which the breakpoint stopped.
</p>
<div class="ulist"><ul>
<li>
<p>
On the main thread, it reaches <code>main</code>.
</p>
</li>
<li>
<p>
On the sub thread, it does not reach <code>main</code> but reaches NULL pointer function via <code>start_thread()</code> and <code>clone()</code>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>bt full</code>  lists all stack frames and local variables of the thread.
</p>
<div class="ulist"><ul>
<li>
<p>
Uninitialized variables show bogus valus.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>thead apply all bt</code> lists all stack frames of all running threads.
</p>
</li>
</ul></div>
<div class="paragraph"><p>See how a user defined command <code>xprint</code> is defined and a sequence of commands
at breakpoint is auto-executed via <code>command</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_gdb_tui">GDB TUI</h3>
<div class="paragraph"><p>Although normal command mode GDB is powerful, it is cumbersome to keep typing
"<code>list</code>", "<code>print ...</code>", "<code>info break</code>", and "<code>info reg</code>", &#8230; just to see what
is going on.</p></div>
<div class="paragraph"><p>That is where GDB Text User Interface (TUI) comes in.  Wile you are using GDB:</p></div>
<div class="ulist"><ul>
<li>
<p>
Type "Ctrl-X" and "Ctrl-A" (or "Ctrl-X" and "a") to get into the TUI mode.
</p>
</li>
<li>
<p>
Type "Ctrl-X" and "Ctrl-A" (or "Ctrl-X" and "a") again to get out of the TUI mode and back to the normal command prompt.
</p>
</li>
<li>
<p>
Change the screen layout by "<code>la src</code>", "<code>la asm</code>", "<code>la split</code>", "<code>la regs</code>", "<code>la next</code>", or "<code>la prev</code>". (<code>la</code> is short for <code>layout</code>)
</p>
</li>
<li>
<p>
Change the screen focus by "<code>fs cmd</code>", "<code>fs src</code>", "<code>fs asm</code>", "<code>fs split</code>", "<code>fs regs</code>", "<code>fs next</code>", or "<code>fs prev</code>". (<code>fs</code> is short for <code>focus</code>)
</p>
</li>
<li>
<p>
Change the register window by "<code>tui reg general</code>", "<code>tui reg float</code>", "<code>tui reg next</code>", or "<code>tui reg all</code>".
</p>
</li>
<li>
<p>
Refresh the screen by "<code>refresh</code>" or "Ctrl-L".
</p>
</li>
<li>
<p>
Change active window by "Ctrl-X" and "o".
</p>
</li>
<li>
<p>
Check window status by "<code>info win</code>".
</p>
</li>
</ul></div>
<div class="paragraph"><p>For more, read "<code>info gdb TUI</code>" from the shell prompt.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Use "<code>gdb -tui</code>" or "<code>gdbtui</code>" in place of "<code>gdb</code>" to start GDB in the TUI mode.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_gdb_resources">GDB resources</h3>
<div class="paragraph"><p>Here are some GDB resources:</p></div>
<div class="ulist"><ul>
<li>
<p>
GDB QUICK REFERENCE (gdb-doc package, /usr/share/doc/gdb-doc/pdf/refcard.pdf.gz)
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/HowToGetABacktrace">HowToGetABacktrace</a> (Debian wiki)
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/DebugPackage">DebugPackage</a> (Debian wiki)
</p>
</li>
<li>
<p>
<a href="http://www.dirac.org/linux/gdb/">Using GNU&#8217;s GDB Debugger</a> (Debian GDB package recommended)
</p>
</li>
<li>
<p>
<a href="http://sourceware.org/gdb/">GDB: The GNU Project Debugger</a> (upstream)
</p>
</li>
<li>
<p>
<a href="http://sourceware.org/gdb/wiki/">GDB Wiki</a> (upstream FAQ wiki)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-gdb.html">GNU Project Debugger: More fun with GDB</a> by William B. Zimmerly (IBM DW,Date: 03 Oct 2006)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-unix-strace.html">Fun with strace and the GDB Debugger</a> by William B. Zimmerly (IBM DW, Date: 11 May 2006)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/systems/library/es-debug/">Debugging tools and techniques for Linux on Power</a> by Calvin Sze (IBM DW, Date: 04 Aug 2005)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/library/l-debug/">Mastering Linux debugging techniques</a> by Steve Best (IBM DW, Date: 01 Aug 2002)
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/library/l-gdb/">Linux software debugging with GDB</a> by David Seager (IBM DW, Date: 01 Feb 2001)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_other_debuggers">Other debuggers</h3>
<div class="paragraph"><p>The Data Display Debugger (the <code>ddd</code> package) is a popular graphical user interface to UNIX
debuggers such as GDB, DBX, XDB, JDB and others.  IDEs, such as <a href="http://www.eclipse.org/eclipse/debug/">Eclipse</a> also come with a
graphical debugger.</p></div>
<div class="paragraph"><p>The <code>bashdb</code> package is the Bash debugger the Bash.  See
<a href="http://bashdb.sourceforge.net/bashdb.html">Debugging with the BASH debugger</a>.</p></div>
<div class="paragraph"><p>The "<code>perl -d program.pl</code>" drops you into the Perl debugger.
See <a href="http://debugger.perl.org/tools.html">Perl Debugging Tools</a>.</p></div>
<div class="paragraph"><p>The "<code>python -m pdb program.py</code>" drops you into <a href="https://docs.python.org/3/library/pdb.html">the Python debugger</a>.
You can alternatively add a "<code>import pdb</code>" line to the program.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debug_level_4">Debug: level 4</h2>
<div class="sectionbody">
<div class="paragraph"><p>Dynamically tracing program execution to understand the general behavior of the program is
the major part of debugging.</p></div>
<div class="paragraph"><p>There are several ways to trace programs interactively.  The <code>perf</code> tool
facilitate this without any modifications to the source.</p></div>
<div class="sect2">
<h3 id="_perf">perf</h3>
<div class="paragraph"><p>The <code>linux-tools-*</code> package matching your running kernel provides the <code>perf</code>
command on your system.</p></div>
<div class="paragraph"><p>The <code>perf</code> command provides Linux profiling with performance counters.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>perf stat</code>: obtain event counts (better <code>time</code>(1), <code>sar</code>(1), &#8230;)
</p>
</li>
<li>
<p>
<code>perf record</code>: record events for later reporting
</p>
</li>
<li>
<p>
<code>perf report</code>: break down events by process, function, etc. (better <code>strace</code>(1), <code>ltrace</code>(1), &#8230;)
</p>
</li>
<li>
<p>
<code>perf annotate</code>: annotate assembly or source code with event counts
</p>
</li>
<li>
<p>
<code>perf top</code>: see live event count (better <code>top</code>(1) with disassembler but need to be <code>root</code>)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Unlike other profiling tools, this does not require the recompilation of the
source nor the source file.  This is also very light weight.  But this is a
Linux specific tool.</p></div>
<div class="paragraph"><p>See <a href="https://perf.wiki.kernel.org/">perf: Linux profiling with performance counters</a> for more information.</p></div>
</div>
<div class="sect2">
<h3 id="_profiling_prime">Profiling prime</h3>
<div class="paragraph"><p>Let&#8217;s investigate why the compiled Vala <code>prime</code> program with Glib was
very slow as described in <a href="#_benchmark">Benchmark</a> using the <code>perf stat</code>
command.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<caption class="title">Table 13. Global performance counter stats for the various <code>prime</code> programs.</caption>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<thead>
<tr>
<th align="left" valign="top">Performance counter stats</th>
<th align="left" valign="top">C</th>
<th align="left" valign="top">Vala (Gee)</th>
<th align="left" valign="top">Python</th>
<th align="left" valign="top">Vala (GLib)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">context-switches</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
<td align="left" valign="top"><p class="table">224</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cpu-migrations</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">page-faults</p></td>
<td align="left" valign="top"><p class="table">687</p></td>
<td align="left" valign="top"><p class="table">392</p></td>
<td align="left" valign="top"><p class="table">2,457</p></td>
<td align="left" valign="top"><p class="table">835</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cycles</p></td>
<td align="left" valign="top"><p class="table">466,358,587</p></td>
<td align="left" valign="top"><p class="table">1,594,133,625</p></td>
<td align="left" valign="top"><p class="table">12,488,958,305</p></td>
<td align="left" valign="top"><p class="table">24,030,260,910</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-frontend</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stalled-cycles-backend</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
<td align="left" valign="top"><p class="table">&lt;not supported&gt;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">instructions</p></td>
<td align="left" valign="top"><p class="table">248,374,341</p></td>
<td align="left" valign="top"><p class="table">1,591,250,418</p></td>
<td align="left" valign="top"><p class="table">36,576,972,637</p></td>
<td align="left" valign="top"><p class="table">14,242,935,242</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branches</p></td>
<td align="left" valign="top"><p class="table">62,118,548</p></td>
<td align="left" valign="top"><p class="table">257,910,375</p></td>
<td align="left" valign="top"><p class="table">6,990,933,256</p></td>
<td align="left" valign="top"><p class="table">3,430,366,381</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">branch-misses</p></td>
<td align="left" valign="top"><p class="table">428,200</p></td>
<td align="left" valign="top"><p class="table">546,112</p></td>
<td align="left" valign="top"><p class="table">6,858,027</p></td>
<td align="left" valign="top"><p class="table">617,814</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">seconds time elapsed</p></td>
<td align="left" valign="top"><p class="table">0.138605703</p></td>
<td align="left" valign="top"><p class="table">0.475090850</p></td>
<td align="left" valign="top"><p class="table">3.729816361</p></td>
<td align="left" valign="top"><p class="table">7.161628095</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>You see the compiled Vala <code>prime</code> program with GLib has much more
stalled-cycles.  This seems to be the primary source of its slowness. (The
execution speed of the interpreted Python <code>prime</code> program is more than double
of that of the compiled Vala one.  If the value of the stalled-cycles is not as
high for the compiled Vala <code>prime</code> program, the execution speed of the
interpreted Python one should be much slower.)</p></div>
<div class="paragraph"><p>You can obtain interactive performance counter stats with the following method.</p></div>
<div class="listingblock">
<div class="title">Method to obtain interactive performance counter stats.</div>
<div class="content">
<pre><code>$ perf record ./prime "$(echo 2^20 | bc)"&gt;/dev/null
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.044 MB perf.data (~1941 samples) ]
$ perf report</code></pre>
</div></div>
<div class="paragraph"><p>This brings out interactive performance counter stats itemized for each
function calls etc.  The key parts of results are the following.</p></div>
<div class="listingblock">
<div class="title">Itemized performance counter stats for <code>prime</code> from the C (list) source</div>
<div class="content">
<pre><code># Overhead  Command      Shared Object                            Symbol
# ........  .......  .................  ................................
#
    92.83%    prime  prime              [.] main
     2.02%    prime  libc-2.19.so       [.] vfprintf
     1.47%    prime  libc-2.19.so       [.] _int_malloc
     0.74%    prime  libc-2.19.so       [.] _IO_file_xsputn@@GLIBC_2.2.5
     0.55%    prime  libc-2.19.so       [.] _itoa_word
     0.37%    prime  libc-2.19.so       [.] free</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Itemized performance counter stats for the compiled Vala <code>prime</code> with Gee.</div>
<div class="content">
<pre><code># Overhead  Command               Shared Object                                        Symbol
# ........  .......  ..........................  ............................................
#
    86.87%    prime  prime                       [.] _vala_main
     1.84%    prime  libgobject-2.0.so.0.4200.1  [.] g_object_unref
     1.64%    prime  libgobject-2.0.so.0.4200.1  [.] g_object_ref
     1.53%    prime  libgee.so.2.0.0             [.] 0x0000000000010268
     1.43%    prime  libgobject-2.0.so.0.4200.1  [.] g_type_check_instance_is_fundamentally_a
     1.05%    prime  libgee.so.2.0.0             [.] 0x0000000000010261
     1.00%    prime  libgee.so.2.0.0             [.] 0x000000000001026d
     0.95%    prime  libgee.so.2.0.0             [.] 0x00000000000102b4
     0.89%    prime  libgee.so.2.0.0             [.] 0x0000000000010250
     0.69%    prime  libgee.so.2.0.0             [.] gee_abstract_list_get
     0.68%    prime  libc-2.19.so                [.] vfprintf</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Itemized performance counter stats for the interpreted Python <code>prime</code>.</div>
<div class="content">
<pre><code># Overhead  Command      Shared Object                               Symbol
# ........  .......  .................  ...................................
#
    28.81%    prime  python3.4          [.] PyEval_EvalFrameEx
    11.70%    prime  python3.4          [.] PyDict_GetItem
     5.95%    prime  python3.4          [.] PyDict_SetItem
     1.99%    prime  python3.4          [.] 0x000000000017f184
     1.79%    prime  python3.4          [.] 0x00000000000d2ad7
     1.79%    prime  python3.4          [.] PyLong_FromLong
     1.79%    prime  python3.4          [.] 0x00000000000d2b0d
     1.79%    prime  python3.4          [.] PyArg_UnpackTuple
     1.59%    prime  python3.4          [.] 0x00000000000d2af2
     1.39%    prime  python3.4          [.] _PyLong_New
     1.38%    prime  python3.4          [.] 0x00000000000d2ca0
     0.99%    prime  python3.4          [.] 0x00000000000d2cae
     0.99%    prime  python3.4          [.] 0x0000000000103a47
     0.99%    prime  python3.4          [.] 0x00000000000d2aa2</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Itemized performance counter stats for the compiled Vala <code>prime</code> with GLib.</div>
<div class="content">
<pre><code># Overhead  Command            Shared Object                              Symbol
# ........  .......  .......................  ..................................
#
    94.64%    prime  libglib-2.0.so.0.4200.1  [.] g_list_last
     5.14%    prime  prime                    [.] _vala_main
     0.05%    prime  libc-2.19.so             [.] vfprintf
     0.02%    prime  libglib-2.0.so.0.4200.1  [.] g_private_get
     0.02%    prime  libglib-2.0.so.0.4200.1  [.] g_list_append
     0.02%    prime  libglib-2.0.so.0.4200.1  [.] g_slice_alloc
     0.01%    prime  libglib-2.0.so.0.4200.1  [.] g_slice_free_chain_with_offset
     0.01%    prime  libc-2.19.so             [.] _itoa_word
     0.01%    prime  libpthread-2.19.so       [.] pthread_getspecific
     0.01%    prime  libglib-2.0.so.0.4200.1  [.] 0x0000000000065c4a
     0.01%    prime  [kernel.kallsyms]        [k] apic_timer_interrupt</code></pre>
</div></div>
<div class="paragraph"><p>Now you see the <code>g_list_last</code> function in the <code>libglib-2.0</code> library is the big
overhead making the compiled Vala <code>prime</code> program with GLib to run very
slow.  You get more information from the interactive screen by pressing ENTER
on the line of the <code>g_list_last</code> function and then on the <code>Annotate
g_list_last</code> line.</p></div>
<div class="listingblock">
<div class="title">Annotated g_list_last</div>
<div class="content">
<pre><code>g_list_last
       
           Disassembly of section .text:
       
           0000000000047480 &lt;g_list_last&gt;:
             test   %rdi,%rdi
             mov    %rdi,%rax
            jne    13
            jmp    1e
             nop
 13.28 10:   mov    %rdx,%rax
       13:   mov    0x8(%rax),%rdx
 86.72       test   %rdx,%rdx
            jne    10
             repz   retq
       1e:   repz   retq</code></pre>
</div></div>
<div class="paragraph"><p>This looks like searching the end of list by scanning from the head of the
list.  This not only wastes many instructions but also runs through
large memory space causing stalled-cycles for the cached memory system.</p></div>
<div class="paragraph"><p>The assembly code "<code>repz   retq</code>" did not make sense to me.  As I searched the
web for the answer, I found this to be for <a href="http://repzret.org/p/repzret/">the code
optimization of the branch prediction mechanism</a>.  For us to read the generated
assembly code, this is practically the same as "<code>retq</code>", though.</p></div>
<div class="paragraph"><p>In the (<a href="#_c_with_the_list">C with the list</a>) source, the code is compact and
the pointer to the tail of the list is kept in the <code>tail</code> pointer variable
which is updated without scanning the whole list from the head.</p></div>
<div class="paragraph"><p>Let&#8217;s output the Vala source with GLib into C source using the <code>valac -C</code>
command and touch it up into a readable C source to inspect the situation.</p></div>
<div class="listingblock">
<div class="title">A equivalent C source for the Vala source with GLib.</div>
<div class="content">
<pre><code>/* prime.c generated by valac 0.16.1, the Vala compiler
 * generated from prime.vala, and touched up :-) */

/* The same result as Vala code for slowness */

#include &lt;glib.h&gt;
#include &lt;glib-object.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;


int main (int argc, char ** argv) {
        glong n_max = atol (argv[1]);
        GList* p = NULL;
        glong n;
        n = (glong) 1;
        while (TRUE) {
                n = n + 1;
                gboolean flag_prime;
                flag_prime = FALSE;
                if (!(n &lt; n_max)) {
                        break;
                }
                flag_prime = TRUE;
                GList* i_it = NULL;
                for (i_it = p; i_it != NULL; i_it = i_it-&gt;next) {
                        glong i = GPOINTER_TO_INT (i_it-&gt;data);
                        glong n_div_i;
                        glong n_mod_i;
                        n_div_i = n / i;
                        n_mod_i = n - (n_div_i * i);
                        if (n_mod_i == ((glong) 0)) {
                                flag_prime = FALSE;
                                break;
                        }
                        if (n_div_i &lt; i) {
                                break;
                        }
                }
                if (flag_prime == TRUE) {
                        p = g_list_append (p, GINT_TO_POINTER (n));
                }
        }
        GList* i_it = NULL;
        for (i_it = p; i_it != NULL; i_it = i_it-&gt;next) {
                glong i = 0L;
                i = GPOINTER_TO_INT (i_it-&gt;data);
                {
                        fprintf (stdout, "%ld\n", i);
                }
        }
        if (p != NULL) {
            p = (g_list_free (p), NULL);
        }
        return EXIT_SUCCESS;
}</code></pre>
</div></div>
<div class="paragraph"><p>Here, the Vala does not generate a C source with the tail tracking for the
list.  The <code>p = g_list_append (p, GINT_TO_POINTER (n));</code> code should cause many
calls to <code>g_list_last</code> for every prime numbers found. No wonder <code>g_list_last</code>
is called so many times.</p></div>
<div class="paragraph"><p>The use of <a href="https://live.gnome.org/Libgee">Gee</a> solves this problem.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_python_program">Python program</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> is a vary
<a href="http://en.wikipedia.org/wiki/High-level_programming_language">high-level
programming language</a> which offers features to support
<a href="http://en.wikipedia.org/wiki/Object-oriented_programming">OOP</a>.  It is very well
documented in the <a href="http://docs.python.org/">Python documentation web site</a>.</p></div>
<div class="paragraph"><p>Python frees us from chores of the memory management required by C and allows
us to focus on the problem solving.  Python module system allows us to organize
codes in multiple files nicely and let us divide and conqueror bugs
efficiently.</p></div>
<div class="paragraph"><p>If you are completely new to Python, I found a wiki page at
<a href="http://wiki.debian.org/DebianWomen/PythonTutorial">DebianWomen/PythonTutorial</a>
to be a very good starting point.  (I knew Python basics explained here.)</p></div>
<div class="paragraph"><p>Let me try to learn slightly advanced Python such as modules and class by going
through the following available documentation as the self-teaching session.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/tutorial/">The Python Tutorial</a> (Complete tutorial)
</p>
</li>
<li>
<p>
<a href="http://www.greenteapress.com/thinkpython/thinkpython.html">Think Python: How to Think Like a Computer Scientist</a> by Allen B. Downey
</p>
</li>
<li>
<p>
<a href="https://python-guide.readthedocs.org/en/latest/">The Hitchhikers Guide to Python!</a>
</p>
</li>
<li>
<p>
Wikipedia articles
</p>
</li>
</ul></div>
<div class="paragraph"><p>Consider the following as my note of the self-teaching session.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you are using Python 2.7, replace <code>python3</code> in the above examples with <code>python</code>.</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="_what_is_oop">What is OOP?</h3>
<div class="paragraph"><p>An <a href="http://en.wikipedia.org/wiki/Object_(computer_science)">object</a> is a
<strong>location in memory</strong> having a
<a href="http://en.wikipedia.org/wiki/Value_(computer_science)">value</a> and referenced by
an <a href="http://en.wikipedia.org/wiki/Identifier">identifier</a>. An object can be a
<a href="http://en.wikipedia.org/wiki/Variable_(computer_science)">variable</a>,
<a href="http://en.wikipedia.org/wiki/Subroutine">function</a>, or
<a href="http://en.wikipedia.org/wiki/Data_structure">data structure</a>.</p></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Object-oriented_programming">Object-oriented
programming (OOP)</a> is a
<a href="http://en.wikipedia.org/wiki/Programming_paradigm">programming paradigm</a>.  The
"object" for OOP refers to a particular
<a href="http://en.wikipedia.org/wiki/Instance_(computer_science)">instance</a> of a
<a href="http://en.wikipedia.org/wiki/Class_(computer_science)">class</a>. Objects are used
to interact with one another to design applications and computer programs.
"<a href="http://en.wikipedia.org/wiki/Object_(computer_science)">objects</a>" have</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Field_(computer_science)">data fields</a> (attributes that describe the object) and
</p>
</li>
<li>
<p>
associated procedures known as <a href="http://en.wikipedia.org/wiki/Method_(computer_science)">methods</a>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_python2_and_python3">Python2 and Python3</h3>
<div class="paragraph"><p>See <a href="http://wiki.python.org/moin/Python2orPython3">"Should I use Python 2 or Python 3 for my development activity?"</a></p></div>
<div class="paragraph"><p>Currently, Python is available in 2 major versions.</p></div>
<div class="ulist"><div class="title">Python2</div><ul>
<li>
<p>
Very stable (2.7 being the last version)
</p>
</li>
<li>
<p>
Very robust
</p>
</li>
<li>
<p>
Latin-1 (ISO-8859-1) encoding centric
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">Python3</div><ul>
<li>
<p>
Future of Python
</p>
</li>
<li>
<p>
Moving target
</p>
</li>
<li>
<p>
Cleaner grammer
</p>
<div class="ulist"><ul>
<li>
<p>
<code>print</code> as a function.
</p>
</li>
<li>
<p>
extensive use of iterator
</p>
</li>
</ul></div>
</li>
<li>
<p>
UTF-8 encoding centric
</p>
</li>
</ul></div>
<div class="paragraph"><p>The conversion of source files between Python2 and Python3 is done by:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/2/library/2to3.html">2to3</a>
</p>
</li>
<li>
<p>
<a href="https://pypi.python.org/pypi/3to2">3to2</a>
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Example to convert Python2 to Python3 using <code>fridge.py</code> in <a href="#_python_inheritance">Python inheritance</a></div>
<div class="content">
<pre><code>--- fridge/fridge.py    (original)
+++ fridge/fridge.py    (refactored)
@@ -3,19 +3,19 @@
 class Fridge:
     def __init__(self, name):
         self.beer = 0
-        print name, "bought a new fridge."
+        print(name, "bought a new fridge.")
         self.name = name
     def report_beer(self):
-        print self.name, "has", self.beer, "can(s) of beer in stock."
+        print(self.name, "has", self.beer, "can(s) of beer in stock.")
         return
     def stock_beer(self, cans):
-        print self.name, "stocks", cans, "can(s) of beer."
+        print(self.name, "stocks", cans, "can(s) of beer.")
         self.beer += cans
         return
     def consume_beer(self, cans):
-        print self.name, "tries to consume", cans, "can(s) of beer"
+        print(self.name, "tries to consume", cans, "can(s) of beer")
         if self.beer &lt;= cans:
-            print ("No more beer after drinking %i can(s) of beer!" % self.beer)...
+            print(("No more beer after drinking %i can(s) of beer!" % self.beer)...
             self.beer = 0
         else:
             self.beer -= cans
@@ -25,12 +25,12 @@
 class NormalFridge(Fridge):
     def __init__(self, name, min_beer):
         Fridge.__init__(self, name)
-        print name, "wishes to have", min_beer, "cans of beer"
+        print(name, "wishes to have", min_beer, "cans of beer")
         self.min_beer = min_beer
     def check_beer(self):
         if self.beer &lt; self.min_beer:
-            print ("%i extra can(s) of beer needed for good stocking." %
-                    (self.min_beer - self.beer))
+            print(("%i extra can(s) of beer needed for good stocking." %
+                    (self.min_beer - self.beer)))
         return
     def consume_beer(self, cans):
         Fridge.consume_beer(self, cans)</code></pre>
</div></div>
<div class="ulist"><div class="title">References:</div><ul>
<li>
<p>
<a href="http://docs.python.org/3/howto/pyporting.html">"Porting Python 2 Code to Python 3" in "Python HOWTOs."</a>
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/release/3.0/whatsnew/3.0.html">"Whats New In Python 3.0"</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_python_modules">Python modules</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/modules.html">"The Python Tutorial: Modules"</a>.</p></div>
<div class="paragraph"><p>The Python <strong>module</strong> is a block of reusable code which can be <strong>imported</strong> to some
Python code.</p></div>
<div class="ulist"><div class="title">Types of modules:</div><ul>
<li>
<p>
pure Python module
</p>
<div class="ulist"><ul>
<li>
<p>
a module written in Python and contained in a <code>.py</code> file.
</p>
</li>
</ul></div>
</li>
<li>
<p>
extension module
</p>
<div class="ulist"><ul>
<li>
<p>
a module written in the low-level language of the Python implementation: C/C++ for Python in a <code>.so</code> file.
</p>
</li>
<li>
<p>
extension module written in C is a shared library following <a href="http://docs.python.org/3/c-api/">Python/C API</a>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
module package
</p>
<div class="ulist"><ul>
<li>
<p>
a module package contains many modules under a tree of directories all containing <code>__init__.py</code> files.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="ulist"><div class="title">Names defined by the Python module:</div><ul>
<li>
<p>
Names defined by the current module is listed by the Python built-in function <a href="http://docs.python.org/3/tutorial/modules.html#the-dir-function"><code>dir()</code></a>.
</p>
</li>
<li>
<p>
Names defined by the <code>foo</code> module is listed by the Python built-in function <a href="http://docs.python.org/3/tutorial/modules.html#the-dir-function"><code>dir(foo)</code></a>.
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">Python module search path:</div><ul>
<li>
<p>
Python module search path is used to search Python modules by the <code>import</code> statement.
</p>
<div class="ulist"><ul>
<li>
<p>
"<code>import foo</code>" imports the Python code <code>foo.py</code> found in the Python module search path.
</p>
</li>
<li>
<p>
"<code>import foo</code>" imports the compiled C code <code>foo.so</code> found in the Python module search path.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Python module search path is defined in the Python variable <code>sys.path</code>.
</p>
</li>
<li>
<p>
Python module search path is usually customized by the <code>PYTHONPATH</code> environment variable by the user.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let&#8217;s check it with the <code>printpath2</code> script for Python 2.*.</p></div>
<div class="listingblock">
<div class="title">Program to check <code>sys.path</code> for Python 2.*</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"dir() ="</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dir</span></span><span style="color: #990000">()</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"dir(sys) ="</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dir</span></span><span style="color: #990000">(</span>sys<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"sys.path ="</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span>path</tt></pre></div></div>
<div class="paragraph"><p>The console output is:</p></div>
<div class="listingblock">
<div class="title"><code>sys.path</code> for Python 2.*</div>
<div class="content">
<pre><code>dir() = ['__builtins__', '__doc__', '__file__', '__name__', '__package__', 'sys'
]
dir(sys) = ['__displayhook__', '__doc__', '__excepthook__', '__name__', '__packa
ge__', '__stderr__', '__stdin__', '__stdout__', '_clear_type_cache', '_current_f
rames', '_getframe', '_mercurial', '_multiarch', 'api_version', 'argv', 'builtin
_module_names', 'byteorder', 'call_tracing', 'callstats', 'copyright', 'displayh
ook', 'dont_write_bytecode', 'exc_clear', 'exc_info', 'exc_type', 'excepthook',
'exec_prefix', 'executable', 'exit', 'flags', 'float_info', 'float_repr_style',
'getcheckinterval', 'getdefaultencoding', 'getdlopenflags', 'getfilesystemencodi
ng', 'getprofile', 'getrecursionlimit', 'getrefcount', 'getsizeof', 'gettrace',
'hexversion', 'long_info', 'maxint', 'maxsize', 'maxunicode', 'meta_path', 'modu
les', 'path', 'path_hooks', 'path_importer_cache', 'platform', 'prefix', 'py3kwa
rning', 'pydebug', 'setcheckinterval', 'setdlopenflags', 'setprofile', 'setrecur
sionlimit', 'settrace', 'stderr', 'stdin', 'stdout', 'subversion', 'version', 'v
ersion_info', 'warnoptions']
sys.path = ['/path/to/path', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_
64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/
lib/python2.7/lib-dynload', '/home/osamu/.local/lib/python2.7/site-packages', '/
usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/us
r/lib/python2.7/dist-packages/PILcompat', '/usr/lib/python2.7/dist-packages/gtk-
2.0', '/usr/lib/pymodules/python2.7', '/usr/lib/python2.7/dist-packages/wx-3.0-g
tk2']</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s check it with the <code>printpath3</code> script for Python 3.*.</p></div>
<div class="listingblock">
<div class="title">Program to check <code>sys.path</code> for Python 3.*</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"dir() ="</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dir</span></span><span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"dir(sys) ="</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">dir</span></span><span style="color: #990000">(</span>sys<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"sys.path ="</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span>path<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The console output is:</p></div>
<div class="listingblock">
<div class="title"><code>sys.path</code> for Python 3.*</div>
<div class="content">
<pre><code>dir() = ['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__n
ame__', '__package__', '__spec__', 'sys']
dir(sys) = ['__displayhook__', '__doc__', '__excepthook__', '__interactivehook__
', '__loader__', '__name__', '__package__', '__spec__', '__stderr__', '__stdin__
', '__stdout__', '_clear_type_cache', '_current_frames', '_debugmallocstats', '_
getframe', '_home', '_mercurial', '_xoptions', 'abiflags', 'api_version', 'argv'
, 'base_exec_prefix', 'base_prefix', 'builtin_module_names', 'byteorder', 'call_
tracing', 'callstats', 'copyright', 'displayhook', 'dont_write_bytecode', 'exc_i
nfo', 'excepthook', 'exec_prefix', 'executable', 'exit', 'flags', 'float_info',
'float_repr_style', 'getallocatedblocks', 'getcheckinterval', 'getdefaultencodin
g', 'getdlopenflags', 'getfilesystemencoding', 'getprofile', 'getrecursionlimit'
, 'getrefcount', 'getsizeof', 'getswitchinterval', 'gettrace', 'hash_info', 'hex
version', 'implementation', 'int_info', 'intern', 'maxsize', 'maxunicode', 'meta
_path', 'modules', 'path', 'path_hooks', 'path_importer_cache', 'platform', 'pre
fix', 'setcheckinterval', 'setdlopenflags', 'setprofile', 'setrecursionlimit', '
setswitchinterval', 'settrace', 'stderr', 'stdin', 'stdout', 'thread_info', 'ver
sion', 'version_info', 'warnoptions']
sys.path = ['/path/to/path', '/usr/lib/python3.4', '/usr/lib/python3.4/plat-x86_
64-linux-gnu', '/usr/lib/python3.4/lib-dynload', '/home/osamu/.local/lib/python3
.4/site-packages', '/usr/local/lib/python3.4/dist-packages', '/usr/lib/python3/d
ist-packages']</code></pre>
</div></div>
<div class="paragraph"><p>The Python module search path is set as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
The directory containing the input script.
</p>
<div class="ulist"><ul>
<li>
<p>
The current working directory for interactive <code>python</code>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>PYTHONPATH</code> environment variable.
</p>
<div class="ulist"><ul>
<li>
<p>
colon (":") separated on Unix-like systems (defined in <code>.bashrc</code> etc.)
</p>
</li>
<li>
<p>
semicolon (";") separated on the Windows system
</p>
</li>
</ul></div>
</li>
<li>
<p>
The installation-dependent default.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>/usr/lib/python*.*</code>
</p>
</li>
<li>
<p>
<code>/usr/lib/python*.*/plat-linux*</code>
</p>
</li>
<li>
<p>
<code>/usr/lib/python*.*/lib-dynload</code>
</p>
</li>
<li>
<p>
<code>/home/&lt;user_name&gt;/.local/lib/python*.*/site-packages</code> (installed by the local user.)
</p>
</li>
<li>
<p>
<code>/usr/local/lib/python*.*/dist-packages</code> (installed by the local admin.)
</p>
</li>
<li>
<p>
<code>/usr/lib/python*/dist-packages</code> (installed by the Debian system.)
</p>
</li>
</ul></div>
</li>
<li>
<p>
The content of any <code>*.pth</code> files (if present)
</p>
<div class="ulist"><ul>
<li>
<p>
<code>/usr/lib/python2.7/dist-packages/PIL.pth</code> containing <code>PIL</code> to include <code>/usr/lib/python2.7/dist-packages/PIL</code>. (Python 2)
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The additional Python module search path including <code>dist-packages</code> are for modules provided by the Debian system.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <code>sys.path</code> value consists of only existing directory path on the system.  (I.e., <code>/home/&lt;user_name&gt;/.local/lib/python3.2/site-packages</code> should exist to see it in the above example.)</p></div>
<div class="ulist"><div class="title">References:</div><ul>
<li>
<p>
<a href="http://www.debian.org/doc/packaging-manuals/python-policy/ch-python.html#s-paths">"Debian Python Policy": "Module Path"</a>.
</p>
</li>
<li>
<p>
<a href="http://www.debian.org/doc/packaging-manuals/python-policy/ch-module_packages.html">"Debian Python Policy": "Debian packaged modules"</a>.
</p>
</li>
<li>
<p>
<a href="http://wiki.debian.org/Python#Deviations_from_upstream">"Debian wiki": "Python: Deviations from upstream"</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_python_module_package">Python module package</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/modules.html#packages">"The Python Tutorial: Python module package."</a></p></div>
<div class="paragraph"><p>Python module files may be organized in multi-level directories.
For example on Unix-like environments, a Python module package <code>foo</code> may
contain directories and files as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>foo/
    __init__.py
    bar.py
    baz/
        __init__.py
        qux.py</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<code>foo/</code> should reside in the Python module search path <code>sys.path</code>.
</p>
</li>
<li>
<p>
All directories in the Python module package should contain <code>__init__.py</code>.
</p>
</li>
<li>
<p>
The module name uses the platform independent "dotted module name" convention.
</p>
<div class="ulist"><ul>
<li>
<p>
The module name <code>foo</code> accesses the module file <code>foo/__init__.py</code>.
</p>
</li>
<li>
<p>
The module name <code>foo.bar</code> accesses the module file <code>foo/bar.py</code>.
</p>
</li>
<li>
<p>
The module name <code>foo.baz</code> accesses the module file <code>foo/baz/__init__.py</code>.
</p>
</li>
<li>
<p>
The module name <code>foo.baz.qux</code> accesses the module file <code>foo/baz/qux.py</code>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
"<code>import foo</code>" imports the entire Python module package <code>foo</code> including all submodules.
</p>
</li>
<li>
<p>
The Python module <code>*.py</code> in the above may alternatively be the shared libraries <code>*.so</code> following <a href="http://docs.python.org/3/c-api/">Python/C API</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_python_scope">Python scope</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/classes.html#python-scopes-and-namespaces">"The Python Tutorial: Python Scopes and Namespaces."</a></p></div>
<div class="paragraph"><p>A <strong>scope</strong> is a textual region of a Python program where a namespace is <strong>directly accessible</strong> by the unqualified reference to a name.  It is determined textually no matter from where or by what alias the function is called.</p></div>
<div class="paragraph"><p>The <strong>name searching order</strong> is the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
the <strong>local</strong> names in the innermost scope
</p>
</li>
<li>
<p>
the <strong>non-local</strong> names in the nearest enclosing scope (excluding the last 2 scopes)
</p>
</li>
<li>
<p>
the <strong>global</strong> names in the next-to-last scope
</p>
</li>
<li>
<p>
the <strong>built-in</strong> names in the outermost scope.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <strong>name binding scope</strong> can be manipulated.</p></div>
<div class="ulist"><ul>
<li>
<p>
The nonlocal statement rebinds variables as the non-local names.
</p>
</li>
<li>
<p>
The global statement rebinds variables as the global names.
</p>
</li>
<li>
<p>
The del statement removes the binding of the local variables.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here is an example of code to show scopes and namespaces: <code>test_scope</code>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vi:se ts=4 sts=4 et:</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
<span style="font-style: italic"><span style="color: #9A1900">#######################################################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_spam</span></span><span style="color: #990000">(</span>context<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>context<span style="color: #990000">,</span> <span style="color: #FF0000">"EXT Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>context<span style="color: #990000">,</span> <span style="color: #FF0000">"EXT Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">#######################################################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">scope_test</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">do_local</span></span><span style="color: #990000">():</span>
        spam <span style="color: #990000">=</span> <span style="color: #FF0000">"local spam"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">do_nonlocal</span></span><span style="color: #990000">():</span>
        nonlocal spam
        spam <span style="color: #990000">=</span> <span style="color: #FF0000">"nonlocal spam"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">do_del_nonlocal</span></span><span style="color: #990000">():</span>
        nonlocal spam
        <span style="font-weight: bold"><span style="color: #0000FF">del</span></span> spam
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">do_global</span></span><span style="color: #990000">():</span>
        <span style="font-weight: bold"><span style="color: #0000FF">global</span></span> spam
        spam <span style="color: #990000">=</span> <span style="color: #FF0000">"global spam"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_spam_in</span></span><span style="color: #990000">(</span>context<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>context<span style="color: #990000">,</span> <span style="color: #FF0000">"IN Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>context<span style="color: #990000">,</span> <span style="color: #FF0000">"IN Error"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">#----------------------------------------------------------------------</span></span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status before scope_test() INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Scope"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Scope"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Make assignment INSIDE ###</span></span>
    spam <span style="color: #990000">=</span> <span style="color: #FF0000">"scope_test spam"</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after assignment INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Assign"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Assign"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Make local assignment INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">do_local</span></span><span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_local INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"local"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"local"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_local INT ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">test_spam_in</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"local"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_local EXT ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">test_spam</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"local"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">### Make nonlocal assignment INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">do_nonlocal</span></span><span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_nonlocal INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_nonlocal INT ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">test_spam_in</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_nonlocal EXT ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">test_spam</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">### Make nonlocal del INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">do_del_nonlocal</span></span><span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_nonlocal INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal after del"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal after del"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_local INT ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">test_spam_in</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"nonlocal after del"</span><span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">### Make global assignment INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #000000">do_global</span></span><span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after do_global INSIDE ###</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Global "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Global "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">#######################################################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status before scope_test() OUTSIDE ###</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Start "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Start "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
<span style="font-style: italic"><span style="color: #9A1900">### Call scope_test() ###</span></span>
<span style="font-weight: bold"><span style="color: #000000">scope_test</span></span><span style="color: #990000">()</span>
<span style="font-style: italic"><span style="color: #9A1900">### Check spam status after scope_test() OUTSIDE ###</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"End   "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Valid:"</span><span style="color: #990000">,</span> spam<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"End   "</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Error:"</span><span style="color: #990000">,</span> sys<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exc_info</span></span><span style="color: #990000">()[</span><span style="color: #993399">1</span><span style="color: #990000">])</span>
</tt></pre></div></div>
<div class="paragraph"><p>This is a bit more complicated than the <a href="http://docs.python.org/3/tutorial/classes.html#scopes-and-namespaces-example">example found on Python Tutorial</a> since this <a href="http://docs.python.org/3/tutorial/errors.html#handling-exceptions">handles exceptions</a> caused by the errors.</p></div>
<div class="paragraph"><p>Let&#8217;s execute this.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Start  Error: name 'spam' is not defined
Scope Error: local variable 'spam' referenced before assignment
Assign Valid: scope_test spam
local Valid: scope_test spam
local IN Valid: scope_test spam
local EXT Error: name 'spam' is not defined
nonlocal Valid: nonlocal spam
nonlocal IN Valid: nonlocal spam
nonlocal EXT Error: name 'spam' is not defined
nonlocal after del Error: local variable 'spam' referenced before assignment
nonlocal after del IN Error free variable 'spam' referenced before assignment in
 enclosing scope
Global  Error: local variable 'spam' referenced before assignment
End    Valid: global spam</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_python_class">Python class</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/classes.html#a-first-look-at-classes">"The Python Tutorial: A First Look at Classes."</a></p></div>
<div class="paragraph"><p>When a <strong>class definition</strong> is left normally (via the end), a <strong>class object</strong> is created.  Class object for <code>MyClass</code> has attributes such as <code>foo</code> and <code>bar</code> globally referenced as <code>MyClass.foo</code> and <code>MyClass.bar</code>.</p></div>
<div class="paragraph"><p>By the assignment of a class object, a new <strong>instance object</strong> such as <code>x</code> is created.  <strong>Instance objects</strong> can have 2 types of valid attributes:  <strong>data attribute</strong> and <strong>method attribute</strong>.  They may be referenced as <code>x.foo</code> and <code>x.bar</code>.</p></div>
<div class="paragraph"><p>The <strong>data attribute</strong> in Python is equivalent of <strong>instance variables</strong> in <a href="http://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a> and <strong>data members</strong> in <a href="http://en.wikipedia.org/wiki/C++">C++</a>.</p></div>
<div class="paragraph"><p><strong>Data attributes</strong> override <strong>method attributes</strong> and may cause confusion.  There are some naming conventions to prevent this confusion.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>data attribute</strong> names
</p>
<div class="ulist"><ul>
<li>
<p>
prefix with a underscore
</p>
</li>
<li>
<p>
using nouns
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>method attribute</strong> names
</p>
<div class="ulist"><ul>
<li>
<p>
capitalize
</p>
</li>
<li>
<p>
using verbs
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>The first argument of a method is called <code>self</code> by convention.</p></div>
<div class="paragraph"><p>An object has class (also called its type) which is stored as <code>object.__class__</code>.</p></div>
<div class="paragraph"><p>The instantiation method is defined by <code>def __init__(self):</code> etc.</p></div>
</div>
<div class="sect2">
<h3 id="_python_inheritance">Python inheritance</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/classes.html#inheritance">"The Python Tutorial: Inheritance."</a></p></div>
<div class="paragraph"><p>The syntax for the derived class definition starts with:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>class DerivedClassName(BaseClassName):</code>
</p>
</li>
<li>
<p>
<code>class DerivedClassName(modname.BaseClassName):</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Derived classes may override methods of their base classes. (I.e., All methods in Python are effectively <a href="http://en.wikipedia.org/wiki/Virtual_function">virtual methods</a> in <a href="http://en.wikipedia.org/wiki/C++">C++</a> sense.)</p></div>
<div class="paragraph"><p>A base class accessible as <code>BaseClassName</code> may be extended by calling its method directly as <code>BaseClassName.methodname(self, arguments)</code>.</p></div>
<div class="paragraph"><p>Python has two built-in functions that work with inheritance:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>isinstance()</code>
</p>
<div class="ulist"><ul>
<li>
<p>
<code>isinstance(obj, int)</code> is True only if <code>obj.__class__</code> for the <code>obj</code> instance is <code>int</code> or some class derived from <code>int</code>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>issubclass()</code>
</p>
<div class="ulist"><ul>
<li>
<p>
issubclass(bool, int) is True since <code>bool</code> is a subclass of <code>int</code>.
</p>
</li>
<li>
<p>
issubclass(float, int) is False since <code>float</code> is not a subclass of <code>int</code>.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Python supports a form of multiple inheritance as well. A class definition with multiple base classes looks like this:</p></div>
<div class="paragraph"><p>The syntax for the multiple inheritance starts with:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>class DerivedClassName(Base1, Base2, Base3):</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The attributes inherited from a parent class is searched basically as:</p></div>
<div class="ulist"><ul>
<li>
<p>
depth-first
</p>
</li>
<li>
<p>
left-to-right
</p>
</li>
<li>
<p>
not searching twice in the same class where there is an overlap in the hierarchy.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Thus, the search order is:</p></div>
<div class="ulist"><ul>
<li>
<p>
attributes found in <code>DerivedClassName</code>
</p>
</li>
<li>
<p>
attributes found in <code>Base1</code> class
</p>
</li>
<li>
<p>
attributes found in recursively in the base classes of <code>Base1</code>
</p>
</li>
<li>
<p>
attributes found in <code>Base2</code> class
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>In practice, slightly more complex method resolution order like the call-next-method of <a href="http://en.wikipedia.org/wiki/Common_Lisp_Object_System">CLOS</a> is supported via cooperative calls to the <a href="http://docs.python.org/3.1/library/functions.html#super">super</a> built-in function. (This is out-of-scope for me now.)</p></div>
<div class="paragraph"><p>Here is an example of code <code>fridge/fridge.py</code> in Python2 to show how class and inheritance can be used.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vi:se ts=4 sts=4 et:</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Fridge<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>beer <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> name<span style="color: #990000">,</span> <span style="color: #FF0000">"bought a new fridge."</span>
        self<span style="color: #990000">.</span>name <span style="color: #990000">=</span> name
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">report_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"has"</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer in stock."</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"stocks"</span><span style="color: #990000">,</span> cans<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer."</span>
        self<span style="color: #990000">.</span>beer <span style="color: #990000">+=</span> cans
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"tries to consume"</span><span style="color: #990000">,</span> cans<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer"</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>beer <span style="color: #990000">&lt;=</span> cans<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"No more beer after drinking %i can(s) of beer!"</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">)</span>
            self<span style="color: #990000">.</span>beer <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>beer <span style="color: #990000">-=</span> cans
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">report_beer</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">NormalFridge</span></span><span style="color: #990000">(</span>Fridge<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">,</span> min_beer<span style="color: #990000">):</span>
        Fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> name<span style="color: #990000">,</span> <span style="color: #FF0000">"wishes to have"</span><span style="color: #990000">,</span> min_beer<span style="color: #990000">,</span> <span style="color: #FF0000">"cans of beer"</span>
        self<span style="color: #990000">.</span>min_beer <span style="color: #990000">=</span> min_beer
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">check_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>beer <span style="color: #990000">&lt;</span> self<span style="color: #990000">.</span>min_beer<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"%i extra can(s) of beer needed for good stocking."</span> <span style="color: #990000">%</span>
                    <span style="color: #990000">(</span>self<span style="color: #990000">.</span>min_beer <span style="color: #990000">-</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        Fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">check_beer</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test</span></span><span style="color: #990000">(</span>name <span style="color: #990000">=</span> <span style="color: #FF0000">"Tom"</span><span style="color: #990000">,</span> minimum <span style="color: #990000">=</span> <span style="color: #993399">6</span><span style="color: #990000">):</span>
    tom_fridge <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">NormalFridge</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> minimum<span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">12</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">8</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">test</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s execute this.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Tom bought a new fridge.
Tom wishes to have 6 cans of beer
Tom stocks 12 can(s) of beer.
Tom tries to consume 5 can(s) of beer
Tom has 7 can(s) of beer in stock.
Tom tries to consume 5 can(s) of beer
Tom has 2 can(s) of beer in stock.
4 extra can(s) of beer needed for good stocking.
Tom tries to consume 5 can(s) of beer
No more beer after drinking 2 can(s) of beer!
Tom has 0 can(s) of beer in stock.
6 extra can(s) of beer needed for good stocking.
Tom stocks 8 can(s) of beer.
Tom tries to consume 3 can(s) of beer
Tom has 5 can(s) of beer in stock.
1 extra can(s) of beer needed for good stocking.</code></pre>
</div></div>
<div class="paragraph"><p>Here is an example of code <code>fridge/fridge.py</code> in Python3 converted from the above example by <code>2to3</code> as described in <a href="#_python2_and_python3">Python2 and Python3</a>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vi:se ts=4 sts=4 et:</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Fridge<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>beer <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"bought a new fridge."</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>name <span style="color: #990000">=</span> name
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">report_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"has"</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer in stock."</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"stocks"</span><span style="color: #990000">,</span> cans<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer."</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>beer <span style="color: #990000">+=</span> cans
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"tries to consume"</span><span style="color: #990000">,</span> cans<span style="color: #990000">,</span> <span style="color: #FF0000">"can(s) of beer"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>beer <span style="color: #990000">&lt;=</span> cans<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">((</span><span style="color: #FF0000">"No more beer after drinking %i can(s) of beer!"</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">))</span>
            self<span style="color: #990000">.</span>beer <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>beer <span style="color: #990000">-=</span> cans
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">report_beer</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">NormalFridge</span></span><span style="color: #990000">(</span>Fridge<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">,</span> min_beer<span style="color: #990000">):</span>
        Fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> name<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> <span style="color: #FF0000">"wishes to have"</span><span style="color: #990000">,</span> min_beer<span style="color: #990000">,</span> <span style="color: #FF0000">"cans of beer"</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>min_beer <span style="color: #990000">=</span> min_beer
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">check_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>beer <span style="color: #990000">&lt;</span> self<span style="color: #990000">.</span>min_beer<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">((</span><span style="color: #FF0000">"%i extra can(s) of beer needed for good stocking."</span> <span style="color: #990000">%</span>
                    <span style="color: #990000">(</span>self<span style="color: #990000">.</span>min_beer <span style="color: #990000">-</span> self<span style="color: #990000">.</span>beer<span style="color: #990000">)))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">):</span>
        Fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> cans<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">check_beer</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test</span></span><span style="color: #990000">(</span>name <span style="color: #990000">=</span> <span style="color: #FF0000">"Tom"</span><span style="color: #990000">,</span> minimum <span style="color: #990000">=</span> <span style="color: #993399">6</span><span style="color: #990000">):</span>
    tom_fridge <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">NormalFridge</span></span><span style="color: #990000">(</span>name<span style="color: #990000">,</span> minimum<span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">12</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">stock_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">8</span><span style="color: #990000">)</span>
    tom_fridge<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">consume_beer</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">test</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s execute this.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Tom bought a new fridge.
Tom wishes to have 6 cans of beer
Tom stocks 12 can(s) of beer.
Tom tries to consume 5 can(s) of beer
Tom has 7 can(s) of beer in stock.
Tom tries to consume 5 can(s) of beer
Tom has 2 can(s) of beer in stock.
4 extra can(s) of beer needed for good stocking.
Tom tries to consume 5 can(s) of beer
No more beer after drinking 2 can(s) of beer!
Tom has 0 can(s) of beer in stock.
6 extra can(s) of beer needed for good stocking.
Tom stocks 8 can(s) of beer.
Tom tries to consume 3 can(s) of beer
Tom has 5 can(s) of beer in stock.
1 extra can(s) of beer needed for good stocking.</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_python_private_variables">Python private variables</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/tutorial/classes.html#private-variables">"The Python Tutorial: Private Variables."</a></p></div>
<div class="paragraph"><p><strong>Private</strong> instance variables that should be treated as a non-public part of the API normally use names prefixed with an underscore (e.g. <code>_spam</code>) by convention.</p></div>
<div class="paragraph"><p>The name mangling mechanism to support class-private members:</p></div>
<div class="ulist"><ul>
<li>
<p>
For current class name of <code>classname</code> or <code>_classname</code>:
</p>
<div class="ulist"><ul>
<li>
<p>
Replace <code>__spam</code> with <code>_classname__spam</code>.
</p>
</li>
<li>
<p>
Replace <code>__spam_</code> with <code>_classname__spam_</code>.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_install_python_source_distribution">Install Python source distribution</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/install/">"The Python Tutorial: Installing Python
Modules"</a> to learn <code>distutils</code> from user&#8217;s perspective.</p></div>
<div class="paragraph"><p>Python programs are normally distributed as a tar ball containing Python module
package and script files.  These are managed by the cross-platform distribution
utility, <code>distutils</code>.  The Python source distribution tar ball can be untared
as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>setup.py
foo/
    __init__.py
    bar.py
    baz/
        __init__.py
        qux.py
scripts/
    command_line_command</code></pre>
</div></div>
<div class="paragraph"><p>The <code>setup.py</code> script of <code>distutils</code> installs Python module package <code>foo</code> in this Python source distribution to the <code>lib/pythonX.Y/site-packages</code> subdirectory with:</p></div>
<div class="listingblock">
<div class="title">Basic install (system wide to <code>/usr/local</code>)</div>
<div class="content">
<pre><code>$ sudo python3 setup.py install</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Alternate install (per user to <code>~/.local</code>)</div>
<div class="content">
<pre><code>$ pythone setup.py install --user</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Alternate install (per user to <code>~/</code>)</div>
<div class="content">
<pre><code>$ python3 setup.py install --home</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Alternate install (custom to <code>/path/to</code>)</div>
<div class="content">
<pre><code>$ python3 setup.py install --prefix=/path/to</code></pre>
</div></div>
<div class="paragraph"><p>Each execution of <code>setup.py</code> script in the above examples also installs files in the <code>scripts</code> to the corresponding <code>bin</code> subdirectory.</p></div>
</div>
<div class="sect2">
<h3 id="_generate_python_source_distribution">Generate Python source distribution</h3>
<div class="paragraph"><p>See <a href="http://docs.python.org/3/distutils/">"The Python Tutorial: Distributing
Python Modules"</a> and <a href="http://guide.python-distribute.org/">The Hitchhikers Guide
to Packaging</a> to learn <code>distutils</code> from developer&#8217;s perspective.</p></div>
<div class="paragraph"><p>The <code>setup.py</code> script of <code>distutils</code> can generate Python source distribution from the source tree containing Python modules and script files.</p></div>
<div class="listingblock">
<div class="title">Generate Python source distribution</div>
<div class="content">
<pre><code>$ python3 setup.py sdist</code></pre>
</div></div>
<div class="paragraph"><p>This creates a <code>dist/foo-1.0.tar.gz</code> tar ball file for the Python source distribution.</p></div>
</div>
<div class="sect2">
<h3 id="_example_1_of_python_source_distribution">Example #1 of Python source distribution</h3>
<div class="paragraph"><p>Let&#8217;s populate the <code>fridge</code> directory with a few files to make Python source distribution.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>fridge.py</code> : Python module <code>fridge</code> to be packaged (see <a href="#_python_inheritance">Python inheritance</a>).
</p>
</li>
<li>
<p>
<code>README</code> : Package description
</p>
</li>
<li>
<p>
<code>setup.py</code> : Package configuration for the Python source distribution.
</p>
</li>
<li>
<p>
<code>scripts/jane</code>, &#8230; : Python script using Python module <code>fridge</code>.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Let&#8217;s make a source tree for Python module <code>fridge</code>.</div>
<div class="content">
<pre><code>fridge:
total 20
-rw-r--r-- 1 osamu osamu 1586 Aug 20 23:25 fridge.py
-rw-r--r-- 1 osamu osamu 1579 Aug 20 23:25 fridge.py.bak
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 scripts
-rwxr-xr-x 1 osamu osamu  362 Apr  5  2013 setup.py

fridge/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$
$ cat fridge/setup.py
#!/usr/bin/python3
# vi:se ts=4 sts=4 et si:
from distutils.core import setup
setup(name='fridge',
    version='1.0',
    description='Python Distutils practice',
    author='Osamu Aoki',
    author_email='osamu@debian.org',
    url='http://people.debian.org/~osamu/',
    py_modules=['fridge'],
    scripts=['scripts/jane', 'scripts/joe', 'scripts/tom'],
    )
$
$ cat fridge/README
python source package practice
$
$ cat fridge/scripts/jane
#!/usr/bin/python3
import fridge
import sys

if __name__ == '__main__':
    print(sys.path)
    fridge.test(name = "Jane")
$
$ cat fridge/scripts/joe
#!/usr/bin/python3
import fridge

if __name__ == '__main__':
    fridge.test(name = "Joe")
$
$ cat fridge/scripts/tom
#!/usr/bin/python3
import fridge

if __name__ == '__main__':
    fridge.test()</code></pre>
</div></div>
<div class="paragraph"><p>Please note "<code>py_modules=['fridge'],</code>" in <code>setup.py</code> which tells to
use the <code>fridge.py</code> file as the <code>fridge</code> module.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s execute <code>setup.py</code> and generate Python source distribution</div>
<div class="content">
<pre><code>/path/to/package2/fridge
running sdist
running check
warning: sdist: manifest template 'MANIFEST.in' does not exist (using default fil...

writing manifest file 'MANIFEST'
creating fridge-1.0
creating fridge-1.0/scripts
making hard links in fridge-1.0...
hard linking README -&gt; fridge-1.0
hard linking fridge.py -&gt; fridge-1.0
hard linking setup.py -&gt; fridge-1.0
hard linking scripts/jane -&gt; fridge-1.0/scripts
hard linking scripts/joe -&gt; fridge-1.0/scripts
hard linking scripts/tom -&gt; fridge-1.0/scripts
creating dist
Creating tar archive
removing 'fridge-1.0' (and everything under it)
/path/to/package2</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Let&#8217;s see the updated source tree for fridge</div>
<div class="content">
<pre><code>fridge:
total 28
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 dist
-rw-r--r-- 1 osamu osamu 1586 Aug 20 23:25 fridge.py
-rw-r--r-- 1 osamu osamu 1579 Aug 20 23:25 fridge.py.bak
-rw-rw-r-- 1 osamu osamu  106 Aug 20 23:25 MANIFEST
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 scripts
-rwxr-xr-x 1 osamu osamu  362 Apr  5  2013 setup.py

fridge/dist:
total 4
-rw-rw-r-- 1 osamu osamu 1219 Aug 20 23:25 fridge-1.0.tar.gz

fridge/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$
$ tar -tvzf fridge/dist/fridge-1.0.tar.gz
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/
-rw-rw-r-- osamu/osamu     233 2015-08-20 23:25 fridge-1.0/PKG-INFO
-rw-rw-r-- osamu/osamu      31 2013-03-28 22:17 fridge-1.0/README
-rw-r--r-- osamu/osamu    1586 2015-08-20 23:25 fridge-1.0/fridge.py
-rwxr-xr-x osamu/osamu     362 2013-04-05 23:58 fridge-1.0/setup.py
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/scripts/
-rw-r--r-- osamu/osamu     124 2013-04-06 18:14 fridge-1.0/scripts/jane
-rw-r--r-- osamu/osamu      93 2013-03-28 20:18 fridge-1.0/scripts/joe
-rw-r--r-- osamu/osamu      81 2013-03-28 20:19 fridge-1.0/scripts/tom
$
$ tar -xvzOf fridge/dist/fridge-1.0.tar.gz fridge-1.0/PKG-INFO
fridge-1.0/PKG-INFO
Metadata-Version: 1.0
Name: fridge
Version: 1.0
Summary: Python Distutils practice
Home-page: http://people.debian.org/~osamu/
Author: Osamu Aoki
Author-email: osamu@debian.org
License: UNKNOWN
Description: UNKNOWN
Platform: UNKNOWN</code></pre>
</div></div>
<div class="paragraph"><p>You see few files generated.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>MANIFEST</code> : auto generated by distutils.
</p>
</li>
<li>
<p>
<code>dist</code> : directory for generated Python source distribution packages.
</p>
</li>
<li>
<p>
<code>dist/fridge-1.0.tar.gz</code> :  Python source distribution package.
</p>
</li>
<li>
<p>
<code>PKG-INFO</code> in <code>dist/fridge-1.0.tar.gz</code> : Metadata for Python source distribution package generated from the <code>setup.py</code> file.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Let&#8217;s untar Python source distribution package and install as user.</div>
<div class="content">
<pre><code>fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
$ cd dist/fridge-1.0; python3 setup.py install --user;cd -
/path/to/package2/dist/fridge-1.0
running install
running build
running build_py
creating build
creating build/lib
copying fridge.py -&gt; build/lib
running build_scripts
creating build/scripts-3.4
copying and adjusting scripts/jane -&gt; build/scripts-3.4
copying and adjusting scripts/joe -&gt; build/scripts-3.4
copying and adjusting scripts/tom -&gt; build/scripts-3.4
changing mode of build/scripts-3.4/jane from 664 to 775
changing mode of build/scripts-3.4/joe from 664 to 775
changing mode of build/scripts-3.4/tom from 664 to 775
running install_lib
copying build/lib/fridge.py -&gt; /home/osamu/.local/lib/python3.4/site-packages
byte-compiling /home/osamu/.local/lib/python3.4/site-packages/fridge.py to fridge...
running install_scripts
copying build/scripts-3.4/jane -&gt; /home/osamu/.local/bin
copying build/scripts-3.4/joe -&gt; /home/osamu/.local/bin
copying build/scripts-3.4/tom -&gt; /home/osamu/.local/bin
changing mode of /home/osamu/.local/bin/jane to 775
changing mode of /home/osamu/.local/bin/joe to 775
changing mode of /home/osamu/.local/bin/tom to 775
running install_egg_info
Removing /home/osamu/.local/lib/python3.4/site-packages/fridge-1.0.egg-info
Writing /home/osamu/.local/lib/python3.4/site-packages/fridge-1.0.egg-info
/path/to/package2
$ jane|fold
['/home/osamu/.local/bin', '/usr/lib/python3.4', '/usr/lib/python3.4/plat-x86_64
-linux-gnu', '/usr/lib/python3.4/lib-dynload', '/home/osamu/.local/lib/python3.4
/site-packages', '/usr/local/lib/python3.4/dist-packages', '/usr/lib/python3/dis
t-packages']
Jane bought a new fridge.
Jane wishes to have 6 cans of beer
Jane stocks 12 can(s) of beer.
Jane tries to consume 5 can(s) of beer
Jane has 7 can(s) of beer in stock.
Jane tries to consume 5 can(s) of beer
Jane has 2 can(s) of beer in stock.
4 extra can(s) of beer needed for good stocking.
Jane tries to consume 5 can(s) of beer
No more beer after drinking 2 can(s) of beer!
Jane has 0 can(s) of beer in stock.
6 extra can(s) of beer needed for good stocking.
Jane stocks 8 can(s) of beer.
Jane tries to consume 3 can(s) of beer
Jane has 5 can(s) of beer in stock.
1 extra can(s) of beer needed for good stocking.</code></pre>
</div></div>
<div class="paragraph"><p>Unfortunately, <code>distutils</code> as of now does not offer uninstall.  We need to remove files manually to uninstall them.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s uninstall Python source distribution manually.</div>
<div class="content">
<pre><code>$ rm -r ~/.local/bin/jane ~/.local/bin/joe ~/.local/bin/tom
$ rm -r ~/.local/lib/python3.2/site-packages/fridge.py
rm: cannot remove /home/osamu/.local/lib/python3.2/site-packages/fridge.py: No ...
$ rm -r ~/.local/lib/python3.2/site-packages/fridge-1.0.egg-info
rm: cannot remove /home/osamu/.local/lib/python3.2/site-packages/fridge-1.0.egg-...
$ rm -rf ~/.local/lib/python3.2/site-packages/__pycache__</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_example_2_of_python_source_distribution">Example #2 of Python source distribution</h3>
<div class="paragraph"><p>Let&#8217;s try an alternative Python source distribution with <a href="#_python_module_package">Python module package</a>.</p></div>
<div class="paragraph"><p>Basically, move <code>fridge/fridge.py</code> in Example #1 to <code>fridge/src/fridge/__init__.py</code>.</p></div>
<div class="paragraph"><p>Let&#8217;s execute this.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Tom bought a new fridge.
Tom wishes to have 6 cans of beer
Tom stocks 12 can(s) of beer.
Tom tries to consume 5 can(s) of beer
Tom has 7 can(s) of beer in stock.
Tom tries to consume 5 can(s) of beer
Tom has 2 can(s) of beer in stock.
4 extra can(s) of beer needed for good stocking.
Tom tries to consume 5 can(s) of beer
No more beer after drinking 2 can(s) of beer!
Tom has 0 can(s) of beer in stock.
6 extra can(s) of beer needed for good stocking.
Tom stocks 8 can(s) of beer.
Tom tries to consume 3 can(s) of beer
Tom has 5 can(s) of beer in stock.
1 extra can(s) of beer needed for good stocking.</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s populate the <code>fridge</code> directory with mostly the same files except:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>src/fridge/__init__.py</code> : Python module <code>fridge</code> to be packaged insted of <code>fridge.py</code> (see <a href="#_python_module_package">Python module package</a>).
</p>
</li>
<li>
<p>
<code>setup.py</code> : Package configuration for the Python source distribution (Contents of the file updated).
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Let&#8217;s make a source tree for Python module <code>fridge</code>.</div>
<div class="content">
<pre><code>fridge:
total 16
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 scripts
-rwxr-xr-x 1 osamu osamu  402 Apr  5  2013 setup.py
drwxrwxr-x 3 osamu osamu 4096 Mar 29  2013 src

fridge/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom

fridge/src:
total 4
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 fridge

fridge/src/fridge:
total 4
-rw-r--r-- 1 osamu osamu 1583 Mar 28  2013 __init__.py
$
$ cat fridge/setup.py
#!/usr/bin/python3
# vi:se ts=4 sts=4 et si:
from distutils.core import setup
setup(name='fridge',
    version='1.0',
    description='Python Distutils practice',
    author='Osamu Aoki',
    author_email='osamu@debian.org',
    url='http://people.debian.org/~osamu/',
    packages=['fridge'],
    package_dir={'fridge': 'src/fridge'},
    scripts=['scripts/jane', 'scripts/joe', 'scripts/tom'],
    )</code></pre>
</div></div>
<div class="paragraph"><p>Please note "<code>package_dir={'fridge': 'src/fridge'},</code>" in <code>setup.py</code> which tells
to use files in the <code>src/fridge</code> directory as the <code>fridge</code> module package.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s execute <code>setup.py</code> and generate Python source distribution</div>
<div class="content">
<pre><code>/path/to/package3/fridge
running sdist
running check
warning: sdist: manifest template 'MANIFEST.in' does not exist (using default fil...

writing manifest file 'MANIFEST'
creating fridge-1.0
creating fridge-1.0/scripts
creating fridge-1.0/src
creating fridge-1.0/src/fridge
making hard links in fridge-1.0...
hard linking README -&gt; fridge-1.0
hard linking setup.py -&gt; fridge-1.0
hard linking scripts/jane -&gt; fridge-1.0/scripts
hard linking scripts/joe -&gt; fridge-1.0/scripts
hard linking scripts/tom -&gt; fridge-1.0/scripts
hard linking src/fridge/__init__.py -&gt; fridge-1.0/src/fridge
creating dist
Creating tar archive
removing 'fridge-1.0' (and everything under it)
/path/to/package3</code></pre>
</div></div>
<div class="listingblock">
<div class="title">Let&#8217;s see the updated source tree for fridge</div>
<div class="content">
<pre><code>fridge:
total 24
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 dist
-rw-rw-r-- 1 osamu osamu  119 Aug 20 23:25 MANIFEST
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 scripts
-rwxr-xr-x 1 osamu osamu  402 Apr  5  2013 setup.py
drwxrwxr-x 3 osamu osamu 4096 Mar 29  2013 src

fridge/dist:
total 4
-rw-rw-r-- 1 osamu osamu 1265 Aug 20 23:25 fridge-1.0.tar.gz

fridge/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom

fridge/src:
total 4
drwxrwxr-x 2 osamu osamu 4096 Apr  6  2013 fridge

fridge/src/fridge:
total 4
-rw-r--r-- 1 osamu osamu 1583 Mar 28  2013 __init__.py
$
$ tar -tvzf fridge/dist/fridge-1.0.tar.gz
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/src/
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/src/fridge/
-rw-r--r-- osamu/osamu    1583 2013-03-28 20:10 fridge-1.0/src/fridge/__init__.py...
-rw-rw-r-- osamu/osamu     233 2015-08-20 23:25 fridge-1.0/PKG-INFO
-rw-rw-r-- osamu/osamu      31 2013-03-28 22:17 fridge-1.0/README
-rwxr-xr-x osamu/osamu     402 2013-04-05 23:59 fridge-1.0/setup.py
drwxrwxr-x osamu/osamu       0 2015-08-20 23:25 fridge-1.0/scripts/
-rw-r--r-- osamu/osamu     124 2013-04-06 18:14 fridge-1.0/scripts/jane
-rw-r--r-- osamu/osamu      93 2013-03-28 20:18 fridge-1.0/scripts/joe
-rw-r--r-- osamu/osamu      81 2013-03-28 20:19 fridge-1.0/scripts/tom</code></pre>
</div></div>
<div class="paragraph"><p>You see few files generated.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>MANIFEST</code> : auto generated by distutils.
</p>
</li>
<li>
<p>
<code>dist</code> : directory for generated Python source distribution packages.
</p>
</li>
<li>
<p>
<code>dist/fridge-1.0.tar.gz</code> :  Python source distribution package.
</p>
</li>
<li>
<p>
<code>PKG-INFO</code> in <code>dist/fridge-1.0.tar.gz</code> : Metadata for Python source distribution package generated from the <code>setup.py</code> file.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Let&#8217;s untar Python source distribution package and install as user.</div>
<div class="content">
<pre><code>fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
$ cd dist/fridge-1.0; python3 setup.py install --user;cd -
/path/to/package2/dist/fridge-1.0
running install
running build
running build_py
creating build
creating build/lib
copying fridge.py -&gt; build/lib
running build_scripts
creating build/scripts-3.4
copying and adjusting scripts/jane -&gt; build/scripts-3.4
copying and adjusting scripts/joe -&gt; build/scripts-3.4
copying and adjusting scripts/tom -&gt; build/scripts-3.4
changing mode of build/scripts-3.4/jane from 664 to 775
changing mode of build/scripts-3.4/joe from 664 to 775
changing mode of build/scripts-3.4/tom from 664 to 775
running install_lib
copying build/lib/fridge.py -&gt; /home/osamu/.local/lib/python3.4/site-packages
byte-compiling /home/osamu/.local/lib/python3.4/site-packages/fridge.py to fridge...
running install_scripts
copying build/scripts-3.4/jane -&gt; /home/osamu/.local/bin
copying build/scripts-3.4/joe -&gt; /home/osamu/.local/bin
copying build/scripts-3.4/tom -&gt; /home/osamu/.local/bin
changing mode of /home/osamu/.local/bin/jane to 775
changing mode of /home/osamu/.local/bin/joe to 775
changing mode of /home/osamu/.local/bin/tom to 775
running install_egg_info
Removing /home/osamu/.local/lib/python3.4/site-packages/fridge-1.0.egg-info
Writing /home/osamu/.local/lib/python3.4/site-packages/fridge-1.0.egg-info
/path/to/package2
$ jane|fold
['/home/osamu/.local/bin', '/usr/lib/python3.4', '/usr/lib/python3.4/plat-x86_64
-linux-gnu', '/usr/lib/python3.4/lib-dynload', '/home/osamu/.local/lib/python3.4
/site-packages', '/usr/local/lib/python3.4/dist-packages', '/usr/lib/python3/dis
t-packages']
Jane bought a new fridge.
Jane wishes to have 6 cans of beer
Jane stocks 12 can(s) of beer.
Jane tries to consume 5 can(s) of beer
Jane has 7 can(s) of beer in stock.
Jane tries to consume 5 can(s) of beer
Jane has 2 can(s) of beer in stock.
4 extra can(s) of beer needed for good stocking.
Jane tries to consume 5 can(s) of beer
No more beer after drinking 2 can(s) of beer!
Jane has 0 can(s) of beer in stock.
6 extra can(s) of beer needed for good stocking.
Jane stocks 8 can(s) of beer.
Jane tries to consume 3 can(s) of beer
Jane has 5 can(s) of beer in stock.
1 extra can(s) of beer needed for good stocking.</code></pre>
</div></div>
<div class="paragraph"><p>Unfortunately, <code>distutils</code> as of now does not offer uninstall.  We need to remove files manually to uninstall them.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s uninstall Python source distribution manually.</div>
<div class="content">
<pre><code>$ rm -r ~/.local/bin/jane ~/.local/bin/joe ~/.local/bin/tom
$ rm -r ~/.local/lib/python3.2/site-packages/fridge.py
rm: cannot remove /home/osamu/.local/lib/python3.2/site-packages/fridge.py: No ...
$ rm -r ~/.local/lib/python3.2/site-packages/fridge-1.0.egg-info
rm: cannot remove /home/osamu/.local/lib/python3.2/site-packages/fridge-1.0.egg-...
$ rm -rf ~/.local/lib/python3.2/site-packages/__pycache__</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_debian_package_from_python2_source_distribution_dh_make">Debian package from Python2 source distribution (dh_make)</h3>
<div class="paragraph"><p>The <code>dh_make</code> is handy for making a Debian package.  I will be very sloppy for now.  (More work is needed to make package suitable for Debian.)</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian source package.</div>
<div class="content">
<pre><code>fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
$ cd deb/fridge-1.0; dh_make -s --createorig --yes; cd -
/path/to/package1/deb/fridge-1.0
Maintainer name  : Osamu Aoki
Email-Address    : osamu@debian.org
Date             : Thu, 20 Aug 2015 23:25:16 +0900
Package Name     : fridge
Version          : 1.0
License          : blank
Type of Package  : Single
Currently there is no top level Makefile. This may require additional tuning.
Done. Please edit the files in the debian/ subdirectory now. You should also
check that the fridge Makefiles install into $DESTDIR and not in / .
/path/to/package1
$ ls -lR deb
deb:
total 8
drwxrwxr-x 4 osamu osamu 4096 Aug 20 23:25 fridge-1.0
-rw-rw-r-- 1 osamu osamu 1224 Aug 20 23:25 fridge_1.0.orig.tar.xz

deb/fridge-1.0:
total 24
drwxr-xr-x 3 osamu osamu 4096 Aug 20 23:25 debian
-rw-r--r-- 1 osamu osamu 1579 Apr  8  2013 fridge.py
-rw-rw-r-- 1 osamu osamu  233 Aug 20 23:25 PKG-INFO
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 scripts
-rwxr-xr-x 1 osamu osamu  361 Apr  8  2013 setup.py

deb/fridge-1.0/debian:
total 104
-rw-rw-r-- 1 osamu osamu   180 Aug 20 23:25 changelog
-rw-rw-r-- 1 osamu osamu     2 Aug 20 23:25 compat
-rw-rw-r-- 1 osamu osamu   512 Aug 20 23:25 control
-rw-rw-r-- 1 osamu osamu  1668 Aug 20 23:25 copyright
-rw-rw-r-- 1 osamu osamu     7 Aug 20 23:25 docs
-rw-rw-r-- 1 osamu osamu   128 Aug 20 23:25 fridge.cron.d.ex
-rw-rw-r-- 1 osamu osamu   232 Aug 20 23:25 fridge.default.ex
-rw-rw-r-- 1 osamu osamu   504 Aug 20 23:25 fridge.doc-base.EX
-rw-rw-r-- 1 osamu osamu  4579 Aug 20 23:25 init.d.ex
-rw-rw-r-- 1 osamu osamu  1625 Aug 20 23:25 manpage.1.ex
-rw-rw-r-- 1 osamu osamu  4648 Aug 20 23:25 manpage.sgml.ex
-rw-rw-r-- 1 osamu osamu 11003 Aug 20 23:25 manpage.xml.ex
-rw-rw-r-- 1 osamu osamu   123 Aug 20 23:25 menu.ex
-rw-rw-r-- 1 osamu osamu   956 Aug 20 23:25 postinst.ex
-rw-rw-r-- 1 osamu osamu   929 Aug 20 23:25 postrm.ex
-rw-rw-r-- 1 osamu osamu   689 Aug 20 23:25 preinst.ex
-rw-rw-r-- 1 osamu osamu   876 Aug 20 23:25 prerm.ex
-rw-rw-r-- 1 osamu osamu   173 Aug 20 23:25 README.Debian
-rw-rw-r-- 1 osamu osamu   258 Aug 20 23:25 README.source
-rwxr-xr-x 1 osamu osamu   844 Aug 20 23:25 rules
drwxr-xr-x 2 osamu osamu  4096 Aug 20 23:25 source
-rw-rw-r-- 1 osamu osamu   775 Aug 20 23:25 watch.ex

deb/fridge-1.0/debian/source:
total 4
-rw-rw-r-- 1 osamu osamu 12 Aug 20 23:25 format

deb/fridge-1.0/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$

  ... update debian/control
  ... update debian/rules
  ... touch up template files
  ... remove unused template files

$ ls -l deb/fridge-1.0/debian
total 32
-rw-rw-r-- 1 osamu osamu  180 Apr  6  2013 changelog
-rw-rw-r-- 1 osamu osamu    2 Apr  6  2013 compat
-rw-rw-r-- 1 osamu osamu  554 Apr  8  2013 control
-rw-rw-r-- 1 osamu osamu 1668 Apr  6  2013 copyright
-rw-rw-r-- 1 osamu osamu  440 Apr  6  2013 manpage.1
-rw-rw-r-- 1 osamu osamu  120 Apr  6  2013 README.Debian
-rwxr-xr-x 1 osamu osamu   67 Apr  9  2013 rules
drwxr-xr-x 2 osamu osamu 4096 Apr  6  2013 source
$ cat deb/fridge-1.0/debian/control
Source: fridge
Section: unknown
Priority: extra
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;= 8.0.0), python-minimal, python
Standards-Version: 3.9.3
X-Python-Version: &gt;= 2.6
Homepage: &lt;insert the upstream URL, if relevant&gt;
#Vcs-Git: git://git.debian.org/collab-maint/fridge.git
#Vcs-Browser: http://git.debian.org/?p=collab-maint/fridge.git;a=summary

Package: fridge
Architecture: all
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: &lt;insert up to 60 chars description&gt;
 &lt;insert long description, indented with spaces&gt;
$ cat deb/fridge-1.0/debian/rules
#!/usr/bin/make -f
#export DH_VERBOSE=1

%:
    dh $@ --with python2</code></pre>
</div></div>
<div class="paragraph"><p>Here, I add the package dependency etc. to <code>debian/control</code>.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian binary package.</div>
<div class="content">
<pre><code>/path/to/package1/deb/fridge-1.0
 dpkg-buildpackage -rfakeroot -D -us -uc -i
dpkg-buildpackage: source package fridge
dpkg-buildpackage: source version 1.0-1
dpkg-buildpackage: source distribution unstable
dpkg-buildpackage: source changed by Osamu Aoki &lt;osamu@debian.org&gt;
 dpkg-source -i --before-build fridge-1.0
dpkg-buildpackage: host architecture amd64
 fakeroot debian/rules clean
dh clean --with python2
   dh_testdir
   dh_auto_clean
    python setup.py clean -a
running clean
'build/lib.linux-x86_64-2.7' does not exist -- can't clean it
'build/bdist.linux-x86_64' does not exist -- can't clean it
'build/scripts-2.7' does not exist -- can't clean it
    find . -name \*.pyc -exec rm {} \+
   dh_clean
 dpkg-source -i -b fridge-1.0
dpkg-source: info: using source format `3.0 (quilt)'
dpkg-source: info: building fridge using existing ./fridge_1.0.orig.tar.xz
dpkg-source: info: building fridge in fridge_1.0-1.debian.tar.xz
dpkg-source: info: building fridge in fridge_1.0-1.dsc
 debian/rules build
dh build --with python2
   dh_testdir
   dh_auto_configure
   dh_auto_build
    python setup.py build --force
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying fridge.py -&gt; build/lib.linux-x86_64-2.7
running build_scripts
creating build/scripts-2.7
copying and adjusting scripts/jane -&gt; build/scripts-2.7
copying and adjusting scripts/joe -&gt; build/scripts-2.7
copying and adjusting scripts/tom -&gt; build/scripts-2.7
changing mode of build/scripts-2.7/jane from 644 to 755
changing mode of build/scripts-2.7/joe from 644 to 755
changing mode of build/scripts-2.7/tom from 644 to 755
   dh_auto_test
 fakeroot debian/rules binary
dh binary --with python2
   dh_testroot
   dh_prep
   dh_auto_install
    python setup.py install --force --root=/path/to/package1/deb/fridge-1.0/debia...
running install
running build
running build_py
running build_scripts
running install_lib
creating /path/to/package1/deb/fridge-1.0/debian/fridge/usr
creating /path/to/package1/deb/fridge-1.0/debian/fridge/usr/lib
creating /path/to/package1/deb/fridge-1.0/debian/fridge/usr/lib/python2.7
creating /path/to/package1/deb/fridge-1.0/debian/fridge/usr/lib/python2.7/dist-pa...
copying build/lib.linux-x86_64-2.7/fridge.py -&gt; /path/to/package1/deb/fridge-1.0/...
running install_scripts
creating /path/to/package1/deb/fridge-1.0/debian/fridge/usr/bin
copying build/scripts-2.7/jane -&gt; /path/to/package1/deb/fridge-1.0/debian/fridge/...
copying build/scripts-2.7/joe -&gt; /path/to/package1/deb/fridge-1.0/debian/fridge/u...
copying build/scripts-2.7/tom -&gt; /path/to/package1/deb/fridge-1.0/debian/fridge/u...
changing mode of /path/to/package1/deb/fridge-1.0/debian/fridge/usr/bin/jane to 7...
changing mode of /path/to/package1/deb/fridge-1.0/debian/fridge/usr/bin/joe to 75...
changing mode of /path/to/package1/deb/fridge-1.0/debian/fridge/usr/bin/tom to 75...
running install_egg_info
Writing /path/to/package1/deb/fridge-1.0/debian/fridge/usr/lib/python2.7/dist-pac...
   dh_installdocs
   dh_installchangelogs
   dh_python2
W: dh_python2:479: Please add dh-python package to Build-Depends
   dh_perl
   dh_link
   dh_compress
   dh_fixperms
   dh_installdeb
   dh_gencontrol
dpkg-gencontrol: warning: Depends field of package fridge: unknown substitution v...
dpkg-gencontrol: warning: package fridge: unused substitution variable ${python:D...
dpkg-gencontrol: warning: package fridge: unused substitution variable ${python:V...
   dh_md5sums
   dh_builddeb
dpkg-deb: building package `fridge' in `../fridge_1.0-1_all.deb'.
 dpkg-genchanges  &gt;../fridge_1.0-1_amd64.changes
dpkg-genchanges: including full source code in upload
 dpkg-source -i --after-build fridge-1.0
dpkg-buildpackage: full upload (original source is included)
Now running lintian...
W: fridge source: superfluous-clutter-in-homepage &lt;insert the upstream URL, if re...
N:
N:    The "Homepage:" field in this package's control file contains
N:    superfluous markup around the URL, like enclosing &lt; and &gt;. This is
N:    unnecessary and needlessly complicates using this information.
N:
N:    Refer to Debian Policy Manual section 5.6.23 (Homepage) for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge source: bad-homepage &lt;insert the upstream URL, if relevant&gt;
N:
N:    The "Homepage:" field in this package's control file does not contain a
N:    valid absolute URL. Most probably you forgot to specify the scheme (e.g.
N:    http).
N:
N:    This tag is also triggered if the scheme is not known by Lintian.
N:
N:    Please file a bug against Lintian, if this tag is triggered for a valid
N:    homepage URL.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge source: space-in-std-shortname-in-dep5-copyright &lt;special license&gt; (par...
N:
N:    The license header contains a short name with a space, which does not
N:    conform to the specification.
N:
N:    Refer to
N:    http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/ for
N:    details.
N:
N:    Severity: minor, Certainty: certain
N:
N:    Check: source-copyright, Type: source
N:
W: fridge source: ancient-standards-version 3.9.3 (current is 3.9.6)
N:
N:    The source package refers to a Standards-Version that has been obsolete
N:    for more than two years. Please update your package to latest Policy and
N:    set this control field appropriately.
N:
N:    If the package is already compliant with the current standards, you
N:    don't have to re-upload the package just to adjust the Standards-Version
N:    control field. However, please remember to update this field next time
N:    you upload the package.
N:
N:    See /usr/share/doc/debian-policy/upgrading-checklist.txt.gz in the
N:    debian-policy package for a summary of changes in newer versions of
N:    Policy.
N:
N:    Refer to https://www.debian.org/doc/debian-policy/upgrading-checklist
N:    for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: standards-version, Type: source
N:
I: fridge source: debian-watch-file-is-missing
N:
N:    This source package is not Debian-native but it does not have a
N:    debian/watch file. This file is used for automatic detection of new
N:    upstream versions by the Debian External Health Status project and other
N:    project infrastructure. If this package is maintained upstream, please
N:    consider adding a debian/watch file to detect new releases.
N:
N:    If the package is not maintained upstream or if upstream uses a
N:    distribution mechanism that cannot be meaningfully monitored by uscan
N:    and the Debian External Health Status project, please consider adding a
N:    debian/watch file containing only comments documenting the situation.
N:
N:    Refer to Debian Policy Manual section 4.11 (Optional upstream source
N:    location: debian/watch) and the uscan(1) manual page for details.
N:
N:    Severity: wishlist, Certainty: certain
N:
N:    Check: watch-file, Type: source
N:
W: fridge: wrong-bug-number-in-closes l3:#nnnn
N:
N:    Bug numbers can only contain digits.
N:
N:    Refer to Debian Policy Manual section 4.4 (Debian changelog:
N:    debian/changelog) for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
W: fridge: new-package-should-close-itp-bug
N:
N:    This package appears to be the first packaging of a new upstream
N:    software package (there is only one changelog entry and the Debian
N:    revision is 1), but it does not close any bugs. The initial upload of a
N:    new package should close the corresponding ITP bug for that package.
N:
N:    This warning can be ignored if the package is not intended for Debian or
N:    if it is a split of an existing Debian package.
N:
N:    Refer to Debian Developer's Reference section 5.1 (New packages) for
N:    details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
E: fridge: changelog-is-dh_make-template
N:
N:    The changelog file has an instruction left by dh_make, which has not
N:    been removed. Example:
N:
N:      * Initial release (Closes: #nnnn)  &lt;nnnn is the bug number of your ITP%gt...
N:
N:    The "&lt;... is the bug number ...&gt;" part has not been removed from the
N:    changelog.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
E: fridge: helper-templates-in-copyright
N:
N:    The /usr/share/doc/&lt;pkg&gt;/copyright file still contains template markers
N:    from a packaging helper. Please fill in the actual license, upstream
N:    copyright holders, and download information about the package and remove
N:    any remaining templates generated by the packaging helper.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: copyright-file, Type: binary
N:
W: fridge: copyright-has-url-from-dh_make-boilerplate
N:
N:    There is "url://example.com" in your copyright file. This was most
N:    likely a remnant from the dh_make template.
N:
N:    Make sure you include the real location where you obtained the upstream
N:    sources (if any).
N:
N:    Refer to Debian Policy Manual section 12.5 (Copyright information) for
N:    details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: copyright-file, Type: binary
N:
E: fridge: copyright-contains-dh_make-todo-boilerplate
N:
N:    The string "Please also look if..." appears in the copyright file, which
N:    indicates that you either didn't check the whole source to find
N:    additional copyright/license, or that you didn't remove that paragraph
N:    after having done so.
N:
N:    Refer to Debian Policy Manual section 12.5 (Copyright information) for
N:    details.
N:
N:    Severity: serious, Certainty: possible
N:
N:    Check: copyright-file, Type: binary
N:
E: fridge: description-is-dh_make-template
N:
N:    The synopsis or the extended description has not been changed from the
N:    template provided by dh_make.
N:
N:    Severity: serious, Certainty: certain
N:
N:    Check: description, Type: binary, udeb
N:
I: fridge: extended-description-is-probably-too-short
N:
N:    The extended description (the lines after the first line of the
N:    "Description:" field) is only one or two lines long. The extended
N:    description should provide a user with enough information to decide
N:    whether they want to install this package, what it contains, and how it
N:    compares to similar packages. One or two lines is normally not enough to
N:    do this.
N:
N:    Refer to Debian Developer's Reference section 6.2.1 (General guidelines
N:    for package descriptions) and Debian Developer's Reference section 6.2.3
N:    (The long description) for details.
N:
N:    Severity: minor, Certainty: possible
N:
N:    Check: description, Type: binary, udeb
N:
E: fridge: section-is-dh_make-template
N:
N:    The "Section:" field in this package's control file is set to unknown.
N:    This is not a valid section, and usually means a dh_make template
N:    control file was used and never modified to set the correct section.
N:
N:    Refer to Debian Policy Manual section 2.4 (Sections) for details.
N:
N:    Severity: serious, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge: superfluous-clutter-in-homepage &lt;insert the upstream URL, if relevant&gt;...
W: fridge: bad-homepage &lt;insert the upstream URL, if relevant&gt;
W: fridge: binary-without-manpage usr/bin/jane
N:
N:    Each binary in /usr/bin, /usr/sbin, /bin, /sbin or /usr/games should
N:    have a manual page
N:
N:    Note that though the man program has the capability to check for several
N:    program names in the NAMES section, each of these programs should have
N:    its own manual page (a symbolic link to the appropriate manual page is
N:    sufficient) because other manual page viewers such as xman or tkman
N:    don't support this.
N:
N:    If the name of the man page differs from the binary by case, man may be
N:    able to find it anyway; however, it is still best practice to make the
N:    case of the man page match the case of the binary.
N:
N:    If the man pages are provided by another package on which this package
N:    depends, lintian may not be able to determine that man pages are
N:    available. In this case, after confirming that all binaries do have man
N:    pages after this package and its dependencies are installed, please add
N:    a lintian override.
N:
N:    Refer to Debian Policy Manual section 12.1 (Manual pages) for details.
N:
N:    Severity: normal, Certainty: possible
N:
N:    Check: manpages, Type: binary
N:
W: fridge: binary-without-manpage usr/bin/joe
W: fridge: binary-without-manpage usr/bin/tom
E: fridge: python-script-but-no-python-dep usr/bin/jane
N:
N:    Packages with Python scripts should depend on the package python. Those
N:    with scripts that specify a specific version of Python must depend on
N:    that version of Python (exactly).
N:
N:    For example, if a script in the package uses #!/usr/bin/python, the
N:    package needs a dependency on python. If a script uses
N:    #!/usr/bin/python2.6, the package needs a dependency on python2.6. A
N:    dependency on python (&gt;= 2.6) is not correct, since later versions of
N:    Python may not provide the /usr/bin/python2.6 binary.
N:
N:    If you are using debhelper, adding ${python:Depends} to the Depends
N:    field and ensuring dh_pysupport or dh_pycentral are run during the build
N:    should take care of adding the correct dependency.
N:
N:    In some cases a weaker relationship, such as Suggests or Recommends,
N:    will be more appropriate.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: scripts, Type: binary
N:
E: fridge: python-script-but-no-python-dep usr/bin/joe
E: fridge: python-script-but-no-python-dep usr/bin/tom
Finished running lintian.
/path/to/package1
$ ls -l deb
total 40
drwxrwxr-x 5 osamu osamu  4096 Aug 20 23:25 fridge-1.0
-rw-r--r-- 1 osamu osamu  3400 Aug 20 23:25 fridge_1.0-1_all.deb
-rw-r--r-- 1 osamu osamu 14801 Aug 20 23:25 fridge_1.0-1_amd64.build
-rw-r--r-- 1 osamu osamu  1414 Aug 20 23:25 fridge_1.0-1_amd64.changes
-rw-r--r-- 1 osamu osamu  2000 Aug 20 23:25 fridge_1.0-1.debian.tar.xz
-rw-r--r-- 1 osamu osamu   813 Aug 20 23:25 fridge_1.0-1.dsc
-rw-rw-r-- 1 osamu osamu  1224 Aug 20 23:25 fridge_1.0.orig.tar.xz
$ dpkg -c deb/fridge_1.0-1_all.deb
drwxr-xr-x root/root         0 2015-08-20 23:25 ./
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/bin/
-rwxr-xr-x root/root       124 2015-08-20 23:25 ./usr/bin/jane
-rwxr-xr-x root/root        93 2015-08-20 23:25 ./usr/bin/joe
-rwxr-xr-x root/root        81 2015-08-20 23:25 ./usr/bin/tom
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/python2.7/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/python2.7/dist-packages...
-rw-r--r-- root/root       233 2015-08-20 23:25 ./usr/lib/python2.7/dist-packages...
-rw-r--r-- root/root      1579 2013-04-08 21:16 ./usr/lib/python2.7/dist-packages...
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/doc/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/doc/fridge/
-rw-r--r-- root/root       172 2013-04-06 22:36 ./usr/share/doc/fridge/changelog....
-rw-r--r-- root/root       120 2013-04-06 23:03 ./usr/share/doc/fridge/README.Deb...
-rw-r--r-- root/root      1668 2013-04-06 22:36 ./usr/share/doc/fridge/copyright</code></pre>
</div></div>
<div class="paragraph"><p>Now we have Debian package <code>fridge_1.0-1_all.deb</code> which can be installed and removed easily.</p></div>
</div>
<div class="sect2">
<h3 id="_debian_package_from_python3_source_distribution_dh_make">Debian package from Python3 source distribution (dh_make)</h3>
<div class="paragraph"><p>Let&#8217;s do the same for Python3.</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian source package.</div>
<div class="content">
<pre><code>fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
$ cd deb/fridge-1.0; dh_make -s --createorig --yes; cd -
/path/to/package2/deb/fridge-1.0
Maintainer name  : Osamu Aoki
Email-Address    : osamu@debian.org
Date             : Thu, 20 Aug 2015 23:25:20 +0900
Package Name     : fridge
Version          : 1.0
License          : blank
Type of Package  : Single
Currently there is no top level Makefile. This may require additional tuning.
Done. Please edit the files in the debian/ subdirectory now. You should also
check that the fridge Makefiles install into $DESTDIR and not in / .
/path/to/package2
$ ls -lR deb
deb:
total 8
drwxrwxr-x 4 osamu osamu 4096 Aug 20 23:25 fridge-1.0
-rw-rw-r-- 1 osamu osamu 1220 Aug 20 23:25 fridge_1.0.orig.tar.xz

deb/fridge-1.0:
total 24
drwxr-xr-x 3 osamu osamu 4096 Aug 20 23:25 debian
-rw-r--r-- 1 osamu osamu 1586 Aug 20 23:25 fridge.py
-rw-rw-r-- 1 osamu osamu  233 Aug 20 23:25 PKG-INFO
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 scripts
-rwxr-xr-x 1 osamu osamu  362 Apr  5  2013 setup.py

deb/fridge-1.0/debian:
total 104
-rw-rw-r-- 1 osamu osamu   180 Aug 20 23:25 changelog
-rw-rw-r-- 1 osamu osamu     2 Aug 20 23:25 compat
-rw-rw-r-- 1 osamu osamu   512 Aug 20 23:25 control
-rw-rw-r-- 1 osamu osamu  1668 Aug 20 23:25 copyright
-rw-rw-r-- 1 osamu osamu     7 Aug 20 23:25 docs
-rw-rw-r-- 1 osamu osamu   128 Aug 20 23:25 fridge.cron.d.ex
-rw-rw-r-- 1 osamu osamu   232 Aug 20 23:25 fridge.default.ex
-rw-rw-r-- 1 osamu osamu   504 Aug 20 23:25 fridge.doc-base.EX
-rw-rw-r-- 1 osamu osamu  4579 Aug 20 23:25 init.d.ex
-rw-rw-r-- 1 osamu osamu  1625 Aug 20 23:25 manpage.1.ex
-rw-rw-r-- 1 osamu osamu  4648 Aug 20 23:25 manpage.sgml.ex
-rw-rw-r-- 1 osamu osamu 11003 Aug 20 23:25 manpage.xml.ex
-rw-rw-r-- 1 osamu osamu   123 Aug 20 23:25 menu.ex
-rw-rw-r-- 1 osamu osamu   956 Aug 20 23:25 postinst.ex
-rw-rw-r-- 1 osamu osamu   929 Aug 20 23:25 postrm.ex
-rw-rw-r-- 1 osamu osamu   689 Aug 20 23:25 preinst.ex
-rw-rw-r-- 1 osamu osamu   876 Aug 20 23:25 prerm.ex
-rw-rw-r-- 1 osamu osamu   173 Aug 20 23:25 README.Debian
-rw-rw-r-- 1 osamu osamu   258 Aug 20 23:25 README.source
-rwxr-xr-x 1 osamu osamu   844 Aug 20 23:25 rules
drwxr-xr-x 2 osamu osamu  4096 Aug 20 23:25 source
-rw-rw-r-- 1 osamu osamu   775 Aug 20 23:25 watch.ex

deb/fridge-1.0/debian/source:
total 4
-rw-rw-r-- 1 osamu osamu 12 Aug 20 23:25 format

deb/fridge-1.0/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$

  ... update debian/control
  ... update debian/rules
  ... touch up template files
  ... remove unused template files

$ ls -l deb/fridge-1.0/debian
total 32
-rw-rw-r-- 1 osamu osamu  180 Apr  6  2013 changelog
-rw-rw-r-- 1 osamu osamu    2 Apr  6  2013 compat
-rw-rw-r-- 1 osamu osamu  557 Apr  8  2013 control
-rw-rw-r-- 1 osamu osamu 1668 Apr  6  2013 copyright
-rw-rw-r-- 1 osamu osamu  440 Apr  6  2013 manpage.1
-rw-rw-r-- 1 osamu osamu  120 Apr  6  2013 README.Debian
-rwxr-xr-x 1 osamu osamu  663 Apr  9  2013 rules
drwxr-xr-x 2 osamu osamu 4096 Apr  6  2013 source
$ cat deb/fridge-1.0/debian/control
Source: fridge
Section: unknown
Priority: extra
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;= 8.0.0), python3-minimal, python3
Standards-Version: 3.9.3
X-Python3-Version: &gt;= 3.1
Homepage: &lt;insert the upstream URL, if relevant&gt;
#Vcs-Git: git://git.debian.org/collab-maint/fridge.git
#Vcs-Browser: http://git.debian.org/?p=collab-maint/fridge.git;a=summary

Package: fridge
Architecture: all
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: &lt;insert up to 60 chars description&gt;
 &lt;insert long description, indented with spaces&gt;
$ cat deb/fridge-1.0/debian/rules
#!/usr/bin/make -f
#export DH_VERBOSE=1
ifeq ($(DH_VERBOSE),1)
    DH_VERBOSE_OPT = -ex
else
    DH_VERBOSE_OPT = -e
endif
PY3REQUESTED := $(shell py3versions -r)
PY3DEFAULT := $(shell py3versions -d)
PYTHON3 := $(filter-out $(PY3DEFAULT),$(PY3REQUESTED)) python3

%:
    dh $@ --with python3

override_dh_auto_clean:
    rm -rf build

override_dh_auto_build:
    set $(DH_VERBOSE_OPT); for python in $(PYTHON3); do \
        $$python setup.py build; \
    done

# use fridge instead of tmp since it is single binary package
override_dh_auto_install:
    set $(DH_VERBOSE_OPT); for python in $(PYTHON3); do \
        $$python setup.py install --root=debian/fridge --install-layout=deb; \
    done</code></pre>
</div></div>
<div class="paragraph"><p>Here, I am working around lack of Python3 support
(<a href="http://bugs.debian.org/538978">#538978</a> and
<a href="http://bugs.debian.org/597105">#597105</a> bugs) by <code>debhelper</code> using the
customized build script <code>debian/rules</code> following
<a href="http://developer.ubuntu.com/packaging/html/python-packaging.html">Ubuntu
documentation on "Packaging Python modules and applications"</a></p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian binary package.</div>
<div class="content">
<pre><code>/path/to/package2/deb/fridge-1.0
 dpkg-buildpackage -rfakeroot -D -us -uc -i
dpkg-buildpackage: source package fridge
dpkg-buildpackage: source version 1.0-1
dpkg-buildpackage: source distribution unstable
dpkg-buildpackage: source changed by Osamu Aoki &lt;osamu@debian.org&gt;
 dpkg-source -i --before-build fridge-1.0
dpkg-buildpackage: host architecture amd64
 fakeroot debian/rules clean
dh clean --with python3
   dh_testdir
   debian/rules override_dh_auto_clean
make[1]: Entering directory '/path/to/package2/deb/fridge-1.0'
rm -rf build
make[1]: Leaving directory '/path/to/package2/deb/fridge-1.0'
   dh_clean
 dpkg-source -i -b fridge-1.0
dpkg-source: info: using source format `3.0 (quilt)'
dpkg-source: info: building fridge using existing ./fridge_1.0.orig.tar.xz
dpkg-source: info: building fridge in fridge_1.0-1.debian.tar.xz
dpkg-source: info: building fridge in fridge_1.0-1.dsc
 debian/rules build
dh build --with python3
   dh_testdir
   dh_auto_configure
   debian/rules override_dh_auto_build
make[1]: Entering directory '/path/to/package2/deb/fridge-1.0'
set -e; for python in  python3; do \
    $python setup.py build; \
done
running build
running build_py
creating build
creating build/lib
copying fridge.py -&gt; build/lib
running build_scripts
creating build/scripts-3.4
copying and adjusting scripts/jane -&gt; build/scripts-3.4
copying and adjusting scripts/joe -&gt; build/scripts-3.4
copying and adjusting scripts/tom -&gt; build/scripts-3.4
changing mode of build/scripts-3.4/jane from 644 to 755
changing mode of build/scripts-3.4/joe from 644 to 755
changing mode of build/scripts-3.4/tom from 644 to 755
make[1]: Leaving directory '/path/to/package2/deb/fridge-1.0'
   dh_auto_test
 fakeroot debian/rules binary
dh binary --with python3
   dh_testroot
   dh_prep
   debian/rules override_dh_auto_install
make[1]: Entering directory '/path/to/package2/deb/fridge-1.0'
set -e; for python in  python3; do \
    $python setup.py install --root=debian/fridge --install-layout=deb; \
done
running install
running build
running build_py
running build_scripts
running install_lib
creating debian/fridge
creating debian/fridge/usr
creating debian/fridge/usr/lib
creating debian/fridge/usr/lib/python3
creating debian/fridge/usr/lib/python3/dist-packages
copying build/lib/fridge.py -&gt; debian/fridge/usr/lib/python3/dist-packages
byte-compiling debian/fridge/usr/lib/python3/dist-packages/fridge.py to fridge.cp...
running install_scripts
creating debian/fridge/usr/bin
copying build/scripts-3.4/jane -&gt; debian/fridge/usr/bin
copying build/scripts-3.4/joe -&gt; debian/fridge/usr/bin
copying build/scripts-3.4/tom -&gt; debian/fridge/usr/bin
changing mode of debian/fridge/usr/bin/jane to 755
changing mode of debian/fridge/usr/bin/joe to 755
changing mode of debian/fridge/usr/bin/tom to 755
running install_egg_info
Writing debian/fridge/usr/lib/python3/dist-packages/fridge-1.0.egg-info
make[1]: Leaving directory '/path/to/package2/deb/fridge-1.0'
   dh_installdocs
   dh_installchangelogs
   dh_pysupport
dh_pysupport: This program is deprecated, you should use dh_python2 instead. Migr...
   dh_python3
   dh_perl
   dh_link
   dh_compress
   dh_fixperms
   dh_installdeb
   dh_gencontrol
dpkg-gencontrol: warning: Depends field of package fridge: unknown substitution v...
dpkg-gencontrol: warning: package fridge: unused substitution variable ${python3:...
   dh_md5sums
   dh_builddeb
dpkg-deb: building package `fridge' in `../fridge_1.0-1_all.deb'.
 dpkg-genchanges  &gt;../fridge_1.0-1_amd64.changes
dpkg-genchanges: including full source code in upload
 dpkg-source -i --after-build fridge-1.0
dpkg-buildpackage: full upload (original source is included)
Now running lintian...
W: fridge source: superfluous-clutter-in-homepage &lt;insert the upstream URL, if re...
N:
N:    The "Homepage:" field in this package's control file contains
N:    superfluous markup around the URL, like enclosing &lt; and &gt;. This is
N:    unnecessary and needlessly complicates using this information.
N:
N:    Refer to Debian Policy Manual section 5.6.23 (Homepage) for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge source: bad-homepage &lt;insert the upstream URL, if relevant&gt;
N:
N:    The "Homepage:" field in this package's control file does not contain a
N:    valid absolute URL. Most probably you forgot to specify the scheme (e.g.
N:    http).
N:
N:    This tag is also triggered if the scheme is not known by Lintian.
N:
N:    Please file a bug against Lintian, if this tag is triggered for a valid
N:    homepage URL.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge source: space-in-std-shortname-in-dep5-copyright &lt;special license&gt; (par...
N:
N:    The license header contains a short name with a space, which does not
N:    conform to the specification.
N:
N:    Refer to
N:    http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/ for
N:    details.
N:
N:    Severity: minor, Certainty: certain
N:
N:    Check: source-copyright, Type: source
N:
W: fridge source: ancient-standards-version 3.9.3 (current is 3.9.6)
N:
N:    The source package refers to a Standards-Version that has been obsolete
N:    for more than two years. Please update your package to latest Policy and
N:    set this control field appropriately.
N:
N:    If the package is already compliant with the current standards, you
N:    don't have to re-upload the package just to adjust the Standards-Version
N:    control field. However, please remember to update this field next time
N:    you upload the package.
N:
N:    See /usr/share/doc/debian-policy/upgrading-checklist.txt.gz in the
N:    debian-policy package for a summary of changes in newer versions of
N:    Policy.
N:
N:    Refer to https://www.debian.org/doc/debian-policy/upgrading-checklist
N:    for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: standards-version, Type: source
N:
I: fridge source: debian-watch-file-is-missing
N:
N:    This source package is not Debian-native but it does not have a
N:    debian/watch file. This file is used for automatic detection of new
N:    upstream versions by the Debian External Health Status project and other
N:    project infrastructure. If this package is maintained upstream, please
N:    consider adding a debian/watch file to detect new releases.
N:
N:    If the package is not maintained upstream or if upstream uses a
N:    distribution mechanism that cannot be meaningfully monitored by uscan
N:    and the Debian External Health Status project, please consider adding a
N:    debian/watch file containing only comments documenting the situation.
N:
N:    Refer to Debian Policy Manual section 4.11 (Optional upstream source
N:    location: debian/watch) and the uscan(1) manual page for details.
N:
N:    Severity: wishlist, Certainty: certain
N:
N:    Check: watch-file, Type: source
N:
W: fridge: wrong-bug-number-in-closes l3:#nnnn
N:
N:    Bug numbers can only contain digits.
N:
N:    Refer to Debian Policy Manual section 4.4 (Debian changelog:
N:    debian/changelog) for details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
W: fridge: new-package-should-close-itp-bug
N:
N:    This package appears to be the first packaging of a new upstream
N:    software package (there is only one changelog entry and the Debian
N:    revision is 1), but it does not close any bugs. The initial upload of a
N:    new package should close the corresponding ITP bug for that package.
N:
N:    This warning can be ignored if the package is not intended for Debian or
N:    if it is a split of an existing Debian package.
N:
N:    Refer to Debian Developer's Reference section 5.1 (New packages) for
N:    details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
E: fridge: changelog-is-dh_make-template
N:
N:    The changelog file has an instruction left by dh_make, which has not
N:    been removed. Example:
N:
N:      * Initial release (Closes: #nnnn)  &lt;nnnn is the bug number of your ITP%gt...
N:
N:    The "&lt;... is the bug number ...&gt;" part has not been removed from the
N:    changelog.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: changelog-file, Type: binary
N:
E: fridge: helper-templates-in-copyright
N:
N:    The /usr/share/doc/&lt;pkg&gt;/copyright file still contains template markers
N:    from a packaging helper. Please fill in the actual license, upstream
N:    copyright holders, and download information about the package and remove
N:    any remaining templates generated by the packaging helper.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: copyright-file, Type: binary
N:
W: fridge: copyright-has-url-from-dh_make-boilerplate
N:
N:    There is "url://example.com" in your copyright file. This was most
N:    likely a remnant from the dh_make template.
N:
N:    Make sure you include the real location where you obtained the upstream
N:    sources (if any).
N:
N:    Refer to Debian Policy Manual section 12.5 (Copyright information) for
N:    details.
N:
N:    Severity: normal, Certainty: certain
N:
N:    Check: copyright-file, Type: binary
N:
E: fridge: copyright-contains-dh_make-todo-boilerplate
N:
N:    The string "Please also look if..." appears in the copyright file, which
N:    indicates that you either didn't check the whole source to find
N:    additional copyright/license, or that you didn't remove that paragraph
N:    after having done so.
N:
N:    Refer to Debian Policy Manual section 12.5 (Copyright information) for
N:    details.
N:
N:    Severity: serious, Certainty: possible
N:
N:    Check: copyright-file, Type: binary
N:
E: fridge: description-is-dh_make-template
N:
N:    The synopsis or the extended description has not been changed from the
N:    template provided by dh_make.
N:
N:    Severity: serious, Certainty: certain
N:
N:    Check: description, Type: binary, udeb
N:
I: fridge: extended-description-is-probably-too-short
N:
N:    The extended description (the lines after the first line of the
N:    "Description:" field) is only one or two lines long. The extended
N:    description should provide a user with enough information to decide
N:    whether they want to install this package, what it contains, and how it
N:    compares to similar packages. One or two lines is normally not enough to
N:    do this.
N:
N:    Refer to Debian Developer's Reference section 6.2.1 (General guidelines
N:    for package descriptions) and Debian Developer's Reference section 6.2.3
N:    (The long description) for details.
N:
N:    Severity: minor, Certainty: possible
N:
N:    Check: description, Type: binary, udeb
N:
E: fridge: section-is-dh_make-template
N:
N:    The "Section:" field in this package's control file is set to unknown.
N:    This is not a valid section, and usually means a dh_make template
N:    control file was used and never modified to set the correct section.
N:
N:    Refer to Debian Policy Manual section 2.4 (Sections) for details.
N:
N:    Severity: serious, Certainty: certain
N:
N:    Check: fields, Type: binary, udeb, source
N:
W: fridge: superfluous-clutter-in-homepage &lt;insert the upstream URL, if relevant&gt;...
W: fridge: bad-homepage &lt;insert the upstream URL, if relevant&gt;
W: fridge: binary-without-manpage usr/bin/jane
N:
N:    Each binary in /usr/bin, /usr/sbin, /bin, /sbin or /usr/games should
N:    have a manual page
N:
N:    Note that though the man program has the capability to check for several
N:    program names in the NAMES section, each of these programs should have
N:    its own manual page (a symbolic link to the appropriate manual page is
N:    sufficient) because other manual page viewers such as xman or tkman
N:    don't support this.
N:
N:    If the name of the man page differs from the binary by case, man may be
N:    able to find it anyway; however, it is still best practice to make the
N:    case of the man page match the case of the binary.
N:
N:    If the man pages are provided by another package on which this package
N:    depends, lintian may not be able to determine that man pages are
N:    available. In this case, after confirming that all binaries do have man
N:    pages after this package and its dependencies are installed, please add
N:    a lintian override.
N:
N:    Refer to Debian Policy Manual section 12.1 (Manual pages) for details.
N:
N:    Severity: normal, Certainty: possible
N:
N:    Check: manpages, Type: binary
N:
W: fridge: binary-without-manpage usr/bin/joe
W: fridge: binary-without-manpage usr/bin/tom
E: fridge: python-script-but-no-python-dep usr/bin/jane
N:
N:    Packages with Python scripts should depend on the package python. Those
N:    with scripts that specify a specific version of Python must depend on
N:    that version of Python (exactly).
N:
N:    For example, if a script in the package uses #!/usr/bin/python, the
N:    package needs a dependency on python. If a script uses
N:    #!/usr/bin/python2.6, the package needs a dependency on python2.6. A
N:    dependency on python (&gt;= 2.6) is not correct, since later versions of
N:    Python may not provide the /usr/bin/python2.6 binary.
N:
N:    If you are using debhelper, adding ${python:Depends} to the Depends
N:    field and ensuring dh_pysupport or dh_pycentral are run during the build
N:    should take care of adding the correct dependency.
N:
N:    In some cases a weaker relationship, such as Suggests or Recommends,
N:    will be more appropriate.
N:
N:    Severity: important, Certainty: certain
N:
N:    Check: scripts, Type: binary
N:
E: fridge: python-script-but-no-python-dep usr/bin/joe
E: fridge: python-script-but-no-python-dep usr/bin/tom
Finished running lintian.
/path/to/package2
$ ls -l deb
total 40
drwxrwxr-x 5 osamu osamu  4096 Aug 20 23:25 fridge-1.0
-rw-r--r-- 1 osamu osamu  3482 Aug 20 23:25 fridge_1.0-1_all.deb
-rw-r--r-- 1 osamu osamu 14323 Aug 20 23:25 fridge_1.0-1_amd64.build
-rw-r--r-- 1 osamu osamu  1414 Aug 20 23:25 fridge_1.0-1_amd64.changes
-rw-r--r-- 1 osamu osamu  2248 Aug 20 23:25 fridge_1.0-1.debian.tar.xz
-rw-r--r-- 1 osamu osamu   815 Aug 20 23:25 fridge_1.0-1.dsc
-rw-rw-r-- 1 osamu osamu  1220 Aug 20 23:25 fridge_1.0.orig.tar.xz
$ dpkg -c deb/fridge_1.0-1_all.deb
drwxr-xr-x root/root         0 2015-08-20 23:25 ./
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/bin/
-rwxr-xr-x root/root       124 2015-08-20 23:25 ./usr/bin/jane
-rwxr-xr-x root/root        93 2015-08-20 23:25 ./usr/bin/joe
-rwxr-xr-x root/root        81 2015-08-20 23:25 ./usr/bin/tom
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/python3/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/lib/python3/dist-packages/
-rw-r--r-- root/root       233 2015-08-20 23:25 ./usr/lib/python3/dist-packages/f...
-rw-r--r-- root/root      1586 2015-08-20 23:25 ./usr/lib/python3/dist-packages/f...
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/doc/
drwxr-xr-x root/root         0 2015-08-20 23:25 ./usr/share/doc/fridge/
-rw-r--r-- root/root       172 2013-04-06 22:36 ./usr/share/doc/fridge/changelog....
-rw-r--r-- root/root       120 2013-04-06 23:03 ./usr/share/doc/fridge/README.Deb...
-rw-r--r-- root/root      1668 2013-04-06 22:36 ./usr/share/doc/fridge/copyright</code></pre>
</div></div>
<div class="paragraph"><p>Now we have Debian package <code>fridge_1.0-1_all.deb</code> which can be installed and removed easily.</p></div>
</div>
<div class="sect2">
<h3 id="_debian_package_from_python2_source_distribution_debmake">Debian package from Python2 source distribution (debmake)</h3>
<div class="paragraph"><p>The <code>debmake</code> is even more handier for making a Debian package.  I will be very sloppy for now as well.  (More work is needed to make package suitable for Debian.)</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian source package.</div>
<div class="content">
<pre><code>/path/to/package1/fridge
running sdist
running check
warning: sdist: manifest template 'MANIFEST.in' does not exist (using default fil...

writing manifest file 'MANIFEST'
creating fridge-1.0
creating fridge-1.0/scripts
making hard links in fridge-1.0...
hard linking README -&gt; fridge-1.0
hard linking fridge.py -&gt; fridge-1.0
hard linking setup.py -&gt; fridge-1.0
hard linking scripts/jane -&gt; fridge-1.0/scripts
hard linking scripts/joe -&gt; fridge-1.0/scripts
hard linking scripts/tom -&gt; fridge-1.0/scripts
Creating tar archive
removing 'fridge-1.0' (and everything under it)
fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
I: set parameters
I: sanity check of parameters
W: -u "1.0" != auto set value ""
I: pkg="", ver="1.0", rev="1"
I: make the upstream tarball with "make dist" equivalents
I: pwd = "/path/to/package1/fridge"
I: $ python setup.py sdist
I: -&gt; dist/fridge-1.0.tar.gz created
I: fridge-1.0.tar.gz picked for packaging
I: pwd = "/path/to/package1"
I: $ cp -f fridge/dist/fridge-1.0.tar.gz fridge-1.0.tar.gz
I: pkg="fridge", ver="1.0", rev="1"
I: untar the upstream tarball
I: pwd = "/path/to/package1"
I: $ tar -xvzf fridge-1.0.tar.gz
I: untared fridge-1.0.tar.gz.
I: tar -tzf fridge-1.0.tar.gz|grep -v /.
I: pwd = "/path/to/package1/fridge-1.0"
I: *** start packaging in "fridge-1.0". ***
I: provide fridge_1.0.orig.tar.gz for non-native Debian package
I: pwd = "/path/to/package1"
I: $ ln -sf fridge-1.0.tar.gz fridge_1.0.orig.tar.gz
I: pwd = "/path/to/package1/fridge-1.0"
I: parse binary package settings: :python
I: binary package=fridge Type=python / Arch=all M-A=foreign
I: analyze the source tree
I: build_type = Python distutils
I: scan source for copyright+license text and file extensions
I: 100 %, ext = python
I: check_all_licenses
I: .......
I: check_all_licenses completed for 7 files.
I: bunch_all_licenses
I: format_all_licenses
I: make debian/* template files
I: single binary package
I: debmake -x "1" ...
I: creating =&gt; debian/control
I: creating =&gt; debian/copyright
I: substituting =&gt; /usr/share/debmake/extra0/changelog
I: creating =&gt; debian/changelog
I: substituting =&gt; /usr/share/debmake/extra0/rules
I: creating =&gt; debian/rules
I: substituting =&gt; /usr/share/debmake/extra1/README.Debian
I: creating =&gt; debian/README.Debian
I: substituting =&gt; /usr/share/debmake/extra1/compat
I: creating =&gt; debian/compat
I: substituting =&gt; /usr/share/debmake/extra1/watch
I: creating =&gt; debian/watch
I: substituting =&gt; /usr/share/debmake/extra1source/format
I: creating =&gt; debian/source/format
I: substituting =&gt; /usr/share/debmake/extra1source/local-options
I: creating =&gt; debian/source/local-options
I: substituting =&gt; /usr/share/debmake/extra1patches/series
I: creating =&gt; debian/patches/series
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to/package1/fridge
I: please execute "cd /path/to/package1/fridge-1.0" before building the binary pa...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).
/path/to/package1
$ ls -lR fridge-1.0
fridge-1.0:
total 24
drwxrwxr-x 4 osamu osamu 4096 Aug 20 23:25 debian
-rw-r--r-- 1 osamu osamu 1579 Apr  8  2013 fridge.py
-rw-rw-r-- 1 osamu osamu  233 Aug 20 23:25 PKG-INFO
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 scripts
-rwxr-xr-x 1 osamu osamu  361 Apr  8  2013 setup.py

fridge-1.0/debian:
total 36
-rw-rw-r-- 1 osamu osamu  184 Aug 20 23:25 changelog
-rw-rw-r-- 1 osamu osamu    2 Aug 20 23:25 compat
-rw-rw-r-- 1 osamu osamu  509 Aug 20 23:25 control
-rw-rw-r-- 1 osamu osamu  515 Aug 20 23:25 copyright
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 patches
-rw-rw-r-- 1 osamu osamu  224 Aug 20 23:25 README.Debian
-rwxr-xr-x 1 osamu osamu  133 Aug 20 23:25 rules
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 source
-rw-rw-r-- 1 osamu osamu   75 Aug 20 23:25 watch

fridge-1.0/debian/patches:
total 4
-rw-rw-r-- 1 osamu osamu 65 Aug 20 23:25 series

fridge-1.0/debian/source:
total 8
-rw-rw-r-- 1 osamu osamu 12 Aug 20 23:25 format
-rw-rw-r-- 1 osamu osamu 44 Aug 20 23:25 local-options

fridge-1.0/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$ cat fridge-1.0/debian/control
Source: fridge
Section: unknown
Priority: extra
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=9), dh-python, python-all, python3-all
Standards-Version: 3.9.6
Homepage: &lt;insert the upstream URL, if relevant&gt;
X-Python-Version: &gt;= 2.6

Package: fridge
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}, ${python:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.
$ cat fridge-1.0/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

%:
    dh $@ --with python2</code></pre>
</div></div>
<div class="paragraph"><p>Now we have Debian package <code>fridge_1.0-1_all.deb</code> which can be installed and removed easily.</p></div>
</div>
<div class="sect2">
<h3 id="_debian_package_from_python3_source_distribution_debmake">Debian package from Python3 source distribution (debmake)</h3>
<div class="paragraph"><p>Let&#8217;s do the same for Python3 (The <code>debmake</code> does hard work for you).</p></div>
<div class="listingblock">
<div class="title">Let&#8217;s make Debian source package.</div>
<div class="content">
<pre><code>/path/to/package2/fridge
running sdist
running check
warning: sdist: manifest template 'MANIFEST.in' does not exist (using default fil...

writing manifest file 'MANIFEST'
creating fridge-1.0
creating fridge-1.0/scripts
making hard links in fridge-1.0...
hard linking README -&gt; fridge-1.0
hard linking fridge.py -&gt; fridge-1.0
hard linking setup.py -&gt; fridge-1.0
hard linking scripts/jane -&gt; fridge-1.0/scripts
hard linking scripts/joe -&gt; fridge-1.0/scripts
hard linking scripts/tom -&gt; fridge-1.0/scripts
Creating tar archive
removing 'fridge-1.0' (and everything under it)
fridge-1.0/
fridge-1.0/PKG-INFO
fridge-1.0/README
fridge-1.0/fridge.py
fridge-1.0/setup.py
fridge-1.0/scripts/
fridge-1.0/scripts/jane
fridge-1.0/scripts/joe
fridge-1.0/scripts/tom
I: set parameters
I: sanity check of parameters
W: -u "1.0" != auto set value ""
I: pkg="", ver="1.0", rev="1"
I: make the upstream tarball with "make dist" equivalents
I: pwd = "/path/to/package2/fridge"
I: $ python3 setup.py sdist
I: -&gt; dist/fridge-1.0.tar.gz created
I: fridge-1.0.tar.gz picked for packaging
I: pwd = "/path/to/package2"
I: $ cp -f fridge/dist/fridge-1.0.tar.gz fridge-1.0.tar.gz
I: pkg="fridge", ver="1.0", rev="1"
I: untar the upstream tarball
I: pwd = "/path/to/package2"
I: $ tar -xvzf fridge-1.0.tar.gz
I: untared fridge-1.0.tar.gz.
I: tar -tzf fridge-1.0.tar.gz|grep -v /.
I: pwd = "/path/to/package2/fridge-1.0"
I: *** start packaging in "fridge-1.0". ***
I: provide fridge_1.0.orig.tar.gz for non-native Debian package
I: pwd = "/path/to/package2"
I: $ ln -sf fridge-1.0.tar.gz fridge_1.0.orig.tar.gz
I: pwd = "/path/to/package2/fridge-1.0"
I: parse binary package settings: :python
I: binary package=fridge Type=python / Arch=all M-A=foreign
I: analyze the source tree
I: build_type =
I: scan source for copyright+license text and file extensions
I: 100 %, ext = python
I: check_all_licenses
I: .......
I: check_all_licenses completed for 7 files.
I: bunch_all_licenses
I: format_all_licenses
I: make debian/* template files
I: single binary package
I: debmake -x "1" ...
I: creating =&gt; debian/control
I: creating =&gt; debian/copyright
I: substituting =&gt; /usr/share/debmake/extra0/changelog
I: creating =&gt; debian/changelog
I: substituting =&gt; /usr/share/debmake/extra0/rules
I: creating =&gt; debian/rules
I: substituting =&gt; /usr/share/debmake/extra1/README.Debian
I: creating =&gt; debian/README.Debian
I: substituting =&gt; /usr/share/debmake/extra1/compat
I: creating =&gt; debian/compat
I: substituting =&gt; /usr/share/debmake/extra1/watch
I: creating =&gt; debian/watch
I: substituting =&gt; /usr/share/debmake/extra1source/format
I: creating =&gt; debian/source/format
I: substituting =&gt; /usr/share/debmake/extra1source/local-options
I: creating =&gt; debian/source/local-options
I: substituting =&gt; /usr/share/debmake/extra1patches/series
I: creating =&gt; debian/patches/series
I: run "debmake -x2" to get more template files
I: $ wrap-and-sort
I: upon return to the shell, current directory becomes /path/to/package2/fridge
I: please execute "cd /path/to/package2/fridge-1.0" before building the binary pa...
I: with dpkg-buildpackage (or debuild, pdebuild, sbuild, ...).
/path/to/package2
$ ls -lR fridge-1.0
fridge-1.0:
total 24
drwxrwxr-x 4 osamu osamu 4096 Aug 20 23:25 debian
-rw-r--r-- 1 osamu osamu 1586 Aug 20 23:25 fridge.py
-rw-rw-r-- 1 osamu osamu  233 Aug 20 23:25 PKG-INFO
-rw-rw-r-- 1 osamu osamu   31 Mar 28  2013 README
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 scripts
-rwxr-xr-x 1 osamu osamu  362 Apr  5  2013 setup.py

fridge-1.0/debian:
total 36
-rw-rw-r-- 1 osamu osamu  184 Aug 20 23:25 changelog
-rw-rw-r-- 1 osamu osamu    2 Aug 20 23:25 compat
-rw-rw-r-- 1 osamu osamu  535 Aug 20 23:25 control
-rw-rw-r-- 1 osamu osamu  515 Aug 20 23:25 copyright
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 patches
-rw-rw-r-- 1 osamu osamu  224 Aug 20 23:25 README.Debian
-rwxr-xr-x 1 osamu osamu  163 Aug 20 23:25 rules
drwxrwxr-x 2 osamu osamu 4096 Aug 20 23:25 source
-rw-rw-r-- 1 osamu osamu   75 Aug 20 23:25 watch

fridge-1.0/debian/patches:
total 4
-rw-rw-r-- 1 osamu osamu 65 Aug 20 23:25 series

fridge-1.0/debian/source:
total 8
-rw-rw-r-- 1 osamu osamu 12 Aug 20 23:25 format
-rw-rw-r-- 1 osamu osamu 44 Aug 20 23:25 local-options

fridge-1.0/scripts:
total 12
-rw-r--r-- 1 osamu osamu 124 Apr  6  2013 jane
-rw-r--r-- 1 osamu osamu  93 Mar 28  2013 joe
-rw-r--r-- 1 osamu osamu  81 Mar 28  2013 tom
$ cat fridge-1.0/debian/control
Source: fridge
Section: unknown
Priority: extra
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=9), dh-python, python-all, python3-all
Standards-Version: 3.9.6
Homepage: &lt;insert the upstream URL, if relevant&gt;
X-Python-Version: &gt;= 2.6
X-Python3-Version: &gt;= 3.2

Package: fridge
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}, ${python:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.
$ cat fridge-1.0/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

%:
    dh $@ --with python2,python3 --buildsystem=pybuild</code></pre>
</div></div>
<div class="paragraph"><p>Now we have Debian package <code>fridge_1.0-1_all.deb</code> which can be installed and removed easily.</p></div>
</div>
<div class="sect2">
<h3 id="_python_c">Python + C</h3>
<div class="paragraph"><p>For non-trivial tasks, it is good idea to write major parts of the program in
some high level programing language such as Python using modules, with some
mission-critical small parts of the program as Python modules written in C (or
in any compiled languages) for speed.</p></div>
<div class="paragraph"><p>There are several approaches to mix <a href="http://docs.python.org/3/">Python</a> and C/C++
code.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/library/ctypes.html">ctypes</a>:
</p>
<div class="ulist"><ul>
<li>
<p>
ctypes can use existing C libraries as a Python extension module without
   compilation.
</p>
</li>
<li>
<p>
You need to understand how C works to use this.
</p>
</li>
<li>
<p>
This is not as fast as other methods but is easier to use.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://swig.org/Doc2.0/Python.html">Python support of SWIG</a>:
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.swig.org/">SWIG</a> is a specialized compiler that transforms
   ANSI C/C++ declarations into scripting language extension wrappers.
</p>
<div class="ulist"><ul>
<li>
<p>
The interface file "*.i" wraps ANSI C/C++ declarations.
</p>
</li>
<li>
<p>
Python is one of many scripting languages supported by SWIG.
</p>
</li>
</ul></div>
</li>
<li>
<p>
You need to understand how C/C++ works to use this.
</p>
</li>
<li>
<p>
This is good if you have many libraries to be wrapped.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="https://live.gnome.org/PyGObject">PyGObject</a>
</p>
<div class="ulist"><ul>
<li>
<p>
This is basically for GNOME3 (see <a href="#_pygobject">PyGObject</a>).
</p>
</li>
<li>
<p>
PyGObject binds
   <a href="http://developer.gnome.org/gobject/unstable/pt02.html">GObject</a>
   as Python extension module using
   <a href="https://live.gnome.org/GObjectIntrospection">GObject Introspection</a> with a
   "*.gir" file.
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/GObjectIntrospection">GObject Introspection</a> provides
   tighter binding than <a href="http://www.swig.org/">SWIG</a>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://www.cython.org/">Cython</a>:
</p>
<div class="ulist"><ul>
<li>
<p>
Cython is a superset of the <a href="http://docs.python.org/3/">Python</a> language.
</p>
<div class="ulist"><ul>
<li>
<p>
Cython code "*.pyx" generates an optimized C code.
</p>
</li>
<li>
<p>
Cython supports calling C functions and declaring C types on variables and
    class attributes.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Cython makes writing C extensions for the Python language as easy as Python
   itself.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.cython.org/src/tutorial">Tutorials</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://docs.python.org/3/extending/index.html">Python/C API</a>:
</p>
<div class="ulist"><ul>
<li>
<p>
A custom C/C++ code with the header <code>#include "Python.h"</code>
   can access the native Python/C API.
</p>
</li>
<li>
<p>
You need to understand how C/C++ works to use this.
</p>
</li>
<li>
<p>
You need to understand how the Python Interpreter works to use this.
</p>
</li>
<li>
<p>
This enables both extending and embedding of the
   <a href="http://www.python.org/">Python</a> Interpreter.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_system">Build system</h2>
<div class="sectionbody">
<div class="paragraph"><p>There are many cross-platform build systems:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#_autotools">Autotools</a> for GNU, GNOME, generic C/C++/Vala/&#8230; programs
</p>
</li>
<li>
<p>
<a href="#_cmake">CMake</a> for KDE programs, etc.
</p>
</li>
<li>
<p>
Python <code>distutils</code> for some Python programs
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="#_install_python_source_distribution">Install Python source distribution</a> (as a user)
</p>
</li>
<li>
<p>
<a href="#_generate_python_source_distribution">Generate Python source distribution</a> (as an upstream)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Please note there are many programs which come with the plain GNU Make as the
build system .  The plain GNU Make is simple and works fairly well across all
modern Unix-like systems.</p></div>
<div class="sect2">
<h3 id="_autotools">Autotools</h3>
<div class="paragraph"><p>This is the most versatile and robust build system.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/html_node/Autotools-Introduction.html">An Introduction to the Autotools</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/html_node/GNU-Build-System.html">Introducing the GNU Build System</a>
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/html_node/Use-Cases.html">Use Cases for the GNU Build System</a>
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/html_node/Why-Autotools.html">Why Autotools</a>
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/html_node/Hello-World.html">A Small Hello World</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://www.lrde.epita.fr/~adl/autotools.html">Autotools Tutorial</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The internal of Autotools are beyond my taste for learning. (Yack! What a convoluted use of <a href="http://en.wikipedia.org/wiki/M4_(computer_language)">GNU m4</a> for such complicated tasks.)</p></div>
<div class="paragraph"><p>But compared to other newer build systems, I would rather use Autotools.  This is because:  "better the devil you know than the devil you don&#8217;t know."</p></div>
<div class="sect3">
<h4 id="_as_a_user">As a user</h4>
<div class="paragraph"><p>The source package generated by the Autotools (= Autoconf + Automake + &#8230;)
requires only basic tools available on any Debian systems:</p></div>
<div class="ulist"><ul>
<li>
<p>
Bourne shell (Dash)
</p>
</li>
<li>
<p>
Sed
</p>
</li>
<li>
<p>
Make
</p>
</li>
</ul></div>
<div class="paragraph"><p>As a user, you only deal with files such as <code>configure</code> and <code>Makefile.in</code>
generated by the Autotools.  There is no need for any specialized external
tools such as GNU M4 nor Perl nor Autotools.</p></div>
<div class="paragraph"><p>They can be build as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./configure
...
$ make
...
$ sudo make install</code></pre>
</div></div>
<div class="paragraph"><p>The schematic relationship can be visualized as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>program.c --------------------------------------\
program.h --------------------------------------+--[make]--&gt; program
config.h.in --\                 /--&gt; config.h --/    /
Makefile.in --+--[./configure]--+--&gt; Makefile ------+</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above build process is true not just for source packages generated by
the Autotools but for many other source packages.</td>
</tr></table>
</div>
<div class="paragraph"><p>Here, the template files such as <code>Makefile.in</code> and <code>config.h.in</code>  have embedded
strings such as <code>@CC@</code> and <code>@prefix@</code> and they are replaced by the name of the
particular C compiler and the installation directory using the Sed program
executed from the <code>configure</code> script.  It is good idea not to mess with these
directly to customize your package build process.</p></div>
<div class="paragraph"><p>Instead, you have 2 basic ways to customize your package build process as a
user.</p></div>
<div class="ulist"><ul>
<li>
<p>
Run the <code>configure</code> shell script with options.
</p>
</li>
<li>
<p>
Run the <code>make</code> command with options and environment variables.
</p>
</li>
</ul></div>
<div class="paragraph"><p>As for the <code>configure</code> options, you get their good explanation as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./configure -h</code></pre>
</div></div>
<div class="paragraph"><p>You should check all available command line options displayed.  This is because
the <code>configure</code> script is meant to be run non-interactively.</p></div>
<div class="paragraph"><p>As for the <code>make</code> command, since the <code>Makefile</code> generated by the Autotools
follows GNU coding standards, please read "Makefile Conventions" in the
<a href="http://www.gnu.org/prep/standards/html_node/index.html">GNU coding standards</a> to
learn how to change behavior of <code>make</code>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The default installation destination is <code>/usr/local</code>.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_as_an_upstream">As an upstream</h4>
<div class="paragraph"><p>Autotools (= Autoconf + Automake + &#8230;) is a tool to create the portable source
package with minimal efforts.  It is not easy to make portable across different
platforms.  It generates a good set of <code>configure</code>, <code>Makefile.in</code> and
<code>config.h.in</code> required for a source package from simple data in the
<code>configure.ac</code> and <code>Makefile.am</code> files using the <code>autoreconf -i</code> command which
runs all the Autotools in the right sequences.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>program.c--------------+
program.h--------------+
configure.ac --+       |           +--&gt; configure----------V
               +--[autoreconf -i]--+--&gt; config.h.in --[./configure]--&gt; config.h
Makefile.am  --+                   +--&gt; Makefile.in --[./configure]--&gt; Makefile</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<code>configure.ac</code> is the primarily configuration file to create <code>configure</code> by the Autoconf:
</p>
<div class="ulist"><ul>
<li>
<p>
The Autoconf is a M4 macro program with many pre-defined macros.
</p>
</li>
<li>
<p>
M4 macro quotes used by the Autoconf is changed to <code>[</code> <code>]</code>.
</p>
</li>
<li>
<p>
M4 macro strings in <code>configure.ac</code> are substituted by the Autoconf.
</p>
</li>
<li>
<p>
<code>configure.ac</code> can contain shell codes and they remain in <code>configure</code> as is.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>Makefile.am</code> is the primarily configuration file to create <code>Makefile.in</code> by the Automake:
</p>
<div class="ulist"><ul>
<li>
<p>
The Automake is a Perl program.
</p>
</li>
<li>
<p>
<code>Makefile.am</code> defines the specific variable names and their values to denote source files and their generated files.
</p>
</li>
<li>
<p>
Generated build dependencies are defined as suffix rules.
</p>
</li>
<li>
<p>
<code>Makefile.am</code> can contain Makefile snippets and remains in <code>Makefile</code> as is.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>Makefile</code> is generated from <code>Makefile.in</code> using <code>configure</code> by a user.
</p>
<div class="ulist"><ul>
<li>
<p>
<code>configure</code> is a portable shell program.
</p>
</li>
<li>
<p>
<code>Makefile.in</code> is the <code>Makefile</code> template.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Suppose you have <code>hello.c</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include "config.h"
main()
{
    printf("Hello, world! version: %s\n", VERSION);
    return EXIT_SUCCESS;
}</code></pre>
</div></div>
<div class="paragraph"><p>Then run <code>autoscan</code> to generate initial template of <code>configure.ac</code> and edit it
manually to the shape.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>configure.ac: warning: missing AC_CHECK_HEADERS([stdlib.h]) wanted by: hello.c:1
$ mv configure.scan configure.ac
$ vim configure.ac</code></pre>
</div></div>
<div class="paragraph"><p>Since strict GNU compliance is not easy, lets make this as a "foreign" package
to avoid complication:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.69])
AC_INIT([hello], [0.1], [osamu@debian.org])
AC_CONFIG_SRCDIR([config.h.in])
AC_CONFIG_HEADERS([config.h])

# Manually added
AM_INIT_AUTOMAKE([foreign])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_CONFIG_FILES([Makefile])
AC_OUTPUT</code></pre>
</div></div>
<div class="paragraph"><p><code>Makefile.am</code> defines programs to be built and relationship of source files in very simple way as.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>bin_PROGRAMS = hello
hello_SOURCES = hello.c</code></pre>
</div></div>
<div class="paragraph"><p>Here:</p></div>
<div class="ulist"><ul>
<li>
<p>
List binary program names as the value of <code>bin_PROGRAMS</code>.
</p>
</li>
<li>
<p>
List source file names for <code>hello</code> as the value of <code>hello_SOURCES</code>.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>configure.ac
hello.c
Makefile.am</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s generate <code>configure</code>,  <code>Makefile.in</code> and <code>config.h.in</code> using <code>autoreconf
-i -v -f</code> (<code>-f</code> option is needed only when you are running this command second
time.  <code>-v</code> is for verbose output.):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>autoreconf: Entering directory `.'
autoreconf: configure.ac: not using Gettext
autoreconf: running: aclocal --force
autoreconf: configure.ac: tracing
autoreconf: configure.ac: not using Libtool
autoreconf: running: /usr/bin/autoconf --force
autoreconf: running: /usr/bin/autoheader --force
autoreconf: running: automake --add-missing --copy --force-missing
configure.ac:13: installing './compile'
configure.ac:10: installing './install-sh'
configure.ac:10: installing './missing'
Makefile.am: installing './depcomp'
autoreconf: Leaving directory `.'</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s make <code>./configure</code> to change the binary program destination from
<code>/usr/local/bin</code> to <code>/usr/bin</code> and to change the entire install destination
from <code>/</code> to <code>./tmp</code> for use by the binary distribution package build.  Then
let&#8217;s run it from <code>./tmp/usr/bin/hello</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking whether gcc understands -c and -o together... yes
checking for style of include used by make... GNU
checking dependency style of gcc... gcc3
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: creating config.h
config.status: executing depfiles commands
$ make
make[5]: Entering directory '/path/to/hello'
make  all-am
make[6]: Entering directory '/path/to/hello'
gcc -DHAVE_CONFIG_H -I.     -g -O2 -MT hello.o -MD -MP -MF .deps/hello.Tpo -c -o ...
mv -f .deps/hello.Tpo .deps/hello.Po
gcc  -g -O2   -o hello hello.o
make[6]: Leaving directory '/path/to/hello'
make[5]: Leaving directory '/path/to/hello'
$ DESTDIR=./debian/tmp make install
make[5]: Entering directory '/path/to/hello'
make[6]: Entering directory '/path/to/hello'
 /bin/mkdir -p './debian/tmp/usr/bin'
  /usr/bin/install -c hello './debian/tmp/usr/bin'
make[6]: Nothing to be done for 'install-data-am'.
make[6]: Leaving directory '/path/to/hello'
make[5]: Leaving directory '/path/to/hello'
$ # now run it
$ ./debian/tmp/usr/bin/hello
Hello, world! version: 0.1</code></pre>
</div></div>
<div class="paragraph"><p>For more, <a href="http://www.lrde.epita.fr/~adl/dl/autotools.pdf">Using GNU Autotools</a></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you find <code>configure.in</code> instead of <code>configure.ac</code> in the source tree,
the source is very old.  It is good idea to update the configuration files to
match newer versions of the Autotools.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You should commit only hand-edited files to the upstream VCS.  For
Autotools, these are <code>configure.ac</code>, <code>Makefile.am</code>, <code>*/Makefile.am</code>, <code>AUTHORS</code>,
and <code>NEWS</code>(optional).  Do not bother to track other generated files.</td>
</tr></table>
</div>
<div class="paragraph"><p>See :</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.lrde.epita.fr/~adl/dl/autotools.pdf">Using GNU Autotools</a>
by A. Duret-Lutz (Tutorial)
</p>
</li>
<li>
<p>
<a href="http://www.dwheeler.com/autotools/introduction-autotools.pdf">Introduction to the autotools (autoconf, automake, and libtool)</a> by David A. Wheeler (Tutorial)
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/index.html">GNU Autoconf manual (html)</a>, <a href="http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/autoconf.pdf">GNU Autoconf manual (PDF)</a>
</p>
</li>
<li>
<p>
<a href="http://www.gnu.org/software/automake/manual/automake.html">GNU Automake manual (html)</a>, <a href="http://www.gnu.org/software/automake/manual/automake.pdf">GNU Automake manual (PDF)</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_cmake">CMake</h3>
<div class="paragraph"><p>XXX_FIXME_XXX</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.cmake.org/">http://www.cmake.org/</a>
</p>
</li>
<li>
<p>
<a href="http://www.cmake.org/cmake/help/cmake_tutorial.html">CMake Tutorial</a>
</p>
</li>
<li>
<p>
Set <code>CMakeLists</code> file.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gnome">GNOME</h2>
<div class="sectionbody">
<div class="paragraph"><p>The choice of the best GUI program practice is not simple since there are many
choices for GUI platforms, many outdated documentations, new features without
updated tutorials, and future uncertainties.</p></div>
<div class="paragraph"><p>Despite people had very negative reaction to the GNOME3 due to its new default
user experience, I chose it as my GUI example platform for its fundamental
internal technical merits.  We can always customize the user experience part.</p></div>
<div class="paragraph"><p>Here is my best effort to capture the recent GUI framework history for GNOME
and best sources for references.  (The latest stable is GNOME3.4 as of 2012 Summer.)</p></div>
<div class="sect2">
<h3 id="_gnome_history">GNOME history</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/GTK+">GTK+</a> is the GUI toolkit for
<a href="http://en.wikipedia.org/wiki/GNOME">GNOME</a> and is build on the top of C with
<a href="http://en.wikipedia.org/wiki/GLib">GLib</a> and
<a href="http://en.wikipedia.org/wiki/GObject">GObject</a>.  It requires many chores with
boiler plate macro definitions when used directly from a C program.  Its
modularity as a GUI toolkit has evolved roughly as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
GTK+1.0 (1998): just separated from <a href="http://www.gimp.org/about/ancient_history.html">GIMP</a>.
</p>
</li>
<li>
<p>
GTK+1.2 (1999): reasonable shape for general applications.
</p>
</li>
<li>
<p>
GTK+2.0 (2002): for GNOME2 based on GLib, GObject, GIO, ATK, GDK, GdkPixbuff
</p>
</li>
<li>
<p>
GTK+3.0 (2011): for GNOME3 based on GLib, GObject, GIO, ATK, GDK, GdkPixbuff, <a href="http://en.wikipedia.org/wiki/Pango">Pango</a>
</p>
<div class="ulist"><ul>
<li>
<p>
GTK+3.0 works with <a href="http://en.wikipedia.org/wiki/Cairo_(graphics)">Cairo</a>, <a href="http://en.wikipedia.org/wiki/Clutter_(toolkit)">Clutter</a>, and <a href="https://live.gnome.org/GObjectIntrospection/">GObject-introspection</a>, &#8230;
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/GNOME">GNOME</a> has evolved significantly with its
<a href="http://en.wikipedia.org/wiki/Inter-process_communication">inter-process
communication (IPC)</a> structure.  Its history is roughly as follows.</p></div>
<div class="ulist"><ul>
<li>
<p>
GNOME1 (1999): <a href="http://en.wikipedia.org/wiki/CORBA">CORBA</a> (= <a href="http://en.wikipedia.org/wiki/Bonobo_(component_model)">Bonobo</a> + libIDL + ORBit) as IPC established.
</p>
</li>
<li>
<p>
GNOME2 (2002): Antialiased fonts, UNICODE support (internationalization), HIG compliance (accessibility), &#8230;
</p>
<div class="ulist"><ul>
<li>
<p>
GNOME2 cycle: IPC migrated from CORBA to <a href="http://en.wikipedia.org/wiki/D-Bus">D-Bus</a>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
GNOME3 (2011): D-Bus as IPC established. (<a href="http://developer.gnome.org/platform-overview/2.32/bonobo-corba.html.en">CORBA deprecated</a>)
</p>
<div class="ulist"><ul>
<li>
<p>
GNOME3 cycle: <a href="https://live.gnome.org/GObjectIntrospection/">GObject-Introspection</a> is introduced.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://live.gnome.org/Vala">Vala</a> is becoming a popular choice to write applications for the native binary target instead of traditional and complicated C code with many boiler plate macro definitions.
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> with <a href="https://live.gnome.org/PyGObject">PyGObject</a> is a popular choice to write applications under the high level interpreter language with <a href="http://en.wikipedia.org/wiki/Just-in-time_compilation">JIT compilation</a>.
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/JavaScript">Javascript</a> is becoming the choice for the embedded language of applications with the <a href="https://live.gnome.org/Gjs">Gjs</a> binding.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>GNOME3 applications are just plain GTK+3 applications.  There is no code bloat
by <a href="http://en.wikipedia.org/wiki/CORBA">CORBA</a> any more.</p></div>
<div class="paragraph"><p><a href="https://live.gnome.org/GObjectIntrospection/Users">The language binding system
based on GObject-Introspection</a> can provide:</p></div>
<div class="ulist"><ul>
<li>
<p>
tighter binding including the memory management than the generic language binding systems such as <a href="http://www.swig.org/">SWIG</a> can, and
</p>
</li>
<li>
<p>
more consistent binding across different languages.
</p>
</li>
</ul></div>
<div class="paragraph"><p>GObject-Introspection xml data of each library can be found under the <code>/usr/share/gir-1.0</code> directory.</p></div>
</div>
<div class="sect2">
<h3 id="_glib_and_gobject">Glib and GObject</h3>
<div class="paragraph"><p>Dynamic memory management using <code>malloc()</code> etc. is a big headache when coding
with C.:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.gnu.org/software/libc/manual/html_node/Memory.html">Virtual Memory Allocation And Paging in The GNU C Library manual</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/C_dynamic_memory_allocation">C dynamic memory allocation</a> (Wikipedia)
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Mmap">mmap</a> (Wikipedia)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Such complication can be avoided using libraries such as Glib and GObject.</p></div>
<div class="paragraph"><p>GLib is a general-purpose utility library, which provides many useful data
types, macros, type conversions, string utilities, file utilities, a mainloop
abstraction, utility data structures, and so on.</p></div>
<div class="paragraph"><p><code>GString</code> offered in GLib is a data structure and associated methods offering
text buffers which grow automatically as text is added with the proper dynamic
memory management.</p></div>
<div class="listingblock">
<div class="title">Source to convert to upper case.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib/gprintf.h&gt;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span><span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GString</span> a<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>argc <span style="color: #990000">==</span> <span style="color: #993399">2</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        a <span style="color: #990000">=</span> <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #000000">g_string_new</span></span><span style="color: #990000">(</span>argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"input  = '%s'</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> a<span style="color: #990000">.</span>str<span style="color: #990000">);</span>
        a<span style="color: #990000">.</span>str <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_ascii_strup</span></span><span style="color: #990000">(</span>a<span style="color: #990000">.</span>str<span style="color: #990000">,</span> a<span style="color: #990000">.</span>len<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"OUTPUT = '%s'</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> a<span style="color: #990000">.</span>str<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"%s put_word_to_be_printed_uppercase</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>If we try to guess the library name and header location, it is not easy to get them right.</p></div>
<div class="listingblock">
<div class="title">Manual failed compilation</div>
<div class="content">
<pre><code>In file included from /usr/include/glib-2.0/glib/galloca.h:32:0,
                 from /usr/include/glib-2.0/glib.h:30,
                 from upper.c:2:
/usr/include/glib-2.0/glib/gtypes.h:32:24: fatal error: glibconfig.h: No such fil...
 #include &lt;glibconfig.h&gt;
                        ^
compilation terminated.</code></pre>
</div></div>
<div class="paragraph"><p>Many modern libraries provide <code>*.pc</code> files in their development packages.  You
can use it with <code>pkg-config</code> to get proper compilation options for the glib
library.  Let&#8217;s look for such thing for <code>glib</code>.</p></div>
<div class="listingblock">
<div class="title">Search the development package of Glib</div>
<div class="content">
<pre><code>libglib2.0-dev - Development files for the GLib library</code></pre>
</div></div>
<div class="paragraph"><p>If the <code>libglib2.0-dev</code> package has not been installed, install it now.</p></div>
<div class="paragraph"><p>Search the right <code>*.pc</code> file for Glib for use with <code>pkg-config</code>.</p></div>
<div class="listingblock">
<div class="title">Search the right *.pc file for Glib</div>
<div class="content">
<pre><code>   $(dpkg -L libglib2.0-dev|grep -e "/pkgconfig/")| \
   sed -ne "s/^.*\/pkgconfig\//.../p"
...gmodule-2.0.pc:Name: GModule
...gmodule-2.0.pc:Description: Dynamic module loader for GLib
...gmodule-2.0.pc:Requires: glib-2.0
...glib-2.0.pc:Name: GLib
...glib-2.0.pc:Description: C Utility Library
...glib-2.0.pc:Requires.private: libpcre
...gio-2.0.pc:Name: GIO
...gio-2.0.pc:Description: glib I/O library
...gio-2.0.pc:Requires: glib-2.0 gobject-2.0
...gio-2.0.pc:Requires.private: gmodule-no-export-2.0
...gmodule-export-2.0.pc:Name: GModule
...gmodule-export-2.0.pc:Description: Dynamic module loader for GLib
...gmodule-export-2.0.pc:Requires: glib-2.0
...gobject-2.0.pc:Name: GObject
...gobject-2.0.pc:Description: GLib Type, Object, Parameter and Signal Library
...gobject-2.0.pc:Requires: glib-2.0
...gio-unix-2.0.pc:Name: GIO unix specific APIs
...gio-unix-2.0.pc:Description: unix specific headers for glib I/O library
...gio-unix-2.0.pc:Requires: gobject-2.0,gio-2.0
...gmodule-no-export-2.0.pc:Name: GModule
...gmodule-no-export-2.0.pc:Description: Dynamic module loader for GLib
...gmodule-no-export-2.0.pc:Requires: glib-2.0
...gthread-2.0.pc:Name: GThread
...gthread-2.0.pc:Description: Thread support for GLib
...gthread-2.0.pc:Requires: glib-2.0</code></pre>
</div></div>
<div class="paragraph"><p>The <code>glib-2.0.pc</code> file is the right file.</p></div>
<div class="listingblock">
<div class="title">The glib-2.0.pc file found on the Debian wheezy system.</div>
<div class="content">
<pre><code>prefix=/usr
exec_prefix=${prefix}
libdir=${prefix}/lib/x86_64-linux-gnu
includedir=${prefix}/include

glib_genmarshal=glib-genmarshal
gobject_query=gobject-query
glib_mkenums=glib-mkenums

Name: GLib
Description: C Utility Library
Version: 2.32.3
Requires.private: libpcre
Libs: -L${libdir} -lglib-2.0
Libs.private: -pthread -lrt  -lpcre
Cflags: -I${includedir}/glib-2.0 -I${libdir}/glib-2.0/include</code></pre>
</div></div>
<div class="paragraph"><p>The right compile and link options used by Glib is given as follows.</p></div>
<div class="listingblock">
<div class="title">Compile and link options used by Glib</div>
<div class="content">
<pre><code>-I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -lg
lib-2.0</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The Debian wheezy system on amd64 architecture has its <code>*.pc</code> file at
<code>/usr/lib/x86_64-linux-gnu/pkgconfig/glib-2.0.pc</code>.  Please note the additional
Multi-Arch specific <code>/x86_64-linux-gnu/</code> in its path.</td>
</tr></table>
</div>
<div class="paragraph"><p>By using this, the <code>upper.c</code> program can be compiled without error.</p></div>
<div class="listingblock">
<div class="title">Compilation of upper.c with Glib</div>
<div class="content">
<pre><code></code></pre>
</div></div>
<div class="paragraph"><p>By adding the <code>-v</code> option, the compilation details are exposed.</p></div>
<div class="listingblock">
<div class="title">Compilation of upper.c with Glib with the -v option</div>
<div class="content">
<pre><code>Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 4.9.2-10' --with-b...
Thread model: posix
gcc version 4.9.2 (Debian 4.9.2-10)
COLLECT_GCC_OPTIONS='-v' '-Wall' '-I' '/usr/include/glib-2.0' '-I' '/usr/lib/x86_...
 /usr/lib/gcc/x86_64-linux-gnu/4.9/cc1 -quiet -v -I /usr/include/glib-2.0 -I /usr...
GNU C (Debian 4.9.2-10) version 4.9.2 (x86_64-linux-gnu)
    compiled by GNU C version 4.9.2, GMP version 6.0.0, MPFR version 3.1.2-p3, MP...
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
ignoring nonexistent directory "/usr/lib/gcc/x86_64-linux-gnu/4.9/../../../../x86...
#include "..." search starts here:
#include &lt;...&gt; search starts here:
 /usr/include/glib-2.0
 /usr/lib/x86_64-linux-gnu/glib-2.0/include
 /usr/lib/gcc/x86_64-linux-gnu/4.9/include
 /usr/local/include
 /usr/lib/gcc/x86_64-linux-gnu/4.9/include-fixed
 /usr/include/x86_64-linux-gnu
 /usr/include
End of search list.
GNU C (Debian 4.9.2-10) version 4.9.2 (x86_64-linux-gnu)
    compiled by GNU C version 4.9.2, GMP version 6.0.0, MPFR version 3.1.2-p3, MP...
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
Compiler executable checksum: dc5310582b2a0cacbb4cea323963a0c0
COLLECT_GCC_OPTIONS='-v' '-Wall' '-I' '/usr/include/glib-2.0' '-I' '/usr/lib/x86_...
 as -v -I /usr/include/glib-2.0 -I /usr/lib/x86_64-linux-gnu/glib-2.0/include --6...
GNU assembler version 2.25 (x86_64-linux-gnu) using BFD version (GNU Binutils for...
COMPILER_PATH=/usr/lib/gcc/x86_64-linux-gnu/4.9/:/usr/lib/gcc/x86_64-linux-gnu/4....
LIBRARY_PATH=/usr/lib/gcc/x86_64-linux-gnu/4.9/:/usr/lib/gcc/x86_64-linux-gnu/4.9...
COLLECT_GCC_OPTIONS='-v' '-Wall' '-I' '/usr/include/glib-2.0' '-I' '/usr/lib/x86_...
 /usr/lib/gcc/x86_64-linux-gnu/4.9/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu...</code></pre>
</div></div>
<div class="paragraph"><p>When reading <a href="http://developer.gnome.org/glib/stable/">GLib Reference Manual</a>
(via web or <code>devhelp</code>) and the source of GLib, please note that GLib is written
using its own fundamental type system.</p></div>
<div class="sect3">
<h4 id="_fundamental_fixed_size_data_types">Fundamental fixed size data types</h4>
<div class="paragraph"><p>GLib uses its own fixed size data types.</p></div>
<div class="ulist"><ul>
<li>
<p>
Types prefixed by "g" which are equivalent of ones in standard C
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gchar</code> <code>gint</code> <code>gshort</code> <code>glong</code> <code>gfloat</code> <code>gdouble</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Unsined types prefixed by "gu" which are equivalent of unsined ones in standard C
</p>
<div class="ulist"><ul>
<li>
<p>
<code>guchar</code> <code>guint</code> <code>gushort</code> <code>gulong</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Integer types with platform independent specified bit size
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gint8</code> <code>guint8</code> <code>gint16</code> <code>guint16</code> <code>gint32</code> <code>guint32</code> <code>gint64</code> <code>guint64</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Untyped pointer alias
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gpointer</code>: C99 type <code>void*</code>
</p>
</li>
<li>
<p>
<code>gconstpointer</code>: C99 type <code>const void*</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
New types which are not part of standard C
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gboolean</code>: value=TRUE or FALSE
</p>
</li>
<li>
<p>
<code>gsize</code>: C99 unsigned integer type <code>size_t</code> (usually 64bit or 32bit)
</p>
</li>
<li>
<p>
<code>gssize</code>: C99 signed integer type <code>ssize_t</code> (usually 64bit or 32bit)
</p>
</li>
<li>
<p>
<code>goffset</code>: C99 type <code>off64_t</code>
</p>
</li>
<li>
<p>
<code>gintptr</code>: C99 type <code>intptr_t</code>
</p>
</li>
<li>
<p>
<code>guintptr</code>: C99 type <code>uintptr_t</code>
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_fundamental_variable_size_data_types">Fundamental variable size data types</h4>
<div class="paragraph"><p>Glib offers its own variable size data types with associated routines such as
memory allocation for many utility data structures such as <code>GString</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>GList</code>: Doubly-Linked Lists&#8201;&#8212;&#8201;linked lists that can be iterated over in both directions
</p>
</li>
<li>
<p>
<code>GSList</code>: Singly-Linked Lists&#8201;&#8212;&#8201;linked lists that can be iterated in one direction
</p>
</li>
<li>
<p>
<code>GQueue</code>: Double-ended Queues&#8201;&#8212;&#8201;double-ended queue data structure
</p>
</li>
<li>
<p>
<code>GSequence</code>: Sequences&#8201;&#8212;&#8201;scalable lists
</p>
</li>
<li>
<p>
<code>GTrashStack</code>: Trash Stacks&#8201;&#8212;&#8201;maintain a stack of unused allocated memory chunks
</p>
</li>
<li>
<p>
<code>GHashTable</code>: Hash Tables&#8201;&#8212;&#8201;associations between keys and values so that given a key the value can be found quickly
</p>
</li>
<li>
<p>
<code>GString</code>: Strings&#8201;&#8212;&#8201;text buffers which grow automatically as text is added
</p>
</li>
<li>
<p>
<code>GStringChunk</code>: String Chunks&#8201;&#8212;&#8201;efficient storage of groups of strings
</p>
</li>
<li>
<p>
<code>GArray</code>: Arrays&#8201;&#8212;&#8201;arrays of arbitrary elements which grow automatically as elements are added
</p>
</li>
<li>
<p>
<code>GPtrArray</code>: Pointer Arrays&#8201;&#8212;&#8201;arrays of pointers to any type of data, which grow automatically as new elements are added
</p>
</li>
<li>
<p>
<code>GByteArray</code>: Byte Arrays&#8201;&#8212;&#8201;arrays of bytes
</p>
</li>
<li>
<p>
<code>GTree</code>: Balanced Binary Trees&#8201;&#8212;&#8201;a sorted collection of key/value pairs optimized for searching and traversing in order
</p>
</li>
<li>
<p>
<code>GNode</code>: N-ary Trees&#8201;&#8212;&#8201;trees of data with any number of branches
</p>
</li>
<li>
<p>
<code>GQuark</code>: Quarks&#8201;&#8212;&#8201;a 2-way association between a string and a unique integer identifier
</p>
</li>
<li>
<p>
<code>GData</code>: Keyed Data Lists&#8201;&#8212;&#8201;lists of data elements which are accessible by a string or GQuark identifier
</p>
<div class="ulist"><ul>
<li>
<p>
<code>Datasets</code>&#8201;&#8212;&#8201;associate groups of data elements with particular memory locations
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>GVariantType</code>: GVariantType&#8201;&#8212;&#8201;introduction to the GVariant type system
</p>
</li>
<li>
<p>
<code>GVariant</code>: GVariant&#8201;&#8212;&#8201;strongly typed value datatype
</p>
<div class="ulist"><ul>
<li>
<p>
<code>GVariant Format Strings</code>&#8201;&#8212;&#8201;varargs conversion of GVariants
</p>
</li>
<li>
<p>
<code>GVariant Text Format</code>&#8201;&#8212;&#8201;textual representation of GVariants
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_gobject">GObject</h4>
<div class="paragraph"><p>GObject provides a generic type system to register arbitrary single-inherited
flat and deep derived types as well as interfaces for structured types in C on
top of GLib fundamental data types.</p></div>
<div class="paragraph"><p>C with GLib and GObject offers an alternative to C++ with its Standard library
although it requires many chores with
<a href="http://developer.gnome.org/gobject/stable/gtype-conventions.html">boiler plate
macro definitions</a>.</p></div>
<div class="paragraph"><p>The GTK+ GUI toolkit is build on the top of C with GLib and GObject.  If you
wish to simplify this coding process, please think about Vala.  For more see
the following section on this document and the followings:</p></div>
<div class="paragraph"><p>See more at:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/GLib">GLib (wikipedia)</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/GObject">GObject (wikipedia)</a>
</p>
</li>
<li>
<p>
<a href="http://developer.gnome.org/glib/stable/">GLib (upstream doc)</a>, or via <code>devhelp</code>
</p>
</li>
<li>
<p>
<a href="http://developer.gnome.org/gobject/stable/">GObject (upstream doc)</a>, or via <code>devhelp</code>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/tutorials/l-glib/">Manage C data using the GLib collections</a> by Tom Copeland. (IBM DW, Date: 28 Jun 2005)
</p>
</li>
<li>
<p>
<a href="http://lore.ua.ac.be/Publications/summary/Hendrickx2004.php">Glib-C: C as an alternative Object Oriented Environment</a> (PDF) by  Steven Hendrickx. (2004)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_gtk_3">GTK+3</h3>
<div class="paragraph"><p>Although we are at GTK+3, we have many older documentations for GTK+2 but not enough ones for GTK+3.</p></div>
<div class="paragraph"><p>Those older documentations for GTK+2 contain useful contents as long as they are used carefully.</p></div>
<div class="paragraph"><p>For pure C programs, migrating from GTK+2 to GTK3+ is basically as easy as
changing from "gtk+-2.0" to "gtk+-3.0" in <code>pkg-config</code> argument.  In case of
troubles such as missing <code>GtkObject</code> and many missing GDK API issues, see
<a href="http://developer.gnome.org/gtk3/3.0/migrating.html">GTK+ 3 Reference Manual:
Part V. Migrating from Previous Versions of GTK+</a>.</p></div>
<div class="paragraph"><p>Here are basic references:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/GTK+">GTK+ (wikipedia)</a>
</p>
</li>
<li>
<p>
<a href="http://www.gtk.org/documentation.php">GTK+ (upstream doc)</a>, or via <code>devhelp</code>
</p>
</li>
<li>
<p>
<a href="http://developer.gnome.org/gtk3/stable/index.html">GTK+ 3 Reference Manual</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_glade">Glade</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Glade_Interface_Designer">Glade</a> is the UI design
tool for GTK+.  Its output is an XML file and can be loaded directly to GTK+.
If you wish to simplify the GUI coding process with many UI widgets under any
language, please think about using Glade.</p></div>
<div class="paragraph"><p>See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://live.gnome.org/Glade/Tutorials">Glade Tutorials</a> (pointers)
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://blog.borovsak.si/">Tips and tutorials related to GTK+ toolkit</a> (2009-2010)
</p>
</li>
<li>
<p>
<a href="http://www.micahcarrick.com/gtk-glade-tutorial-part-1.html">GTK+ and Glade3 GUI Programming Tutorial</a> (2007)
</p>
</li>
<li>
<p>
<a href="http://scentric.net/tutorial/treeview-tutorial.html">GTK+ 2.0 Tree View Tutorial</a> (2005)
</p>
</li>
<li>
<p>
<a href="http://virtualex.linuxoid.net/2009/08/18/glade-catalog-tutorial/">Glade Catalog Tutorial</a> (2009)
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="http://developer.gnome.org/gladeui/3.6/">Glade User Interface Designer Reference Manual</a> (API for Glade 3.6)
</p>
</li>
<li>
<p>
<a href="http://www.youtube.com/playlist?list=PL70617645D7DC1FD1&amp;feature=plcp">Tutorial: A GUI application using Python &amp; gtk.Builder</a> (2009, Video)
</p>
<div class="ulist"><ul>
<li>
<p>
Learn how to use Glade GUI from video.
</p>
</li>
<li>
<p>
Disregard details of Python code since it is based on gtk.Builder from PyGTK for GTK+2 and outdated.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_pygobject">PyGObject</h3>
<div class="paragraph"><p>Python bindings of GTK+ has evolved.</p></div>
<div class="ulist"><ul>
<li>
<p>
PyGTK for GTK+2: (deprecated))
</p>
<div class="ulist"><ul>
<li>
<p>
starting code with "<code>import pygtk</code>" (newer), or "<code>import gtk</code>" (older)
</p>
</li>
</ul></div>
</li>
<li>
<p>
PyGObject for GTK+3: (recommended)
</p>
<div class="ulist"><ul>
<li>
<p>
starting code with "<code>from gi.repository import Gtk</code>" (current)
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>So we focus on the latest PyGObject for GTK+3 and recommend you to start with:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://python-gtk-3-tutorial.readthedocs.org/en/latest/">The Python GTK+ 3 Tutorial</a> (2012)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Unfortunately, as of 2012 on Debian wheezy, we can not find good reference
documentations of GTK+3 and its related libraries for Python.</p></div>
<div class="paragraph"><p>We can create a usable reference documentation of GTK+3 and related libraries
by yourself using the <code>g-ir-doc-tool</code> command from the gobject-introspection
package as explained in
<a href="https://live.gnome.org/GObjectIntrospection/Doctools">GObject Introspection
Doctools</a>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ g-ir-doc-tool --language Python -o ./output_dir /usr/share/gir-1.0/Gtk-3.0.gir
$ yelp ./output_dir/index.page</code></pre>
</div></div>
<div class="paragraph"><p>Despite the efforts to make GTK+3 PyGObject as compatible to the older GTK+2
PyGTK as possible, the differences are still huge.  See
<a href="http://pfrields.fedorapeople.org/presentations/OhioLF2011/PyGObject.pdf">Graduating
to GUI (PDF)</a>.</p></div>
<div class="paragraph"><p>Please note older PyGTK for GTK+2 are still used widely as of now.  The new
GTK+3 Python codes using PyGObject such as <code>accerciser</code>, <code>caribou-preferences</code>,
<code>gdebi-gtk</code>, <code>gnome-shell-timer-config</code>, <code>software-center</code>, and
<code>software-properties-gtk</code> provide us with good examples.</p></div>
</div>
<div class="sect2">
<h3 id="_vala_4">Vala</h3>
<div class="paragraph"><p>Vala is a programming language specifically designed to ease the traditional C
coding process for GNOME3. The Vala compiler generates C codes using the object system of GNOME with GLib, GObject, etc.  Vala offers capabilities such as:</p></div>
<div class="ulist"><ul>
<li>
<p>
access to the modern object oriented language features such as <code>class</code>,
</p>
</li>
<li>
<p>
access to the automatic memory management system based on the reference counting,
</p>
</li>
<li>
<p>
access to all C libraries, and
</p>
</li>
<li>
<p>
generation of native binaries with the C API.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Writing codes for GNOME with the plain C is very tedious and error prone
process. But Writing codes for GNOME in Vala is very simple and straigtfrward
process just like writing codes under high-level languages such as Python,
Java, or MONO/C#.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Vala does not free you from thinking in C.  Think Vala as a nice pre-processor.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s start here:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://live.gnome.org/Vala/Tutorial">Vala Tutorial</a>
</p>
</li>
<li>
<p>
<a href="http://valadoc.org/#!wiki=index">Valadoc Online API Documentation</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>In Vala, GLib and GObject objects are available as default.  Almost any
libraries written in C can be accessed from Vala by declaring <code>using ...;</code> at
the top using Vala bindings defined as VAPI files located in the <code>/usr/share/vala*/vapi/</code> directory.</p></div>
<div class="paragraph"><p><a href="https://live.gnome.org/Vala/Bindings">Vala binding to GObject-based libraries</a> are generated automatically as:</p></div>
<div class="ulist"><ul>
<li>
<p>
generating GObject Introspection GIR file (stored in the <code>/usr/share/gir-1.0</code> directory)
</p>
</li>
<li>
<p>
generation the VAPI binding from the GIR file with <code>vapigen</code>
</p>
</li>
<li>
<p>
tweaking the binding generation with metadata and custom code
</p>
</li>
<li>
<p>
their VAPI files contain "generated by vapigen" in it.
</p>
</li>
</ul></div>
<div class="paragraph"><p><a href="https://live.gnome.org/Vala/ExternalBindings">Vala binding to non-GObject-based
C libraries</a> are manually generated and their VAPI files do not contain
"generated by vapigen" in it.</p></div>
<div class="paragraph"><p>The C API is always available in the pertinent manpage, info page, or
documentations accessed via <code>devhelp</code>.  But Vala API is a bit difficult to get
at this moment and explained as below.</p></div>
<div class="paragraph"><p>C API names of many libraries are mapped to Vala ones with the similar naming
convention as GLib naming convention as:</p></div>
<div class="ulist"><ul>
<li>
<p>
C API: <code>g_topic_foobar()</code>
</p>
</li>
<li>
<p>
Vala API: <code>GLib.Topic.foobar()</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The exact mapping from C API names to Vala ones is defined in <code>*.vapi</code> (Vala
API) files found in <code>/usr/share/vala*/vapi/</code>.  For example, on Debian wheezy:</p></div>
<div class="ulist"><ul>
<li>
<p>
Glib: <code>/usr/share/vala-0.16/vapi/glib-2.0.vapi</code>
</p>
</li>
<li>
<p>
GObject: <code>/usr/share/vala-0.16/vapi/gobject-2.0.vapi</code>
</p>
</li>
<li>
<p>
GTK+: <code>/usr/share/vala-0.16/vapi/gtk+-3.0.vapi</code>
</p>
</li>
<li>
<p>
POSIX: <code>/usr/share/vala-0.16/vapi/posix.vapi</code> (libc/libm library)
</p>
</li>
<li>
<p>
CURSES: <code>/usr/share/vala-0.16/vapi/curses.vapi</code> (curses library)
</p>
</li>
</ul></div>
<div class="paragraph"><p>These <code>*.vapi</code> (Vala API) files are written in Vala language with extensive use
of the <a href="https://live.gnome.org/Vala/Manual/Attributes">attributes</a> such as
<code>CCode</code>.  Here are some cliches used in <code>*.vapi</code> files:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>[CCode (cprefix ...)]</code>
</p>
<div class="ulist"><ul>
<li>
<p>
This is primarily used for namespaces. While when left to its
   own devices valac will simply concatenate the parent names to
   generate C type names, setting the <code>cprefix</code> allows you to
   override this. For instance, assuming you have a class
   <code>Foo.Bar.Baz</code>, setting a cprefix of "<code>Fubar</code>" on a your <code>Bar</code>
   namespace will result in a C name of "<code>FubarBaz</code>" for the <code>Baz</code>
   class.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>[CCode (lower_case_cprefix ...)]</code>
</p>
<div class="ulist"><ul>
<li>
<p>
This overrides everything up to the start of
   the method name. For instance, a method named <code>Foo.Bar.baz</code> would
   normally result in a C name of <code>foo_bar_baz</code>. However, if you set
   the <code>lower_case_cprefix</code> of the <code>bar</code> class to be "<code>fb_</code>", the
   resulting C name would be "<code>fb_baz</code>".
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>[CCode (cname ...)]</code>
</p>
<div class="ulist"><ul>
<li>
<p>
This sets the C name to exactly what you specify here. For
   instance, if you set the <code>cname</code> of a <code>Foo.Bar.baz</code> method to
   "<code>bacon</code>", the name of the <code>Foo.Bar.baz</code> function in C will be
   "<code>bacon</code>".
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Here are some reminders for errors when using Gtk.Builder with Vala.</p></div>
<div class="ulist"><ul>
<li>
<p>
Forgetting to use <code>[CCode (instance_pos = -1)]</code> when using instance
  methods instead of static methods as handlers
</p>
</li>
<li>
<p>
Forgetting to mangle the handler method names in Glade, e.g. from
  <code>FooBar.my_handler</code> to <code>foo_bar_my_handler</code>
</p>
</li>
<li>
<p>
Not using the right signature for the handler. One missing parameter
  or one parameter too much will result in a segmentation fault.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let me explain the last case a bit more.  If the signal signature is</p></div>
<div class="listingblock">
<div class="content">
<pre><code>public class Area : Object {
    public signal void clicked (int x, int y);
}</code></pre>
</div></div>
<div class="paragraph"><p>then the handler method must have <strong>exactly</strong> these parameters in order
to work with Gtk.Builder&#8217;s auto-connect:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[CCode (instance_pos = -1)]
public void on_clicked (Area source, int x, int y) { }</code></pre>
</div></div>
<div class="paragraph"><p>Vala can&#8217;t recognize this mistake, because auto-connection happens at
runtime an it doesn&#8217;t know at compile-time which method will be connected
to which signal.</p></div>
<div class="paragraph"><p>See also:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://live.gnome.org/Vala">Vala - Compiler for the GObject type system</a>&#8201;&#8212;&#8201;Homepage
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/Vala/Documentation">Vala - Documentation</a>&#8201;&#8212;&#8201;Sample Code
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/Vala/Manual">Vala - Manual (Draft)</a>
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/Vala/Hacking">Hackers' Guide to Vala</a>
</p>
</li>
<li>
<p>
C API documentation found in <code>devhelp</code> or for <a href="http://developer.gnome.org/glib/unstable/">GLib</a>, <a href="http://developer.gnome.org/gobject/unstable/">GObject</a>, and <a href="http://www.gtk.org/documentation.php">GTK+</a>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_javascript">JavaScript</h3>
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a> programming language is
selected to be the embedded language of
<a href="http://en.wikipedia.org/wiki/GNOME_Shell">GNOME Shell</a>.  See:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://developer.mozilla.org/en-US/docs/JavaScript">JavaScript</a> (Mozilla)
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/JavaScript">JavaScript</a> (GNOME)
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/GnomeShell">GNOME Shell</a>
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/GnomeShell/Technology">GNOME Shell: Technology</a>
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/GnomeShell/Extensions">GNOME Shell: Extensions</a>
</p>
</li>
<li>
<p>
<a href="https://live.gnome.org/GnomeShell/Extensions/StepByStepTutorial">GNOME Shell: Step by step tutorial to create extensions</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>I am not going into details now.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gtk_gui_programs">GTK+ GUI programs</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are some pointers to example codes for GNOME GUI:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://live.gnome.org/DocumentationProject/Tasks/DeveloperDocs/BeginnerTutorials">Beginner Gtk+ Course</a> (August 20, 2012)
</p>
</li>
<li>
<p>
<a href="http://developer.gnome.org/gnome-devel-demos/stable/">GNOME Developer Platform Demos</a> (These are mostly empty templates as of 2012.)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Let me record my practice codes which create executables with the following
same behaviour.</p></div>
<div class="paragraph"><p>First it displays a small window as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code> +----------------X
 |    Click me!   |
 |                |
 +----------------+</code></pre>
</div></div>
<div class="paragraph"><p>If you click it with the mouse pointer, it updates its display via call
backfunction mechanism.  For example, after 3 clicks, it displays a small
window as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code> +--------------------X
 |   Hello World!     |
 |   Click count = 3  |
 +--------------------+</code></pre>
</div></div>
<div class="paragraph"><p>If you click the right top corner of window, this window is closed and program
is terminated.</p></div>
<div class="paragraph"><p>My first set of example codes do not use Glade while my second set of example
codes use Glade for defining GUI design.</p></div>
<div class="sect2">
<h3 id="_c_7">C</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries to build GUI version of a
"Hello World!" program in simple C.</p></div>
<div class="listingblock">
<div class="title">Source code: gui.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">quit</span></span><span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    i <span style="color: #990000">++;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_BUTTON</span></span><span style="color: #990000">(</span>button<span style="color: #990000">),</span>
        <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> i<span style="color: #990000">));</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">quit</span></span><span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    GtkWidget<span style="color: #990000">*</span> window<span style="color: #990000">;</span>
    GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">;</span>

    i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span><span style="color: #990000">(&amp;</span>argc<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_window_new</span></span><span style="color: #990000">(</span>GTK_WINDOW_TOPLEVEL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_title</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_WINDOW</span></span><span style="color: #990000">(</span>window<span style="color: #990000">),</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_set_border_width</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_CONTAINER</span></span><span style="color: #990000">(</span>window<span style="color: #990000">),</span> <span style="color: #990000">(</span>guint<span style="color: #990000">)</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_set</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_WINDOW</span></span><span style="color: #990000">(</span>window<span style="color: #990000">),</span> <span style="color: #FF0000">"window-position"</span><span style="color: #990000">,</span>
        GTK_WIN_POS_CENTER<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_default_size</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_WINDOW</span></span><span style="color: #990000">(</span>window<span style="color: #990000">),</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span><span style="color: #990000">(</span>window<span style="color: #990000">,</span> <span style="color: #FF0000">"destroy"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">G_CALLBACK</span></span><span style="color: #990000">(</span>quit<span style="color: #990000">),</span> NULL<span style="color: #990000">);</span>
    button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_button_new_with_label</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect_data</span></span><span style="color: #990000">(</span>button<span style="color: #990000">,</span> <span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">G_CALLBACK</span></span><span style="color: #990000">(</span>hello<span style="color: #990000">),</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_add</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_CONTAINER</span></span><span style="color: #990000">(</span>window<span style="color: #990000">),</span> button<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span><span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s look for the right compile and link options for the gtk+3.0 GUI libraries.</p></div>
<div class="listingblock">
<div class="title">Search the development package of gtk+3.0</div>
<div class="content">
<pre><code>libgtk2.0-dev - development files for the GTK+ library
libgtk-3-dev - development files for the GTK+ library</code></pre>
</div></div>
<div class="paragraph"><p>If the <code>libgtk-3-dev</code> package has not been installed, install it now.</p></div>
<div class="paragraph"><p>Search the right <code>*.pc</code> file for gtk+3.0 for use with <code>pkg-config</code>.</p></div>
<div class="listingblock">
<div class="title">Search the right *.pc file for gtk+3.0</div>
<div class="content">
<pre><code>/usr/lib/x86_64-linux-gnu/pkgconfig/gtk+-x11-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gtk+-wayland-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gtk+-unix-print-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gtk+-broadway-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gtk+-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gdk-x11-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gdk-wayland-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gdk-broadway-3.0.pc
/usr/lib/x86_64-linux-gnu/pkgconfig/gdk-3.0.pc</code></pre>
</div></div>
<div class="paragraph"><p>Now you can obtain the right compile and link options used by gtk+3.0.</p></div>
<div class="listingblock">
<div class="title">Compile and link options used by gtk+3.0</div>
<div class="content">
<pre><code>-pthread -I/usr/include/gtk-3.0 -I/usr/include/at-spi2-atk/2.0 -I/usr/include/at-...</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui.c</code> program with gtk+3.0.</p></div>
<div class="listingblock">
<div class="title">Compilation of gui.c into the gtk+3.0 GUI program gui.</div>
<div class="content">
<pre><code></code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s list linked libraries to the ELF object hello with the <code>nm</code> command.
&#8230;  Impressive &#8230; or too much.</p></div>
</div>
<div class="sect2">
<h3 id="_python_5">Python</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries to build GUI version of a "Hello
World!" program with simple Python.</p></div>
<div class="listingblock">
<div class="title">Source code <code>gui</code> in Python language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> gi<span style="color: #990000">.</span>repository <span style="font-weight: bold"><span style="color: #000080">import</span></span> Gtk

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">TopWindow</span></span><span style="color: #990000">(</span>Gtk<span style="color: #990000">.</span>Window<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        Gtk<span style="color: #990000">.</span>Window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>title <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello World!"</span>
        self<span style="color: #990000">.</span>counter <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        self<span style="color: #990000">.</span>border_width <span style="color: #990000">=</span> <span style="color: #993399">10</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_default_size</span></span><span style="color: #990000">(</span><span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_position</span></span><span style="color: #990000">(</span>Gtk<span style="color: #990000">.</span>WindowPosition<span style="color: #990000">.</span>CENTER<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>button <span style="color: #990000">=</span> Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Button</span></span><span style="color: #990000">(</span>label<span style="color: #990000">=</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>button<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>on_button_clicked<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>button<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"delete-event"</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>on_window_destroy<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">on_window_destroy</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">*</span>args<span style="color: #990000">):</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span><span style="color: #990000">(*</span>args<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">on_button_clicked</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> widget<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>counter <span style="color: #990000">+=</span> <span style="color: #993399">1</span>
        widget<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_label</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!\nClick count = %i"</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>counter<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">TopWindow</span></span><span style="color: #990000">()</span>
    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span><span style="color: #990000">()</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
</tt></pre></div></div>
<div class="paragraph"><p>Please note, "<code>from gi.repository import Gtk</code>" at the top.</p></div>
</div>
<div class="sect2">
<h3 id="_vala_5">Vala</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries to build GUI version of a "Hello
World!" program with simple Vala.  Just like the Vala examples for "CLI
programs", we present codes in 3 different styles.</p></div>
<div class="sect3">
<h4 id="_simple_non_oop_style_no_class_3">Simple non-OOP style (no class)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-1.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="color: #009900">var</span> window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Window</span></span> <span style="color: #990000">();</span>
    window<span style="color: #990000">.</span>title <span style="color: #990000">=</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">;</span>
    window<span style="color: #990000">.</span>border_width <span style="color: #990000">=</span> <span style="color: #993399">10</span><span style="color: #990000">;</span>
    window<span style="color: #990000">.</span>window_position <span style="color: #990000">=</span> WindowPosition<span style="color: #990000">.</span>CENTER<span style="color: #990000">;</span>
    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_default_size</span></span> <span style="color: #990000">(</span><span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
    window<span style="color: #990000">.</span>destroy<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(</span>Gtk<span style="color: #990000">.</span>main_quit<span style="color: #990000">);</span>

    i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #009900">var</span> button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Button<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
    button<span style="color: #990000">.</span>clicked<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(()</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">++;</span>
        button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">);</span>
    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>

    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-1.vala</code> to create the ELF object <code>gui-1</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
cc -o '/path/to/vala/gui-1' '/path/to/vala/gui-1.vala.c' -pthread -I/usr/include/...</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
<span style="color: #993399">26</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala
<span style="color: #993399">111</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-1.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-1.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> Block1Data<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> _ref_count_<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>



<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">);</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_atomic_int_inc</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _data1_<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    _data1_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*)</span> _userdata_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_atomic_int_dec_and_test</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_slice_free</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">,</span> _data1_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> _data1_<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    _data1_<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _data1_<span style="color: #990000">-&gt;</span>i<span style="color: #990000">);</span>
    _tmp2_ <span style="color: #990000">=</span> _tmp1_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    GtkWindow<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    _data1_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_slice_new0</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>_ref_count_ <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">gtk_window_new</span></span> <span style="color: #990000">(</span>GTK_WINDOW_TOPLEVEL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">);</span>
    window <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_title</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">,</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_set_border_width</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> window<span style="color: #990000">,</span> <span style="color: #990000">(</span>guint<span style="color: #990000">)</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_set</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">,</span> <span style="color: #FF0000">"window-position"</span><span style="color: #990000">,</span> GTK_WIN_POS_CENTER<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_default_size</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> window<span style="color: #990000">,</span> <span style="color: #FF0000">"destroy"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> _gtk_main_quit
_gtk_widget_destroy<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">gtk_button_new_with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>button <span style="color: #990000">=</span> _tmp1_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect_data</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> <span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> ___lambda4__g
tk_button_clicked<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">),</span> <span style="color: #990000">(</span>GClosureNotify<span style="color: #990000">)</span> block1_data_unref
<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_add</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> window<span style="color: #990000">,</span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*)</span> _data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">);</span>
    _data1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.</p></div>
<div class="paragraph"><p>One notable logical difference from the corresponding C program example is the
use of dynamically assigned object pointed by <code>Block1Data* _data1_</code> and maneged
by reference counting.</p></div>
<div class="paragraph"><p>Since no OOP techniques are used, the resulting C code does not have GObject
related macros.</p></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_outside_of_class_3">OOP style (main outside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-2.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Gui</span> <span style="color: #990000">:</span> Gtk<span style="color: #990000">.</span>Window <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>title <span style="color: #990000">=</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>border_width <span style="color: #990000">=</span> <span style="color: #993399">10</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>window_position <span style="color: #990000">=</span> WindowPosition<span style="color: #990000">.</span>CENTER<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_default_size</span></span> <span style="color: #990000">(</span><span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>destroy<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(</span>Gtk<span style="color: #990000">.</span>main_quit<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #009900">var</span> button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Button<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
        button<span style="color: #990000">.</span>clicked<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(()</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">++;</span>
            button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i<span style="color: #990000">);</span>
            <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>

    <span style="color: #009900">var</span> window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Gui</span></span> <span style="color: #990000">();</span>
    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above example skips specifying <code>GLib</code> for the parent class since it is
the default for Vala.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-2.vala</code> to create the ELF object <code>gui-2</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
cc -o '/path/to/vala/gui-2' '/path/to/vala/gui-2.vala.c' -pthread -I/usr/include/...</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
<span style="color: #993399">34</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala
<span style="color: #993399">205</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-2.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-2.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_GUI</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> Gui<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_GUI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_GUI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiClass
<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Gui</span> Gui<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiClass</span> GuiClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiPrivate</span> GuiPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> Block1Data<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Gui</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GtkWindow</span> parent_instance<span style="color: #990000">;</span>
    GuiPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GtkWindowClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiPrivate</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> _ref_count_<span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> gui_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_PRIVATE</span></span><span style="color: #990000">(</span>o<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_PRIVATE</span></span> <span style="color: #990000">((</span>o<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiPriva
te<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    GUI_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">);</span>
Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_atomic_int_inc</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _data1_<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    _data1_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*)</span> _userdata_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_atomic_int_dec_and_test</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
        self <span style="color: #990000">=</span> _data1_<span style="color: #990000">-&gt;</span>self<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_slice_free</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">,</span> _data1_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> _data1_<span style="color: #990000">-&gt;</span>self<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp1_<span style="color: #990000">);</span>
    _tmp3_ <span style="color: #990000">=</span> _tmp2_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> _tmp3_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _data1_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_slice_new0</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>_ref_count_ <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _data1_<span style="color: #990000">-&gt;</span>self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_title</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_set_border_width</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #990000">(</span>guint<span style="color: #990000">)</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_set</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"window-position"</span><span style="color: #990000">,</span> GTK_WIN_POS_CENTER<span style="color: #990000">,</span> NULL
<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_default_size</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"destroy"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> _gtk_main_quit_g
tk_widget_destroy<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">gtk_button_new_with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>button <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect_data</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> <span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> ___lambda4__g
tk_button_clicked<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">),</span> <span style="color: #990000">(</span>GClosureNotify<span style="color: #990000">)</span> block1_data_unref
<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_add</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*)</span> _data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> self<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">);</span>
    _data1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span>TYPE_GUI<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_class_init</span></span> <span style="color: #990000">(</span>GuiClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    gui_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_class_add_private</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>GuiPrivate<span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> gui_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_instance_init</span></span> <span style="color: #990000">(</span>Gui <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    self<span style="color: #990000">-&gt;</span>priv <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_PRIVATE</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_GUI<span style="color: #990000">,</span> Gui<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>gui_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> gui_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>gui_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>GuiClass<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseI
nitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> gui_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClas
sFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInitFunc<span style="color: #990000">)</span> gui_instance_ini
t<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> gui_type_id<span style="color: #990000">;</span>
        gui_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gtk_window_get_type</span></span> <span style="color: #990000">(),</span> <span style="color: #FF0000">"Gui"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_
define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>gui_type_id__volatile<span style="color: #990000">,</span> gui_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> gui_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">);</span>
    window <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_inside_of_class_3">OOP style (main inside of class)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-3.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Gui</span> <span style="color: #990000">:</span> Gtk<span style="color: #990000">.</span>Window <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>title <span style="color: #990000">=</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>border_width <span style="color: #990000">=</span> <span style="color: #993399">10</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>window_position <span style="color: #990000">=</span> WindowPosition<span style="color: #990000">.</span>CENTER<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_default_size</span></span> <span style="color: #990000">(</span><span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>destroy<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(</span>Gtk<span style="color: #990000">.</span>main_quit<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #009900">var</span> button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Button<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
        button<span style="color: #990000">.</span>clicked<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span> <span style="color: #990000">(()</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">++;</span>
            button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i<span style="color: #990000">);</span>
            <span style="color: #FF0000">}</span><span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>

        <span style="color: #009900">var</span> window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Gui</span></span> <span style="color: #990000">();</span>
        window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">();</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The above example skips specifying <code>GLib</code> for the parent class since it is
the default for Vala.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-3.vala</code> to create the ELF object <code>gui-3</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
cc -o '/path/to/vala/gui-3' '/path/to/vala/gui-3.vala.c' -pthread -I/usr/include/...</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
<span style="color: #993399">34</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala
<span style="color: #993399">205</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-3.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-3.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_GUI</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> Gui<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_GUI</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_GUI_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiClass
<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Gui</span> Gui<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiClass</span> GuiClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiPrivate</span> GuiPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> Block1Data<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Gui</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GtkWindow</span> parent_instance<span style="color: #990000">;</span>
    GuiPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GtkWindowClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_GuiPrivate</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_Block1Data</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> _ref_count_<span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> gui_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_PRIVATE</span></span><span style="color: #990000">(</span>o<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_PRIVATE</span></span> <span style="color: #990000">((</span>o<span style="color: #990000">),</span> TYPE_GUI<span style="color: #990000">,</span> GuiPriva
te<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    GUI_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> Block1Data<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_atomic_int_inc</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> _data1_<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span> <span style="color: #990000">*</span> _userdata_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    _data1_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*)</span> _userdata_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_atomic_int_dec_and_test</span></span> <span style="color: #990000">(&amp;</span>_data1_<span style="color: #990000">-&gt;</span>_ref_count_<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
        self <span style="color: #990000">=</span> _data1_<span style="color: #990000">-&gt;</span>self<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_slice_free</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">,</span> _data1_<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">_gtk_main_quit_gtk_widget_destroy</span></span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> gpointer self
<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui<span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> _data1_<span style="color: #990000">-&gt;</span>self<span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp1_<span style="color: #990000">);</span>
    _tmp3_ <span style="color: #990000">=</span> _tmp2_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> _tmp3_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">___lambda4__gtk_button_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> _sender<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">__lambda4_</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    Block1Data<span style="color: #990000">*</span> _data1_<span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    _data1_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_slice_new0</span></span> <span style="color: #990000">(</span>Block1Data<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>_ref_count_ <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _data1_<span style="color: #990000">-&gt;</span>self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_title</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"My first GUI program"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_set_border_width</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #990000">(</span>guint<span style="color: #990000">)</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_set</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"window-position"</span><span style="color: #990000">,</span> GTK_WIN_POS_CENTER<span style="color: #990000">,</span> NULL
<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_window_set_default_size</span></span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #993399">400</span><span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #FF0000">"destroy"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> _gtk_main_quit_g
tk_widget_destroy<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">gtk_button_new_with_label</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Click me!"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">);</span>
    _data1_<span style="color: #990000">-&gt;</span>button <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect_data</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">,</span> <span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> ___lambda4__g
tk_button_clicked<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">block1_data_ref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">),</span> <span style="color: #990000">(</span>GClosureNotify<span style="color: #990000">)</span> block1_data_unref
<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_container_add</span></span> <span style="color: #990000">((</span>GtkContainer<span style="color: #990000">*)</span> self<span style="color: #990000">,</span> <span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*)</span> _data1_<span style="color: #990000">-&gt;</span>button<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> self<span style="color: #990000">);</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">block1_data_unref</span></span> <span style="color: #990000">(</span>_data1_<span style="color: #990000">);</span>
    _data1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">gui_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    Gui<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_ref_sink</span></span> <span style="color: #990000">(</span>_tmp0_<span style="color: #990000">);</span>
    window <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gui_run</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">gui_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>Gui<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


Gui<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">gui_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">gui_construct</span></span> <span style="color: #990000">(</span>TYPE_GUI<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_class_init</span></span> <span style="color: #990000">(</span>GuiClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    gui_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_class_add_private</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>GuiPrivate<span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> gui_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_instance_init</span></span> <span style="color: #990000">(</span>Gui <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    self<span style="color: #990000">-&gt;</span>priv <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">GUI_GET_PRIVATE</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">gui_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gui <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_GUI<span style="color: #990000">,</span> Gui<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>gui_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">gui_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> gui_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>gui_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>GuiClass<span style="color: #990000">),</span> <span style="color: #990000">(</span>GBaseI
nitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> gui_class_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClas
sFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>Gui<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInitFunc<span style="color: #990000">)</span> gui_instance_ini
t<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> gui_type_id<span style="color: #990000">;</span>
        gui_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gtk_window_get_type</span></span> <span style="color: #990000">(),</span> <span style="color: #FF0000">"Gui"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_
define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>gui_type_id__volatile<span style="color: #990000">,</span> gui_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> gui_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_glade_2">Glade</h3>
<div class="paragraph"><p>Let&#8217;s try to design GUI for a "Hello World!" with Glade and try to be used by
the gtk+3.0 GUI libraries.  For most cases, we should create <code>clickme.glade</code>.</p></div>
<div class="listingblock">
<div class="title">GUI design XML file <code>clickme.glade</code> generated by Glade.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;interface&gt;</span></span>
  <span style="font-style: italic"><span style="color: #9A1900">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;object</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"GtkWindow"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"window1"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"can_focus"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"border_width"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>10<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"title"</span> <span style="color: #009900">translatable</span><span style="color: #990000">=</span><span style="color: #FF0000">"yes"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>My first GUI program<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"window_position"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>center-always<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"default_width"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>400<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"default_height"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>100<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;signal</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"destroy"</span> <span style="color: #009900">handler</span><span style="color: #990000">=</span><span style="color: #FF0000">"on_window1_destroy"</span> <span style="color: #009900">swapped</span><span style="color: #990000">=</span><span style="color: #FF0000">"no"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;child&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">&lt;object</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"GtkButton"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"button1"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"label"</span> <span style="color: #009900">translatable</span><span style="color: #990000">=</span><span style="color: #FF0000">"yes"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Click me!<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"use_action_appearance"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"visible"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>True<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"can_focus"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"receives_default"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"use_action_appearance"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;signal</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"clicked"</span> <span style="color: #009900">handler</span><span style="color: #990000">=</span><span style="color: #FF0000">"on_button1_clicked"</span> <span style="color: #009900">swapped</span><span style="color: #990000">=</span><span style="color: #FF0000">"no"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">&lt;/object&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;/child&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/object&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/interface&gt;</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You can check this by "<code>glade clickme.glade</code>".</td>
</tr></table>
</div>
<div class="paragraph"><p>For Vala, the Gtk.Builder&#8217;s signal auto-connection mechanism uses the C name.
The CamelCase namespace and class name prefix for the callback method name is
converted to the lower_case C name prefix.</p></div>
<div class="paragraph"><p>So for such cases as described later, we create <code>clickme-ext.glade</code>, instead.</p></div>
<div class="listingblock">
<div class="title">Alternative GUI design XML file <code>clickme-ext.glade</code> generated by Glade.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;interface&gt;</span></span>
  <span style="font-style: italic"><span style="color: #9A1900">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;object</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"GtkWindow"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"window1"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"can_focus"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"border_width"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>10<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"title"</span> <span style="color: #009900">translatable</span><span style="color: #990000">=</span><span style="color: #FF0000">"yes"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>My first GUI program<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"window_position"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>center-always<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"default_width"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>400<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"default_height"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>100<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;signal</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"destroy"</span> <span style="color: #009900">handler</span><span style="color: #990000">=</span><span style="color: #FF0000">"hello_world_on_window1_destroy"</span> <span style="color: #009900">swapped</span><span style="color: #990000">=</span><span style="color: #FF0000">"no"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;child&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">&lt;object</span></span> <span style="color: #009900">class</span><span style="color: #990000">=</span><span style="color: #FF0000">"GtkButton"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"button1"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"label"</span> <span style="color: #009900">translatable</span><span style="color: #990000">=</span><span style="color: #FF0000">"yes"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Click me!<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"use_action_appearance"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"visible"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>True<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"can_focus"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"receives_default"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;property</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"use_action_appearance"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>False<span style="font-weight: bold"><span style="color: #0000FF">&lt;/property&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;signal</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"clicked"</span> <span style="color: #009900">handler</span><span style="color: #990000">=</span><span style="color: #FF0000">"hello_world_on_button1_clicked"</span> <span style="color: #009900">swapped</span><span style="color: #990000">=</span><span style="color: #FF0000">"no"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">&lt;/object&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;/child&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/object&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/interface&gt;</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The class name prefix "<code>HelloWorld.</code>" is converted to the C name prefix
"<code>hello_world_</code>" in the Glade XML file used by the Gtk.Builder.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_c_with_glade">C with Glade</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries and Glade generated XML file to
build GUI version of a "Hello World!" program in C.</p></div>
<div class="listingblock">
<div class="title">Source code: gui.c</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">GtkWidget</span> <span style="color: #990000">*</span>object<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> user_data<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">(</span>GtkWidget<span style="color: #990000">*</span> button<span style="color: #990000">,</span> <span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    i <span style="color: #990000">++;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">GTK_BUTTON</span></span><span style="color: #990000">(</span>button<span style="color: #990000">),</span>
        <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> i<span style="color: #990000">));</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">GtkBuilder</span>      <span style="color: #990000">*</span>builder<span style="color: #990000">;</span>
    <span style="color: #008080">GtkWidget</span>       <span style="color: #990000">*</span>window<span style="color: #990000">;</span>
    <span style="color: #008080">GtkWidget</span>       <span style="color: #990000">*</span>button<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>argc<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>argv<span style="color: #990000">);</span>
    i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme.glade"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    window <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">GTK_WIDGET</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">,</span> <span style="color: #FF0000">"destroy"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> on_window1_destroy<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">GTK_WIDGET</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">,</span> <span style="color: #FF0000">"button1"</span><span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">g_signal_connect</span></span> <span style="color: #990000">(</span>button<span style="color: #990000">,</span> <span style="color: #FF0000">"clicked"</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GCallback<span style="color: #990000">)</span> hello<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_OBJECT</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">));</span>

    <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui.c</code> program with gtk+3.0.</p></div>
<div class="listingblock">
<div class="title">Compilation of gui.c into the gtk+3.0 GUI program gui.</div>
<div class="content">
<pre><code></code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s list linked libraries to the ELF object hello with the <code>nm</code> command.
&#8230;  Impressive &#8230; or too much.</p></div>
</div>
<div class="sect2">
<h3 id="_python_with_glade">Python with Glade</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries to build GUI program with Python.</p></div>
<div class="listingblock">
<div class="title">Source code <code>gui</code> in Python language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> gi<span style="color: #990000">.</span>repository <span style="font-weight: bold"><span style="color: #000080">import</span></span> Gtk

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Handler<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">*</span>args<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>counter <span style="color: #990000">=</span> <span style="color: #993399">0</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">*</span>args<span style="color: #990000">):</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span><span style="color: #990000">(*</span>args<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> widget<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>counter <span style="color: #990000">+=</span> <span style="color: #993399">1</span>
        widget<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_label</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!\nClick count = %i"</span> <span style="color: #990000">%</span> self<span style="color: #990000">.</span>counter<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">():</span>
    builder <span style="color: #990000">=</span> Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Builder</span></span><span style="color: #990000">()</span>
    builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"clickme.glade"</span><span style="color: #990000">)</span>
    builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">Handler</span></span><span style="color: #990000">())</span>
    window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span>
    window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span><span style="color: #990000">()</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span>
</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The content of the "<code>class Handler:</code>" class provides the callback handlers.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_vala_with_glade">Vala with Glade</h3>
<div class="paragraph"><p>Let&#8217;s try to use the gtk+3.0 GUI libraries to build GUI version of a "Hello
World!" program in Vala with the Glade generated GUI definition XML
configuration file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You need to specify the additional gmodule module to the Vala compiler
option as "<code>--pkg gmodule-2.0</code>".  This enables the dynamic loading of methods
based on the glade XML data during the program execution.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_simple_non_oop_style_no_class_4">Simple non-OOP style (no class)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-1.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="color: #009900">int</span> i<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span><span style="color: #008080">Button</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    i <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
    i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">var</span> builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Builder</span></span> <span style="color: #990000">();</span>
        builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"clickme.glade"</span><span style="color: #990000">);</span>
        builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">);</span>
        <span style="color: #009900">var</span> window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> Window<span style="color: #990000">;</span>
        window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Error</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        stderr<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Since no namespace nor class isused, simple "<code>clickme.glade</code>" is used here.</p></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-1.vala</code> to create the ELF object <code>gui-1</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gmodule-2.0.vapi'
cc -o '/path/to/vala-glade/gui-1' '/path/to/vala-glade/gui-1.vala.c' -pthread -I/...</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
<span style="color: #993399">29</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>vala
<span style="color: #993399">125</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-1.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-1.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>


<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
<span style="color: #008080">gint</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp2_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>button <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
    i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> button<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> i<span style="color: #990000">;</span>
    _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp4_ <span style="color: #990000">=</span> _tmp3_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> _tmp4_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self <span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">{</span>
        GtkBuilder<span style="color: #990000">*</span> builder <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GObject<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
        builder <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme.glade"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_error<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        _tmp2_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_connect_signals</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        _tmp3_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp4_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">);</span>
        _tmp5_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">,</span> gtk_window_
<span style="font-weight: bold"><span style="color: #000000">get_type</span></span> <span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> _tmp4_<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">);</span>
        window <span style="color: #990000">=</span> _tmp5_<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> window<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> _tmp6_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp7_ <span style="color: #990000">=</span> stderr<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> _tmp8_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp7_<span style="color: #990000">,</span> <span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp9_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.</p></div>
<div class="paragraph"><p>One notable logical difference from the corresponding C program example is the
use of dynamically assigned object pointed by <code>Block1Data* _data1_</code> and maneged
by reference counting.</p></div>
<div class="paragraph"><p>Since no OOP techniques are used, the resulting C code does not have GObject
related macros.</p></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_outside_of_class_callback_as_static">OOP style (main outside of class, callback as static)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-2.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span><span style="color: #008080">Button</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">var</span> builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Builder</span></span> <span style="color: #990000">();</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">);</span>
            <span style="color: #009900">var</span> window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> Window<span style="color: #990000">;</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Error</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stderr<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
    <span style="color: #009900">var</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
    h<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>args<span style="color: #990000">);</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Since class is isused, "<code>clickme-ext.glade</code>" is used here.</p></div>
<div class="paragraph"><p>Although you see compiler warnings like "<code>warning: method ... never used</code>", do
not worry.  They are used via Gtk.Builder callback mechanism.</p></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-2.vala</code> to create the ELF object <code>gui-2</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>gui-2.vala:7.5-7.41: warning: method `HelloWorld.on_button1_clicked' never used
    public static void on_button1_clicked (Button button) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gui-2.vala:12.5-12.41: warning: method `HelloWorld.on_window1_destroy' never used...
    public static void on_window1_destroy (Window window) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gmodule-2.0.vapi'
cc -o '/path/to/vala-glade/gui-2' '/path/to/vala-glade/gui-2.vala.c' -pthread -I/...
Compilation succeeded - 2 warning(s)</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala<span style="color: #990000">:</span><span style="color: #993399">7.5</span><span style="color: #990000">-</span><span style="color: #993399">7.41</span><span style="color: #990000">:</span> warning<span style="color: #990000">:</span> method `HelloWorld<span style="color: #990000">.</span>on_button1_clicked<span style="color: #FF0000">' never used</span>
<span style="color: #FF0000">    public static void on_button1_clicked (Button button) {</span>
<span style="color: #FF0000">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #FF0000">gui-2.vala:12.5-12.41: warning: method `HelloWorld.on_window1_destroy'</span> <span style="color: #008080">never</span> used<span style="color: #990000">...</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #990000">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #008080">Compilation</span> succeeded <span style="color: #990000">-</span> <span style="color: #993399">2</span> <span style="font-weight: bold"><span style="color: #000000">warning</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span>
$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
<span style="color: #993399">38</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>vala
<span style="color: #993399">215</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-2.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-2.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> H
elloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELLO_W
ORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD
<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELL
O_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> HelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> HelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> HelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    HelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> hello_world_i<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> hello_world_i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp2_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>button <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> hello_world_i<span style="color: #990000">;</span>
    hello_world_i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> button<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> hello_world_i<span style="color: #990000">;</span>
    _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp4_ <span style="color: #990000">=</span> _tmp3_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> _tmp4_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self <span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    hello_world_i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">{</span>
        GtkBuilder<span style="color: #990000">*</span> builder <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GObject<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
        builder <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_error<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        _tmp2_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">);</span>
        _tmp4_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> gtk_window_
<span style="font-weight: bold"><span style="color: #000000">get_type</span></span> <span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> _tmp3_<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">);</span>
        window <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_connect_signals</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> window<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> _tmp7_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> stderr<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> _tmp9_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp8_<span style="color: #990000">,</span> <span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp10_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span>TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_class_init</span></span> <span style="color: #990000">(</span>HelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> hello_world_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_instance_init</span></span> <span style="color: #990000">(</span>HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>hello_world_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldClass<span style="color: #990000">),</span>
<span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> hello_world_cla
ss_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInit
Func<span style="color: #990000">)</span> hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> hello_world_type_id<span style="color: #990000">;</span>
        hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"HelloWorld</span>
<span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">,</span> hello_world_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> h <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">();</span>
    h <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">,</span> _tmp1_<span style="color: #990000">,</span> _tmp1__length1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_outside_of_class_callback_as_instance">OOP style (main outside of class, callback as instance)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-3.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>instance_pos <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span><span style="color: #008080">Button</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>instance_pos <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">var</span> builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Builder</span></span> <span style="color: #990000">();</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">);</span>
            <span style="color: #009900">var</span> window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> Window<span style="color: #990000">;</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Error</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stderr<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
    <span style="color: #009900">var</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
    h<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>args<span style="color: #990000">);</span>
    Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Since class is isused, "<code>clickme-ext.glade</code>" is used here.</p></div>
<div class="paragraph"><p>Although you see compiler warnings like "<code>warning: method ... never used</code>", do
not worry.  They are used via Gtk.Builder callback mechanism.</p></div>
<div class="paragraph"><p>Please make sure to use "<code>[CCode (instance_pos = -1)]</code>" when using instance
methods instead of static methods as callback handlers for the Gtk.Builder&#8217;s
signal auto-connection mechanism.</p></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-3.vala</code> to create the ELF object <code>gui-3</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>gui-3.vala:8.5-8.34: warning: method `HelloWorld.on_button1_clicked' never used
    public void on_button1_clicked (Button button) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gui-3.vala:14.5-14.34: warning: method `HelloWorld.on_window1_destroy' never used...
    public void on_window1_destroy (Window window) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gmodule-2.0.vapi'
cc -o '/path/to/vala-glade/gui-3' '/path/to/vala-glade/gui-3.vala.c' -pthread -I/...
Compilation succeeded - 2 warning(s)</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala<span style="color: #990000">:</span><span style="color: #993399">8.5</span><span style="color: #990000">-</span><span style="color: #993399">8.34</span><span style="color: #990000">:</span> warning<span style="color: #990000">:</span> method `HelloWorld<span style="color: #990000">.</span>on_button1_clicked<span style="color: #FF0000">' never used</span>
<span style="color: #FF0000">    public void on_button1_clicked (Button button) {</span>
<span style="color: #FF0000">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #FF0000">gui-3.vala:14.5-14.34: warning: method `HelloWorld.on_window1_destroy'</span> <span style="color: #008080">never</span> used<span style="color: #990000">...</span>
    public <span style="color: #008080">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #990000">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #008080">Compilation</span> succeeded <span style="color: #990000">-</span> <span style="color: #993399">2</span> <span style="font-weight: bold"><span style="color: #000000">warning</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span>
$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
<span style="color: #993399">40</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>vala
<span style="color: #993399">222</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-3.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-3.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> H
elloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELLO_W
ORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD
<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELL
O_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> HelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> HelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> HelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    HelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_PRIVATE</span></span><span style="color: #990000">(</span>o<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_PRIVATE</span></span> <span style="color: #990000">((</span>o<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldPrivate<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp2_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>button <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> button<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp4_ <span style="color: #990000">=</span> _tmp3_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> _tmp4_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self <span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">{</span>
        GtkBuilder<span style="color: #990000">*</span> builder <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GObject<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
        builder <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_error<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        _tmp2_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">);</span>
        _tmp4_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> gtk_window_
<span style="font-weight: bold"><span style="color: #000000">get_type</span></span> <span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> _tmp3_<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">);</span>
        window <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_connect_signals</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> window<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> _tmp7_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> stderr<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> _tmp9_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp8_<span style="color: #990000">,</span> <span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp10_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span>TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_class_init</span></span> <span style="color: #990000">(</span>HelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_class_add_private</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldPrivate<span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> hello_world_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_instance_init</span></span> <span style="color: #990000">(</span>HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    self<span style="color: #990000">-&gt;</span>priv <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_PRIVATE</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>hello_world_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldClass<span style="color: #990000">),</span>
<span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> hello_world_cla
ss_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInit
Func<span style="color: #990000">)</span> hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> hello_world_type_id<span style="color: #990000">;</span>
        hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"HelloWorld</span>
<span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">,</span> hello_world_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> h <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">();</span>
    h <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">,</span> _tmp1_<span style="color: #990000">,</span> _tmp1__length1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">_vala_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_inside_of_class_callback_as_static">OOP style (main inside of class, callback as static)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-4.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span><span style="color: #008080">Button</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">var</span> builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Builder</span></span> <span style="color: #990000">();</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">);</span>
            <span style="color: #009900">var</span> window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> Window<span style="color: #990000">;</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Error</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stderr<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
        <span style="color: #009900">var</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
        h<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>args<span style="color: #990000">);</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Since class is isused, "<code>clickme-ext.glade</code>" is used here.</p></div>
<div class="paragraph"><p>Although you see compiler warnings like "<code>warning: method ... never used</code>", do
not worry.  They are used via Gtk.Builder callback mechanism.</p></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-4.vala</code> to create the ELF object <code>gui-4</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>gui-4.vala:7.5-7.41: warning: method `HelloWorld.on_button1_clicked' never used
    public static void on_button1_clicked (Button button) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gui-4.vala:12.5-12.41: warning: method `HelloWorld.on_window1_destroy' never used...
    public static void on_window1_destroy (Window window) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gmodule-2.0.vapi'
cc -o '/path/to/vala-glade/gui-4' '/path/to/vala-glade/gui-4.vala.c' -pthread -I/...
Compilation succeeded - 2 warning(s)</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>vala<span style="color: #990000">:</span><span style="color: #993399">7.5</span><span style="color: #990000">-</span><span style="color: #993399">7.41</span><span style="color: #990000">:</span> warning<span style="color: #990000">:</span> method `HelloWorld<span style="color: #990000">.</span>on_button1_clicked<span style="color: #FF0000">' never used</span>
<span style="color: #FF0000">    public static void on_button1_clicked (Button button) {</span>
<span style="color: #FF0000">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #FF0000">gui-4.vala:12.5-12.41: warning: method `HelloWorld.on_window1_destroy'</span> <span style="color: #008080">never</span> used<span style="color: #990000">...</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #990000">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #008080">Compilation</span> succeeded <span style="color: #990000">-</span> <span style="color: #993399">2</span> <span style="font-weight: bold"><span style="color: #000000">warning</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span>
$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>c
<span style="color: #993399">38</span> gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>vala
<span style="color: #993399">215</span> gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">4</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-4.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-4.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> H
elloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELLO_W
ORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD
<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELL
O_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> HelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> HelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> HelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    HelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> hello_world_i<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> hello_world_i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp2_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>button <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> hello_world_i<span style="color: #990000">;</span>
    hello_world_i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> button<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> hello_world_i<span style="color: #990000">;</span>
    _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp4_ <span style="color: #990000">=</span> _tmp3_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> _tmp4_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self <span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    hello_world_i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">{</span>
        GtkBuilder<span style="color: #990000">*</span> builder <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GObject<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
        builder <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_error<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        _tmp2_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">);</span>
        _tmp4_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> gtk_window_
<span style="font-weight: bold"><span style="color: #000000">get_type</span></span> <span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> _tmp3_<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">);</span>
        window <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_connect_signals</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> window<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> _tmp7_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> stderr<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> _tmp9_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp8_<span style="color: #990000">,</span> <span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp10_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> h <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">();</span>
    h <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">,</span> _tmp1_<span style="color: #990000">,</span> _tmp1__length1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span>TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_class_init</span></span> <span style="color: #990000">(</span>HelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> hello_world_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_instance_init</span></span> <span style="color: #990000">(</span>HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>hello_world_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldClass<span style="color: #990000">),</span>
<span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> hello_world_cla
ss_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInit
Func<span style="color: #990000">)</span> hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> hello_world_type_id<span style="color: #990000">;</span>
        hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"HelloWorld</span>
<span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">,</span> hello_world_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_oop_style_main_inside_of_class_callback_as_instance">OOP style (main inside of class, callback as instance)</h4>
<div class="listingblock">
<div class="title">Source code <code>gui-5.vala</code> in Vala language</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">using</span></span> Gtk<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">HelloWorld</span> <span style="color: #990000">:</span> Object <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>

    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>instance_pos <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_button1_clicked</span></span> <span style="color: #990000">(</span><span style="color: #008080">Button</span> button<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">+=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        button<span style="color: #990000">.</span>label <span style="color: #990000">=</span> <span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    <span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">CCode</span></span> <span style="color: #990000">(</span>instance_pos <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">)]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main_quit</span></span> <span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
            <span style="color: #009900">var</span> builder <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Builder</span></span> <span style="color: #990000">();</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">add_from_file</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">);</span>
            <span style="color: #009900">var</span> window <span style="color: #990000">=</span> builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_object</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"window1"</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> Window<span style="color: #990000">;</span>
            builder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect_signals</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            window<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">show_all</span></span> <span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Error</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
            stderr<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> e<span style="color: #990000">.</span>message<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">string</span><span style="color: #990000">[]</span> args<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">init</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">ref</span></span> args<span style="color: #990000">);</span>
        <span style="color: #009900">var</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">HelloWorld</span></span><span style="color: #990000">();</span>
        h<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">(</span>args<span style="color: #990000">);</span>
        Gtk<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Since class is isused, "<code>clickme-ext.glade</code>" is used here.</p></div>
<div class="paragraph"><p>Although you see compiler warnings like "<code>warning: method ... never used</code>", do
not worry.  They are used via Gtk.Builder callback mechanism.</p></div>
<div class="paragraph"><p>Please make sure to use "<code>[CCode (instance_pos = -1)]</code>" when using instance
methods instead of static methods as callback handlers for the Gtk.Builder&#8217;s
signal auto-connection mechanism.</p></div>
<div class="paragraph"><p>Let&#8217;s compile <code>gui-5.vala</code> to create the ELF object <code>gui-5</code> and run it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>gui-5.vala:8.5-8.34: warning: method `HelloWorld.on_button1_clicked' never used
    public void on_button1_clicked (Button button) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
gui-5.vala:14.5-14.34: warning: method `HelloWorld.on_window1_destroy' never used...
    public void on_window1_destroy (Window window) {
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Loaded package `/usr/share/vala-0.26/vapi/glib-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gobject-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gtk+-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gio-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/atk.vapi'
Loaded package `/usr/share/vala-0.26/vapi/cairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-pixbuf-2.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gdk-3.0.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pango.vapi'
Loaded package `/usr/share/vala-0.26/vapi/pangocairo.vapi'
Loaded package `/usr/share/vala-0.26/vapi/x11.vapi'
Loaded package `/usr/share/vala-0.26/vapi/gmodule-2.0.vapi'
cc -o '/path/to/vala-glade/gui-5' '/path/to/vala-glade/gui-5.vala.c' -pthread -I/...
Compilation succeeded - 2 warning(s)</code></pre>
</div></div>
<div class="paragraph"><p>You can get the C source as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>vala<span style="color: #990000">:</span><span style="color: #993399">8.5</span><span style="color: #990000">-</span><span style="color: #993399">8.34</span><span style="color: #990000">:</span> warning<span style="color: #990000">:</span> method `HelloWorld<span style="color: #990000">.</span>on_button1_clicked<span style="color: #FF0000">' never used</span>
<span style="color: #FF0000">    public void on_button1_clicked (Button button) {</span>
<span style="color: #FF0000">    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #FF0000">gui-5.vala:14.5-14.34: warning: method `HelloWorld.on_window1_destroy'</span> <span style="color: #008080">never</span> used<span style="color: #990000">...</span>
    public <span style="color: #008080">void</span> <span style="font-weight: bold"><span style="color: #000000">on_window1_destroy</span></span> <span style="color: #990000">(</span><span style="color: #008080">Window</span> window<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #990000">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span style="color: #008080">Compilation</span> succeeded <span style="color: #990000">-</span> <span style="color: #993399">2</span> <span style="font-weight: bold"><span style="color: #000000">warning</span></span><span style="color: #990000">(</span>s<span style="color: #990000">)</span>
$ wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>vala <span style="color: #990000">;</span> wc <span style="color: #990000">-</span><span style="color: #008080">l</span> gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>c
<span style="color: #993399">40</span> gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>vala
<span style="color: #993399">222</span> gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>c
$ <span style="color: #008080">cat</span> gui<span style="color: #990000">-</span><span style="color: #993399">5</span><span style="color: #990000">.</span>c <span style="color: #990000">|</span>sed <span style="color: #990000">-</span>e <span style="color: #FF0000">'s/       /    /g'</span><span style="color: #990000">|</span>fold
<span style="font-style: italic"><span style="color: #9A1900">/* gui-5.c generated by valac 0.26.1, the Vala compiler</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * generated from gui-5.vala, do not modify */</span></span>


<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;glib-object.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;gtk/gtk.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>


<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">TYPE_HELLO_WORLD</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">())</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> H
elloWorld<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_CAST</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELLO_W
ORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO_WORLD
<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">IS_HELLO_WORLD_CLASS</span></span><span style="color: #990000">(</span>klass<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_CLASS_TYPE</span></span> <span style="color: #990000">((</span>klass<span style="color: #990000">),</span> TYPE_HELL
O_WORLD<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_CLASS</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_CLASS</span></span> <span style="color: #990000">((</span>obj<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldClass<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> HelloWorld<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> HelloWorldClass<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> HelloWorldPrivate<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span> NULL<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_object_unref</span></span> <span style="color: #990000">(</span>va
r<span style="color: #990000">),</span> NULL<span style="color: #990000">)))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span><span style="color: #990000">(</span>var<span style="color: #990000">)</span> <span style="color: #990000">((</span>var <span style="color: #990000">==</span> NULL<span style="color: #990000">)</span> <span style="color: #990000">?</span> NULL <span style="color: #990000">:</span> <span style="color: #990000">(</span>var <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_error_free</span></span> <span style="color: #990000">(</span>var<span style="color: #990000">),</span>
NULL<span style="color: #990000">)))</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorld</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObject</span> parent_instance<span style="color: #990000">;</span>
    HelloWorldPrivate <span style="color: #990000">*</span> priv<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldClass</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">GObjectClass</span> parent_class<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">_HelloWorldPrivate</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> i<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> hello_world_parent_class <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>

<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> G_GNUC_CONST<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_PRIVATE</span></span><span style="color: #990000">(</span>o<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_INSTANCE_GET_PRIVATE</span></span> <span style="color: #990000">((</span>o<span style="color: #990000">),</span> TYPE_HELLO
_WORLD<span style="color: #990000">,</span> HelloWorldPrivate<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span>  <span style="color: #FF0000">{</span>
    HELLO_WORLD_DUMMY_PROPERTY
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">);</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_button1_clicked</span></span> <span style="color: #990000">(</span>GtkButton<span style="color: #990000">*</span> button<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> _tmp0_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GtkButton<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp2_ <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>button <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> _tmp0_ <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> button<span style="color: #990000">;</span>
    _tmp2_ <span style="color: #990000">=</span> self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i<span style="color: #990000">;</span>
    _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_strdup_printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"Hello, World!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Click count = %i"</span><span style="color: #990000">,</span> _tmp2_<span style="color: #990000">);</span>
    _tmp4_ <span style="color: #990000">=</span> _tmp3_<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_button_set_label</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> _tmp4_<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_free0</span></span> <span style="color: #990000">(</span>_tmp4_<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_on_window1_destroy</span></span> <span style="color: #990000">(</span>GtkWindow<span style="color: #990000">*</span> window<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_if_fail</span></span> <span style="color: #990000">(</span>window <span style="color: #990000">!=</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main_quit</span></span> <span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gpointer</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="color: #008080">gpointer</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self <span style="color: #990000">?</span> <span style="font-weight: bold"><span style="color: #000000">g_object_ref</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*</span> self<span style="color: #990000">,</span> gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    GError <span style="color: #990000">*</span> _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">g_return_val_if_fail</span></span> <span style="color: #990000">(</span>self <span style="color: #990000">!=</span> NULL<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
    self<span style="color: #990000">-&gt;</span>priv<span style="color: #990000">-&gt;</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">{</span>
        GtkBuilder<span style="color: #990000">*</span> builder <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> window <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp2_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GObject<span style="color: #990000">*</span> _tmp3_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp4_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp5_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkBuilder<span style="color: #990000">*</span> _tmp6_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GtkWindow<span style="color: #990000">*</span> _tmp7_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_new</span></span> <span style="color: #990000">();</span>
        builder <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
        _tmp1_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_add_from_file</span></span> <span style="color: #990000">(</span>_tmp1_<span style="color: #990000">,</span> <span style="color: #FF0000">"clickme-ext.glade"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
            <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
            <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __catch0_g_error<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        _tmp2_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp3_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">gtk_builder_get_object</span></span> <span style="color: #990000">(</span>_tmp2_<span style="color: #990000">,</span> <span style="color: #FF0000">"window1"</span><span style="color: #990000">);</span>
        _tmp4_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">_g_object_ref0</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_TYPE</span></span> <span style="color: #990000">(</span>_tmp3_<span style="color: #990000">,</span> gtk_window_
<span style="font-weight: bold"><span style="color: #000000">get_type</span></span> <span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #990000">((</span>GtkWindow<span style="color: #990000">*)</span> _tmp3_<span style="color: #990000">)</span> <span style="color: #990000">:</span> NULL<span style="color: #990000">);</span>
        window <span style="color: #990000">=</span> _tmp4_<span style="color: #990000">;</span>
        _tmp5_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        _tmp6_ <span style="color: #990000">=</span> builder<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_builder_connect_signals</span></span> <span style="color: #990000">(</span>_tmp5_<span style="color: #990000">,</span> _tmp6_<span style="color: #990000">);</span>
        _tmp7_ <span style="color: #990000">=</span> window<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">gtk_widget_show_all</span></span> <span style="color: #990000">((</span>GtkWidget<span style="color: #990000">*)</span> _tmp7_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>window<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>builder<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">goto</span></span> __finally0<span style="color: #990000">;</span>
    __catch0_g_error<span style="color: #990000">:</span>
    <span style="color: #FF0000">{</span>
        GError<span style="color: #990000">*</span> e <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        FILE<span style="color: #990000">*</span> _tmp8_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        GError<span style="color: #990000">*</span> _tmp9_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> gchar<span style="color: #990000">*</span> _tmp10_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        e <span style="color: #990000">=</span> _inner_error_<span style="color: #990000">;</span>
        _inner_error_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
        _tmp8_ <span style="color: #990000">=</span> stderr<span style="color: #990000">;</span>
        _tmp9_ <span style="color: #990000">=</span> e<span style="color: #990000">;</span>
        _tmp10_ <span style="color: #990000">=</span> _tmp9_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span> <span style="color: #990000">(</span>_tmp8_<span style="color: #990000">,</span> <span style="color: #FF0000">"Could not load UI: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> _tmp10_<span style="color: #990000">);</span>
        result <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #000000">_g_error_free0</span></span> <span style="color: #990000">(</span>e<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    __finally0<span style="color: #990000">:</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">G_UNLIKELY</span></span> <span style="color: #990000">(</span>_inner_error_ <span style="color: #990000">!=</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">g_critical</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"file %s: line %d: uncaught error: %s (%s, %d)"</span><span style="color: #990000">,</span> __FILE__<span style="color: #990000">,</span> _
_LINE__<span style="color: #990000">,</span> _inner_error_<span style="color: #990000">-&gt;</span>message<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">g_quark_to_string</span></span> <span style="color: #990000">(</span>_inner_error_<span style="color: #990000">-&gt;</span>domain<span style="color: #990000">),</span> _inn
er_error_<span style="color: #990000">-&gt;</span>code<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_clear_error</span></span> <span style="color: #990000">(&amp;</span>_inner_error_<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">gint</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>gchar<span style="color: #990000">**</span> args<span style="color: #990000">,</span> <span style="color: #009900">int</span> args_length1<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">gint</span> result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> h <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    HelloWorld<span style="color: #990000">*</span> _tmp0_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    gchar<span style="color: #990000">**</span> _tmp1_ <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    <span style="color: #008080">gint</span> _tmp1__length1 <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_init</span></span> <span style="color: #990000">(&amp;</span>args_length1<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>args<span style="color: #990000">);</span>
    _tmp0_ <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">();</span>
    h <span style="color: #990000">=</span> _tmp0_<span style="color: #990000">;</span>
    _tmp1_ <span style="color: #990000">=</span> args<span style="color: #990000">;</span>
    _tmp1__length1 <span style="color: #990000">=</span> args_length1<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">hello_world_run</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">,</span> _tmp1_<span style="color: #990000">,</span> _tmp1__length1<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">gtk_main</span></span> <span style="color: #990000">();</span>
    result <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #000000">_g_object_unref0</span></span> <span style="color: #990000">(</span>h<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> result<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span> argv<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#if</span></span> <span style="color: #990000">!</span><span style="font-weight: bold"><span style="color: #000000">GLIB_CHECK_VERSION</span></span> <span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">35</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_init</span></span> <span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_main</span></span> <span style="color: #990000">(</span>argv<span style="color: #990000">,</span> argc<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span><span style="color: #008080">GType</span> object_type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self <span style="color: #990000">=</span> NULL<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">*)</span> <span style="font-weight: bold"><span style="color: #000000">g_object_new</span></span> <span style="color: #990000">(</span>object_type<span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


HelloWorld<span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_new</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_world_construct</span></span> <span style="color: #990000">(</span>TYPE_HELLO_WORLD<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_class_init</span></span> <span style="color: #990000">(</span>HelloWorldClass <span style="color: #990000">*</span> klass<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    hello_world_parent_class <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_class_peek_parent</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">g_type_class_add_private</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldPrivate<span style="color: #990000">));</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>klass<span style="color: #990000">)-&gt;</span>finalize <span style="color: #990000">=</span> hello_world_finalize<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_instance_init</span></span> <span style="color: #990000">(</span>HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    self<span style="color: #990000">-&gt;</span>priv <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">HELLO_WORLD_GET_PRIVATE</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_finalize</span></span> <span style="color: #990000">(</span>GObject<span style="color: #990000">*</span> obj<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    HelloWorld <span style="color: #990000">*</span> self<span style="color: #990000">;</span>
    self <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">G_TYPE_CHECK_INSTANCE_CAST</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">,</span> TYPE_HELLO_WORLD<span style="color: #990000">,</span> HelloWorld<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">G_OBJECT_CLASS</span></span> <span style="color: #990000">(</span>hello_world_parent_class<span style="color: #990000">)-&gt;</span><span style="font-weight: bold"><span style="color: #000000">finalize</span></span> <span style="color: #990000">(</span>obj<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>


<span style="color: #008080">GType</span> <span style="font-weight: bold"><span style="color: #000000">hello_world_get_type</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">volatile</span></span> <span style="color: #008080">gsize</span> hello_world_type_id__volatile <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">g_once_init_enter</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">GTypeInfo</span> g_define_type_info <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorldClass<span style="color: #990000">),</span>
<span style="color: #990000">(</span>GBaseInitFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GBaseFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassInitFunc<span style="color: #990000">)</span> hello_world_cla
ss_init<span style="color: #990000">,</span> <span style="color: #990000">(</span>GClassFinalizeFunc<span style="color: #990000">)</span> NULL<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span> <span style="color: #990000">(</span>HelloWorld<span style="color: #990000">),</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #990000">(</span>GInstanceInit
Func<span style="color: #990000">)</span> hello_world_instance_init<span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">GType</span> hello_world_type_id<span style="color: #990000">;</span>
        hello_world_type_id <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">g_type_register_static</span></span> <span style="color: #990000">(</span>G_TYPE_OBJECT<span style="color: #990000">,</span> <span style="color: #FF0000">"HelloWorld</span>
<span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>g_define_type_info<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">g_once_init_leave</span></span> <span style="color: #990000">(&amp;</span>hello_world_type_id__volatile<span style="color: #990000">,</span> hello_world_type_id<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> hello_world_type_id__volatile<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>


</tt></pre></div></div>
<div class="paragraph"><p>It is obvious that the Vala code is much shorter than the generated C code.
The Vala compiler took care chores of generating CPP macros for GObject
with.</p></div>
<div class="ulist"><ul>
<li>
<p>
No prefix.
</p>
</li>
<li>
<p>
<code>gui</code>, <code>GUI</code>, <code>Gui</code>: object type (= class) name
</p>
</li>
<li>
<p>
<code>gui_get_type()</code>: returning GType of object GUI
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sqlite">SQLite</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/Sqlite">SQLite</a> is a lightweight relational
database management system suitable for embedding into the application program
by linking the SQLite library. Structured Query Language
(<a href="http://en.wikipedia.org/wiki/SQL">SQL</a>) can be used to manage the content of
the database.</p></div>
<div class="sect2">
<h3 id="_sql_basics">SQL basics</h3>
<div class="paragraph"><p>You can interactively input SQL commands to the command line after starting
<code>sqlite3</code> as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ sqlite3 test.db
SQLite version 3.7.14 2012-09-03 15:42:36
Enter ".help" for instructions
Enter SQL statements terminated with a ";"
sqlite&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Read references:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.sqlite.org/">SQLite (upstream)</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikibooks.org/wiki/SQL_Exercises">SQL Exercises (Wikibooks)</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikibooks.org/wiki/SQL_Dialects_Reference">SQL Dialects Reference (Wikibooks)</a>
</p>
</li>
<li>
<p>
<a href="http://souptonuts.sourceforge.net/readme_sqlite_tutorial.html">SQLite Tutorial (Mike Chirico, 2007)</a>
</p>
</li>
<li>
<p>
<a href="http://zetcode.com/databases/sqlitetutorial/">SQLite tutorial (Jan Bodnar, 2009)</a>
</p>
</li>
<li>
<p>
<a href="http://zetcode.com/db/sqlitepythontutorial/">SQLite Python tutorial (Jan Bodnar, 2011)</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Alternatively, the GUI tool <code>sqlitebrowser</code> may be used, too.</p></div>
</div>
<div class="sect2">
<h3 id="_phonebook">Phonebook</h3>
<div class="paragraph"><p>Let&#8217;s make a batch file of SQL commands to create a phonebook database.</p></div>
<div class="listingblock">
<div class="title">SQL batch file <code>sql-1.sql</code>:</div>
<div class="content">
<pre><code>.explain ON
.header ON
-- Generate a SQL data table: phone
create table phone(
        name string NOT NULL,
        phone string NOT NULL);
insert into phone values('Napoleon Bonaparte', '+33-(0)1.01.01.01.01');
insert into phone values('George Washington', '+1-800-START-USA');
insert into phone values('John Adams', '+1-800-LOVE-BEER');
insert into phone values('Thomas Jefferson', '+1-800-4-FREEDOM');
-- SQLite parameter set and data dump
.width 8 20 20
.show
.schema
.dump phone
-- Select all phone table contents and display
select rowid,* from phone;</code></pre>
</div></div>
<div class="paragraph"><p>Here, "<code>NOT NULL</code>" is specified to avoid empty data.</p></div>
<div class="paragraph"><p>Let&#8217;s create a SQL database file <code>private.db</code> containing a phonebook data as
a <code>phone</code> table using <code>sqlite3</code>.  For readability, I added "<code>-echo</code>" to echo
SQL command to the console.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat sql-1.sql | sqlite3 -echo private.db
.explain ON
.header ON
-- Generate a SQL data table: phone
create table phone(
    name string NOT NULL,
    phone string NOT NULL);
insert into phone values('Napoleon Bonaparte', '+33-(0)1.01.01.01.01');
insert into phone values('George Washington', '+1-800-START-USA');
insert into phone values('John Adams', '+1-800-LOVE-BEER');
insert into phone values('Thomas Jefferson', '+1-800-4-FREEDOM');
-- SQLite parameter set and data dump
.width 8 20 20
.show
     echo: on
      eqp: off
  explain: on
  headers: on
     mode: explain
nullvalue: ""
   output: stdout
separator: "|" "\r\n"
    stats: off
    width: 8 20 20 4 4 13 2 13
.schema
CREATE TABLE phone(
    name string NOT NULL,
    phone string NOT NULL);
.dump phone
PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE phone(
    name string NOT NULL,
    phone string NOT NULL);
INSERT INTO "phone" VALUES('Napoleon Bonaparte','+33-(0)1.01.01.01.01');
INSERT INTO "phone" VALUES('George Washington','+1-800-START-USA');
INSERT INTO "phone" VALUES('John Adams','+1-800-LOVE-BEER');
INSERT INTO "phone" VALUES('Thomas Jefferson','+1-800-4-FREEDOM');
COMMIT;
-- Select all phone table contents and display
select rowid,* from phone;
rowid     name                  phone
--------  --------------------  --------------------
1         Napoleon Bonaparte    +33-(0)1.01.01.01.01
2         George Washington     +1-800-START-USA
3         John Adams            +1-800-LOVE-BEER
4         Thomas Jefferson      +1-800-4-FREEDOM

$ ls -l private.db
-rw-r--r-- 1 osamu osamu 2048 Aug 20 23:24 private.db</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s add, update, delete data in this <code>phone</code> table be creating a batch file
<code>sql-2.sql</code> and executing <code>sqlite3</code> with it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>.explain ON
.header ON
-- Add/remove entries in a SQL data table
insert into phone values('Tokugawa Ieyasu', '+81-(0)1-SHOUGUN1');
update phone set phone = '+1-800-BEER-BEER' where name = 'John Adams';
delete from phone where name like 'George%';
-- Select all phone table contents and display
.width 8 20 20
select rowid,* from phone;

$ cat sql-2.sql | sqlite3 -echo private.db
.explain ON
.header ON
-- Add/remove entries in a SQL data table
insert into phone values('Tokugawa Ieyasu', '+81-(0)1-SHOUGUN1');
update phone set phone = '+1-800-BEER-BEER' where name = 'John Adams';
delete from phone where name like 'George%';
-- Select all phone table contents and display
.width 8 20 20
select rowid,* from phone;
rowid     name                  phone
--------  --------------------  --------------------
1         Napoleon Bonaparte    +33-(0)1.01.01.01.01
3         John Adams            +1-800-BEER-BEER
4         Thomas Jefferson      +1-800-4-FREEDOM
5         Tokugawa Ieyasu       +81-(0)1-SHOUGUN1</code></pre>
</div></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 14. SQL wildcard chracters used for <code>LIKE</code> matching</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Wildcard</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>%</code></p></td>
<td align="left" valign="top"><p class="table">A substitute for zero or more characters</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>_</code></p></td>
<td align="left" valign="top"><p class="table">A substitute for exactly one character</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sql_python">SQL + Python</h3>
<div class="paragraph"><p>You can manupilate SQL database via Python using the pysqlite binding.  For example:</p></div>
<div class="listingblock">
<div class="title">Python code example to add "Abraham Lincoln" to the phonebook.</div>
<div class="content">
<pre><code>#!/usr/bin/python3
# -*- coding: utf-8 -*-
import sqlite3 as lite
import sys

con = lite.connect('private.db')
with con:
    c = con.cursor()
    c.execute("""insert into phone values(
        'Abraham Lincoln', '+1-800-FREEDOM-1');""")
    c.execute("""select rowid,* from phone""")
    for row in c.fetchall():
        print ("%s : Name = %s, Phone =  %s" % (row[0], row[1], row[2]))
con.commit()
con.close()</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s execute it.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>1 : Name = Napoleon Bonaparte, Phone =  +33-(0)1.01.01.01.01
3 : Name = John Adams, Phone =  +1-800-BEER-BEER
4 : Name = Thomas Jefferson, Phone =  +1-800-4-FREEDOM
5 : Name = Tokugawa Ieyasu, Phone =  +81-(0)1-SHOUGUN1
6 : Name = Abraham Lincoln, Phone =  +1-800-FREEDOM-1</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_null_data">NULL data</h3>
<div class="paragraph"><p>SQL command behavior for NULL data is complicated.  See how SQLite behaves:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>.explain ON
.header ON
-- Generate a SQL test data table: t1
create table t1(a int, b int, c int);
insert into t1 values(1,0,0);
insert into t1 values(2,0,1);
insert into t1 values(3,1,0);
insert into t1 values(4,1,1);
insert into t1 values(5,null,0);
insert into t1 values(6,null,1);
insert into t1 values(7,null,null);
insert into t1 values(null,null,null);
insert into t1 values(null,null,null);
.schema
CREATE TABLE phone(
    name string NOT NULL,
    phone string NOT NULL);
CREATE TABLE t1(a int, b int, c int);
-- Select all t1 table contents and display
.width 8 8 8 40
select rowid,* from t1;
rowid     a         b         c
--------  --------  --------  ----------------------------------------
1         1         0         0
2         2         0         1
3         3         1         0
4         4         1         1
5         5                   0
6         6                   1
7         7
8
9
-- Test SQL case behavior with null
.width 4 8 60
select rowid,a, case when b&lt;&gt;0 then 1 else 0 end from t1;
rowi  a         case when b&lt;&gt;0 then 1 else 0 end
----  --------  ------------------------------------------------------------
1     1         0
2     2         0
3     3         1
4     4         1
5     5         0
6     6         0
7     7         0
8               0
9               0
select rowid,a+10, case when not b&lt;&gt;0 then 1 else 0 end from t1;
rowi  a+10      case when not b&lt;&gt;0 then 1 else 0 end
----  --------  ------------------------------------------------------------
1     11        1
2     12        1
3     13        0
4     14        0
5     15        0
6     16        0
7     17        0
8               0
9               0
select rowid,a+20, case when b&lt;&gt;0 and c&lt;&gt;0 then 1 else 0 end from t1;
rowi  a+20      case when b&lt;&gt;0 and c&lt;&gt;0 then 1 else 0 end
----  --------  ------------------------------------------------------------
1     21        0
2     22        0
3     23        0
4     24        1
5     25        0
6     26        0
7     27        0
8               0
9               0
select rowid,a+30, case when not (b&lt;&gt;0 and c&lt;&gt;0) then 1 else 0 end from t1;
rowi  a+30      case when not (b&lt;&gt;0 and c&lt;&gt;0) then 1 else 0 end
----  --------  ------------------------------------------------------------
1     31        1
2     32        1
3     33        1
4     34        0
5     35        1
6     36        0
7     37        0
8               0
9               0
select rowid,a+40, case when b&lt;&gt;0 or c&lt;&gt;0 then 1 else 0 end from t1;
rowi  a+40      case when b&lt;&gt;0 or c&lt;&gt;0 then 1 else 0 end
----  --------  ------------------------------------------------------------
1     41        0
2     42        1
3     43        1
4     44        1
5     45        0
6     46        1
7     47        0
8               0
9               0
select rowid,a+50, case when not (b&lt;&gt;0 or c&lt;&gt;0) then 1 else 0 end from t1;
rowi  a+50      case when not (b&lt;&gt;0 or c&lt;&gt;0) then 1 else 0 end
----  --------  ------------------------------------------------------------
1     51        1
2     52        0
3     53        0
4     54        0
5     55        0
6     56        0
7     57        0
8               0
9               0
select rowid,a+60, case b when c then 1 else 0 end from t1;
rowi  a+60      case b when c then 1 else 0 end
----  --------  ------------------------------------------------------------
1     61        1
2     62        0
3     63        0
4     64        1
5     65        0
6     66        0
7     67        0
8               0
9               0
select rowid,a+70, case c when b then 1 else 0 end from t1;
rowi  a+70      case c when b then 1 else 0 end
----  --------  ------------------------------------------------------------
1     71        1
2     72        0
3     73        0
4     74        1
5     75        0
6     76        0
7     77        0
8               0
9               0
-- What happens when you multiple a NULL by zero?
select rowid,a+80, b*0 from t1;
rowi  a+80      b*0
----  --------  ------------------------------------------------------------
1     81        0
2     82        0
3     83        0
4     84        0
5     85
6     86
7     87
8
9
select rowid,a+90, b*c from t1;
rowi  a+90      b*c
----  --------  ------------------------------------------------------------
1     91        0
2     92        0
3     93        0
4     94        1
5     95
6     96
7     97
8
9
-- What happens to NULL for other operators?
select rowid,a+100, b+c from t1;
rowi  a+100     b+c
----  --------  ------------------------------------------------------------
1     101       0
2     102       1
3     103       1
4     104       2
5     105
6     106
7     107
8
9
-- Check the behavior of NULLs in WHERE clauses
select rowid,a+110 from t1 where b&lt;10;
rowi  a+110
----  --------
1     111
2     112
3     113
4     114
select rowid,+120 from t1 where not b&gt;10;
rowi  +120
----  --------
1     120
2     120
3     120
4     120
select rowid,a+130 from t1 where b&lt;10 OR c=1;
rowi  a+130
----  --------
1     131
2     132
3     133
4     134
6     136
select rowid,a+140 from t1 where b&lt;10 AND c=1;
rowi  a+140
----  --------
2     142
4     144
select rowid,a+150 from t1 where not (b&lt;10 AND c=1);
rowi  a+150
----  --------
1     151
3     153
5     155
select rowid,a+160 from t1 where not (c=1 AND b&lt;10);
rowi  a+160
----  --------
1     161
3     163
5     165
-- Select null data
select rowid,a+170 from t1 where a isnull;
rowi  a+170
----  --------
8
9
select rowid,a+180 from t1 where b isnull;
rowi  a+180
----  --------
5     185
6     186
7     187
8
9
select rowid,a+190 from t1 where c isnull;
rowi  a+190
----  --------
7     197
8
9
-- Test the treatment of aggregate operators
.width 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
select count(*), count(b), sum(b), avg(b), min(b), max(b) from t1;
count(*)  count(b)  sum(b)    avg(b)    min(b)    max(b)
--------  --------  --------  --------  --------  --------
9         4         2         0.5       0         1
-- Check the behavior of NULLs in a DISTINCT query
select distinct b from t1;
b
--------
0
1

-- Check the behavior of NULLs in a UNION query
select b from t1 union select b from t1;
b
--------

0
1
-- NULLs are not considered to be distinct.
create table t2(a int, b int unique);
insert into t2 values(1,1);
insert into t2 values(2,null);
insert into t2 values(3,null);
Error: near line 56: UNIQUE constraint failed: t2.b
insert into t2 values(4,1);
.schema
CREATE TABLE phone(
    name string NOT NULL,
    phone string NOT NULL);
CREATE TABLE t1(a int, b int, c int);
CREATE TABLE t2(a int, b int unique);
select rowid,* from t2;
rowid     a         b
--------  --------  --------
1         1         1
2         2
3         3
-- Remove database tables
drop table t1;
drop table t2;
.schema
CREATE TABLE phone(
    name string NOT NULL,
    phone string NOT NULL);
--</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The autogenerated "<code>rowid</code>" is a 64-bit signed integer key that uniquely
identifies the row within its table.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_xml">XML</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="http://en.wikipedia.org/wiki/XML">XML</a> is a representation of the textual data structure.  For example, it is used for web pages (<a href="http://en.wikipedia.org/wiki/XHTML">XHTML</a>) and DocBook source files (<a href="http://en.wikipedia.org/wiki/DocBook">DocBook</a>).</p></div>
<div class="paragraph"><p>The tag pair "<code>&lt;tag&gt; ... &lt;/tag&gt;</code>" or selfclosing tag "<code>&lt;tag /&gt;</code>" are used to markup the text data.  This simple XML data structure allows to create its generic data processing tools such as XSLT, DOM, SAX, &#8230; .</p></div>
<div class="sect2">
<h3 id="_xslt">XSLT</h3>
<div class="paragraph"><p>I used <a href="http://en.wikipedia.org/wiki/XSLT">XSLT</a> (Extensible Stylesheet Language Transformations) to manupulate DocBook XML source files for my <a href="http://www.debian.org/doc/manuals/debian-reference/">Debian Reference</a>.</p></div>
<div class="paragraph"><p>It automated inserting popcon data and reformatted URLs suitable for <a href="http://po4a.alioth.debian.org/">po4a</a> translation framework.</p></div>
<div class="paragraph"><p>Its source is available at <a href="http://anonscm.debian.org/viewvc/ddp/manuals/trunk/quick-reference/">alioth subversion repo for debian-reference</a>.</p></div>
<div class="paragraph"><p>My impression is, "yes we can write &#8230; but debugging is hell and code is un-intuitive.".</p></div>
<div class="paragraph"><p>So my next update of these build scripts may not use XSLT.</p></div>
</div>
<div class="sect2">
<h3 id="_python_6">Python</h3>
<div class="paragraph"><p>There are several <a href="http://docs.python.org/3/library/xml.html">Python XML processing modules</a> to chose from.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://docs.python.org/3/library/xml.dom.html">DOM</a> (generic XML parser to read a whole document first and to organoze its objects in a tree structure.)
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/3/library/xml.sax.html">Sax</a> (generic XML parser to read it sequentially with an event-driven API.)
</p>
</li>
<li>
<p>
<a href="http://docs.python.org/3/library/xml.etree.elementtree.html">ElementTree</a> (new easy-to-use pythonic API, now lxml is merged.)
</p>
<div class="ulist"><ul>
<li>
<p>
<code>parse()</code> is like DOM
</p>
</li>
<li>
<p>
<code>iterparse()</code> is like SAX
</p>
</li>
<li>
<p>
Limitted <a href="http://en.wikipedia.org/wiki/XPath">Xpath</a> support (no parent node)
</p>
</li>
</ul></div>
</li>
<li>
<p>
&#8230; others
</p>
</li>
</ul></div>
<div class="paragraph"><p>When I wanted to extract the list of the <a href="http://en.wikipedia.org/wiki/J%C5%8Dy%C5%8D_kanji">jy kanji</a> (literally "regular-use Chinese characters") data from the <a href="http://ja.wikipedia.org/wiki/%E5%B8%B8%E7%94%A8%E6%BC%A2%E5%AD%97%E4%B8%80%E8%A6%A7"></a> page of the Japanese Wikipedia site, I chose <strong>Elementtree</strong> since it looked easier to program.</p></div>
</div>
<div class="sect2">
<h3 id="_download_data">Download data</h3>
<div class="paragraph"><p>Let&#8217;s download target HTML page (in XHTML).</p></div>
<div class="listingblock">
<div class="title">Download XML file</div>
<div class="content">
<pre><code>$ wget -4 -O - http://ja.wikipedia.org/wiki/%E5%B8%B8%E7%94%A8%E6%BC%A2%E5%AD%97
%E4%B8%80%E8%A6%A7 |zcat - &gt; jouyou.xml
--2013-08-18 10:17:35--  http://ja.wikipedia.org/wiki/%E5%B8%B8%E7%94%A8%E6%BC%A
2%E5%AD%97%E4%B8%80%E8%A6%A7
Resolving ja.wikipedia.org (ja.wikipedia.org)... 208.80.154.225
Connecting to ja.wikipedia.org (ja.wikipedia.org)|208.80.154.225|:80... connecte
d.
HTTP request sent, awaiting response... 200 OK
Length: 102499 (100K) [text/html]
Saving to: STDOUT

     0K .......... .......... .......... .......... .......... 49%  134K 0s
    50K .......... .......... .......... .......... .......... 99%  266K 0s
   100K                                                       100%  184G=0.6s

2013-08-18 10:17:36 (179 KB/s) - written to stdout [102499/102499]</code></pre>
</div></div>
<div class="paragraph"><p>Please note the original downloaded data was compressed.</p></div>
</div>
<div class="sect2">
<h3 id="_find_xpath_to_target">Find XPath to target</h3>
<div class="paragraph"><p>Since it is very awkward to count the XPath location manually, I created a text pattern to XPath conversion tool.  (This works for XML somewhat like what <code>grep</code> does for the plain text.)</p></div>
<div class="listingblock">
<div class="title">Program to search XPath (search-xpath.py)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vim: set sts=4 expandtab:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> xml<span style="color: #990000">.</span>etree<span style="color: #990000">.</span>ElementTree as ET
<span style="font-weight: bold"><span style="color: #000080">import</span></span> re

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>element<span style="color: #990000">,</span> text<span style="color: #990000">,</span> xpath<span style="color: #990000">=</span><span style="color: #FF0000">''</span><span style="color: #990000">):</span>
    retext <span style="color: #990000">=</span> re<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">compile</span></span><span style="color: #990000">(</span>text<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> xpath <span style="color: #990000">==</span> <span style="color: #FF0000">''</span><span style="color: #990000">:</span>
        xpath <span style="color: #990000">=</span> element<span style="color: #990000">.</span>tag
    subelements <span style="color: #990000">=</span> element<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">findall</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'*'</span><span style="color: #990000">)</span>
    tagcount <span style="color: #990000">=</span> <span style="color: #990000">{}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> subelements <span style="color: #990000">!=</span> <span style="color: #990000">[]:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> s <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> subelements<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> s<span style="color: #990000">.</span>tag <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> tagcount<span style="color: #990000">:</span>
                tagcount<span style="color: #990000">[</span>s<span style="color: #990000">.</span>tag<span style="color: #990000">]</span> <span style="color: #990000">+=</span> <span style="color: #993399">1</span>
            <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
                tagcount<span style="color: #990000">[</span>s<span style="color: #990000">.</span>tag<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span>
            subxpath <span style="color: #990000">=</span> xpath <span style="color: #990000">+</span> <span style="color: #FF0000">'/'</span> <span style="color: #990000">+</span> s<span style="color: #990000">.</span>tag <span style="color: #990000">+</span> <span style="color: #FF0000">'['</span> <span style="color: #990000">+</span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>tagcount<span style="color: #990000">[</span>s<span style="color: #990000">.</span>tag<span style="color: #990000">])</span> <span style="color: #990000">+</span> <span style="color: #FF0000">']'</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="color: #990000">(</span>s<span style="color: #990000">.</span>text <span style="font-weight: bold"><span style="color: #0000FF">is</span></span> None<span style="color: #990000">):</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> retext<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">search</span></span><span style="color: #990000">(</span>s<span style="color: #990000">.</span>text<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">strip</span></span><span style="color: #990000">()):</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"=&gt; %s"</span> <span style="color: #990000">%</span> subxpath<span style="color: #990000">)</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"with '%s': '%s'"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>text<span style="color: #990000">,</span> s<span style="color: #990000">.</span>text<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">strip</span></span><span style="color: #990000">()))</span>
            <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>s<span style="color: #990000">,</span> text<span style="color: #990000">,</span>  subxpath<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    tree <span style="color: #990000">=</span> ET<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'jouyou.xml'</span><span style="color: #990000">)</span>
    root <span style="color: #990000">=</span> tree<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getroot</span></span><span style="color: #990000">()</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"search_retext(root, '^')"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>root<span style="color: #990000">,</span> <span style="color: #FF0000">'^'</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"search_retext(root, '^')"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>root<span style="color: #990000">,</span> <span style="color: #FF0000">'^'</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"search_retext(root, '^')"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>root<span style="color: #990000">,</span> <span style="color: #FF0000">'^'</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"search_retext(root, '^')"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">search_retext</span></span><span style="color: #990000">(</span>root<span style="color: #990000">,</span> <span style="color: #FF0000">'^'</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s run this script to find the XPath to key locations having specific texts such as "".</p></div>
<div class="listingblock">
<div class="title">Saerching XPath</div>
<div class="content">
<pre><code>$ ./search-xpath.py
search_retext(root, '^')
=&gt; html/body[1]/div[3]/div[3]/div[4]/div[1]/ul[1]/li[1]/a[1]/span[2]
with '^': ''
=&gt; html/body[1]/div[3]/div[3]/div[4]/h2[1]/span[1]
with '^': ''
search_retext(root, '^')
=&gt; html/body[1]/div[3]/div[3]/div[4]/div[1]/ul[1]/li[1]/ul[1]/li[1]/a[1]/span[2]
with '^': ''
=&gt; html/body[1]/div[3]/div[3]/div[4]/h3[1]/span[1]
with '^': ''
search_retext(root, '^')
=&gt; html/body[1]/div[3]/div[3]/div[4]/table[2]/tr[2]/td[2]/a[1]
with '^': ''
search_retext(root, '^')
=&gt; html/body[1]/div[3]/div[3]/div[4]/ul[1]/li[7]/ul[1]/li[20]/span[1]
with '^': ''
=&gt; html/body[1]/div[3]/div[3]/div[4]/table[2]/tr[239]/td[2]/a[1]
with '^': ''</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_extract_data_from_xml">Extract data from XML</h3>
<div class="paragraph"><p>Now that we know the kanji data is under <code>html/body[1]/div[3]/div[3]/div[4]/table[2]/tr[*]/td[2]/a[1]</code> where * iterates over lines.  (This works for XML somewhat like what <code>sed</code> does for the plain text.)</p></div>
<div class="listingblock">
<div class="title">Program to extract data (kanji.py)</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/python3</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># vim: set sts=4 expandtab:</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> xml<span style="color: #990000">.</span>etree<span style="color: #990000">.</span>ElementTree as ET

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">search_kanji</span></span><span style="color: #990000">(</span>element<span style="color: #990000">):</span>
    kanji <span style="color: #990000">=</span> <span style="color: #990000">[]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> row <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> element<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">findall</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'body[1]/div[3]/div[3]/div[4]/table[2]/tr'</span><span style="color: #990000">):</span>
        <span style="font-style: italic"><span style="color: #9A1900"># processing table for each row (expandable!)</span></span>
        k <span style="color: #990000">=</span> row<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">find</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'td[2]/a'</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> k <span style="font-weight: bold"><span style="color: #0000FF">is</span></span> None<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">continue</span></span>
        kanji<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span>k<span style="color: #990000">.</span>text<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> kanji

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    element <span style="color: #990000">=</span> ET<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'jouyou.xml'</span><span style="color: #990000">)</span>
    root <span style="color: #990000">=</span> element<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getroot</span></span><span style="color: #990000">()</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">search_kanji</span></span><span style="color: #990000">(</span>root<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s run this script to list all Jouyou kanjis.</p></div>
<div class="listingblock">
<div class="title">Lists all jouyou kanjis (trancated).</div>
<div class="content">
<pre><code>$ ./kanji.py
['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ...</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_xml_with_namespace">XML with namespace</h3>
<div class="paragraph"><p>For example, this fun2prog web page is in the typical XHTML format having namespace embedded in the "<code>&lt;html&gt;</code>" tag attiribute as "<code>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;</code>".  This declaration applies to child elements until it is overriden by another definition.</p></div>
<div class="paragraph"><p>In an Element tree, such qualified names are stored as universal names in Clarks notatioion.  So if "<code>&lt;tag&gt;</code>" apears in such XML, Elementtree read it as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{http://www.w3.org/1999/xhtml}tag</code></pre>
</div></div>
<div class="paragraph"><p>For example, let&#8217;s consider that a copy of this web page fun2prog.html in this current directory.  The first thing to do is to change above example code to the following.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>...
    tree = ET.parse('jouyou.xml')
    root = tree.getroot()
...</code></pre>
</div></div>
<div class="paragraph"><p>Running this will produce very noisy output (folded to fit to the screen).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{http://www.w3.org/1999/xhtml}html/ \
{http://www.w3.org/1999/xhtml}body[1]/ \
{http://www.w3.org/1999/xhtml}div[2]/ ...</code></pre>
</div></div>
<div class="paragraph"><p>The following should let you supress these curly brakets.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>...
    f = open('fun2prog.html', 'r')
    xhtmlstring = f.read()
    f.close()
    xhtmlstring = re.sub(' xmlns="[^"]+"', '', xhtmlstring, count=1)
    root = ET.fromstring(xhtmlstring)
...</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedded_lua">Embedded Lua</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Lua interpreter embedded into a small C program offers an ideal
configuration system.  It can execute any functions of the hosting C program
under specified conditions and sequences with arbitrary parameter values.</p></div>
<div class="ulist"><ul>
<li>
<p>
Lua is small.
</p>
</li>
<li>
<p>
Lua has simple procedural syntax.
</p>
</li>
<li>
<p>
Lua has powerful data constructs based on associative arrays.
</p>
</li>
<li>
<p>
Lua has extensible semantics.
</p>
</li>
<li>
<p>
Lua is dynamically typed.
</p>
</li>
<li>
<p>
Lua has automatic memory management with incremental garbage collection.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Learn Lua:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.lua.org/">http://www.lua.org/</a>
</p>
</li>
<li>
<p>
<a href="http://www.lua.org/manual/5.1/">http://www.lua.org/manual/5.1/</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>In Debian, Lua interpreter is offered as a shared library linkable from any C
codes.</p></div>
<div class="sect2">
<h3 id="_pseudo_stack">Pseudo stack</h3>
<div class="paragraph"><p>The hosting C program and the embedded Lua interpreter needs to communicate
each other.  This communication is done by passing parameters via the shared
Lua pseudo stack.  Here is a private library function to print out its content.</p></div>
<div class="listingblock">
<div class="title">dump.c defining the dump_stack(lua_State* L) function source</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lua.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lualib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lauxlib.h&gt;</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>lua_State<span style="color: #990000">*</span> L<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> stack_size <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lua_gettop</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">/*  Lua virtual stack size */</span></span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span> <span style="color: #990000">(</span><span style="color: #FF0000">"=== DUMP STACK top=[%i] --&gt; bottom=[1] ===</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> stack_size<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> stack_size<span style="color: #990000">;</span> i <span style="color: #990000">&gt;=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">--)</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> type <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lua_type</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> i<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C: stack[%2i or %3i] type=%10s"</span><span style="color: #990000">,</span> i<span style="color: #990000">,</span> i <span style="color: #990000">-</span> stack_size <span style="color: #990000">-</span> <span style="color: #993399">1</span><span style="color: #990000">,</span>
                        <span style="font-weight: bold"><span style="color: #000000">lua_typename</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span>type<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span><span style="color: #990000">(</span>type<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> LUA_TNUMBER<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900">/* Lua type: number */</span></span>
                <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= %g"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">lua_tonumber</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> i<span style="color: #990000">));</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> LUA_TBOOLEAN<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900">/* Lua type: boolean */</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">lua_toboolean</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> i<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= true"</span><span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= false"</span><span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> LUA_TSTRING<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900">/* Lua type: string */</span></span>
                <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= %s"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">lua_tostring</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> i<span style="color: #990000">)</span> <span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> LUA_TNIL<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900">/* Lua type: nil */</span></span>
                        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= nil (nil == 0)"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #008080">        default:</span></span>
                        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">";  value= non-printable"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">dump.h defining the dump_stack(lua_State* L) function header</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>lua_State<span style="color: #990000">*</span> L<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Here is an example hosting C program of Lua interpreter <code>luastack.c</code>.  This
manipulates the shared parameter passing pseudo stack from the hosting C
program.</p></div>
<div class="listingblock">
<div class="title">The hosting luastack.c source</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lua.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lualib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lauxlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"dump.h"</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    lua_State<span style="color: #990000">*</span> L <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">luaL_newstate</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushboolean(L, TRUE)</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushboolean</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> TRUE<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushnumber(L, 3.141592) -- push 3.141592</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushnumber</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">3.141592</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushinteger(L, -200) -- push -200</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushinteger</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">200</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushnil(L) -- push nil</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushnil</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushstring(L, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Hello world!</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">) -- push </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Hello world!</span><span style="color: #CC33CC">\"\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushstring</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #FF0000">"Hello world!"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_replace(L, 2) -- replace stack[2] with stack top</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_replace</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushvalue(L, 1) -- push value of stack[1]</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushvalue</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_pushvalue(L, -2) -- push value of stack[-2]</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_pushvalue</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_insert(L, 2) -- insert stack top to stack[2]</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_insert</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_remove(L, 2) -- remove stack[2]</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_remove</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lua_settop(L, -1) -- remove 1 item from stack top</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_settop</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">lua_close</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s compile these and run <code>luastack</code>.</p></div>
<div class="listingblock">
<div class="title">Compile and run of luastack</div>
<div class="content">
<pre><code>$ gcc -Wall `pkg-config --cflags --libs lua5.1` -c luastack.c
$ gcc -Wall `pkg-config --cflags --libs lua5.1` dump.o luastack.o -o luastack
$ ./luastack
lua_pushboolean(L, TRUE)
=== DUMP STACK top=[1] --&gt; bottom=[1] ===
C: stack[ 1 or  -1] type=   boolean;  value= true
lua_pushnumber(L, 3.141592) -- push 3.141592
=== DUMP STACK top=[2] --&gt; bottom=[1] ===
C: stack[ 2 or  -1] type=    number;  value= 3.14159
C: stack[ 1 or  -2] type=   boolean;  value= true
lua_pushinteger(L, -200) -- push -200
=== DUMP STACK top=[3] --&gt; bottom=[1] ===
C: stack[ 3 or  -1] type=    number;  value= -200
C: stack[ 2 or  -2] type=    number;  value= 3.14159
C: stack[ 1 or  -3] type=   boolean;  value= true
lua_pushnil(L) -- push nil
=== DUMP STACK top=[4] --&gt; bottom=[1] ===
C: stack[ 4 or  -1] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -2] type=    number;  value= -200
C: stack[ 2 or  -3] type=    number;  value= 3.14159
C: stack[ 1 or  -4] type=   boolean;  value= true
lua_pushstring(L, "Hello world!") -- push "Hello world!"
=== DUMP STACK top=[5] --&gt; bottom=[1] ===
C: stack[ 5 or  -1] type=    string;  value= Hello world!
C: stack[ 4 or  -2] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -3] type=    number;  value= -200
C: stack[ 2 or  -4] type=    number;  value= 3.14159
C: stack[ 1 or  -5] type=   boolean;  value= true
lua_replace(L, 2) -- replace stack[2] with stack top
=== DUMP STACK top=[4] --&gt; bottom=[1] ===
C: stack[ 4 or  -1] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -2] type=    number;  value= -200
C: stack[ 2 or  -3] type=    string;  value= Hello world!
C: stack[ 1 or  -4] type=   boolean;  value= true
lua_pushvalue(L, 1) -- push value of stack[1]
=== DUMP STACK top=[5] --&gt; bottom=[1] ===
C: stack[ 5 or  -1] type=   boolean;  value= true
C: stack[ 4 or  -2] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -3] type=    number;  value= -200
C: stack[ 2 or  -4] type=    string;  value= Hello world!
C: stack[ 1 or  -5] type=   boolean;  value= true
lua_pushvalue(L, -2) -- push value of stack[-2]
=== DUMP STACK top=[6] --&gt; bottom=[1] ===
C: stack[ 6 or  -1] type=       nil;  value= nil (nil == 0)
C: stack[ 5 or  -2] type=   boolean;  value= true
C: stack[ 4 or  -3] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -4] type=    number;  value= -200
C: stack[ 2 or  -5] type=    string;  value= Hello world!
C: stack[ 1 or  -6] type=   boolean;  value= true
lua_insert(L, 2) -- insert stack top to stack[2]
=== DUMP STACK top=[6] --&gt; bottom=[1] ===
C: stack[ 6 or  -1] type=   boolean;  value= true
C: stack[ 5 or  -2] type=       nil;  value= nil (nil == 0)
C: stack[ 4 or  -3] type=    number;  value= -200
C: stack[ 3 or  -4] type=    string;  value= Hello world!
C: stack[ 2 or  -5] type=       nil;  value= nil (nil == 0)
C: stack[ 1 or  -6] type=   boolean;  value= true
lua_remove(L, 2) -- remove stack[2]
=== DUMP STACK top=[5] --&gt; bottom=[1] ===
C: stack[ 5 or  -1] type=   boolean;  value= true
C: stack[ 4 or  -2] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -3] type=    number;  value= -200
C: stack[ 2 or  -4] type=    string;  value= Hello world!
C: stack[ 1 or  -5] type=   boolean;  value= true
lua_settop(L, -1) -- remove 1 item from stack top
=== DUMP STACK top=[5] --&gt; bottom=[1] ===
C: stack[ 5 or  -1] type=   boolean;  value= true
C: stack[ 4 or  -2] type=       nil;  value= nil (nil == 0)
C: stack[ 3 or  -3] type=    number;  value= -200
C: stack[ 2 or  -4] type=    string;  value= Hello world!
C: stack[ 1 or  -5] type=   boolean;  value= true</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_c_lua">C + Lua</h3>
<div class="paragraph"><p>Let&#8217;s write a hosting C program <code>luahost.c</code> which can load a Lua script
<code>script.lua</code> into the embedded Lua interpreter.</p></div>
<div class="listingblock">
<div class="title">luahost.c source</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lua.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lualib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;lauxlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"dump.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"average.h"</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> TRUE <span style="color: #993399">1</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> FALSE <span style="color: #993399">0</span>

<span style="color: #009900">int</span>
<span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">int</span> argc<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>argv<span style="color: #990000">[])</span>
<span style="color: #FF0000">{</span>
    <span style="color: #009900">double</span> w<span style="color: #990000">;</span>
    <span style="color: #009900">double</span> h<span style="color: #990000">;</span>
    <span style="color: #009900">double</span> a<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- lua_State* L = luaL_newstate(); /* initialize Lua */"</span><span style="color: #990000">);</span>
    lua_State<span style="color: #990000">*</span> L <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">luaL_newstate</span></span><span style="color: #990000">();</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- luaL_openlibs(L); /* standard libraries */"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">luaL_openlibs</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- lua_register(L, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">average</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, c_average); /* private library */"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_register</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #FF0000">"average"</span><span style="color: #990000">,</span> c_average<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- luaL_loadfile(L, argv[1]) ..."</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">luaL_loadfile</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">])</span> <span style="color: #990000">||</span> <span style="font-weight: bold"><span style="color: #000000">lua_pcall</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">))</span>
    <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"cannot run: %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">lua_tostring</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
        <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- %s load and executed.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> argv<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- lua_getglobal(L, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">width</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">); /* push Lua variable width */"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_getglobal</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #FF0000">"width"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- lua_getglobal(L, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">height</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">); /* push Lua variable height */"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_getglobal</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #FF0000">"height"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- lua_getglobal(L, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">ave</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">); /* push Lua variable ave */"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">lua_getglobal</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #FF0000">"ave"</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">dump_stack</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- a = lua_tonumber(L, -1); /* read ave at -1 in the stack */"</span><span style="color: #990000">);</span>
    a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lua_tonumber</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C: Average = %g</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> a<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- h = lua_tonumber(L, -2); /* read height at -2 in the stack */"</span><span style="color: #990000">);</span>
    h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lua_tonumber</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">2</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C: Height  = %g</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> h<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">puts</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"-- h = lua_tonumber(L, -3); /* read width at -3 in the stack */"</span><span style="color: #990000">);</span>
    w <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">lua_tonumber</span></span><span style="color: #990000">(</span>L<span style="color: #990000">,</span> <span style="color: #990000">-</span><span style="color: #993399">3</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C: Width   = %g</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> w<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">printf</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"C: Volume  %g * %g * %g = %g</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> w<span style="color: #990000">,</span> h<span style="color: #990000">,</span> a<span style="color: #990000">,</span> w<span style="color: #990000">*</span>h<span style="color: #990000">*</span>a<span style="color: #990000">);</span>

    <span style="font-weight: bold"><span style="color: #000000">lua_close</span></span><span style="color: #990000">(</span>L<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">script.lua source</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">-- lua example</span></span>

ave <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">average</span></span><span style="color: #990000">(</span><span style="color: #993399">1.0</span><span style="color: #990000">,</span> <span style="color: #993399">2.0</span><span style="color: #990000">,</span> <span style="color: #993399">3.0</span><span style="color: #990000">,</span> <span style="color: #993399">4.0</span><span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Lua: ave    = %g"</span><span style="color: #990000">,</span> ave<span style="color: #990000">))</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> os<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getenv</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"SMALL"</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #FF0000">"YES"</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span>
    width <span style="color: #990000">=</span> <span style="color: #993399">5</span>
    height <span style="color: #990000">=</span> <span style="color: #993399">50</span>
<span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
    width <span style="color: #990000">=</span> <span style="color: #993399">100</span>
    height <span style="color: #990000">=</span> <span style="color: #993399">200</span>
<span style="font-weight: bold"><span style="color: #0000FF">end</span></span>

<span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Lua: width  = %g"</span><span style="color: #990000">,</span> width<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span>string<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Lua: height = %g"</span><span style="color: #990000">,</span> height<span style="color: #990000">))</span>
</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s see how they interact.</p></div>
<div class="listingblock">
<div class="title">Compile and run of luahost</div>
<div class="content">
<pre><code>$ gcc -Wall `pkg-config --cflags --libs lua5.1` -c luahost.c
$ gcc -Wall `pkg-config --cflags --libs lua5.1` dump.o average.o \
    luahost.o -o luahost
$ export SMALL
$ SMALL="NO"
$ ./luahost script.lua
-- lua_State* L = luaL_newstate(); /* initialize Lua */
-- luaL_openlibs(L); /* standard libraries */
-- lua_register(L, "average", c_average); /* private library */
-- luaL_loadfile(L, argv[1]) ...
C: argument[ 4 or  -1]= 4
C: argument[ 3 or  -2]= 3
C: argument[ 2 or  -3]= 2
C: argument[ 1 or  -4]= 1
Lua: ave    = 2.5
Lua: width  = 100
Lua: height = 200
-- script.lua load and executed.
-- lua_getglobal(L, "width"); /* push Lua variable width */
=== DUMP STACK top=[1] --&gt; bottom=[1] ===
C: stack[ 1 or  -1] type=    number;  value= 100
-- lua_getglobal(L, "height"); /* push Lua variable height */
=== DUMP STACK top=[2] --&gt; bottom=[1] ===
C: stack[ 2 or  -1] type=    number;  value= 200
C: stack[ 1 or  -2] type=    number;  value= 100
-- lua_getglobal(L, "ave"); /* push Lua variable ave */
=== DUMP STACK top=[3] --&gt; bottom=[1] ===
C: stack[ 3 or  -1] type=    number;  value= 2.5
C: stack[ 2 or  -2] type=    number;  value= 200
C: stack[ 1 or  -3] type=    number;  value= 100
-- a = lua_tonumber(L, -1); /* read ave at -1 in the stack */
C: Average = 2.5
-- h = lua_tonumber(L, -2); /* read height at -2 in the stack */
C: Height  = 200
-- h = lua_tonumber(L, -3); /* read width at -3 in the stack */
C: Width   = 100
C: Volume  100 * 200 * 2.5 = 50000
$ SMALL="YES"
$ ./luahost script.lua
-- lua_State* L = luaL_newstate(); /* initialize Lua */
-- luaL_openlibs(L); /* standard libraries */
-- lua_register(L, "average", c_average); /* private library */
-- luaL_loadfile(L, argv[1]) ...
C: argument[ 4 or  -1]= 4
C: argument[ 3 or  -2]= 3
C: argument[ 2 or  -3]= 2
C: argument[ 1 or  -4]= 1
Lua: ave    = 2.5
Lua: width  = 100
Lua: height = 200
-- script.lua load and executed.
-- lua_getglobal(L, "width"); /* push Lua variable width */
=== DUMP STACK top=[1] --&gt; bottom=[1] ===
C: stack[ 1 or  -1] type=    number;  value= 100
-- lua_getglobal(L, "height"); /* push Lua variable height */
=== DUMP STACK top=[2] --&gt; bottom=[1] ===
C: stack[ 2 or  -1] type=    number;  value= 200
C: stack[ 1 or  -2] type=    number;  value= 100
-- lua_getglobal(L, "ave"); /* push Lua variable ave */
=== DUMP STACK top=[3] --&gt; bottom=[1] ===
C: stack[ 3 or  -1] type=    number;  value= 2.5
C: stack[ 2 or  -2] type=    number;  value= 200
C: stack[ 1 or  -3] type=    number;  value= 100
-- a = lua_tonumber(L, -1); /* read ave at -1 in the stack */
C: Average = 2.5
-- h = lua_tonumber(L, -2); /* read height at -2 in the stack */
C: Height  = 200
-- h = lua_tonumber(L, -3); /* read width at -3 in the stack */
C: Width   = 100
C: Volume  100 * 200 * 2.5 = 50000</code></pre>
</div></div>
<div class="paragraph"><p>Lua program can call C functions and use values of C variables such as ones
passed from OS environment variables via the hosting C program.  The hosting C
program can use the execution result of the Lua script.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_examples">Code examples</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are code examples which I thought interesting.</p></div>
<div class="sect2">
<h3 id="_encrypted_code">Encrypted code</h3>
<div class="paragraph"><p>Let&#8217;s make an obfuscated shell code by encrypting its real code contents.
The following creates an encrypted ASCII file <code>hello.asc</code> (passphrase used was
"secret") from <code>hello</code>.</p></div>
<div class="listingblock">
<div class="title">Encrypting <code>hello</code> shell script into <code>hello.asc</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat <span style="color: #990000">.</span>/hello
<span style="font-style: italic"><span style="color: #9A1900">#!/bin/sh</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># my first shell program</span></span>
echo <span style="color: #FF0000">"Hello, world!"</span>
$ gpg -ca <span style="color: #990000">.</span>/hello
Enter passphrase<span style="color: #990000">:</span>
Repeat passphrase<span style="color: #990000">:</span>
$ cat <span style="color: #990000">.</span>/hello<span style="color: #990000">.</span>asc
-----BEGIN PGP MESSAGE-----
Version<span style="color: #990000">:</span> GnuPG v1<span style="color: #990000">.</span><span style="color: #993399">4.12</span> <span style="color: #990000">(</span>GNU/Linux<span style="color: #990000">)</span>

jA0EAwMCz<span style="color: #990000">+</span>Uhs2ZYpdRgyU8jzGO2hKSDOpQgXmUxsIJqgrjo<span style="color: #990000">+</span>CQFiGw8z0CU5YIk
163JjuP2U4IXl<span style="color: #990000">+</span>np8z0TiVqzl1exf5zn1cExELFhuv8yho2RkvINGq0zXYYVDaqd
<span style="color: #990000">=</span>DjhI
-----END PGP MESSAGE-----</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s add decrypting shell code to this <code>hello.asc</code> to make an obfuscated
Shell <code>hello-secret</code> as follows.</p></div>
<div class="listingblock">
<div class="title">Obfuscated Shell <code>hello-secret</code></div>
<div class="content">
<pre><code>#!/bin/sh
cat - &lt;&lt;EOF | gpg -d --no-mdc-warning | while read x ;do eval "$x"; done
-----BEGIN PGP MESSAGE-----
Version: GnuPG v1

jA0EAwMCrIg7DxgtTH5gyU+OiGdl2Gx4aU/PU7ob1F0ysG/LNqiQJX0+cCk/Xg8q
MUZ3dHthwaK+FdN7vpC9KmRQBKHPnOeIw8D+fCOA2u5OYRIZc25R44MYS9wWXxsD
=kYXh
-----END PGP MESSAGE-----
EOF</code></pre>
</div></div>
<div class="paragraph"><p>This script can be executed if you know the secret passphrase as follows.</p></div>
<div class="listingblock">
<div class="title">Executing <code>hello-secret</code> while providing the passphrase</div>
<div class="content">
<pre><code>$ chmod 755 ./hello-secret
$ ./hello-secret
gpg: CAST5 encrypted data
Entere passphrase:
gpg: encrypted with 1 passphrase
Hello, world!</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_check_modification">Check modification</h3>
<div class="paragraph"><p>The identity verification of a file can be simplified by using
<a href="http://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash function</a>
such as:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/SHA-1">SHA-1</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/MD5">MD5</a>
</p>
</li>
<li>
<p>
&#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>Sometimes, you wish to check non-malicious user modifications to a
configuration file from the configuration helper script.  Here is a very light
weight check method without GPG signature which I deployed for the im-config
package.</p></div>
<div class="listingblock">
<div class="title">An example of configuration file <code>test.conf</code></div>
<div class="content">
<pre><code># im-config(8) generated on Sat, 26 Jun 2010 11:41:39 +0900
run_im default</code></pre>
</div></div>
<div class="paragraph"><p>You can add a signature generated by the MD5 cryptographic hash function to
this configuration file <code>test.conf</code>.</p></div>
<div class="listingblock">
<div class="title">Add the MD5 hush value</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat <span style="font-weight: bold"><span style="color: #0000FF">test</span></span><span style="color: #990000">.</span>conf
<span style="font-style: italic"><span style="color: #9A1900"># im-config(8) generated on Sat, 26 Jun 2010 11:41:39 +0900</span></span>
run_im default
<span style="font-style: italic"><span style="color: #9A1900"># config signiture: b4adf8baabbc92cf765f58e30f74c5e5  -</span></span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s verify that this has not been inadvertently modified by users with the
MD5 hush value.</p></div>
<div class="listingblock">
<div class="title">Check the MD5 hush value before modification</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>        <span style="color: #FF0000">"$(tail -n 1 test.conf)"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span> <span style="color: #990000">\</span>
    echo <span style="color: #FF0000">"... UNchanged"</span> <span style="color: #990000">;</span> <span style="color: #990000">\</span>
  <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #990000">\</span>
    echo <span style="color: #FF0000">"*** changed"</span> <span style="color: #990000">;</span> <span style="color: #990000">\</span>
  <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
<span style="color: #990000">...</span> UNchanged</tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s make a modification to <code>test.conf</code> and check with the same method.</p></div>
<div class="listingblock">
<div class="title">Check the MD5 hush value after modification</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat <span style="font-weight: bold"><span style="color: #0000FF">test</span></span><span style="color: #990000">.</span>conf
<span style="font-style: italic"><span style="color: #9A1900"># im-config(8) geneRated on Sat, 26 Jun 2010 11:41:39 +0900</span></span>
Run_im default
<span style="font-style: italic"><span style="color: #9A1900"># config signituRe: b4adf8baabbc92cf765f58e30f74c5e5  -</span></span>
$ <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">[</span> <span style="color: #FF0000">"# config signiture: $(head -n -1 test.conf | md5sum)"</span> <span style="color: #990000">=</span> <span style="color: #990000">\</span>
        <span style="color: #FF0000">"$(tail -n 1 test.conf)"</span> <span style="color: #990000">];</span> <span style="font-weight: bold"><span style="color: #0000FF">then</span></span> <span style="color: #990000">\</span>
    echo <span style="color: #FF0000">"... UNchanged"</span> <span style="color: #990000">;</span> <span style="color: #990000">\</span>
  <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #990000">\</span>
    echo <span style="color: #FF0000">"*** changed"</span> <span style="color: #990000">;</span> <span style="color: #990000">\</span>
  <span style="font-weight: bold"><span style="color: #0000FF">fi</span></span>
<span style="color: #990000">***</span> changed</tt></pre></div></div>
<div class="paragraph"><p>This method is only good for detecting non-malicious user modifications.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_readings">Further readings</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are some documentation I found on the web which may be interesting to read.  (I have not yet examined all their contents yet.)</p></div>
<div class="sect2">
<h3 id="_ibm_developerworks">IBM developerWorks</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.ibm.com/developerworks/">IBM developerWorks</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/">Linux</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/linux/newto/index.html">New to Linux programming and Linux system administration</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/views/aix/libraryview.jsp?search_by=tips">AIX and UNIX Technical library</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_speaking_unix">Speaking UNIX</h3>
<div class="paragraph"><p>This tutorial series by Martin Streicher (<a href="mailto:martin.streicher@gmail.com">martin.streicher@gmail.com</a>) provide many examples of basic UNIX operations.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-unix-commandline/index.html">Speaking UNIX, Part 1: Command the power of the command line</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix2.html">Speaking UNIX, Part 2: Working smarter, not harder</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix3.html">Speaking UNIX, Part 3: Do everything right from the command line</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix4/index.html">Speaking UNIX, Part 4: UNIX ownership and permissions provide for privacy and participation</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix5.html">Speaking UNIX, Part 5: Data, data everywhere</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix6.html">Speaking UNIX, Part 6: Automate, automate, automate!</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix7.html">Speaking UNIX, Part 7: Command-line locution</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix8/index.html">Speaking UNIX, Part 8: UNIX processes</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix9/index.html">Speaking UNIX, Part 9: Regular expressions</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix10/index.html">Speaking UNIX, Part 10: Customize your shell</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix11/index.html">Speaking UNIX, Part 11: Ramble around the UNIX file system</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix12/index.html">Speaking UNIX, Part 12: Do-it-yourself projects</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix13/index.html">Speaking UNIX, Part 13: Ten more command-line concoctions</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-speakingunix14/index.html">Speaking UNIX, Part 14: Manage Ruby and gems with RVM</a>
</p>
</li>
<li>
<p>
<a href="http://www.ibm.com/developerworks/aix/library/au-spunix_greattools/index.html">Speaking UNIX: 10 great tools for any UNIX system</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Please note some contents may be already outdated, etc.  So use these as secondary reference documents.</p></div>
</div>
<div class="sect2">
<h3 id="_c_c_programming_faq">C/C++ programming FAQ</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://c-faq.com/">comp.lang.c Frequently Asked Questions</a> (1995-2005)
</p>
</li>
<li>
<p>
<a href="http://www.andromeda.com/people/ddyer/topten.html">The Top 10 Ways to get screwed by the "C" programming language</a> (2011)
</p>
</li>
<li>
<p>
<a href="http://www.parashift.com/c++-faq/">C++ FAQ</a> (2012)
</p>
</li>
<li>
<p>
<a href="http://www.stroustrup.com/C++11FAQ.html">C++11 FAQ</a> (2013)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_system_programming">System programming</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://space.wccnet.edu/~chasselb/linux275/index2.html">CPS275 - Linux/Unix System Programming</a>
</p>
</li>
<li>
<p>
<a href="http://shellscript.sunone.me">UNIX &amp; Linux command and shell script reference</a> (Japanese)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_kernel_programming">Kernel programming</h3>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.tldp.org/LDP/lkmpg/2.6/html/lkmpg.html">The Linux Kernel Module Programming Guide</a> by Peter Jay Salzman (2001 - 2007)
</p>
</li>
<li>
<p>
<a href="http://www.win.tue.nl/~aeb/linux/lk/lk.html">The Linux kernel</a> by Andries Brouwer (2003)
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apendix">Apendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_system_statistics">System Statistics</h3>
<div class="sect3">
<h4 id="_executables">Executables</h4>
<div class="paragraph"><p>Let&#8217;s check roughly what kind of executables are used on my typical GNOME desktop Debian system building this document.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 15. Statistics over installed executable programs</caption>
<col width="76%" />
<col width="23%" />
<thead>
<tr>
<th align="left" valign="top">Executable type</th>
<th align="left" valign="top">Number of programs</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (all)</p></td>
<td align="left" valign="top"><p class="table">2398</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (set*id)</p></td>
<td align="left" valign="top"><p class="table">28</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to libc)</p></td>
<td align="left" valign="top"><p class="table">2366</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to libstdc++ = C++)</p></td>
<td align="left" valign="top"><p class="table">423</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to libX11 = X)</p></td>
<td align="left" valign="top"><p class="table">459</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to gobject = GNOME)</p></td>
<td align="left" valign="top"><p class="table">405</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to libQtCore = KDE)</p></td>
<td align="left" valign="top"><p class="table">198</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ELF executable (linked to libncurses)</p></td>
<td align="left" valign="top"><p class="table">51</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">POSIX shell script</p></td>
<td align="left" valign="top"><p class="table">567</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Perl script</p></td>
<td align="left" valign="top"><p class="table">263</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Python script</p></td>
<td align="left" valign="top"><p class="table">199</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bash shell script</p></td>
<td align="left" valign="top"><p class="table">150</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Ruby script</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lua script</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>ELF executable can be generated from any compiled languages such as C, C++, ,
Objective C, Objective C++, Vala, Common Lisp, Scheme, Haskel, Pascal,
Fortran, Ada, &#8230;  but most likely they are from C or C++.</p></div>
<div class="paragraph"><p>This gives some idea for popularity of programming language on Debian system.  Of course, the above sampling method focus on the system programming and hides the popularities of PHP, Java, Javascript and Ruby which are mostly used for the web programming etc.  For general idea for popularity of languages, see links from wikipedia article: <a href="http://en.wikipedia.org/wiki/Measuring_programming_language_popularity">measuring programming language popularity</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_libraries">Libraries</h4>
<div class="paragraph"><p>Let&#8217;s check roughly what libraries are used on a typical GNOME desktop Debian system.
I only list ones used by more than 70 ELF executable programs.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 16. Statistics over libraries used by ELF executable programs</caption>
<col width="76%" />
<col width="23%" />
<thead>
<tr>
<th align="left" valign="top">Library</th>
<th align="left" valign="top">Number of programs</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">linux-vdso.so.1</p></td>
<td align="left" valign="top"><p class="table">2366</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libc.so.6</p></td>
<td align="left" valign="top"><p class="table">2366</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">/lib64/ld-linux-x86-64.so.2</p></td>
<td align="left" valign="top"><p class="table">2366</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdl.so.2</p></td>
<td align="left" valign="top"><p class="table">1113</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libm.so.6</p></td>
<td align="left" valign="top"><p class="table">1016</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpthread.so.0</p></td>
<td align="left" valign="top"><p class="table">955</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libz.so.1</p></td>
<td align="left" valign="top"><p class="table">796</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpcre.so.3</p></td>
<td align="left" valign="top"><p class="table">632</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">librt.so.1</p></td>
<td align="left" valign="top"><p class="table">517</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libglib-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">485</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libffi.so.6</p></td>
<td align="left" valign="top"><p class="table">476</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXdmcp.so.6</p></td>
<td align="left" valign="top"><p class="table">462</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb.so.1</p></td>
<td align="left" valign="top"><p class="table">462</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXau.so.6</p></td>
<td align="left" valign="top"><p class="table">462</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libX11.so.6</p></td>
<td align="left" valign="top"><p class="table">459</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgcc_s.so.1</p></td>
<td align="left" valign="top"><p class="table">432</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">liblzma.so.5</p></td>
<td align="left" valign="top"><p class="table">427</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libstdc++.so.6</p></td>
<td align="left" valign="top"><p class="table">423</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXext.so.6</p></td>
<td align="left" valign="top"><p class="table">414</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgobject-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">405</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libselinux.so.1</p></td>
<td align="left" valign="top"><p class="table">402</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libexpat.so.1</p></td>
<td align="left" valign="top"><p class="table">395</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libuuid.so.1</p></td>
<td align="left" valign="top"><p class="table">388</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpng12.so.0</p></td>
<td align="left" valign="top"><p class="table">381</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libfreetype.so.6</p></td>
<td align="left" valign="top"><p class="table">368</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdbus-1.so.3</p></td>
<td align="left" valign="top"><p class="table">362</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libfontconfig.so.1</p></td>
<td align="left" valign="top"><p class="table">356</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXrender.so.1</p></td>
<td align="left" valign="top"><p class="table">345</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libresolv.so.2</p></td>
<td align="left" valign="top"><p class="table">320</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXfixes.so.3</p></td>
<td align="left" valign="top"><p class="table">318</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libudev.so.1</p></td>
<td align="left" valign="top"><p class="table">313</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libICE.so.6</p></td>
<td align="left" valign="top"><p class="table">275</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libSM.so.6</p></td>
<td align="left" valign="top"><p class="table">274</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libbz2.so.1.0</p></td>
<td align="left" valign="top"><p class="table">264</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgmodule-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">258</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXt.so.6</p></td>
<td align="left" valign="top"><p class="table">249</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxml2.so.2</p></td>
<td align="left" valign="top"><p class="table">231</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgio-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">222</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libX11-xcb.so.1</p></td>
<td align="left" valign="top"><p class="table">213</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libnetpbm.so.10</p></td>
<td align="left" valign="top"><p class="table">213</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXi.so.6</p></td>
<td align="left" valign="top"><p class="table">208</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libattr.so.1</p></td>
<td align="left" valign="top"><p class="table">208</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtCore.so.4</p></td>
<td align="left" valign="top"><p class="table">198</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtXml.so.4</p></td>
<td align="left" valign="top"><p class="table">189</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgpg-error.so.0</p></td>
<td align="left" valign="top"><p class="table">187</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtDBus.so.4</p></td>
<td align="left" valign="top"><p class="table">185</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgcrypt.so.11</p></td>
<td align="left" valign="top"><p class="table">185</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtNetwork.so.4</p></td>
<td align="left" valign="top"><p class="table">183</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXxf86vm.so.1</p></td>
<td align="left" valign="top"><p class="table">179</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libkdecore.so.5</p></td>
<td align="left" valign="top"><p class="table">177</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libfam.so.0</p></td>
<td align="left" valign="top"><p class="table">177</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdlrestrictions.so.1</p></td>
<td align="left" valign="top"><p class="table">177</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtGui.so.4</p></td>
<td align="left" valign="top"><p class="table">176</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libaudio.so.2</p></td>
<td align="left" valign="top"><p class="table">176</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxshmfence.so.1</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXdamage.so.1</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-sync.so.1</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-present.so.0</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-glx.so.0</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-dri3.so.0</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-dri2.so.0</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libGL.so.1</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libglapi.so.0</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdrm.so.2</p></td>
<td align="left" valign="top"><p class="table">171</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libQtSvg.so.4</p></td>
<td align="left" valign="top"><p class="table">166</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libkdeui.so.5</p></td>
<td align="left" valign="top"><p class="table">165</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdbusmenu-qt.so.2</p></td>
<td align="left" valign="top"><p class="table">165</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libattica.so.0.4</p></td>
<td align="left" valign="top"><p class="table">165</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgthread-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">152</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXrandr.so.2</p></td>
<td align="left" valign="top"><p class="table">148</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXinerama.so.1</p></td>
<td align="left" valign="top"><p class="table">146</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpixman-1.so.0</p></td>
<td align="left" valign="top"><p class="table">145</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-shape.so.0</p></td>
<td align="left" valign="top"><p class="table">143</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgdk_pixbuf-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">143</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXcursor.so.1</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-xfixes.so.0</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-shm.so.0</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxcb-render.so.0</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libwayland-server.so.0</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libwayland-client.so.0</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgbm.so.1</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libEGL.so.1</p></td>
<td align="left" valign="top"><p class="table">142</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libharfbuzz.so.0</p></td>
<td align="left" valign="top"><p class="table">141</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgraphite2.so.3</p></td>
<td align="left" valign="top"><p class="table">141</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libacl.so.1</p></td>
<td align="left" valign="top"><p class="table">141</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libthai.so.0</p></td>
<td align="left" valign="top"><p class="table">140</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpangoft2-1.0.so.0</p></td>
<td align="left" valign="top"><p class="table">140</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpango-1.0.so.0</p></td>
<td align="left" valign="top"><p class="table">140</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libdatrie.so.1</p></td>
<td align="left" valign="top"><p class="table">140</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libcairo.so.2</p></td>
<td align="left" valign="top"><p class="table">140</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libpangocairo-1.0.so.0</p></td>
<td align="left" valign="top"><p class="table">139</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libXcomposite.so.1</p></td>
<td align="left" valign="top"><p class="table">136</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libatk-1.0.so.0</p></td>
<td align="left" valign="top"><p class="table">134</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libp11-kit.so.0</p></td>
<td align="left" valign="top"><p class="table">117</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libtinfo.so.5</p></td>
<td align="left" valign="top"><p class="table">116</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libsoprano.so.4</p></td>
<td align="left" valign="top"><p class="table">115</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libsolid.so.4</p></td>
<td align="left" valign="top"><p class="table">114</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libtasn1.so.6</p></td>
<td align="left" valign="top"><p class="table">112</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libstreams.so.0</p></td>
<td align="left" valign="top"><p class="table">110</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libstreamanalyzer.so.0</p></td>
<td align="left" valign="top"><p class="table">110</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libnepomuk.so.4</p></td>
<td align="left" valign="top"><p class="table">110</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libkio.so.5</p></td>
<td align="left" valign="top"><p class="table">110</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libjpeg.so.8</p></td>
<td align="left" valign="top"><p class="table">109</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgnutls.so.26</p></td>
<td align="left" valign="top"><p class="table">105</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libcap.so.2</p></td>
<td align="left" valign="top"><p class="table">105</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libogg.so.0</p></td>
<td align="left" valign="top"><p class="table">95</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libcairo-gobject.so.2</p></td>
<td align="left" valign="top"><p class="table">94</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libxkbcommon.so.0</p></td>
<td align="left" valign="top"><p class="table">93</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libwayland-cursor.so.0</p></td>
<td align="left" valign="top"><p class="table">93</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libvorbis.so.0</p></td>
<td align="left" valign="top"><p class="table">92</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgdk-3.so.0</p></td>
<td align="left" valign="top"><p class="table">92</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libkpathsea.so.6</p></td>
<td align="left" valign="top"><p class="table">91</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libgtk-3.so.0</p></td>
<td align="left" valign="top"><p class="table">91</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libatspi.so.0</p></td>
<td align="left" valign="top"><p class="table">91</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libatk-bridge-2.0.so.0</p></td>
<td align="left" valign="top"><p class="table">91</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libutil.so.1</p></td>
<td align="left" valign="top"><p class="table">89</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libsqlite3.so.0</p></td>
<td align="left" valign="top"><p class="table">84</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libnsl.so.1</p></td>
<td align="left" valign="top"><p class="table">82</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libtiff.so.5</p></td>
<td align="left" valign="top"><p class="table">75</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libjbig.so.0</p></td>
<td align="left" valign="top"><p class="table">75</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">libwrap.so.0</p></td>
<td align="left" valign="top"><p class="table">70</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_coding_style">Coding style</h3>
<div class="paragraph"><p>Follow the existing practice for the source.</p></div>
<div class="paragraph"><p>Osamu&#8217;s preference at this moment is as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
For this document, 4 spaces as much as possible for any codes &#8230;
</p>
</li>
<li>
<p>
C and alike: normally Linux-style hardtab. (ts=8 noet)
</p>
</li>
<li>
<p>
Python: 4 spaces (<a href="http://www.python.org/dev/peps/pep-0008/">The official indentation rule for Python</a>, ts=4 sts=4 et)
</p>
</li>
<li>
<p>
Other scripts: also 4 spaces or hardtab. (ts=4 sts=4 et/ts=8 noet)
</p>
</li>
<li>
<p>
Lua: Language tutorial uses 2 spaces &#8230; but sometimes hardtab
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_c_coding_style">C coding style</h4>
<div class="paragraph"><p>There are 2 major practices for the C coding style.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Indent_style#K.26R_style">K&amp;R style</a>
</p>
</li>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Indent_style#GNU_style">GNU style</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>There are many variants in use.</p></div>
<div class="ulist"><ul>
<li>
<p>
K: <a href="http://www.kernel.org/doc/Documentation/CodingStyle">Linux kernel coding style</a> (system&#8201;&#8212;&#8201;K&amp;R)
</p>
</li>
<li>
<p>
B: <a href="http://git.busybox.net/busybox/tree/docs/style-guide.txt">Busybox Style Guide</a> (command line tool&#8201;&#8212;&#8201;K&amp;R)
</p>
</li>
<li>
<p>
G: <a href="http://git.gnome.org/browse/gtk+/plain/docs/CODING-STYLE">GTK+ Coding Style</a> (GUI tool&#8201;&#8212;&#8201;GNU)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here are summary of the K&amp;R styles.</p></div>
<div class="ulist"><ul>
<li>
<p>
Keep it simple, Stupid! (KISS)
</p>
</li>
<li>
<p>
Indentation and line style
</p>
<div class="ulist"><ul>
<li>
<p>
Use tab for indentation.
</p>
<div class="ulist"><ul>
<li>
<p>
K: Use "<code>set tabstop=8 noexpandtab shiftwidth=8 textwidth=78</code>" but do not use vi modeline in the code.
  (For more: <a href="http://www.jukie.net/bart/blog/vim-and-linux-coding-style">http://www.jukie.net/bart/blog/vim-and-linux-coding-style</a>)
</p>
</li>
<li>
<p>
B: Use vi modeline "<code>vi: set sw=4 ts=4:</code>" in the code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Opening brace is at the last on the line with a preceding space (except for function)
</p>
<div class="ulist"><ul>
<li>
<p>
K: Do not unnecessarily use braces where a single statement will do.
</p>
</li>
<li>
<p>
B: Use braces even for a single statement. (The "bracketless" approach is error prone.)
</p>
</li>
<li>
<p>
"opening word"&#8201;&#8212;&#8201;"<code>switch</code>"&#8201;&#8212;&#8201;"<code>case ...:</code>"&#8201;&#8212;&#8201;"<code>default:</code>"&#8201;&#8212;&#8201;"<code>}</code>" in the same tabstop.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Space:
</p>
<div class="ulist"><ul>
<li>
<p>
No spaces used for indentation outside of comments and documentation.
</p>
</li>
<li>
<p>
No spaces between function and its argument.
</p>
</li>
<li>
<p>
No spaces between function like (pointer/address/type/size) operator and operand:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>sizeof  typeof  alignof  __attribute__  defined &amp;  * . -&gt;</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
No spaces between unary operators and its operand:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>+  -  ~  !  ++  --</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
No spaces (inside) parenthesized expressions.
</p>
</li>
<li>
<p>
A space after (most) keywords:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>if switch case for do while</code> &#8230;
</p>
</li>
</ul></div>
</li>
<li>
<p>
A space around (most) binary and ternary operators:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>=  +  -  &lt;  &gt;  *  /  %  |  &amp;  ^  &lt;=  &gt;=  ==  !=  ?  :</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
No trailing whitespaces.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Names:
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>GLOBAL</strong> variables: descriptive, lowercase with <code>_</code>, no encoding of type.
</p>
</li>
<li>
<p>
<strong>LOCAL</strong> variables: short and to the point, lowercase.
</p>
</li>
<li>
<p>
<strong>MACRO</strong> constants: all uppercase
</p>
</li>
</ul></div>
</li>
<li>
<p>
K: Function code length should be 2 screens or less.
</p>
</li>
<li>
<p>
K: Comment on <strong>WHAT</strong> but never explain <strong>WHY</strong> with <code>/* ... */</code>
</p>
</li>
<li>
<p>
B: Comment before the logical block.
</p>
</li>
<li>
<p>
K: Functions return values:
</p>
<div class="ulist"><ul>
<li>
<p>
Action function: add_work()
</p>
<div class="ulist"><ul>
<li>
<p>
&#8658; return error code integer: (non-zero = failure, 0 = success)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Predicate function: pci_dev_present()
</p>
<div class="ulist"><ul>
<li>
<p>
&#8658; return boolean: (0 = failure, non-zero = success)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Do not use pre-ANSI function declaration.
</p>
</li>
</ul></div>
<div class="paragraph"><p>See also <a href="http://www.teamten.com/lawrence/style/notes.html">Notes on Programming
Practices</a> by Lawrence Kesteloot for some detail C style examples.</p></div>
<div class="ulist"><ul>
<li>
<p>
Some style avoids the use of <a href="https://live.gnome.org/GTK+/BestPractices">C99 style line comment</a> preceded by "<code>//</code>" for compatibility.
</p>
</li>
<li>
<p>
Some style promotes the use of C99 style <a href="http://www.greenend.org.uk/rjk/tech/inline.html">inline functions in C</a> over macro.
</p>
</li>
<li>
<p>
Some style promotes the use of "<code>enum { VAR = VALUE };</code>" or C99 style "<code>const &lt;type&gt; var = value;</code>" over macro "<code>#define VAR VALUE</code>".
</p>
</li>
<li>
<p>
GNU style uses <a href="http://www.gnu.org/prep/standards/standards.html#Writing-C">GNU Coding Standards: Formatting Your Source Code</a> which is significantly different from K&amp;R such as indentation with 2 spaces etc.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_naming_conventions">Naming conventions</h4>
<div class="paragraph"><p>Basic naming convention used in C is:</p></div>
<div class="ulist"><ul>
<li>
<p>
normal identifiers: <code>lowercase</code>, <code>lower_case</code>, &#8230;
</p>
<div class="ulist"><ul>
<li>
<p>
integer temporary variables: <code>i</code>, <code>j</code>, <code>k</code>, <code>m</code>, <code>n</code>, &#8230;
</p>
</li>
<li>
<p>
character temporary variables: <code>c</code>, <code>d</code>, <code>e</code>, &#8230;
</p>
</li>
<li>
<p>
macro names: <code>UPPERCASE</code>, <code>UPPER_CASE</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
system reserved identifiers: <code>__???</code>, <code>_Uppercase</code>, <code>???__</code>, <code>__???__</code>, &#8230;
</p>
</li>
</ul></div>
<div class="paragraph"><p>For many object oriented languages,
<a href="http://en.wikipedia.org/wiki/CamelCase">CamelCase</a> naming convention is
introduced to differentiate between class name and class instance name.</p></div>
<div class="ulist"><ul>
<li>
<p>
class, interfaces, enums: <code>UpperCamelCase</code>
</p>
</li>
<li>
<p>
methods,  local variables, fields:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>lowerCamelCase</code> : Java, JavaScript, <a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml?showone=Type_Names#Type_Names">C++ (Google)</a>, &#8230;
</p>
</li>
<li>
<p>
<code>lower_case</code> : Python, Ruby, Vala, Lua, &#8230;
</p>
</li>
</ul></div>
</li>
<li>
<p>
constant: <code>UPPER_CASE</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <a href="http://en.wikipedia.org/wiki/Hungarian_notation">Hungarian Notation</a>
especially Systems Hungarian which encodes the physical data type into prefix is
deplored.  There are <a href="http://www.joelonsoftware.com/articles/Wrong.html">some
defense to Apps Hungarian which encodes the logical data type into prefix</a>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.ibm.com/developerworks/java/library/j-noaccent/index.html">Speaking the Java language without an accent</a> (IBM DW, Jan. 2010)
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_reformat">Reformat</h4>
<div class="paragraph"><p>Reformat source with <code>indent</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ indent -linux foo.c</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
-linux : Linux
</p>
</li>
<li>
<p>
-kr    : K&amp;R coding style
</p>
</li>
<li>
<p>
-gnu   : GNU coding style
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_document_style">Document style</h3>
<div class="sect3">
<h4 id="_gnome_2">GNOME</h4>
<div class="paragraph"><p>There are four golden rules:</p></div>
<div class="ulist"><ul>
<li>
<p>
Limit each sentence to less than 25 words.
</p>
</li>
<li>
<p>
Limit each paragraph to one topic.
</p>
</li>
<li>
<p>
Provide instructions rather than descriptions.
</p>
</li>
<li>
<p>
Write in a neutral tone.
</p>
</li>
</ul></div>
<div class="paragraph"><p>See more at
<a href="http://developer.gnome.org/gdp-style-guide/stable/">GNOME Documentation Style Guide</a>
and
<a href="http://developer.gnome.org/gdp-handbook/stable/">GDP Documentation Guidelines</a> .</p></div>
</div>
<div class="sect3">
<h4 id="_suse">SUSE</h4>
<div class="paragraph"><p>See
<a href="http://doc.opensuse.org/products/opensuse/Styleguide/opensuse_documentation_styleguide_sd/">Documentation Style Guide</a> .</p></div>
</div>
<div class="sect3">
<h4 id="_gnu">GNU</h4>
<div class="paragraph"><p>See
<a href="http://www.fsf.org/licensing/gnu-press/GNU-Press-styleguide.pdf">A Style Guide for GNU Documentation (PDF)</a> .</p></div>
</div>
<div class="sect3">
<h4 id="_ec">EC</h4>
<div class="paragraph"><p>European Commission recommends in
<a href="http://ec.europa.eu/translation/english/guidelines/documents/styleguide_english_dgt_en.pdf">How to write clearly (PDF)</a>
(<a href="http://www.fjfhs.eu/">HTML</a>) as:</p></div>
<div class="ulist"><ul>
<li>
<p>
Think before you write
</p>
</li>
<li>
<p>
Focus on the reader  be direct and interesting
</p>
</li>
<li>
<p>
Get your document into shape
</p>
</li>
<li>
<p>
KISS: Keep It Short and Simple
</p>
</li>
<li>
<p>
Make sense  structure your sentences
</p>
</li>
<li>
<p>
Cut out excess nouns  verb forms are livelier
</p>
</li>
<li>
<p>
Be concrete, not abstract
</p>
</li>
<li>
<p>
Prefer active verbs to passive  and name the agent
</p>
</li>
<li>
<p>
Beware of false friends, jargon and abbreviations
</p>
</li>
<li>
<p>
Revise and check
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_wikipedia">Wikipedia</h4>
<div class="paragraph"><p>See
<a href="http://en.wikipedia.org/wiki/List_of_style_guides">Wikipedia: List of style guides</a> .</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_utilities">Utilities</h3>
<div class="paragraph"><p>Here is a list of basic utilities used for the programming.</p></div>
<div class="paragraph"><p>You can find usage examples for the commands in this document if their lines are ending with *.</p></div>
<div class="ulist"><ul>
<li>
<p>
POSIX shell (<code>dash</code> package) See <a href="http://www.debian.org/doc/manuals/debian-reference/ch12.en.html#_the_shell_script">Debain Reference</a>
</p>
</li>
<li>
<p>
GNU make (<code>make</code> package) See <a href="http://www.debian.org/doc/manuals/debian-reference/ch12.en.html#_make">Debain Reference</a>
</p>
</li>
<li>
<p>
GNU C compiler (<code>gcc</code> package) *
</p>
<div class="ulist"><ul>
<li>
<p>
See the <code>gccintro</code> package containing "Introduction to GCC by Brian J. Gough": <code>apt-get install gccintro</code> (non-free GFDL package)
</p>
</li>
</ul></div>
</li>
<li>
<p>
GNU C++ compiler (<code>g++</code> package) *
</p>
</li>
<li>
<p>
GNU Debugger (<code>gdb</code> package) *
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gdb -tui</code>: Run GDB with TUI (full screen mode)
</p>
</li>
<li>
<p>
<code>ddd</code> package: The Data Display Debugger, a graphical debugger frontend
</p>
</li>
</ul></div>
</li>
<li>
<p>
GNU assembler, linker and binary utilities (<code>binutils</code> package) *
</p>
<div class="ulist"><ul>
<li>
<p>
<code>readelf</code> - Displays information about ELF files.
</p>
</li>
<li>
<p>
<code>objdump</code> - Display information from object files.
</p>
<div class="ulist"><ul>
<li>
<p>
Use this with <code>--demangle</code> for C++.
</p>
</li>
<li>
<p>
Use this with <code>--disassemble</code> to disassemble code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>nm</code> - List symbols from object files.
</p>
<div class="ulist"><ul>
<li>
<p>
Use this with <code>--demangle</code> for C++.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>c++filt</code> - Demangle C++ and Java symbols. *
</p>
<div class="ulist"><ul>
<li>
<p>
This is useful for studying compilation results in assembly codes or ELF binaries.
</p>
</li>
<li>
<p>
Use <code>abi::__cxa_demangle()</code> in C++ source as <a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/ext_demangling.html">The GNU C++ Library Manual, Chapter 29. Demangling</a>.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>addr2line</code> - Convert addresses into file names and line numbers.
</p>
</li>
<li>
<p>
<code>ar</code> - Create, modify, and extract from archives.
</p>
</li>
<li>
<p>
<code>ranlib</code> - Generate index to archive.
</p>
</li>
<li>
<p>
<code>gprof</code> - Display call graph <a href="http://en.wikipedia.org/wiki/Profiling_(computer_programming)">profile</a> data.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.ibm.com/developerworks/library/l-gnuprof.html">Speed your code with the GNU profiler</a> IBM DeveloperWorks (2006)
</p>
</li>
<li>
<p>
<a href="http://sam.zoy.org/writings/programming/gprof.html">HOWTO: using gprof with multithreaded applications</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Embedded GNU C Library: Binaries (<code>libc-bin</code> package)
</p>
<div class="ulist"><ul>
<li>
<p>
<code>ldd</code> - Print shared library dependencies *
</p>
</li>
<li>
<p>
<code>iconv</code> - Convert encoding of given files from one encoding to another See <a href="http://www.debian.org/doc/manuals/debian-reference/ch11.en.html#_text_data_conversion_tools">Debain Reference</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>perf</code> - performance analysis tools for Linux (<code>linux-base</code> package) *
</p>
<div class="ulist"><ul>
<li>
<p>
See <a href="http://www.eece.maine.edu/~vweaver/projects/perf_events/">The Unofficial Linux Perf Events Web-Page</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Remove cpp <code>#ifdef</code> lines from files (<code>unifdef</code> package) *
</p>
<div class="ulist"><ul>
<li>
<p>
<code>unifdef</code>, <code>unifdefall</code>  Remove preprocessor conditionals from code
</p>
<div class="ulist"><ul>
<li>
<p>
This is useful for avoiding distractions when studying code.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Utility to list open files (<code>lsof</code> package)
</p>
<div class="ulist"><ul>
<li>
<p>
<code>lsof</code>   - List open files
</p>
</li>
</ul></div>
</li>
<li>
<p>
Utility for <a href="http://en.wikipedia.org/wiki/Memory_debugger">memory debugger</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<code>gcc</code> with <code>-fstack-protector</code> - Stack smashing protector (SSP) *
</p>
</li>
<li>
<p>
<code>valgrind</code> package - A suite of tools for debugging and profiling programs
</p>
</li>
<li>
<p>
<code>alleyoop</code> package - Valgrind memory checker front-end for GNOME
</p>
</li>
<li>
<p>
<code>electric-fence</code> package - Library to detect buffer overruns and under-runs
</p>
<div class="ulist"><ul>
<li>
<p>
a memory-usage debugger for C programs
</p>
</li>
<li>
<p>
<code>LD_PRELOAD=/path/to/libefence.so.0.0  your-buggy-program</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>duma</code> pckage - A fork of <code>electric-fence</code> with more features
</p>
<div class="ulist"><ul>
<li>
<p>
a memory-usage debugger for C/C++ programs
</p>
</li>
<li>
<p>
<code>LD_PRELOAD=/path/to/libefence.so.0.0  your-buggy-program</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>leaktracer</code> package - Simple and efficient memory-leak tracer for C++ programs
</p>
<div class="ulist"><ul>
<li>
<p>
<code>LeakCheck</code> <code>leak-analyze</code> - A memory-usage debugger for C++ programs
</p>
</li>
<li>
<p>
<code>LD_PRELOAD=/path/to/LeakTracer.so your-buggy-program</code>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>libdmalloc-dev</code> package - Debug memory allocation library (development files and doc)
</p>
<div class="ulist"><ul>
<li>
<p>
Drop in replacement for the system&#8217;s <code>malloc</code>, <code>realloc</code>, <code>calloc</code>, <code>free</code> and other memory management routines.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Utility to trace calls etc. like <a href="http://en.wikipedia.org/wiki/Strace">strace</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<code>strace</code> - Trace system calls and signals *
</p>
</li>
<li>
<p>
<code>ltrace</code> - A library call tracer *
</p>
</li>
<li>
<p>
<code>xtrace</code> - Trace communication between X11 client and server
</p>
</li>
</ul></div>
</li>
<li>
<p>
Utility to <a href="http://en.wikipedia.org/wiki/Static_code_analysis">analyze code statically</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<code>pylint</code> - Python code static checker
</p>
</li>
<li>
<p>
<code>splint</code> - A tool for statically checking C programs
</p>
</li>
<li>
<p>
<code>cppcheck</code> - Tool for static C/C++ code analysis
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_vim_basics">Vim basics</h3>
<div class="paragraph"><p>Learning and practice!</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>vimtutor</code>
</p>
</li>
<li>
<p>
<code>vim +help +only</code>
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">~/.vimrc as:</div>
<div class="content">
<pre><code>set nocompatible
set nopaste
set pastetoggle=&lt;f2&gt;
set syntax=ON
" Use secure modeline plug-in
set nomodeline
if $USER == "root"
 set noswapfile
else
 set swapfile
endif
" filler to avoid the line above being recognized as a modeline
" filler
" filler</code></pre>
</div></div>
<div class="paragraph"><p>Learn additional basics:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 17. Additional vim commands (normal mode)</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">command              </th>
<th align="left" valign="top"> meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">:set tw=79</p></td>
<td align="left" valign="top"><p class="table">textwidth to 79</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set tw=0</p></td>
<td align="left" valign="top"><p class="table">no textwidth</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set ai</p></td>
<td align="left" valign="top"><p class="table">autoindent == copy indent   (non program)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set noai</p></td>
<td align="left" valign="top"><p class="table">no autoindent</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set cin</p></td>
<td align="left" valign="top"><p class="table">cindent    == C-like indent (K&amp;R/Linux)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set nocin</p></td>
<td align="left" valign="top"><p class="table">no cindent</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set ts=8 sts=4 et</p></td>
<td align="left" valign="top"><p class="table">C (K&amp;R style tabstop)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set ts=8 sts=0 noet</p></td>
<td align="left" valign="top"><p class="table">C (Linux style tabstop)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set ts=8 sts=4 et</p></td>
<td align="left" valign="top"><p class="table">python (PEP-8 style tabstop)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set syntax=ON</p></td>
<td align="left" valign="top"><p class="table">syntax highlighting ON based on filetype</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set syntax=OFF</p></td>
<td align="left" valign="top"><p class="table">syntax highlighting OFF</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^Y</p></td>
<td align="left" valign="top"><p class="table">1 line screen up (yank one line)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^E</p></td>
<td align="left" valign="top"><p class="table">1 line screen down (extra line)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^U</p></td>
<td align="left" valign="top"><p class="table">1/2 page screen up (up)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^D</p></td>
<td align="left" valign="top"><p class="table">1/2 page screen down (down)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^B</p></td>
<td align="left" valign="top"><p class="table">1 page screen up (backward)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^F</p></td>
<td align="left" valign="top"><p class="table">1 page screen down (forward)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">v</p></td>
<td align="left" valign="top"><p class="table">visual mode start for character select</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">V</p></td>
<td align="left" valign="top"><p class="table">visual mode start for line select</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">^V</p></td>
<td align="left" valign="top"><p class="table">visual mode start for column select</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set fdm=manual</p></td>
<td align="left" valign="top"><p class="table">foldmethod manual</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set fdm=indent</p></td>
<td align="left" valign="top"><p class="table">foldmethod indent</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:set fdm=syntax</p></td>
<td align="left" valign="top"><p class="table">foldmethod syntax</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zc</p></td>
<td align="left" valign="top"><p class="table">fold close for the current line</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zC</p></td>
<td align="left" valign="top"><p class="table">fold close for the current line (recursive)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zo</p></td>
<td align="left" valign="top"><p class="table">fold open for the current line</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zO</p></td>
<td align="left" valign="top"><p class="table">fold open for the current line (recursive)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zm</p></td>
<td align="left" valign="top"><p class="table">fold more for the current document</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zM</p></td>
<td align="left" valign="top"><p class="table">fold more for the current document (recursive)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zr</p></td>
<td align="left" valign="top"><p class="table">fold reduce for the current document</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">zR</p></td>
<td align="left" valign="top"><p class="table">fold reduce for the current document (recursive)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">K</p></td>
<td align="left" valign="top"><p class="table">run man command on cursor</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">{Visual}=</p></td>
<td align="left" valign="top"><p class="table">indent selected range</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:! &lt;command&gt;</p></td>
<td align="left" valign="top"><p class="table">run &lt;command&gt;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">:r! &lt;command&gt;</p></td>
<td align="left" valign="top"><p class="table">run &lt;command&gt; and read</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">{Visual}! &lt;command&gt;</p></td>
<td align="left" valign="top"><p class="table">run filter &lt;command&gt; for visual mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>For more, read vim help pages.  I find followings especially interesting.</p></div>
<div class="ulist"><ul>
<li>
<p>
|repeat.txt|    repeating commands, Vim scripts and debugging
</p>
</li>
<li>
<p>
|recover.txt|   recovering from a crash
</p>
</li>
<li>
<p>
|tagsrch.txt|   tags and special searches
</p>
</li>
<li>
<p>
|quickfix.txt|  commands for a quick edit-compile-fix cycle
</p>
</li>
<li>
<p>
|windows.txt|   commands for using multiple windows and buffers
</p>
</li>
<li>
<p>
|tabpage.txt|   commands for using multiple tab pages
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_language_basics">Language basics</h3>
<div class="paragraph"><p>See <a href="http://en.wikipedia.org/wiki/Comparison_of_programming_languages_(syntax)">Wikipedia article on programing language</a>.</p></div>
<div class="paragraph"><p>Please note this may be inaccurate.</p></div>
<div class="ulist"><ul>
<li>
<p>
statement
</p>
<div class="ulist"><ul>
<li>
<p>
<code>;</code> as statement terminator: C, C++, Java, Vala, &#8230;
</p>
</li>
<li>
<p>
<code>;</code> as statement separator: Perl, Pascal, PL/I, SQL, &#8230;
</p>
</li>
<li>
<p>
EOL as statement terminator: Python
</p>
</li>
<li>
<p>
<code>;</code> or EOL as statement terminator: Shell
</p>
</li>
<li>
<p>
<code>;</code> as NOP statement: Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
block statement
</p>
<div class="ulist"><ul>
<li>
<p>
<code>{</code> <code>statement...</code> <code>}</code> : C, C++, Java, Vala, Perl, Shell, Lua, &#8230;
</p>
</li>
<li>
<p>
<code>BEGIN</code> <code>statement...</code> <code>END</code> : Pascal
</p>
</li>
<li>
<p>
indented block : Python
</p>
</li>
</ul></div>
</li>
<li>
<p>
comment
</p>
<div class="ulist"><ul>
<li>
<p>
<code>/* ... */</code> or <code>// ...</code> : C, C++, Java, Vala
</p>
</li>
<li>
<p>
<code># ...</code> : Perl, Python, Shell
</p>
</li>
<li>
<p>
<code>-- ...</code> or <code>--[[ ... ]]</code>: Lua (line and block comment)
</p>
</li>
</ul></div>
</li>
<li>
<p>
character constant
</p>
<div class="ulist"><ul>
<li>
<p>
<code>'a'</code>: C, C++
</p>
</li>
</ul></div>
</li>
<li>
<p>
string
</p>
<div class="ulist"><ul>
<li>
<p>
<code>"abcdef"</code> : C, C++, Vala, Python, Perl, Lua; Shell(subst)
</p>
</li>
<li>
<p>
<code>'abcdef'</code> : Python, Perl, Lua; Shell(non-subst.)
</p>
</li>
<li>
<p>
<code>"""abcdef"""</code> : Vala, Python (string literals that span multiple lines)
</p>
</li>
<li>
<p>
<code>[==[abcdef]==]</code> : Lua (string literals that span multiple lines)
</p>
</li>
</ul></div>
</li>
<li>
<p>
string concatenate operator
</p>
<div class="ulist"><ul>
<li>
<p>
<code>.</code> : Perl
</p>
</li>
<li>
<p>
<code>..</code> : Lua
</p>
</li>
<li>
<p>
<code>+</code> : Vala, Python, Pascal
</p>
</li>
<li>
<p>
put together side by side: Shell
</p>
</li>
<li>
<p>
call some function: C (think about glib)
</p>
</li>
</ul></div>
</li>
<li>
<p>
modulo
</p>
<div class="ulist"><ul>
<li>
<p>
<code>%</code> : C, C++, Vala, Python, Perl, Lua
</p>
</li>
<li>
<p>
<code>mod</code> : Pascal
</p>
</li>
</ul></div>
</li>
<li>
<p>
floor
</p>
<div class="ulist"><ul>
<li>
<p>
<code>//</code> : Python
</p>
</li>
<li>
<p>
<code>div</code> : Pascal
</p>
</li>
</ul></div>
</li>
<li>
<p>
power operator
</p>
<div class="ulist"><ul>
<li>
<p>
<code>**</code> : Python, Perl
</p>
</li>
<li>
<p>
<code>^</code> : Lua
</p>
</li>
<li>
<p>
use <code>pow(...)</code> function : C, C++, Vala
</p>
</li>
</ul></div>
</li>
<li>
<p>
bit not operator
</p>
<div class="ulist"><ul>
<li>
<p>
<code>~</code> : C, C++, Vala, Python, Perl
</p>
</li>
</ul></div>
</li>
<li>
<p>
bit or operator:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>|</code> : C, C++, Vala, Python, Perl
</p>
</li>
</ul></div>
</li>
<li>
<p>
bit and operator:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>&amp;</code> : C, C++, Vala, Python, Perl
</p>
</li>
</ul></div>
</li>
<li>
<p>
bit exclusive-or operator:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>^</code> : C, C++, Vala, Python, Perl
</p>
</li>
</ul></div>
</li>
<li>
<p>
logical not operator
</p>
<div class="ulist"><ul>
<li>
<p>
<code>!</code> : C, C++, Vala, Shell, Perl
</p>
</li>
<li>
<p>
<code>not</code> : Python, Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
logical or operator:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>|</code> : Python
</p>
</li>
<li>
<p>
<code>||</code> : C, C++, Vala, Perl, Shell
</p>
</li>
<li>
<p>
<code>or</code> : Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
logical or operator:
</p>
<div class="ulist"><ul>
<li>
<p>
<code>&amp;</code> : Python
</p>
</li>
<li>
<p>
<code>&amp;&amp;</code> : C, C++, Vala, Perl, Shell
</p>
</li>
<li>
<p>
<code>and</code> : Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>if</code>&#8201;&#8212;&#8201;triple choices as example
</p>
<div class="ulist"><ul>
<li>
<p>
<code>if</code> <code>(...)</code> <code>{</code> <code>statement...</code> <code>}</code> <code>else</code> <code>if</code> <code>(...)</code> <code>{</code> <code>statement...</code> <code>}</code> <code>else</code> <code>{</code> <code>statement...</code> <code>}</code> : C, C++, Vala, Java
</p>
</li>
<li>
<p>
<code>if</code> <code>...:</code> <code>statement...</code> <code>elif</code> <code>...:</code> <code>statement...</code> <code>else:</code> <code>statement...</code> : Python (multilined and indented)
</p>
</li>
<li>
<p>
<code>if</code> <code>(...)</code> <code>{</code> <code>statement...</code> <code>}</code> <code>elsif</code> <code>(...)</code> <code>{</code> <code>statement...</code> <code>}</code> <code>else</code> <code>{</code> <code>statement...</code> <code>}</code> : Perl
</p>
</li>
<li>
<p>
<code>if</code> <code>...</code> <code>then</code> <code>statement...</code> <code>elseif</code> <code>...</code> <code>then</code> <code>statement...</code> <code>else</code> <code>statement...</code> <code>end</code> : Lua
</p>
</li>
<li>
<p>
<code>if</code> <code>[...];</code> <code>then</code> <code>statement; ...</code> <code>elif</code> <code>[...]</code> <code>;</code> <code>statement; ...</code> <code>else</code> <code>statement; ...</code> <code>fi</code> : Shell
</p>
</li>
</ul></div>
</li>
<li>
<p>
for&#8201;&#8212;&#8201;indexed loop
</p>
<div class="ulist"><ul>
<li>
<p>
<code>for (i = 1; i &lt;= n; i++)</code> <code>{</code> <code>statement...</code> <code>}</code> : C, C++, Vala, Java
</p>
</li>
<li>
<p>
<code>for i in range(1,n):</code> <code>statement...</code> : Python (multilined and indented)
</p>
</li>
<li>
<p>
<code>for ($i = 1; $i &lt;= $n; $i++)</code> <code>{</code> <code>statement...</code> <code>}</code> : Perl
</p>
</li>
<li>
<p>
<code>for i=1, n, 1</code> <code>do</code> <code>statement...</code> <code>end</code> : Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
foreach&#8201;&#8212;&#8201;iterator loop
</p>
<div class="ulist"><ul>
<li>
<p>
<code>for (type &amp;i : items)</code> <code>{</code> <code>statement...</code> <code>}</code> : C++11
</p>
</li>
<li>
<p>
<code>foreach (type i in items)</code> <code>{</code> <code>statement...</code> <code>}</code> : Vala
</p>
</li>
<li>
<p>
<code>for (type i : items)</code> <code>{</code> <code>statement...</code> <code>}</code> : Java
</p>
</li>
<li>
<p>
<code>for i in items:</code> <code>statement...</code> : Python (multilined and indented)
</p>
</li>
<li>
<p>
<code>foreach $i (@items)</code> <code>{</code> <code>statement...</code> <code>}</code> : Perl
</p>
</li>
<li>
<p>
<code>for i in items ... ;</code> <code>do</code> <code>statement; ...</code> <code>done</code> : Shell
</p>
</li>
</ul></div>
</li>
<li>
<p>
while loop
</p>
<div class="ulist"><ul>
<li>
<p>
<code>while</code> <code>(loop_true)</code> <code>{</code> <code>statement...</code> <code>}</code> : C, C++, Vala, Java, Perl
</p>
</li>
<li>
<p>
<code>while</code> <code>loop_true:</code> <code>statement...</code> : Python (multilined and indented)
</p>
</li>
<li>
<p>
<code>while</code> <code>(loop_true)</code> <code>do</code> <code>statement...</code> <code>end</code> : Lua
</p>
</li>
<li>
<p>
<code>while</code> <code>[...];</code> <code>do</code> <code>statement; ...</code> <code>done</code> : Shell
</p>
</li>
</ul></div>
</li>
<li>
<p>
do while loop
</p>
<div class="ulist"><ul>
<li>
<p>
<code>do</code> <code>{</code> <code>statement...</code> <code>}</code> <code>while</code> <code>(loop_true)</code> <code>;</code> : C, C++, Vala, Java, Perl
</p>
</li>
<li>
<p>
<code>while true:</code> <code>statement...</code> <code>if</code> <code>!</code> <code>loop_true:</code> <code>break</code> : Python (multilined and indented)
</p>
</li>
<li>
<p>
<code>repeat</code> <code>statement...</code> <code>until</code> <code>!</code> <code>loop_true</code> : Lua
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>break</code>
</p>
<div class="ulist"><ul>
<li>
<p>
supported : C, C++, Vala, Java, Python, Lua, Shell
</p>
</li>
<li>
<p>
Instead, use <code>last</code>: Perl
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>continue</code>
</p>
<div class="ulist"><ul>
<li>
<p>
supported : C, C++, Vala, Java, Python, Shell
</p>
</li>
<li>
<p>
Instead, use <code>next</code>: Perl
</p>
</li>
<li>
<p>
NOT supported : Lua (Use <code>if</code> to skip the rest.)
</p>
</li>
</ul></div>
</li>
<li>
<p>
<code>return</code>
</p>
<div class="ulist"><ul>
<li>
<p>
supported : C, C++, Vala, Java, Python, Lua, Shell
</p>
</li>
</ul></div>
</li>
<li>
<p>
multiple branching
</p>
<div class="ulist"><ul>
<li>
<p>
<code>switch(c)</code> <code>{</code> <code>case 'a':</code> statement&#8230; <code>break;</code> <code>default:</code> <code>statement...</code> <code>}</code> : C, C++, Vala, Java
</p>
</li>
<li>
<p>
<code>case</code> <code>$x</code> <code>in</code> <code>a)</code> <code>statement;...</code> <code>;;</code> <code>?)</code> <code>statement;...</code> <code>;;</code> <code>esac</code> : Shell
</p>
</li>
<li>
<p>
NOT supported.  Use <code>if ...</code>: Perl, Python, Lua
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Both <code>return</code> and <code>exit</code> are used for similar purposes for many languages.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>C</strong> : <code>exit</code> is a function in the <code>libc</code> library.
</p>
<div class="ulist"><ul>
<li>
<p>
when <code>exit</code> is called, it <strong>terminates</strong> the process.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>C</strong> : <code>return</code> is a reserved keyword of the C language.
</p>
<div class="ulist"><ul>
<li>
<p>
when <code>return</code> is in the <code>main()</code> function, it <strong>terminates</strong> the process.
</p>
</li>
<li>
<p>
when <code>return</code> is not in the <code>main()</code> function, it <strong>returns</strong> to the calling function code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Shell</strong> : <code>exit</code> is a builtin.
</p>
<div class="ulist"><ul>
<li>
<p>
when <code>exit</code> is called, it <strong>terminates</strong> the shell code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
<strong>Shell</strong> : <code>return</code> is a builtin.
</p>
<div class="ulist"><ul>
<li>
<p>
when <code>return</code> is in the main shell code, it <strong>terminates</strong> the main shell code.
</p>
</li>
<li>
<p>
when <code>return</code> is in the block code <code>{ ...; }</code>, it <strong>terminates</strong> the main shell code.
</p>
</li>
<li>
<p>
when <code>return</code> is in the subshell <code>( ...; )</code>, it <strong>returns</strong> to the main shell code.
</p>
</li>
<li>
<p>
when <code>return</code> is in the sourced file, it <strong>returns</strong> to the sourcing shell code.
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>For the C++ language, you need to be careful uing <code>exit</code> in <code>main()</code> since no
destructor will be called for the locally scoped objects for <code>exit</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_c_language">C Language</h3>
<div class="paragraph"><p>Except for some functional languages such as
<a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a>, many
procedual languages share quite a bit of similarities.
<a href="http://en.wikipedia.org/wiki/C_(programming_language)">C language</a> is a good
start in terms of its gramatical simplicity.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 18. Program control sequence keywords</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">C syntax       </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>expression;</code></p></td>
<td align="left" valign="top"><p class="table">simple expression statement</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>{statement...}</code></p></td>
<td align="left" valign="top"><p class="table">block statement</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>if (expression) statement</code></p></td>
<td align="left" valign="top"><p class="table">conditional execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>if (expression) statement else statement</code></p></td>
<td align="left" valign="top"><p class="table">conditional executions</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>switch (expression) {case const-express: {statement... break;}... default: statement}</code></p></td>
<td align="left" valign="top"><p class="table">conditional branch execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>while (expression) statement</code></p></td>
<td align="left" valign="top"><p class="table">conditional loop execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>do statement while (expression);</code></p></td>
<td align="left" valign="top"><p class="table">conditional loop execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>for (i = 0; i++; i &lt; n) statement</code></p></td>
<td align="left" valign="top"><p class="table">conditional loop execution i = 0, 1, 2, &#8230;, n-1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>return expression;</code></p></td>
<td align="left" valign="top"><p class="table">return by exiting function</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>continue;</code></p></td>
<td align="left" valign="top"><p class="table">continue to the next loop execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>break;</code></p></td>
<td align="left" valign="top"><p class="table">break out of the loop/switch execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>goto identifier</code></p></td>
<td align="left" valign="top"><p class="table">goto identifier label in the current function</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 19. Type, structure, union, storage class declarations</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">C declaration  </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>void</code></p></td>
<td align="left" valign="top"><p class="table">pointer type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>char</code></p></td>
<td align="left" valign="top"><p class="table">byte type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>int</code></p></td>
<td align="left" valign="top"><p class="table">integer type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float</code></p></td>
<td align="left" valign="top"><p class="table">single-precision floating point type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>double</code></p></td>
<td align="left" valign="top"><p class="table">double-precision floating point type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>enum</code></p></td>
<td align="left" valign="top"><p class="table">enumeration constant type</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>short</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>long</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>signed</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>unsigned</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>const</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>volatile</code></p></td>
<td align="left" valign="top"><p class="table">type qualifier</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>union</code></p></td>
<td align="left" valign="top"><p class="table">union declaration</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>struct</code></p></td>
<td align="left" valign="top"><p class="table">structure declaration</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>auto</code></p></td>
<td align="left" valign="top"><p class="table">storage class</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>register</code></p></td>
<td align="left" valign="top"><p class="table">storage class</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>static</code></p></td>
<td align="left" valign="top"><p class="table">storage class</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>extern</code></p></td>
<td align="left" valign="top"><p class="table">storage class</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>typedef</code></p></td>
<td align="left" valign="top"><p class="table">storage class</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 20. Unary operators</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">C operator     </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>-</code></p></td>
<td align="left" valign="top"><p class="table">arith. minus</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>~</code></p></td>
<td align="left" valign="top"><p class="table">bitwise not</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>++</code></p></td>
<td align="left" valign="top"><p class="table">increment.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>--</code></p></td>
<td align="left" valign="top"><p class="table">decrement.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>sizeof</code></p></td>
<td align="left" valign="top"><p class="table">object size</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>(typename)</code></p></td>
<td align="left" valign="top"><p class="table">type conversion</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>*</code></p></td>
<td align="left" valign="top"><p class="table">reference (pointer, indirection)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&amp;</code></p></td>
<td align="left" valign="top"><p class="table">dereference (pointer, address of)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 21. Binary operators</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">C operator     </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>+</code></p></td>
<td align="left" valign="top"><p class="table">arith. addition</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-</code></p></td>
<td align="left" valign="top"><p class="table">arith. substraction</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>*</code></p></td>
<td align="left" valign="top"><p class="table">arith. multiplication</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>/</code></p></td>
<td align="left" valign="top"><p class="table">arith. division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>%</code></p></td>
<td align="left" valign="top"><p class="table">arith. modulo</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&amp;</code></p></td>
<td align="left" valign="top"><p class="table">bitwise and</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>|</code></p></td>
<td align="left" valign="top"><p class="table">bitwise or</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>^</code></p></td>
<td align="left" valign="top"><p class="table">bitwise xor</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;&lt;</code></p></td>
<td align="left" valign="top"><p class="table">bitwise shiftL</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&gt;&gt;</code></p></td>
<td align="left" valign="top"><p class="table">bitwise shiftR</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>==</code></p></td>
<td align="left" valign="top"><p class="table">equal. test.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>!=</code></p></td>
<td align="left" valign="top"><p class="table">non-equal. test.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;</code></p></td>
<td align="left" valign="top"><p class="table">less than</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;=</code></p></td>
<td align="left" valign="top"><p class="table">less or equal.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&gt;</code></p></td>
<td align="left" valign="top"><p class="table">more than</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&gt;=</code></p></td>
<td align="left" valign="top"><p class="table">more or equal.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>!</code></p></td>
<td align="left" valign="top"><p class="table">bool. not</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&amp;&amp;</code></p></td>
<td align="left" valign="top"><p class="table">bool. and</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>||</code></p></td>
<td align="left" valign="top"><p class="table">bool. or</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>=</code></p></td>
<td align="left" valign="top"><p class="table">assign.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>+=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with arith. addition</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with arith. substraction</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>*=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with arith. multiplication</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>/=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with arith. division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>%=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with arith. modulo</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&amp;=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with bitwise and</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>|=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with bitwise or</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>^=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with bitwise xor</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&lt;&lt;=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with bitwise shiftL</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>&gt;&gt;=</code></p></td>
<td align="left" valign="top"><p class="table">aug. assign. with bitwise shiftR</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>.</code></p></td>
<td align="left" valign="top"><p class="table">member select. (structure)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>-&gt;</code></p></td>
<td align="left" valign="top"><p class="table">member select. (structure, pointed by parent)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>,</code></p></td>
<td align="left" valign="top"><p class="table">sequencing</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 22. Ternary and other operators</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">C operator     </th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>? :</code></p></td>
<td align="left" valign="top"><p class="table">cond. eval.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>()</code></p></td>
<td align="left" valign="top"><p class="table">subexpression grouping</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>()</code></p></td>
<td align="left" valign="top"><p class="table">calling function argument</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>[]</code></p></td>
<td align="left" valign="top"><p class="table">array subscript</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Despite its simplicity, writing good code under C is not easy. If you write C
code carelessly with fixed width character array buffers, you are sure to hit a
buffer overflow bug which is serious bug. Memory management to cope with
variable length character array buffers under C is non-trivial task.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 23. C Operator Precedence</caption>
<col width="42%" />
<col width="28%" />
<col width="14%" />
<col width="14%" />
<thead>
<tr>
<th align="left" valign="top"> operator type </th>
<th align="left" valign="top"> operator expression </th>
<th align="left" valign="top"> precidence </th>
<th align="left" valign="top"> space</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">func. operator, array operator, structure member operator</p></td>
<td align="left" valign="top"><p class="table"><code>func(...)</code> <code>array[...]</code> <code>parentptr-&gt;id</code> <code>parent.id</code></p></td>
<td align="left" valign="top"><p class="table">L &#8592; R</p></td>
<td align="left" valign="top"><p class="table">no</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix unary operator (address-of, pointer-to, plus, minus, bitwise not, logical not)</p></td>
<td align="left" valign="top"><p class="table"><code>&amp;</code> <code>*</code> <code>+</code> <code>-</code> <code>~</code> <code>!</code></p></td>
<td align="left" valign="top"><p class="table">L &#8592; R</p></td>
<td align="left" valign="top"><p class="table">no (yes before)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">binary operator (mul., div., mod.)</p></td>
<td align="left" valign="top"><p class="table"><code>*</code> <code>/</code> <code>%</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">binary operator (add, sub)</p></td>
<td align="left" valign="top"><p class="table"><code>+</code> <code>-</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">bitwise shift operator (shr, shl)</p></td>
<td align="left" valign="top"><p class="table"><code>&gt;&gt;</code> <code>&lt;&lt;</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">logical relational operator (gt,lt,ge,le)</p></td>
<td align="left" valign="top"><p class="table"><code>&gt;</code> <code>&lt;</code> <code>&gt;=</code> <code>&lt;=</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">logical equity operator (eq,ne)</p></td>
<td align="left" valign="top"><p class="table"><code>==</code> <code>!=</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">bitwise and operator (and)</p></td>
<td align="left" valign="top"><p class="table"><code>&amp;</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">bitwise xor operator (xor)</p></td>
<td align="left" valign="top"><p class="table"><code>^</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">bitwise or operator (or)</p></td>
<td align="left" valign="top"><p class="table"><code>|</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">logical and operator (and)</p></td>
<td align="left" valign="top"><p class="table"><code>&amp;&amp;</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">logical or operator (or)</p></td>
<td align="left" valign="top"><p class="table"><code>||</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">conditional operator</p></td>
<td align="left" valign="top"><p class="table"><code>? :</code></p></td>
<td align="left" valign="top"><p class="table">L &#8592; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">assignment operator</p></td>
<td align="left" valign="top"><p class="table"><code>=</code> <code>*=</code> <code>/=</code> <code>%=</code> <code>+=</code> <code>-=</code> <code>&lt;&lt;=</code> <code>&gt;&gt;=</code> <code>&amp;=</code> <code>^=</code> <code>|=</code></p></td>
<td align="left" valign="top"><p class="table">L &#8592; R</p></td>
<td align="left" valign="top"><p class="table">yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">comma operator</p></td>
<td align="left" valign="top"><p class="table"><code>,</code></p></td>
<td align="left" valign="top"><p class="table">L &#8594; R</p></td>
<td align="left" valign="top"><p class="table">no (yes for after)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Please note:</p></div>
<div class="ulist"><ul>
<li>
<p>
logical xor operator can be "<code>!a != !b</code>"
</p>
</li>
<li>
<p>
"<code>foo = *p++</code>" is "<code>foo = *(p++)</code>" or "<code>foo = *p, p++</code>". (FIXME TEST!)
</p>
</li>
<li>
<p>
"<code>int *foo()</code>" is a function "<code>foo</code>". The function returns a pointer to an integer value.  Equivalent of "<code>int *(foo())</code>".
</p>
</li>
<li>
<p>
"<code>int (*foo)()</code>" is a function "(*foo)" pointed by "<code>foo</code>".  The function returns an integer value.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_ebnf_rule">EBNF rule</h3>
<div class="paragraph"><p>Exact gramatical description can be provided using EBNF rule.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 24. EBNF rule table (several variants)</caption>
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table header">Usage</p></td>
<td align="left" valign="top"><p class="table header">Notation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">definition</p></td>
<td align="left" valign="top"><p class="table header"><code>:</code> or <code>::=</code> or <code>:=</code> or <code>=</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">concatenation</p></td>
<td align="left" valign="top"><p class="table header"><code>,</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">termination</p></td>
<td align="left" valign="top"><p class="table header"><code>;</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">alternation</p></td>
<td align="left" valign="top"><p class="table header"><code>|</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">option</p></td>
<td align="left" valign="top"><p class="table header"><code>[ ... ]</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">repetition</p></td>
<td align="left" valign="top"><p class="table header"><code>{ ... }</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">grouping</p></td>
<td align="left" valign="top"><p class="table header"><code>( ... )</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">terminal string</p></td>
<td align="left" valign="top"><p class="table header"><code>' ... '</code> or <code>" ... "</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">repeat 0 or more</p></td>
<td align="left" valign="top"><p class="table header"><code>*</code> (postfix)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">repeat 1 or more</p></td>
<td align="left" valign="top"><p class="table header"><code>+</code> (postfix)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table header">exception</p></td>
<td align="left" valign="top"><p class="table header"><code>-</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_Form">Extended BackusNaur Form</a>
</p>
</li>
<li>
<p>
<a href="http://www.w3.org/TR/REC-xml/#sec-notation">EBNF Notation used for XML definition</a>
</p>
</li>
<li>
<p>
<a href="http://www.cs.man.ac.uk/~pjj/bnf/bnf.html">Notations for context-free grammars</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_c_syntax_in_ebnf">C syntax in EBNF</h3>
<div class="listingblock">
<div class="title">C syntax in EBNF.</div>
<div class="content">
<pre><code>translation-unit        : [ translation-unit] external-decl
                        ;
external-decl           : function-definition
                        | decl
                        ;
function-definition     : [ decl-specs ] declarator [ decl-list ] compound-stat
                        ;
decl                    : decl-specs [ init-declarator-list ] ';'
                        ;
decl-list               : [ decl-list ] decl
                        ;
decl-specs              : storage-class-spec [ decl-specs ]
                        | type-spec          [ decl-specs ]
                        | type-qualifier     [ decl-specs ]
                        ;
storage-class-spec      : 'auto' | 'register' | 'static' | 'extern' | 'typedef'
                        ;
type-spec               : 'void' | 'char' | 'short' | 'int' | 'long' | 'float'
                        | 'double' | 'signed' | 'unsigned'
                        | struct-or-union-spec
                        | enum-spec
                        | typedef-name
                        ;
type-qualifier          : 'const' | 'volatile'
                        ;
struct-or-union-spec    : struct-or-union [ id ] '{' struct-decl-list '}'
                        | struct-or-union   id
                        ;
struct-or-union         : 'struct' | 'union'
                        ;
struct-decl-list        : [ struct-decl-list ] struct-decl
                        ;
init-declarator-list    : [ init-declarator-list ',' ] init-declarator
                        ;
init-declarator         : declarator [ '=' initializer ]
                        ;
struct-decl             : spec-qualifier-list struct-declarator-list ';'
                        ;
spec-qualifier-list     : type-spec      [ spec-qualifier-list ]
                        | type-qualifier [ spec-qualifier-list ]
                        ;
struct-declarator-list  : [ struct-declarator-list ',' ] struct-declarator
                        ;
struct-declarator       : declarator
                        | declarator ':' const-exp
                        |               ':' const-exp
                        ;
enum-spec               : 'enum' [ id ] '{' enumerator-list '}'
                        | 'enum' id
                        ;
enumerator-list         : [ enumerator-list ',' ] enumerator
                        ;
enumerator              : id [ '=' const-exp ]
                        ;
declarator              : [ pointer ] direct-declarator
                        ;
direct-declarator       : id
                        | '(' declarator ')'
                        | direct-declarator '[' [ const-exp ] ']'
                        | direct-declarator '(' [ param-type-list
                                                | id-list ] ')'
                        ;
pointer                 : '*' [ type-qualifier-list ] [ pointer ]
                        ;
type-qualifier-list     : type-qualifier
                        | type-qualifier-list type-qualifier
                        ;
param-type-list         : param-list [ ',' '...' ]
                        ;
param-list              : [ param-list ',' ] param-decl
                        ;
param-decl              : decl-specs [ declarator | abstract-declarator ]
                        ;
id-list                 : [ id-list ',' ] id
                        ;
initializer             : assignment-exp
                        | '{' initializer-list '}'
                        | '{' initializer-list ',' '}'
                        ;
initializer-list        : [ initializer-list ',' ] initializer
                        ;
type-name               : spec-qualifier-list [ abstract-declarator ]
                        ;
abstract-declarator     : pointer [ direct-abstract-declarator ]
                        |           direct-abstract-declarator
                        ;
direct-abstract-declarator: '(' abstract-declarator ')'
                        | [ direct-abstract-declarator ] '[' [ const-exp ] ']'
                        | [ direct-abstract-declarator ] '(' [ param-type-list ] ')'
                        ;
typedef-name            : id
                        ;
stat                    : labeled-stat
                        | exp-stat
                        | compound-stat
                        | selection-stat
                        | iteration-stat
                        | jump-stat
                        ;
labeled-stat            : id ':' stat
                        | 'case' const-exp ':' stat
                        | 'default' ':' stat
                        ;
exp-stat                : [ exp ] ';'
                        ;
compound-stat           : '{' [ decl-list] [ stat-list ] '}'
                        ;
stat-list               : [ stat-list ] stat
                        ;
selection-stat          : 'if' '(' exp ')' stat [ 'else' stat ]
                        | 'switch' '(' exp ')' stat
                        ;
iteration-stat          : 'while' '(' exp ')' stat
                        | 'do' stat 'while' '(' exp ')' ';'
                        | 'for' '(' [ exp ] ';' [ exp ] ';' [ exp ] ')' stat
                        ;
jump-stat               : 'goto' id ';'
                        | 'continue' ';'
                        | 'break' ';'
                        | 'return' exp ';'
                        | 'return'      ';'
                        ;
exp                     : [ exp ',' ] assignment-exp
                        ;
assignment-exp          : conditional-exp
                        | unary-exp assignment-operator assignment-exp
                        ;
assignment-operator     : '=' | '*=' | '/=' | '%=' | '+=' | '-=' | '&lt;&lt;='
                        | '&gt;&gt;=' | '&amp;=' | '^=' | '|='
                        ;
conditional-exp         : logical-or-exp
                        | logical-or-exp '?' exp ':' conditional-exp
                        ;
const-exp               : conditional-exp
                        ;
logical-or-exp          : logical-and-exp
                        | logical-or-exp '||' logical-and-exp
                        ;
logical-and-exp         : inclusive-or-exp
                        | logical-and-exp '&amp;&amp;' inclusive-or-exp
                        ;
inclusive-or-exp        : exclusive-or-exp
                        | inclusive-or-exp '|' exclusive-or-exp
                        ;
exclusive-or-exp        : and-exp
                        | exclusive-or-exp '^' and-exp
                        ;
and-exp                 : equality-exp
                        | and-exp '&amp;' equality-exp
                        ;
equality-exp            : relational-exp
                        | equality-exp '==' relational-exp
                        | equality-exp '!=' relational-exp
                        ;
relational-exp          : shift-expression
                        | relational-exp '&lt;' shift-expression
                        | relational-exp '&gt;' shift-expression
                        | relational-exp '&lt;=' shift-expression
                        | relational-exp '&gt;=' shift-expression
                        ;
shift-expression        : additive-exp
                        | shift-expression '&lt;&lt;' additive-exp
                        | shift-expression '&gt;&gt;' additive-exp
                        ;
additive-exp            : mult-exp
                        | additive-exp '+' mult-exp
                        | additive-exp '-' mult-exp
                        ;
mult-exp                : cast-exp
                        | mult-exp '*' cast-exp
                        | mult-exp '/' cast-exp
                        | mult-exp '%' cast-exp
                        ;
cast-exp                : unary-exp
                        | '(' type-name ')' cast-exp
                        ;
unary-exp               : postfix-exp
                        | '++' unary-exp
                        | '--' unary-exp
                        | unary-operator cast-exp
                        | 'sizeof' unary-exp
                        | 'sizeof' '(' type-name ')'
                        ;
unary-operator          : '&amp;' | '*' | '+' | '-' | '~' | '!'
                        ;
postfix-exp             : primary-exp
                        | postfix-exp '[' exp ']'
                        | postfix-exp '(' argument-exp-list ')'
                        | postfix-exp '('                       ')'
                        | postfix-exp '.' id
                        | postfix-exp '-&gt;' id
                        | postfix-exp '++'
                        | postfix-exp '--'
                        ;
primary-exp             : id
                        | const
                        | string
                        | '(' exp ')'
                        ;
argument-exp-list       : [ argument-exp-list ',' ] assignment-exp
                        ;
const                   : int-const
                        | char-const
                        | float-const
                        | enumeration-const
                        ;</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_vala_syntax_in_ebnf">Vala syntax in EBNF</h3>
<div class="listingblock">
<div class="title">Vala syntax in EBNF.</div>
<div class="content">
<pre><code>input                   : using_directive* namespace_member*
                        ;
using_directive         : "using" symbol [ "," symbol ]* ";"
                        ;
symbol                  : symbol_part [ "." symbol_part ]*
                        ;

symbol_part             : ( "global::" identifier )
                        | identifier
                        ;
namespace_member        : [ attributes ] (   namespace_declaration
                                           | class_declaration
                                           | interface_declaration
                                           | struct_declaration
                                           | enum_declaration
                                           | errordomain_declaration
                                           | method_declaration
                                           | field_declaration
                                           | constant_declaration )
                        ;
attributes              : attribute*
                        ;
attribute               : "[" identifier [ attribute_arguments ] "]"
                        ;
attribute_arguments     : "("       attribute_argument
                              [ "," attribute_argument ]* ")"
                        ;
attribute_argument      : identifier "=" expression
                        ;
expression              : lambda_expression
                        | (   conditional_expression
                            [ assignment_operator expression ] )
                        ;
assignment_operator     : "=" | "+=" | "-=" | "|=" | "&amp;=" | "^=" | "/="
                              | "*=" | "%=" | "&lt;&lt;=" | "&gt;&gt;="
                        ;
conditional_expression  : coalescing_expression
                            [ "?" expression ":" expression ]
                        ;
coalescing_expression   : conditional_or_expression
                            [ "??" coalescing_expression ]
                        ;
conditional_or_expression
                        : conditional_and_expression
                            [ "||" conditional_and_expression ]
                        ;
conditional_and_expression
                        : in_expression
                            [ "&amp;&amp;" in_expression ]
                        ;
in_expression           : inclusive_or_expression
                            [ "in" inclusive_or_expression ]
                        ;
inclusive_or_expression : exclusive_or_expression
                            [ "|" exclusive_or_expression ]
                        ;
exclusive_or_expression : and_expression
                            [ "^" and_expression ]
                        ;
and_expression          : equality_expression
                            [ "&amp;" equality_expression ]
                        ;
equality_expression     : relational_expression
                            [ ( "==" | "!=" ) relational_expression ]*
                        ;
relational_expression   : shift_expression
                            [ ( ( "&lt;" | "&lt;=" | "&gt;" | "&gt;=" ) shift_expression )
                              | ( "is" type )
                              | ( "as" type ) ]*
                        ;
type                    : ( "void" [ "*" ]* )
                        | ( [ "dynamic" ] [ "unowned" ] symbol
                                [ type_arguments ] [ "*" ]* [ "?" ] array_type* )
                        ;
type_weak               : ( "void" [ "*" ]* )
                        | ( [ "dynamic" ] [ "unowned" | "weak" ] symbol
                                [ type_arguments ] [ "*" ]* [ "?" ] array_type* )
                        ;
array_type              : "[" array_size "]" [ "?" ]
                        ;
shift_expression        : additive_expression
                            [ ( "&lt;&lt;" | "&gt;&gt;" ) additive_expression ]*
                        ;
additive_expression     : multiplicative_expression
                            [ ( "+" | "-" ) multiplicative_expression ]*
                        ;
multiplicative_expression
                        : unary_expression
                            [ ( "*" | "/" | "%" ) unary_expression ]*
                        ;
unary_expression        : ( unary_operator unary_expression )
                        | ( "(" ( "owned" | "void" | "dynamic" | "!" | type )
                            ")" unary_expression )
                        | primary_expression
                        ;
unary_operator          : "+" | "-" | "!" | "~" | "++" | "--" | "*" | "&amp;"
                              | "(owned)" | "(void)" | "(dynamic)" | "(!)"
                        ;
primary_expression      : ( literal | initializer | tuple | template
                          | open_regex_literal | this_access | base_access
                          | object_or_array_creation_expression
                          | yield_expression | sizeof_expression
                          | typeof_expression | simple_name )
                                [ member_access | pointer_member_access
                                | method_call | element_access
                                | post_increment_expression
                                | post_decrement_expression ]*
                        ;
literal                 : "true" | "false" | "null" | integer_literal
                        | real_literal | character_literal | regex_literal
                        | string_literal | template_string_literal
                        | verbatim_string_literal
                        ;
initializer             : "{" argument [ "," argument ]* "}"
                        ;
arguments               : argument [ "," argument ]*
                        ;
argument                : "ref" expression
                        | "out" expression
                        |       expression
                        | identifier [ ":" expression ]
                        ;
tuple                   : "(" expression [ "," expression ]* ")"
                        ;
template                : '@"' [ expression "," ]* '"'
                        ;
open_regex_literal      : "/" literal
                        ;
this_access             : "this"
                        ;
base_access             : "base"
                        ;
object_or_array_creation_expression
                        : "new" member
                                ( object_creation_expression
                                | array_creation_expression )
                        ;
object_creation_expression
                        : "(" [ arguments ] ")" [ object_initializer ]
                        ;
object_initializer      : "{"       member_initializer
                              [ "," member_initializer ] "}"

member_initializer      : identifier "=" expression
                        ;
array_creation_expression
                        : [ "[" "]" ]* [ "[" [ array_size ] "]" ]
                                [ initializer ]
                        ;
array_size              : expression [ "," expression ]*
                        ;
member                  : member_part [ "." member_part ]*
                        ;
member_part             : ( "global::" identifier || identifier )
                                [ type_arguments ]
                        ;
type_arguments          : "&lt;" type [ "," type ]* "&gt;"
                        ;
yield_expression        : "yield" [ base_access "." ] member method_call
                        ;
method_call             : "(" [ arguments ] ")" [ object_initializer ]
                        ;
sizeof_expression       : "sizeof" "(" type ")"
                        ;
typeof_expression       : "typeof" "(" type ")"
                        ;
simple_name             : ( "global::" identifier | identifier )
                                [ type_arguments ]
                        ;
lambda_expression       : lambda_expression_params "=&gt;" lambda_expression_body
                        ;
lambda_expression_params: identifier
                        | ( "(" [ identifier [ "," identifier ]* ] ")" )
                        ;
lambda_expression_body  : expression | block
                        ;
member_declaration_modifiers
                        : member_declaration_modifier
                                [ " " member_declaration_modifier ]*
                        ;
member_declaration_modifier
                        : "async" | "class" | "extern" | "inline" | "static"
                                | "abstract" | "virtual" | "override" | "new"
                        ;
constructor_declaration : [ constructor_declaration_modifiers ]
                                "construct" block
                        ;
constructor_declaration_modifiers
                        : constructor_declaration_modifier
                                [ " " constructor_declaration_modifier ]*
                        ;
constructor_declaration_modifier
                        : "async" | "class" | "extern" | "inline" | "static"
                                | "abstract" | "virtual" | "override"
                        ;
destructor_declaration  : [ constructor_declaration_modifiers ]
                                "~" "(" ")" block
                        ;
class_declaration       : [ access_modifier ] [ type_declaration_modifiers ]
                                "class" symbol [ type_arguments ]
                                [ ":" base_types ] "{" class_member* "}"
                        ;
base_types              : type [ "," type ]*
                        ;
class_member            : [ attributes ] ( class_declaration
                                         | struct_declaration
                                         | enum_declaration
                                         | delegate_declaration
                                         | method_declaration
                                         | signal_declaration
                                         | field_declaration
                                         | constant_declaration
                                         | property_declaration
                                         | constructor_declaration
                                         | destructor_declaration )
                        ;
access_modifier         : "private" "protected" "internal" "public"
                        ;
type_declaration_modifiers
                        : type_declaration_modifier
                                [ " " type_declaration_modifier ]*
                        ;
type_declaration_modifier : "abstract" | "extern" | "static"
                        ;
enum_declaration        : [ access_modifier ] [ type_declaration_modifiers ]
                                "enum" symbol "{" enumvalues
                                               [ ";" [ method_declaration
                                                 | constant_declaration ]* ]
                                              "}"
                        ;
enumvalues              : enumvalue [ "," enumvalue ]*
                        ;
enumvalue               : [ attributes ] identifier [ "=" expression ]
                        ;
errordomain_declaration : [ access_modifier ] [ type_declaration_modifiers ]
                                "errordomain" symbol "{" errorcodes
                                                      [ ";" method_declaration* ] "}"
                        ;
errorcodes              : errorcode [ "," errorcode ]*
                        ;
errorcode               : [ attributes ] identifier [ "=" expression ]
                        ;
interface_declaration   : [ access_modifier ] [ type_declaration_modifiers ]
                                "interface" symbol [ type_parameters ]
                                [ ":" base_types ] "{" interface_member* "}"
                        ;
type_parameters         : "&lt;" identifier [ "," identifier ]* "&gt;"
                        ;
interface_member        : [ attributes ] ( class_declaration
                                         | struct_declaration
                                         | enum_declaration
                                         | delegate_declaration
                                         | method_declaration
                                         | signal_declaration
                                         | field_declaration
                                         | constant_declaration
                                         | property_declaration )
                        ;
namespace_declaration   : "namespace" symbol "{"
                                using_directive* namespace_member* "}"
                        ;
struct_declaration      : [ access_modifier ] [ type_declaration_modifiers ]
                                "struct" symbol [ ":" base_types ]
                                        "{" struct_member* "}"
                        ;
struct_member           : [ attributes ] ( method_declaration
                                         | field_declaration
                                         | constant_declaration
                                         | property_declaration )
                        ;
creation_method_declaration
                        : [ access_modifier ] [ constructor_declaration_modifiers ]
                                symbol "(" [ parameters ] ")"
                                        [ throws ] [ requires ] [ ensures ]
                                                ( ";" | block )
                        ;
parameters              : parameter [ "," parameter ]*
                        ;
parameter               : [ attributes ] ( "..."
                                         | ( [ "params" ] [ "out" | "ref" ]
                                                type identifier [ "=" expression ] ) )
                        ;
throws                  : "throws" type [ "," type ]*
                        ;
requires                : "requires" "(" expression ")" [ requires ]
                        ;
ensures                 : "ensures" "(" expression ")" [ ensures ]
                        ;
delegate_declaration    : [ access_modifier ] [ delegate_declaration_modifiers ]
                                type symbol [ type_parameters ]
                                        "(" [ parameters ] ")" [ throws ] ";"
                        ;
delegate_declaration_modifiers
                        : delegate_declaration_modifier
                                [ " " delegate_declaration_modifier ]*
                        ;
delegate_declaration_modifier
                        : "async" | "class" | "extern" | "inline" | "abstract"
                                | "virtual" | "override"
                        ;
signal_declaration      : [ access_modifier ] [ signal_declaration_modifiers ]
                                "signal" type identifier "(" [ parameters ] ")"
                                        ( ";" | block )
                        ;
signal_declaration_modifiers
                        : signal_declaration_modifier
                                [ " " signal_declaration_modifier ]*
                        ;
signal_declaration_modifier
                        : "async" | "extern" | "inline" | "abstract"
                                | "virtual" | "override" | "new"
                        ;
method_declaration      : [ access_modifier ] [ member_declaration_modifier ]
                                type identifier [ type_parameters ]
                                        "(" [ parameters ] ")"
                                [ throws ] [ requires ] [ ensures ] ( ";" | block )
                        ;
constant_declaration    : [ access_modifier ] [ member_declaration_modifiers ]
                                "const" type identifier [ inline_array_type ]
                                        [ "=" expression ] ";"
                        ;
inline_array_type       : "[" integer_literal "]"
                        ;
field_declaration       : [ access_modifier ] [ member_declaration_modifiers ]
                                type_weak identifier [ "=" expression ] ";"
                        ;
property_declaration    : [ access_modifier ] [ property_declaration_modifiers ]
                                type_weak identifier
                                        "{" property_declaration_part* "}"
                        ;
property_declaration_part
                        : ( "default" "=" expression ";" )
                        | property_accessor
                        ;
property_accessor       : [ attributes ] [ access_modifier ]
                                ( property_get_accessor
                                | property_set_construct_accessor )
                        ;
property_get_accessor   : "get" ( ";" | block )
                        ;
property_set_construct_accessor
                        : ( "set" "construct" | "construct" "set" )
                                ( ";" | block )
                        ;
property_declaration_modifiers
                        : property_declaration_modifier
                                [ " " property_declaration_modifier ]*
                        ;
property_declaration_modifier
                        : "class" | "static" | "extern" | "inline" | "abstract"
                                | "virtual" | "override" | "new"
                        ;
statement               : local_variable_declarations
                        | embedded_statement
                        ;
embedded_statement      : block
                        | embedded_statement_without_block
                        ;
block                   : "{" statement* "}"
                        ;
embedded_statement_without_block
                        : ";"
                        | if_statement
                        | switch_statement
                        | while_statement
                        | for_statement
                        | foreach_statement
                        | break_statement
                        | continue_statement
                        | return_statement
                        | yield_statement
                        | throw_statement
                        | try_statement
                        | lock_statement
                        | delete_statement
                        | expression_statement
                        ;
if_statement            : "if" "(" expression ")" embedded_statement
                                [ "else" embedded_statement ]
                        ;
switch_statement        : "switch" "(" expression ")" "{" switch_section* "}"
                        ;
switch_section          : ( "case" | "default" ) expression ":"
                        ;
while_statement         : "while" "(" expression ")"
                                embedded_statement
                        ;
do_statement            : "do" embedded_statement
                          "while" "(" expression ")" ";"
                        ;
for_statement           : "for" "(" [ for_initializer ] ";"
                                        [ expression ] ";" [ for_iterator ] ")"
                                embedded_statement
                        ;
for_initializer         : local_variable_declarations
                        | ( statement_expression [ "," statement_expression ]* )
                        ;
for_iterator            : statement_expression [ "," statement_expression ]*
                        ;
statement_expression    : expression
                        ;
foreach_statement       : "foreach" "(" ( "var" | type) identifier
                                        "in" expression ")"
                                embedded_statement
                        ;
break_statement         : "break" ";"
                        ;
continue_statement      : "continue" ";"
                        ;
return_statement        : "return" [ expression ] ";"
                        ;
yield_statement         : "yield" [ expression_statement | "return" expression ] ";"
                        ;
throw_statement         : "throw" expression ";"
                        ;
try_statement           : "try" block catch_clause* [ finally_clause ]
                        ;
catch_clause            : "catch" [ "(" type_weak identifier ")" ] block
                        ;
finally_clause          : "finally" block
                        ;
lock_statement          : "lock" "(" expression ")" embedded_statement
                        ;
delete_statement        : "delete" expression ";"
                        ;
local_variable_declarations
                        : ( "var" | type ) local_variable_declaration
                                [ "," local_variable_declaration ]*
                        ;
local_variable_declartion
                        : local_tuple_declaration
                        | local_variable
                        ;
local_tuple_declaration : "(" identifier [ "," identifier ]* ")" "=" expression
                        ;
local_variable          : identifier [ inline_array_type ] [ "=" expression ]
                        ;
expression_statement    : statement_expression ";"</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_python_syntax_in_ebnf">Python syntax in EBNF</h3>
<div class="listingblock">
<div class="title">Python3 syntax in EBNF.</div>
<div class="content">
<pre><code>single_input            : NEWLINE
                        | simple_stmt
                        | compound_stmt NEWLINE
                        ;
file_input              : (NEWLINE | stmt)* ENDMARKER
                        ;
eval_input              : testlist NEWLINE* ENDMARKER
                        ;
decorator               : '@' dotted_name [ '(' [arglist] ')' ] NEWLINE
                        ;
decorators              : decorator+
                        ;
decorated               : decorators (classdef | funcdef)
                        ;
funcdef                 : 'def' NAME parameters ['-&gt;' test] ':' suite
                        ;
parameters              : '(' [typedargslist] ')'
                        ;
typedargslist           : (tfpdef ['=' test]
                        (',' tfpdef ['=' test])*
                        [',' ['*' [tfpdef]
                        (',' tfpdef ['=' test])*
                        [',' '**' tfpdef]
                        | '**' tfpdef]]
                        |  '*' [tfpdef]
                        (',' tfpdef ['=' test])*
                        [',' '**' tfpdef]
                        | '**' tfpdef)
                        ;
tfpdef                  : NAME [':' test]
varargslist             : (vfpdef ['=' test]
                        (',' vfpdef ['=' test])*
                        [',' ['*' [vfpdef]
                        (',' vfpdef ['=' test])*
                        [',' '**' vfpdef]
                        | '**' vfpdef]]
                        |  '*' [vfpdef]
                        (',' vfpdef ['=' test])*
                        [',' '**' vfpdef]
                        | '**' vfpdef)
                        ;
vfpdef                  : NAME
                        ;
stmt                    : simple_stmt
                        | compound_stmt
                        ;
simple_stmt             : small_stmt (';' small_stmt)* [';'] NEWLINE
                        ;
small_stmt              : (expr_stmt
                        | del_stmt
                        | pass_stmt
                        | flow_stmt
                        | import_stmt
                        | global_stmt
                        | nonlocal_stmt
                        | assert_stmt)
                        ;
expr_stmt               : testlist_star_expr
                        (augassign (yield_expr|testlist)
                        | ('=' (yield_expr|testlist_star_expr))*)
                        ;
testlist_star_expr      : (test|star_expr) (',' (test|star_expr))* [',']
                        ;
augassign               : ('+=' | '-=' | '*=' | '/=' | '%=' | '&amp;=' | '|='
                        | '^=' | '&lt;&lt;=' | '&gt;&gt;=' | '**=' | '//=')
                        ;

# For normal assignments, additional restrictions enforced by the interpreter

del_stmt                : 'del' exprlist
                        ;
pass_stmt               : 'pass'
                        ;
flow_stmt               : break_stmt
                        | continue_stmt
                        | return_stmt
                        | raise_stmt
                        | yield_stmt
                        ;
break_stmt              : 'break'
                        ;
continue_stmt           : 'continue'
                        ;
return_stmt             : 'return' [testlist]
                        ;
yield_stmt              : yield_expr
                        ;
raise_stmt              : 'raise' [test ['from' test]]
                        ;
import_stmt             : import_name
                        | import_from
                        ;
import_name             : 'import' dotted_as_names
                        ;

# note below: the ('.' | '...') is necessary because '...' is tokenized as ELLIPSIS
import_from             : ('from' (('.'
                                  | '...')* dotted_name
                                  | ('.'
                                    | '...')+)
                                        'import' ('*'
                                                 | '(' import_as_names ')'
                                                 | import_as_names))
                        ;
import_as_name          : NAME ['as' NAME]
                        ;
dotted_as_name          : dotted_name ['as' NAME]
                        ;
import_as_names         : import_as_name (',' import_as_name)* [',']
                        ;
dotted_as_names         : dotted_as_name (',' dotted_as_name)*
                        ;
dotted_name             : NAME ('.' NAME)*
                        ;
global_stmt             : 'global' NAME (',' NAME)*
                        ;
nonlocal_stmt           : 'nonlocal' NAME (',' NAME)*
                        ;
assert_stmt             : 'assert' test [',' test]
                        ;
compound_stmt           : if_stmt | while_stmt | for_stmt | try_stmt
                        | with_stmt | funcdef | classdef | decorated
                        ;
if_stmt                 : 'if' test ':'
                                suite
                        ('elif' test ':'
                                suite)*
                        ['else' ':'
                                suite]
                        ;
while_stmt              : 'while' test ':'
                                suite
                        ['else' ':'
                                suite]
                        ;
for_stmt                : 'for' exprlist 'in' testlist ':'
                                suite
                        ['else' ':'
                                suite]
                        ;
try_stmt                : ('try' ':'
                                suite
                        ((except_clause ':'
                                suite)+
                        ['else' ':'
                                suite]
                        ['finally' ':'
                                suite]
                        | 'finally' ':'
                                suite))
                        ;
with_stmt               : 'with' with_item (',' with_item)*  ':'
                                suite
                        ;
with_item               : test ['as' expr]
                        ;

# NB compile.c makes sure that the default except clause is last
except_clause           : 'except' [test ['as' NAME]]
                        ;
suite                   : simple_stmt
                        | NEWLINE
                                INDENT
                                stmt+
                                DEDENT
                        ;
test                    : or_test ['if' or_test 'else' test]
                        | lambdef
                        ;
test_nocond             : or_test
                        | lambdef_nocond
                        ;
lambdef                 : 'lambda' [varargslist] ':' test
lambdef_nocond          : 'lambda' [varargslist] ':' test_nocond
or_test                 : and_test ('or' and_test)*
and_test                : not_test ('and' not_test)*
not_test                : 'not' not_test | comparison
comparison              : expr (comp_op expr)*

# &lt;&gt; isn't actually a valid comparison operator in Python. It's here for the
# sake of a __future__ import described in PEP 401
comp_op                 : '&lt;'|'&gt;'|'=='|'&gt;='|'&lt;='|'&lt;&gt;'|'!='|'in'
                        |'not' 'in'|'is'|'is' 'not'
                        ;
star_expr               : '*' expr
                        ;
expr                    : xor_expr ('|' xor_expr)*
                        ;
xor_expr                : and_expr ('^' and_expr)*
                        ;
and_expr                : shift_expr ('&amp;' shift_expr)*
                        ;
shift_expr              : arith_expr (('&lt;&lt;'|'&gt;&gt;') arith_expr)*
                        ;
arith_expr              : term (('+'|'-') term)*
                        ;
term                    : factor (('*'|'/'|'%'|'//') factor)*
                        ;
factor                  : ('+'|'-'|'~') factor | power
                        ;
power                   : atom trailer* ['**' factor]
                        ;
atom                    : ('(' [yield_expr|testlist_comp] ')'
                        | '[' [testlist_comp] ']'
                        | '{' [dictorsetmaker] '}'
                        | NAME | NUMBER | STRING+
                        | '...' | 'None' | 'True' | 'False')
                        ;
testlist_comp           : (test|star_expr) ( comp_for
                                           | (',' (test|star_expr))* [','] )
                        ;
trailer                 : '(' [arglist] ')'
                        | '[' subscriptlist ']'
                        | '.' NAME
                        ;
subscriptlist           : subscript (',' subscript)* [',']
subscript               : test
                        | [test] ':' [test] [sliceop]
                        ;
sliceop                 : ':' [test]
                        ;
exprlist                : (expr|star_expr) (',' (expr|star_expr))* [',']
                        ;
testlist                : test (',' test)* [',']
                        ;
dictorsetmaker          : ( (test ':' test (comp_for
                                           | (',' test ':' test)* [',']))
                          | (test (comp_for | (',' test)* [','])) )
                        ;
classdef                : 'class' NAME ['(' [arglist] ')'] ':'
                                suite
                        ;
arglist                 : (argument ',')* (argument [',']
                          |'*' test (',' argument)* [',' '**' test]
                          |'**' test)
                        ;

# The reason that keywords are test nodes instead of NAME is that using NAME
# results in an ambiguity. ast.c makes sure it's a NAME.
argument                : test [comp_for]
                        | test '=' test  # Really [keyword '='] test
                        ;
comp_iter               : comp_for
                        | comp_if
                        ;
comp_for                : 'for' exprlist 'in' or_test [comp_iter]
                        ;
comp_if                 : 'if' test_nocond [comp_iter]
                        ;

# not used in grammar, but may appear in "node" passed from Parser to Compiler
encoding_decl           : NAME
                        ;
yield_expr              : 'yield' [yield_arg]
                        ;
yield_arg               : 'from' test
                        | testlist
                        ;</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lua_syntax_in_ebnf">Lua syntax in EBNF</h3>
<div class="listingblock">
<div class="title">Lua syntax in EBNF.</div>
<div class="content">
<pre><code>chunk                   : block
                        ;
block                   : {stat} [retstat]
                        ;
stat                    : ';'
                        | varlist '=' explist
                        | functioncall
                        | label
                        | 'break'
                        | 'goto' Name
                        | 'do' block 'end'
                        | 'while' exp 'do' block 'end'
                        | 'repeat' block 'until' exp
                        | 'if' exp 'then' block
                                {'elseif' exp 'then' block}
                                ['else' block] 'end'
                        | 'for' Name '=' exp ',' exp [',' exp] 'do' block 'end'
                        | 'for' namelist 'in' explist 'do' block 'end'
                        | 'function' funcname funcbody
                        | 'local' 'function' Name funcbody
                        | 'local' namelist ['=' explist]
                        ;
retstat                 : return [explist] [';']
                        ;
label                   : '::' Name '::'
                        ;
funcname                : Name {'.' Name} [':' Name]
                        ;
varlist                 : var {',' var}
                        ;
var                     : Name | prefixexp '[' exp ']' | prefixexp '.' Name
                        ;
namelist                : Name {',' Name}
                        ;
explist                 : exp {',' exp}
                        ;
exp                     : 'nil' | 'false' | 'true' | Number | String | '...'
                        | functiondef | prefixexp | tableconstructor | exp binop exp
                        | unop exp
                        ;
prefixexp               : var | functioncall | '(' exp ')'
                        ;
functioncall            : prefixexp args | prefixexp ':' Name args
                        ;
args                    : '(' [explist] ')' | tableconstructor | String
                        ;
functiondef             : function funcbody
                        ;
funcbody                : '(' [parlist] ')' block 'end'
                        ;
parlist                 : namelist [',' '...'] | '...'
                        ;
tableconstructor        : '{' [fieldlist] '}'
                        ;
fieldlist               : field {fieldsep field} [fieldsep]
                        ;
field                   : '[' exp ']' '=' exp | Name '=' exp | exp
                        ;
fieldsep                : ',' | ';'
                        ;
binop                   : '+' | '-' | '*' | '/' | '^' | '%' | '..'
                                | '&lt;' | '&lt;=' | '&gt;' | '&gt;=' | '=='
                                | '~=' | 'and' | 'or'
                        ;
unop                    : '-' | 'not' | '#'</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Lua honors usual operator precidences.  (Above ENBF is simplified one.)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_javascript_syntax_in_ebnf">JavaScript syntax in EBNF</h3>
<div class="listingblock">
<div class="title">JavaScript syntax in EBNF.</div>
<div class="content">
<pre><code>Program : Element*
        ;
Element : "function" Identifier "(" ParameterList* ")" CompoundStatement
        | Statement
        ;
ParameterList
        : Identifier
        | Identifier "," ParameterList
        ;
CompoundStatement
        : "{" Statement* "}"
        ;
Statement
        : ";"
        | "if" "(" Expression ")" Statement
        | "if" "(" Expression ")" Statement "else" Statement
        | "while" "(" Expression ")" Statement
        | "for" "(" ";" ExpressionOpt ";" ExpressionOpt ")" Statement
        | "for" "(" VariablesOrExpression ";" ExpressionOpt ";"
                        ExpressionOpt ")" Statement
        | "for" "(" VariablesOrExpression "in" Expression ")" Statement
        | "break" ";"
        | "continue" ";"
        | "with" "(" Expression ")" Statement
        | "return" ExpressionOpt ";"
        | CompoundStatement
        | VariablesOrExpression ";"
        ;
VariablesOrExpression
        : "var" Variables
        | Expression
        ;
Variables
        : Variable
        | Variable "," Variables
        ;
Variable: Identifier
        | Identifier "=" AssignmentExpression
        ;
ExpressionOpt
        : empty
        | Expression
        ;
Expression
        : AssignmentExpression
        | AssignmentExpression "," Expression
        ;
AssignmentExpression
        : ConditionalExpression
        | ConditionalExpression AssignmentOperator AssignmentExpression
        ;
ConditionalExpression
        : OrExpression
        | OrExpression "?" AssignmentExpression ":" AssignmentExpression
        ;
OrExpression
        : AndExpression
        | AndExpression "||" OrExpression
        ;
AndExpression
        : BitwiseOrExpression
        | BitwiseOrExpression "&amp;&amp;" AndExpression
        ;
BitwiseOrExpression
        : BitwiseXorExpression
        | BitwiseXorExpression "|" BitwiseOrExpression
        ;
BitwiseXorExpression
        : BitwiseAndExpression
        | BitwiseAndExpression "^" BitwiseXorExpression
        ;
BitwiseAndExpression
        : EqualityExpression
        | EqualityExpression "&amp;" BitwiseAndExpression
        ;
EqualityExpression
        : RelationalExpression
        | RelationalExpression EqualityualityOperator EqualityExpression
        ;
RelationalExpression
        : ShiftExpression
        | RelationalExpression RelationalationalOperator ShiftExpression
        ;
ShiftExpression
        : AdditiveExpression
        | AdditiveExpression ShiftOperator ShiftExpression
        ;
AdditiveExpression
        : MultiplicativeExpression
        | MultiplicativeExpression "+" AdditiveExpression
        | MultiplicativeExpression "-" AdditiveExpression
        ;
MultiplicativeExpression
        : UnaryExpression
        | UnaryExpression MultiplicativeOperator MultiplicativeExpression
        ;
UnaryExpression
        : MemberExpression
        | UnaryOperator UnaryExpression
        | "-" UnaryExpression
        | IncrementOperator MemberExpression
        | MemberExpression IncrementOperator
        | "new" Constructor
        | "delete" MemberExpression
        ;
Constructor
        : "this" "." ConstructorCall
        | ConstructorCall
        ;
ConstructorCall
        : Identifier
        | Identifier "(" ArgumentListOpt ")"
        | Identifier "." ConstructorCall
        ;
MemberExpression
        : PrimaryExpression
        | PrimaryExpression "." MemberExpression
        | PrimaryExpression "[" Expression "]"
        | PrimaryExpression "(" ArgumentListOpt ")"
        ;
ArgumentListOpt
        : empty
        | ArgumentList
        ;
ArgumentList
        : AssignmentExpression
        | AssignmentExpression "," ArgumentList
        ;
PrimaryExpression
        : "(" Expression ")"
        | Identifier
        | IntegerLiteral
        | FloatingPointLiteral
        | StringLiteral
        | "false"
        | "true"
        | "null"
        | "this"
        ;</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_sql_syntax_in_ebnf">SQL syntax in EBNF</h3>
<div class="listingblock">
<div class="title">SQL(SQLite) syntax in EBNF.</div>
<div class="content">
<pre><code>sql-stmt-list:
        [ sql-stmt # ";" ]*
        ;
sql-stmt:
        [ "EXPLAIN" [ "QUERY" "PLAN" ] ]
        ( *-stmt )
        ;
alter-table-stmt: /* *-stmt */
        "ALTER" "TABLE" [ database-name "." ] table-name
        ( "RENAME" "TO" new-table-name
        | "ADD" [ "COLUMN" ] column-def
        )
        ;
analyze-stmt: /* *-stmt */
        "ANALYZE"
        [ database-name
        | tabale-or-index-name
        | databas-name "." table-or-index-name
        ]
        ;
attach-stmt: /* *-stmt */
        "ATTACH" [ "DATABASE" ] expr "AS" database-name
        ;
begin-stmt: /* *-stmt */
        "BEGIN" [ "DEFERED" | "IMMEDIATE" | "EXCLUSIVE" ] [ "TRANSACTION" ]
        ;
commit-stmt: /* *-stmt */
        ( "COMMIT" | "END" ) [ "TRANSACTION" ]
        ;
rollback-stmt: /* *-stmt */
        "ROLLBACK" [ "TRANSACTION" ]
        [ "TO" [ "SAVEPOINT" ] savepoint-name ]
        ;
savepoint-stmt: /* *-stmt */
        "SAVEPOINT" savepoint-name
        ;
release-stmt: /* *-stmt */
        "RELEASE" [ "SAVEPOINT"  ] savepoint-name
        ;
create-index-stmt: /* *-stmt */
        "CREATE" [ "UNIQUE" ] "INDEX" [ "IF" "NOT" "EXISTS" ]
        [ database-name "." index-name ] "ON" table-name
        "(" ( index-column # "," )+ ")"
        ;
indexed-column:
        column-name [ "COLLATE" collation-name ]
        [ "ASC" | "DESC" ]
        ;
create-table-stmt: /* *-stmt */
        "CREATE" [ "TEMP" | "TEMPORARY" ] "TABLE"
        [ "IF" "NOT" "EXISTS" ]
        [ database-name "." ] table-name
        ( "(" ( column-def # "," )+ [ "," table-constant ]* ")"
        | "AS" select-stmt
        )
        ;
column-def:
        column-name [ type-name ] [ column-constraint ]*
        ;
column-constraint:
        [ "CONSTRAINT" name ]
        ( "PRIMARY" "KEY" [ "ASC" | "DESC" ] conflict-clause
                [ "AUTOINCREMENT" ]
        | "NOT" "NULL" conflict-clause
        | "UNIQUE" conflict-clause
        | "CHECK" "(" expr ")"
        | "COLLATE" collation-name
        | foreign-key-clause
        )
        ;
signed-number:
        [ "+" | "-" ] numeric-literal
        ;
table-constraint:
        [ "CONSTRAINT" name ]
        ( ( "PRIMARY" "KEY" | "UNIQUE" )
                "(" ( index-column # "," )+ ")" conflict-clause
        | "CHECK" "(" expr ")"
        | "FOREIGN" "KEY"
                "(" ( column-name # "," )+ ")" foreign-key-clause
        )
        ;
foreign-key-clause:
        "REFERENCES" foreign-table
        [ "(" ( column-name # "," )+ ")"
        [ "ON" ( "DELETE" | "UPDATE" )
                ( "SET" "NULL"
                | "SET" "DEFAULT"
                | "CASCADE"
                | "RESTRICT"
                | "NO" "ACTION"
                )
        | "MATCH" name
        ]*
        [ [ "NOT" ] "DEFERRABLE"
                [ "INITIALLY" ( "DIFERRED" | "IMMEDIATE" ) ]
        ]
        ;
conflict-clause:
        [ "ON" "CONFLICT"
                ( "ROLLBACK | "ABORT" | "FAIL" | "IGNORE"
                        | "REPLACE" )
        ]
        ;
create-trigger-stmt: /* *-stmt */
        "CREATE" [ "TEMP" | "TEMPORARY" ] "TRIGGER"
        [ "IF" "NOT" "EXISTS" ]
        [ database-name "." ] table-name
        [ "BEFORE" | "AFTER" | "INSTEAD" "OF" ]
        ( "DELETE"
        | "INSERT"
        | "UPDATE" [ "OF" ( column-name # "," )+
        )
        "ON" table-name [ "FOR" "EACH" "ROW" ] [ "WHEN" expr ]
        "BEGIN"
        ( ( update-stmt | insert-stmt | delete-stmt | select-stmt ) ";" )+
        "END"
        ;
create-view-stmt: /* *-stmt */
        "CREATE" [ "TEMP" | "TEMPORARY" ] "VIEW"
        [ "IF" "NOT" "EXISTS" ]
        [ database-name "." ] view-name
        "AS"  select-stmt
        ;
create-virtual-table-stmt: /* *-stmt */
        "CREATE" "VIRTUAL" "TABLE"
        [ "IF" "NOT" "EXISTS" ]
        [ database-name "." ] tablename
        "USING"  module-stmt [ "(" ( module-argument # "," )+ ")" ]
        ;
delete-stmt: /* *-stmt */
        "DELETE" "FROM" qualified-table-name
        [ "WHERE" expr ]
        ;
delete-stmt-limited: /* *-stmt */
        delete-stmt
        [ "ORDER" "BY" ( ordering-term # "," )+
                "LIMIT" expr [ ( "OFFSET | "," ) expr ]
        ]
        ;
detach-stmt: /* *-stmt */
        "DETACH" [ "DATABASE" ] database-name
        ;
drop-index-stmt: /* *-stmt */
        "DROP" "INDEX" [ "IF" "EXISTS" ]
                [ database-name "." ] index-name
        ;
drop-table-stmt: /* *-stmt */
        "DROP" "TABLE" [ "IF" "EXISTS" ]
                [ database-name "." ] table-name
        ;
drop-trigger-stmt: /* *-stmt */
        "DROP" "TRIGGER" [ "IF" "EXISTS" ]
                [ database-name "." ] trigger-name
        ;
drop-view-stmt: /* *-stmt */
        "DROP" "VIEW" [ "IF" "EXISTS" ]
                [ database-name "." ] view-name
        ;
expr:   ( literal-value
        | bind-parameter
        | [ [ database-name "." ] table-name "." ] column-name
        | unary-operator expr
        | expr binary-operator expr
        | function-name "(" [ [ "DISTINCT" ] expr [ "," expr ]* | "*" ] ")"
        | "(" expr ")"
        | "CAST" "(" expr as type-name ")"
        | expr "COLLATE" collation-name
        | expr [ "NOT" ] ( "LIKE"
                         | "GLOB"
                         | "REGEXP"
                         | "MATCH"
                         )              expr [ "ESCAPE" expr ]
        | expr ( "ISNULL" | "NOTNULL" | "NOT" "NULL" )
        | expr "IS" [ "NOT" ] expr
        | expr "IS" [ "NOT" ] "BETWEEN" expr "AND" expr
        | expr "IS" [ "NOT" ] "IN" ( "(" [ select-stmt | ( expr # "," )+ ] ")"
                                   | [ database-name "." ] table-name
                                   )
        | [ [ "NOT" ] "EXISTS" ] "(" select-stmt ")"
        | "CASE" [ expr ] ( "WHEN" expr "THEN" expr )+ [ "ELSE" expr ] "END"
        | raise-function
        )
        ;
raise-function:
        "RAISE" "(" ( "IGNORE"
                    | ( "ROLLBACK" | "ABORT" | "FAIL" ) "," error-message
                    )                                                      ")"
        ;
literal-value:
        ( numeric-literal
        | string-literal
        | blob-literal
        | "NULL"
        | "CURRENT_TIME"
        | "CURRENT_DATE"
        | "CUTTENT_TIMESTAMP"
        )
        ;
numeric-literal:
        ( ( digit )+ [ decimal-point [ digit ]* ]
        | decimal-point [ digit ]*
        ) [ "E" [ "+" | "-" ] ( digit )+ ]
        ;
insert-stmt: /* *-stmt */
        ( "INSERT" [ "OR" ( "ROLLBACK" | "ABORT" | "REPLACE" | "FAIL" | "IGNORE" ) ]
        | "REPLACE"
        ) "INTO" [ database-name "." ] table-name
                ( [ "(" ( column-name # "," )+ ")" ]
                        ( "VALUES" ( "(" ( expr # "," )+ ")" # "," )+
                        | select-stmt
                        )
                | "DEFAULT" "VALUES"
                )
        ;
pragma-stmt: /* *-stmt */
        "PRAGMA" [ database-name "." ] pragma-name [ "=" pragma-value
                                                   | "(" pragma-value ")"
                                                   ]
        ;
pragma-value:
        ( signed-number | name | string-literal )
        ;
reindex-stmt: /* *-stmt */
        "REINDEX" [ collation-name
                  | [ database-name "." ] ( table-name | index-name )
                  ]
        ;
select-stmt: /* *-stmt */
        ( select-core # compound-operator )+
        [ "ORDER" "BY" ( ordering-term # "," )+ ]
        [ "LIMIT" expr [ [ "OFFSET" | "," ] expr ]
        ;
select-core:
        "SELECT" [ "DISTINCT" | "ALL" ] ( result-column # "," )+
        [ "FROM" join-source ]
        [ "WHERE" expr ]
        [ "GROUP" "BY" ( expr # "," )+ [ "HAVING" expr ] ]
        ;
result-column:
        ( "*"
        | table-name "." "*"
        | expr [ [ "AS" ] column-alias ]
        )
        ;
join-source:
        single-source [ join-op single-source join-constraint ]*
        ;
single-source
        ( [ database-name "." ] table-name [ [ "AS" ] table-alias ]
                [ "INDEXED" "BY" index-name
                | "NOT" "INDEXED"
                ]
        | "(" select-stmt ")" [ [ "AS" ] table-alias ]
        | "(" join-stmt ")"
        )
        ;
join-op:
        ( "," | [ "NATURAL" ] [ "LEFT" [ "OUTER" ]
                              | "INNER"
                              | "CROSS"
                              ]                     "JOIN" ] )
        ;
join-constraint:
        [ "ON" expr
        | "USING" "(" ( column-name # "," )+
        ]
        ;
ordering-term:
        expr [ "COLLATE" collation-name ] [ "ASC" | "DESC" ]
        ;
compound-operator:
        ( "UNION" [ "ALL" ]
        | "INTERSECT"
        | "EXCEPT"
        )
        ;
update-stmt: /* *-stmt */
        "UPDATE" [ "OR" [ "ROLLBACK"
                        | "ABORT"
                        | "REPLACE"
                        | "FAIL"
                        | "IGNORE"
                        ]               ] qualified-table-name
        "SET" ( column-name "=" expr # "," )+ [ "WHERE" expr ]
        ;
update-stmt-limited: /* *-stmt */
        update-stmt
        [ [ "ORDER" "BY" ( ordering-term # "," )+ ]
                "LIMIT" expr [ ( "OFFSET" | "," ) expr ] ]
        ;
qualified-table-name:
        [ database-name "." ] table-name
                [ "INDEXED" "BY" index-name
                | "NOT" "INDEXED"
                ]
        ;
vacuum-stmt: /* *-stmt */
        "VACUUM"
        ;
comment-syntax:
        ( "--" [ anything-except-newline ]* ( newline | end-of-input )
        | "/*" [ anything-except-*/ ]* ( "*/" | end-of-input )
        )
        ;</code></pre>
</div></div>
<div class="paragraph"><p>Here for SQLite synatx, I use my variant of ENBF style for simplicity and
readability:</p></div>
<div class="ulist"><ul>
<li>
<p>
"<code>foo*</code>" : zero or more repeats of "foo"
</p>
</li>
<li>
<p>
"<code>foo+</code>" : one or more repeats of "foo"
</p>
</li>
<li>
<p>
"<code>[ foo | bar ]</code>" : zero or one of "foo" or "bar" but not both.
</p>
</li>
<li>
<p>
"<code>( foo | bar )</code>" : one of "foo" or "bar" but not both.
</p>
</li>
<li>
<p>
"<code>[ foo | bar ]*</code>" : zero or more repeats of "foo" or "bar"
</p>
</li>
<li>
<p>
"<code>( foo | bar )+</code>" : one or more repeats of "foo" or "bar"
</p>
</li>
<li>
<p>
"<code>[ foo # "," ]*</code>" : zero or more repeats of "foo" separated with ","
</p>
</li>
<li>
<p>
"<code>( foo # "," )+</code>" : one or more repeats of "foo" separated with ","
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2015-08-20 23:21:27 JST
</div>
</div>
</body>
</html>
